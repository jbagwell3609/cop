!function($){"use strict";Window=function(options){options=options||{};var defaults={selectors:{handle:".window-header",title:".window-title",body:".window-body",footer:".window-footer"},elements:{handle:null,title:null,body:null,footer:null},references:{body:$("body"),window:$(window)},effect:"fade",parseHandleForTitle:!0,maximized:!1,maximizable:!1,title:"No Title",bodyContent:"",footerContent:"",closeCallback:null};return this.options=$.extend(!0,{},defaults,options),this.initialize(this.options),this},Window.prototype.initialize=function(options){if(options.fromElement)options.fromElement instanceof jQuery?this.$el=options.clone?options.fromElement.clone():options.fromElement:(options.fromElement instanceof Element||options.fromElement,this.$el=options.clone?$(options.fromElement).clone():$(options.fromElement));else{if(!options.template)throw new Error("No template specified for window.");this.$el=$(options.template)}this.$el.find(options.selectors.handle).length<=0&&this.$el.prepend('<div class="window-header"><h4 class="window-title"></h4></div>'),options.elements.zIndex?this.$el.css("zIndex",options.elements.zIndex):this.$el.css("zIndex",900),options.elements.handle=this.$el.find(options.selectors.handle),options.elements.title=this.$el.find(options.selectors.title),options.elements.body=this.$el.find(options.selectors.body),options.elements.footer=this.$el.find(options.selectors.footer),options.elements.title.html(options.title),options.maximizable&&(options.elements.buttons={},options.elements.buttons.maximize=$('<button data-maximize="window"><i class="glyphicon glyphicon-chevron-up"></i></button>'),options.elements.handle.prepend(options.elements.buttons.maximize),options.elements.buttons.restore=$('<button data-restore="window"><i class="glyphicon glyphicon-modal-window"></i></button>'),options.elements.handle.prepend(options.elements.buttons.restore)),this.$el.find("[data-dismiss=window]").length<=0&&options.elements.handle.append('<button type="button" class="close" data-dismiss="window" aria-hidden="false">&times;</button>'),options.elements.body.html(options.bodyContent),this.undock(),this.setSticky(options.sticky)},Window.prototype.undock=function(){var _this=this;this.$el.css("visibility","hidden"),this.$el.appendTo("body"),this.centerWindow(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&this.options.references.window.bind("orientationchange resize",function(event){_this.centerWindow()}),this.$el.on("touchmove",function(e){e.stopPropagation()}),this.initHandlers(),this.$el.hide(),this.options.id?this.id=this.options.id:this.id="",this.show()},Window.prototype.maximize=function(){this.$el.removeClass("minimized"),this.$el.addClass("maximized"),this.state="maximized";var bottomOffset=0;this.options.window_manager&&(bottomOffset=this.options.window_manager.getContainer().height()),this.$el.css({top:parseInt($("body").css("paddingTop"),10),left:0,right:0,bottom:bottomOffset,maxWidth:"none",width:"auto",height:"auto"}),this.$el.trigger("bsw.maximize")},Window.prototype.restore=function(){this.$el.removeClass("minimized"),this.$el.removeClass("maximized"),this.$el.removeAttr("style"),this.state=void 0,this.$el.css({top:this.window_info.top,left:this.window_info.left,width:this.window_info.width,height:this.window_info.height}),this.$el.removeProp("style"),this.$el.trigger("bsw.restore")},Window.prototype.show=function(cb){var _this=this;this.$el.css("visibility","visible");function callbackHandler(){_this.$el.trigger("bsw.show"),cb&&cb.call(_this,arguments)}"fade"===this.options.effect?this.$el.fadeIn(void 0,void 0,callbackHandler):(this.$el.show(),callbackHandler.call(this.$el))},Window.prototype.setEffect=function(effect){this.options.effect=effect},Window.prototype.getEffect=function(){return this.options.effect},Window.prototype.centerWindow=function(){var top,left,maxHeight,bodyTop=parseInt(this.options.references.body.position().top,10)+parseInt(this.options.references.body.css("paddingTop"),10);left=this.options.references.window.width()/2-this.$el.width()/2,(top=window.innerHeight/2-this.$el.height()/2)<bodyTop&&(top=bodyTop),maxHeight=window.innerHeight-bodyTop-(parseInt(this.options.elements.handle.css("height"),10)+parseInt(this.options.elements.footer.css("height"),10))-45,this.options.elements.body.css("maxHeight",maxHeight),this.$el.css("left",left),this.$el.css("top",top),this.$el&&0<this.$el.length&&(this.window_info={top:this.$el.position().top,left:this.$el.position().left,width:this.$el.outerWidth(),height:this.$el.outerHeight()}),this.$el.trigger("bsw.centerWindow")},Window.prototype.close=function(cb){var _this=this;this.options.parent?(this.options.parent.clearBlocker(),this.options.window_manager&&this.options.window_manager.setFocused(this.options.parent)):this.options.window_manager&&0<this.options.window_manager.windows.length&&this.options.window_manager.setNextFocused();function closeFn(){_this.$el.trigger("bsw.close"),_this.$el.remove(),_this.options.closeCallback&&_this.options.closeCallback(),cb&&cb.call(_this)}"fade"===this.options.effect?this.$el.fadeOut(closeFn):closeFn.call(_this.$el),this.$windowTab&&("fade"===this.options.effect?this.$windowTab.fadeOut(400,function(){_this.$windowTab.remove()}):(this.$windowTab.hide(),this.$windowTab.remove()))},Window.prototype.on=function(){this.$el.on.apply(this.$el,arguments)},Window.prototype.sendToBack=function(){var returnVal=!1;return this.options.window_manager&&(returnVal=this.options.window_manager.sendToBack(this)),returnVal},Window.prototype.setActive=function(active){active?(this.$el.addClass("active"),this.$windowTab&&this.$windowTab.addClass("label-primary"),this.$el.trigger("active")):(this.$el.removeClass("active"),this.$windowTab&&(this.$windowTab.removeClass("label-primary"),this.$windowTab.addClass("label-default")),this.$el.trigger("inactive"))},Window.prototype.setIndex=function(index){this.$el.css("zIndex",index)},Window.prototype.setWindowTab=function(windowTab){this.$windowTab=windowTab},Window.prototype.getWindowTab=function(){return this.$windowTab},Window.prototype.getTitle=function(){return this.options.title},Window.prototype.getElement=function(){return this.$el},Window.prototype.setSticky=function(sticky){!1===(this.options.sticky=sticky)?this.$el.css({position:"absolute"}):this.$el.css({position:"fixed"})},Window.prototype.getSticky=function(){return this.options.sticky},Window.prototype.setManager=function(window_manager){this.options.window_manager=window_manager},Window.prototype.initHandlers=function(){var _this=this;this.$el.find("[data-dismiss=window]").on("click",function(event){event.stopPropagation(),event.preventDefault(),_this.options.blocker||_this.close()}),this.$el.find("[data-maximize=window]").on("click",function(event){event.stopPropagation(),event.preventDefault(),_this.options.blocker||_this.maximize()}),this.$el.find("[data-restore=window]").on("click",function(event){_this.options.blocker||_this.restore()}),this.$el.off("mousedown"),this.$el.on("mousedown",function(){if(_this.options.blocker)return _this.options.blocker.getElement().trigger("focused"),void _this.options.blocker.blink();_this.$el.trigger("focused"),(_this.$el.hasClass("ns-resize")||_this.$el.hasClass("ew-resize"))&&($("body > *").addClass("disable-select"),_this.resizing=!0,_this.offset={},_this.offset.x=event.pageX,_this.offset.y=event.pageY,_this.window_info={top:_this.$el.position().top,left:_this.$el.position().left,width:_this.$el.outerWidth(),height:_this.$el.outerHeight()},event.offsetY<5&&_this.$el.addClass("north"),event.offsetY>_this.$el.height()-5&&_this.$el.addClass("south"),event.offsetX<5&&_this.$el.addClass("west"),event.offsetX>_this.$el.width()-5&&_this.$el.addClass("east"))}),_this.options.references.body.on("mouseup",function(){_this.resizing=!1,$("body > *").removeClass("disable-select"),_this.$el.removeClass("west"),_this.$el.removeClass("east"),_this.$el.removeClass("north"),_this.$el.removeClass("south")}),_this.options.elements.handle.off("mousedown"),_this.options.elements.handle.on("mousedown",function(event){_this.options.blocker||$("body > *").addClass("disable-select")}),_this.options.elements.handle.on("mouseup",function(event){$("body > *").removeClass("disable-select")}),_this.options.references.body.on("mousemove",_this.$el,function(event){if(_this.moving&&"maximized"!==_this.state&&($(event.toElement).hasClass(_this.options.selectors.handle.replace(".",""))||$(event.toElement).hasClass(_this.options.selectors.title.replace(".","")))){_this.options.elements.handle.position().top,_this.options.elements.handle.position().left;_this.$el.css("top",event.pageY-_this.offset.y),_this.window_info.top=event.pageY-_this.offset.y,_this.$el.css("left",event.pageX-_this.offset.x),_this.window_info.left=event.pageX-_this.offset.x,_this.window_info.width=_this.$el.outerWidth(),_this.window_info.height=_this.$el.outerHeight()}_this.options.resizable&&_this.resizing&&(_this.$el.hasClass("east")&&_this.$el.css("width",event.pageX-_this.window_info.left),_this.$el.hasClass("west")&&(_this.$el.css("left",event.pageX),_this.$el.css("width",_this.window_info.width+(_this.window_info.left-event.pageX))),_this.$el.hasClass("south")&&_this.$el.css("height",event.pageY-_this.window_info.top),_this.$el.hasClass("north")&&(_this.$el.css("top",event.pageY),_this.$el.css("height",_this.window_info.height+(_this.window_info.top-event.pageY))))}),this.$el.on("mousemove",function(event){_this.options.blocker||_this.options.resizable&&(event.offsetY>_this.$el.height()-5||event.offsetY<5?_this.$el.addClass("ns-resize"):_this.$el.removeClass("ns-resize"),event.offsetX>_this.$el.width()-5||event.offsetX<5?_this.$el.addClass("ew-resize"):_this.$el.removeClass("ew-resize"))})},Window.prototype.resize=function(options){(options=options||{}).top&&this.$el.css("top",options.top),options.left&&this.$el.css("left",options.left),options.height&&this.$el.css("height",options.height),options.width&&this.$el.css("width",options.width),this.$el.trigger("bsw.resize")},Window.prototype.setBlocker=function(window_handle){this.options.blocker=window_handle,this.$el.find(".disable-shade").remove();var shade='<div class="disable-shade"></div>';this.options.elements.body.append(shade),this.options.elements.body.addClass("disable-scroll"),this.options.elements.footer.append(shade),"fade"===this.options.effect?this.$el.find(".disable-shade").fadeIn():this.$el.find(".disable-shade").show(),this.options.blocker.getParent()||this.options.blocker.setParent(this)},Window.prototype.getBlocker=function(){return this.options.blocker},Window.prototype.clearBlocker=function(){this.options.elements.body.removeClass("disable-scroll"),"fade"===this.options.effect?this.$el.find(".disable-shade").fadeOut(function(){this.remove()}):(this.$el.find(".disable-shade").hide(),this.remove()),delete this.options.blocker},Window.prototype.setParent=function(window_handle){this.options.parent=window_handle,this.options.parent.getBlocker()||this.options.parent.setBlocker(this)},Window.prototype.getParent=function(){return this.options.parent},Window.prototype.blink=function(){var _this=this,active=this.$el.hasClass("active"),windowTab=this.getWindowTab(),focused=windowTab?windowTab.hasClass("label-primary"):void 0,blinkInterval=setInterval(function(){_this.$el.toggleClass("active"),windowTab&&windowTab.toggleClass("label-primary")},250);setTimeout(function(){clearInterval(blinkInterval),active&&_this.$el.addClass("active"),windowTab&&focused&&windowTab.addClass("label-primary")},1e3)},$.fn.window=function(options){options=options||{};var window_opts=$.extend({fromElement:this,selectors:{}},options||{});if("object"==typeof options)window_opts.selectors.handle&&this.find(window_opts.selectors.handle).css("cursor","move"),new Window($.extend({},window_opts,window_opts));else if("string"==typeof options)switch(options){case"close":this.data("window").close();break;case"show":this.data("window").show();break;case"maximize":this.data("window").maximize()}return this},$("[data-window-target]").off("click"),$("[data-window-target]").on("click",function(){var $this=$(this),opts={selectors:{}};$this.data("windowTitle")&&(opts.title=$this.data("windowTitle")),$this.data("titleHandle")&&(opts.selectors.title=$this.data("titleHandle")),$this.data("windowHandle")&&(opts.selectors.handle=$this.data("windowHandle")),$this.data("clone")&&(opts.clone=$this.data("windowHandle")),$($this.data("windowTarget")).window(opts)})}(jQuery);var WindowManager=null;!function($){"use strict";(WindowManager=function(options){return this.windows=[],options=options||{},this.initialize(options),this}).prototype.findWindowByID=function(id){var returnValue=null;return $.each(this.windows,function(index,window){window.id===id&&(returnValue=window)}),returnValue},WindowManager.prototype.destroyWindow=function(window_handle){var _this=this,returnVal=!1;return $.each(this.windows,function(index,window){window===window_handle&&(window_handle.close(),_this.windows.splice(index,1),_this.resortWindows(),returnVal=!0)}),returnVal},WindowManager.prototype.closeWindow=WindowManager.prototype.destroyWindow,WindowManager.prototype.resortWindows=function(){$.each(this.windows,function(index,window){window.setIndex(900+index)})},WindowManager.prototype.setFocused=function(focused_window){for(var focusedWindowIndex;focused_window.getBlocker();)focused_window=focused_window.getBlocker();$.each(this.windows,function(index,windowHandle){windowHandle.setActive(!1),windowHandle===focused_window&&(focusedWindowIndex=index)}),this.windows.push(this.windows.splice(focusedWindowIndex,1)[0]),focused_window.setActive(!0),this.resortWindows()},WindowManager.prototype.sendToBack=function(window){var windowHandle=this.windows.splice(this.windows.indexOf(window),1)[0];return this.windows.unshift(windowHandle),this.resortWindows(),!0},WindowManager.prototype.initialize=function(options){this.options=options,this.elements={},this.options.container&&(this.elements.container=$(this.options.container),this.elements.container.addClass("window-pane"))},WindowManager.prototype.getContainer=function(){var returnVal;return this.elements&&this.elements.container&&(returnVal=this.elements.container),returnVal},WindowManager.prototype.setNextFocused=function(){this.setFocused(this.windows[this.windows.length-1])},WindowManager.prototype.addWindow=function(window_object){var _this=this;return window_object.getElement().on("focused",function(event){_this.setFocused(window_object)}),window_object.getElement().on("close",function(){_this.destroyWindow(window_object),window_object.getWindowTab()&&window_object.getWindowTab().remove()}),window_object.on("bsw.restore",function(){_this.resortWindows()}),this.options.container&&(window_object.setWindowTab($('<span class="label label-default">'+window_object.getTitle()+'<button class="pane-close">x</button></span>')),window_object.getWindowTab().find(".pane-close").on("click",function(event){var blocker=window_object.getBlocker();blocker?blocker.blink():window_object.close()}),window_object.getWindowTab().on("click",function(event){var blocker=window_object.getBlocker();blocker?blocker.blink():(_this.setFocused(window_object),window_object.getSticky()&&window.scrollTo(0,window_object.getElement().position().top))}),$(this.options.container).append(window_object.getWindowTab())),this.windows.push(window_object),window_object.setManager(this),this.setFocused(window_object),window_object},WindowManager.prototype.createWindow=function(window_options){var final_options=Object.create(window_options);this.options.windowTemplate&&!final_options.template&&(final_options.template=this.options.windowTemplate);var newWindow=new Window(final_options);return this.addWindow(newWindow)}}(jQuery);var notifSound=null;function notification(msg){if(notifSound.play(),"Notification"in window&&"denied"!==Notification.permission)if("granted"===Notification.permission)new Notification(msg.username,{icon:"images/avatars/"+msg.tuser_id+".png",body:msg.text});else Notification.requestPermission(function(permission){if("permission"in Notification||(Notification.permission=permission),"granted"===permission)new Notification(msg)});else toastr.info(msg.text,msg.username)}function addChatMessage(messages,bulk){bulk=bulk||!1;for(var i=0;i<messages.length;i++){var channel=messages[i].channel,tuser_id=messages[i].user_id,username=messages[i].username;earliest_messages[channel]||(earliest_messages[channel]=2147483647e3);var pane=$("#"+channel+"Messages"),ts=messages[i].timestamp;if(ts<earliest_messages[channel]&&(earliest_messages[channel]=ts),messages[i].prepend)pane.prepend('<div class="messageWrapper"><div class="message"><div class="messageGutter"><img class="messageAvatar" src="images/avatars/'+tuser_id+'.png"/></div><div class="messageContent"><div class="messageContent-header"><span class="messageSender">'+username+'</span><span class="messageTime">'+epochToDateString(ts)+'</span></div><span class="messageBody">'+messages[i].text+"</span></div></div>");else{var atBottom=$("#"+channel).overlayScrollbars().scroll().max.y==$("#"+channel).overlayScrollbars().scroll().position.y,newMsg=$('<div class="messageWrapper"><div class="message"><div class="messageGutter"><img class="messageAvatar" src="images/avatars/'+tuser_id+'.png"/></div><div class="messageContent"><div class="messageContent-header"><span class="messageSender">'+username+'</span><span class="messageTime">'+epochToDateString(ts)+'</span></div><span class="messageBody">'+messages[i].text+"</span></div></div>");bulk||activeChannel!==channel||newMsg.hide(),newMsg.appendTo(pane),bulk||"log"===channel||user_id==tuser_id||(0<=messages[i].text.search("@"+username)||0<=messages[i].text.search("@alert"))&&notification(messages[i]),bulk||"log"===channel||"chat"===activeTable&&activeChannel===channel||(unreadMessages[channel]?unreadMessages[channel]++:($(".newMessage").removeClass("newMessage"),$(".newMessageLabel").remove(),unreadMessages[channel]=1,newMsg.addClass("newMessage"),newMsg.append('<div class="newMessageLabel">New Messages</div>')),$("#unread-"+channel).text(unreadMessages[channel]).show(),$("#chatTab").css("background-color","#ff6060")),bulk||activeChannel!==channel||newMsg.fadeIn("fast"),atBottom&&setTimeout(function(){$("#"+channel).overlayScrollbars().scroll($("#"+channel).overlayScrollbars().scroll().max.y)},25)}messages[i].more&&pane.prepend('<div id="get-more-messages"><span onClick="getMoreMessages(\''+channel+"')\">Get older messages.</span></div>")}}function getMoreMessages(channel){$("#get-more-messages").remove(),socket.send(JSON.stringify({act:"get_old_chats",arg:{channel:channel,start_from:earliest_messages[channel]},msgId:msgHandler()}))}function getParameterByName(name,url){url=url||window.location.href,name=name.replace(/[\[\]]/g,"\\$&");var results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-center",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},$(document).ready(function(){$(".channel").click(function(e){var channel=e.target.id.split("-")[1];$("#"+channel).overlayScrollbars().scroll().max.y==$("#"+channel).overlayScrollbars().scroll().position.y?chatPosition[activeChannel]="bottom":chatPosition[activeChannel]=$("#"+channel).overlayScrollbars().scroll().position.y,$(".channel-pane").hide(),$(".channel").removeClass("channelSelected"),$("#"+channel).show(),unreadMessages[channel]=0,$("#unread-"+channel).hide(),$("#chatTab").css("background-color",""),chatPosition[channel]&&"bottom"!==chatPosition[channel]||$("#"+channel).scrollTop($("#"+channel)[0].scrollHeight),$("#channel-"+channel).addClass("channelSelected"),activeChannel=channel}),$("#chatTab").click(function(e){unreadMessages[activeChannel]=0,$("#unread-"+activeChannel).hide(),$("#chatTab").css("background-color","")})}),mission_id=getParameterByName("mission"),permissions=permissions||{manage_users:!1,modify_diagram:!1,modify_notes:!1,modify_files:!1,api_access:!1};var minimap=document.getElementById("minimapCanvas"),minimapBg=document.getElementById("minimapBgCanvas"),minimapCtx=minimap.getContext("2d"),minimapBgCtx=minimapBg.getContext("2d");minimap.width=minimapBg.width=100,minimap.height=minimapBg.height=100;var socket,settingsTabulator,wsdb,shareDBConnection,settings={zoom:1,x:Math.round($("#diagramJumbo").width()/2),y:Math.round(350),diagram:700,tools:400,notes:400,files:400},earliest_messages={},creatingLink=!1,userSelect=[],objectsLoaded=null,updatingObject=!1,toolbarState=!1,firstNode=null,SVGCache={},tempLinks=[],guides={},resizeTimer=null,updateSettingsTimer=null,objectMovingTimer=null,activeToolbar=null,activeTable="chat",activeChannel="log",chatPosition={},objectSearchResults=[],objectSearchPtr=null,firstChat=!0,unreadMessages={},lastClick=null,msgId=0,pendingMsg=[],lastFillColor="#000000",lastStrokeColor="#ffffff",windowManager=null,canvasClipboard=[],openDocs={};function checkIfShapesCached(msg){if(0==objectsLoaded.length){for(var o in console.log("cached"),msg)objectsLoaded.push(!1),addObjectToCanvas(msg[o]);checkIfObjectsLoaded()}else setTimeout(function(){checkIfShapesCached(msg)},50)}function checkIfObjectsLoaded(){0==objectsLoaded.length?(console.log("objects loaded"),$("#modal").modal("hide"),updateLinks(),updateMinimapBg(),canvas.requestRenderAll(),canvas.renderOnAddRemove=!0):setTimeout(checkIfObjectsLoaded,50)}function getIcon(icon,cb){var path="images/icons/";SVGCache[icon]?(objectsLoaded.pop(),cb&&cb()):$.get(path+icon,function(data){fabric.loadSVGFromString(data,function(objects,options){SVGCache[icon]=fabric.util.groupSVGElements(objects,options),cb&&cb(),objectsLoaded.pop()})},"text").fail(function(){$.get(path+"missing.svg",function(data){fabric.loadSVGFromString(data,function(objects,options){SVGCache[icon]=fabric.util.groupSVGElements(objects,options),cb&&cb(),objectsLoaded.pop()})},"text")})}function loadSettings(){""===decodeURIComponent(document.cookie)&&(document.cookie="mcscop-settings="+JSON.stringify(settings));var dc=decodeURIComponent(document.cookie);settings=JSON.parse(dc.split("mcscop-settings=")[1]),$("#diagramJumbo").height(settings.diagram),canvas.setZoom(settings.zoom),canvas.relativePan({x:settings.x,y:settings.y})}function updateSettings(){updateSettingsTimer&&window.clearTimeout(updateSettingsTimer),updateSettingsTimer=setTimeout(function(){document.cookie="mcscop-settings="+JSON.stringify(settings)},100)}function updateMinimap(){var scaleX=100/(2*MAXWIDTH),scaleY=100/(2*MAXHEIGHT),zoom=canvas.getZoom(),mLeft=(MAXHEIGHT-settings.x/zoom)*scaleX,mTop=(MAXHEIGHT-settings.y/zoom)*scaleY,mWidth=canvas.width/zoom*scaleX,mHeight=canvas.height/zoom*scaleY;minimapCtx.strokeStyle="#ffffff",minimapCtx.clearRect(0,0,minimapCtx.canvas.width,minimapCtx.canvas.height),minimapCtx.beginPath(),minimapCtx.rect(mLeft,mTop,mWidth,mHeight),minimapCtx.stroke()}function updateMinimapBg(){var scaleX=100/(2*MAXWIDTH),scaleY=100/(2*MAXHEIGHT);minimapBgCtx.clearRect(0,0,minimapCtx.canvas.width,minimapCtx.canvas.height);for(var i=0;i<canvas.getObjects().length;i++)"icon"!==canvas.item(i).objType&&"shape"!==canvas.item(i).objType||(minimapBgCtx.fillStyle="#ffffff",minimapBgCtx.fillRect((MAXWIDTH+canvas.item(i).left)*scaleX,(MAXHEIGHT+canvas.item(i).top)*scaleY,2,2))}function msgHandler(){return pendingMsg[msgId]=setTimeout(function(){for(m in pendingMsg)clearTimeout(pendingMsg[m]);clearInterval(socket.pingInterval),canvas.clear(),canvas.requestRenderAll(),$("#modal-close").hide(),$("#modal-header").html("Attention!"),$("#modal-body").html("<p>Connection lost! Please refresh the page to continue!</p>"),$("#modal-footer").html(""),$("#modal-content").removeAttr("style"),$("#modal-content").removeClass("modal-details"),$("#modal").removeData("bs.modal").modal({backdrop:"static",keyboard:!1})},3e4),msgId++}function sendChatMessage(msg,channel){socket.send(JSON.stringify({act:"insert_chat",arg:{channel:channel,text:msg},msgId:msgHandler()}))}function showMessage(msg,timeout){$("#message").html('<span class="messageHeader">'+msg+"</span>"),$("#message").show(),void 0!==timeout&&setTimeout(function(){$("#message").html(""),$("#message").hide()},1e3*timeout)}function downloadDiagram(link){var viewport=canvas.viewportTransform;canvas.setHeight(2*MAXHEIGHT),canvas.setWidth(2*MAXWIDTH),canvas.viewportTransform=[1,0,0,1,MAXWIDTH,MAXHEIGHT],link.href=canvas.toDataURL("png"),link.download="diagram.png",canvas.viewportTransform=viewport,resizeCanvas(),canvas.requestRenderAll()}function startTime(){var today=new Date,eh=today.getHours(),uh=today.getUTCHours(),m=today.getMinutes(),s=today.getSeconds();m=addZero(m),s=addZero(s),$("#est").html("Local: "+eh+":"+m+":"+s),$("#utc").html("UTC: "+uh+":"+m+":"+s);setTimeout(startTime,500)}function deleteObjectConfirm(){$("#modal-title").text("Are you sure?"),$("#modal-body").html("<p>Are you sure you want to delete this object?</p><p>Deleting an object will delete all attached notes.</p>"),$("#modal-footer").html('<button type="button btn-primary" class="button btn btn-danger" data-dismiss="modal" onClick="cop.deleteObject();">Yes</button> <button type="button btn-primary" class="button btn btn-default" data-dismiss="modal">No</button>'),$("#modal-content").removeAttr("style"),$("#modal-content").removeClass("modal-details"),$("#modal").modal("show")}function getUserSelect(){userSelect.sort(function(a,b){return a.username.localeCompare(b.name)});for(var user={},i=0;i<userSelect.length;i++)user[userSelect[i]._id]=userSelect[i].username;return user}function getObjectSelect(){var res=":",objs=canvas.getObjects();objs.sort(function(a,b){return a.name_val&&b.name_val?a.name_val.localeCompare(b.name_val):0});for(var i=0;i<objs.length;i++)"icon"!==objs[i].objType&&"shape"!==objs[i].objType||(res+=";"+objs[i]._id+":"+objs[i].name_val.split("\n")[0].replace(":","").replace(";",""));return res}function addUser(){for(var msg='<form><div class="form-group"><label for="nuUserId">User:</label><select class="form-control" id="nuUserId">',i=0;i<userSelect.length;i++)msg+='<option value="'+userSelect[i]._id+'">'+userSelect[i].username+"</option>";msg+='</select></div><div class="form-check"><input type="checkbox" class="form-check-input" id="nuPermManageUsers"><label class="form-check-label" for="nuPermManageUsers">Manage Users</label></div>',msg+='<div class="form-check"><input type="checkbox" class="form-check-input" id="nuPermModifyDiagram"><label class="form-check-label" for="nuPermModifyDiagram">Modify Diagram</label></div>',msg+='<div class="form-check"><input type="checkbox" class="form-check-input" id="nuPermModifyNotes"><label class="form-check-label" for="nuPermModifyNotes">Modify Notes</label></div>',msg+='<div class="form-check"><input type="checkbox" class="form-check-input" id="nuPermModifyFiles"><label class="form-check-label" for="nuPermModifyFiles">Modify Files</label></div>',msg+='<div class="form-check"><input type="checkbox" class="form-check-input" id="nuPermApiAccess"><label class="form-check-label" for="nuPermApiAccess">API Access</label></div></form>',bootbox.dialog({message:msg,title:"Add User",buttons:{confirm:{label:"Insert",className:"btn-primary",callback:function(){var user={};user.user_id=$("#nuUserId").val(),user.permissions={manage_users:$("#nuPermManageUsers").is(":checked"),modify_diagram:$("#nuPermModifyDiagram").is(":checked"),modify_notes:$("#nuPermModifyNotes").is(":checked"),modify_files:$("#nuPermModifyFiles").is(":checked"),api_access:$("#nuPermApiAccess").is(":checked")},socket.send(JSON.stringify({act:"insert_user_mission",arg:user,msgId:msgHandler()}))}},cancel:{label:"Cancel",className:"btn-danger"}}})}$(document).ready(function(){$("#modal-title").text("Please wait...!"),$("#modal-body").html('<p>Loading COP, please wait...</p><img src="images/loading.gif"/>'),$("#modal-footer").html(""),$("#toolsForm").overlayScrollbars({className:"os-theme-light"}),$("#notesForm").overlayScrollbars({className:"os-theme-light"}),$("#filesForm").overlayScrollbars({className:"os-theme-light"}),$("#log").overlayScrollbars({className:"os-theme-light"}),$("#general").overlayScrollbars({className:"os-theme-light"}),$("#propObjectGroup").overlayScrollbars({className:"os-theme-dark"}),startTime(),$(window).click(function(e){lastClick=e.target}),notifSound=new Audio("sounds/knock.mp3"),$(".modal-dialog").draggable({handle:".modal-header"}),$(".modal-content").resizable({minHeight:153,minWidth:300}),$(document).on("submit",".bootbox form",function(e){e.preventDefault(),$(".bootbox .btn-primary").click()}),wsdb="https:"===location.protocol?(socket=new WebSocket("wss://"+window.location.host+"/mcscop/"),new WebSocket("wss://"+window.location.host+"/mcscop/")):(socket=new WebSocket("ws://"+window.location.host+"/mcscop/"),new WebSocket("ws://"+window.location.host+"/mcscop/")),shareDBConnection=new ShareDB.Connection(wsdb),wsdb.onopen=function(){wsdb.send(JSON.stringify({act:"stream",arg:""}))},socket.onopen=function(){setTimeout(function(){$("#modal").modal("hide")},1e3),$("#modal").modal("hide"),socket.pingInterval=setInterval(function(){socket.send(JSON.stringify({act:"ping",arg:"",msgId:msgHandler()}))},1e4),setTimeout(function(){console.log("connect"),console.log("joining mission: "+mission_id),socket.send(JSON.stringify({act:"join",arg:{mission_id:mission_id},msgId:msgHandler()}))},100)},socket.onmessage=function(msg){switch((msg=JSON.parse(msg.data)).act){case"ack":clearTimeout(pendingMsg[msg.arg]),delete pendingMsg[msg.arg];break;case"error":$("#modal-close").hide(),$("#modal-header").html("Error!"),$("#modal-body").html("<p>"+msg.arg.text+"</p>"),$("#modal-footer").html(""),$("#modal-content").removeAttr("style"),$("#modal-content").removeClass("modal-details"),$("#modal").removeData("bs.modal").modal({});break;case"join":objectsLoaded=[];var objects=msg.arg.objects;for(var o in objects)"icon"===objects[o].type&&void 0===SVGCache[objects[o].image]&&void 0!==objects[o].image&&null!==objects[o].image&&(SVGCache[objects[o].image]=null,objectsLoaded.push(!1),getIcon(objects[o].image));checkIfShapesCached(objects),settingsTabulator.setData(msg.arg.userSettings),createNotesTree(msg.arg.notes),addChatMessage(msg.arg.chats,!0);break;case"get_users":userSelect=userSelect.concat(msg.arg);break;case"bulk_chat":addChatMessage(msg.arg,!0);break;case"chat":addChatMessage(msg.arg);break;case"update_files":$("#files").jstree("refresh");break;case"insert_note":$("#notes").jstree(!0).create_node("#",msg.arg);break;case"rename_note":(node=$("#notes").jstree(!0).get_node(msg.arg.id,!0))&&$("#notes").jstree(!0).rename_node(node,msg.arg.name);break;case"delete_note":var node;(node=$("#notes").jstree(!0).get_node(msg.arg,!0))&&$("#notes").jstree(!0).delete_node(node);break;case"insert_user_mission":settingsTabulator.addRow(msg.arg);break;case"update_user_mission":settingsTabulator.updateRow(msg.arg._id,msg.arg);break;case"delete_user_mission":settingsTabulator.deleteRow(msg.arg);break;case"change_object":o=msg.arg;for(var selected="",i=0;i<canvas.getObjects().length;i++)if(canvas.item(i)._id===o._id){var to=canvas.item(i);if(to===canvas.getActiveObject()&&(updatingObject=!0,selected="single",1<canvas.getActiveObjects().length&&(selected="group",canvas.getActiveObjects().remove(to))),"icon"===o.type){for(var old_children=[],k=0;k<to.children.length;k++)"link"===to.children[k].objType&&old_children.push(to.children[k]),"name"===to.children[k].objType&&canvas.remove(to.children[k]);canvas.remove(to),cb=function(){for(k=0;k<old_children.length;k++)updateLink(old_children[k])},addObjectToCanvas(o,selected,cb),canvas.requestRenderAll()}else if("shape"===o.type||"link"===o.type){if(setObjectLock(canvas.item(i),o.locked),"link"===o.type&&""===o.stroke_color&&(o.stroke_color="#000000"),canvas.item(i).name_val!==o.name){console.log("renaming"),canvas.item(i).name_val=o.name;for(k=0;k<to.children.length;k++)"name"===canvas.item(i).children[k].objType&&canvas.item(i).children[k].set("text",o.name)}canvas.item(i).set("stroke",o.stroke_color),canvas.item(i).set("fill",o.fill_color),canvas.item(i).set("dirty",!0),canvas.requestRenderAll()}updatingObject=!1;break}break;case"move_object":for(var h=0;h<msg.arg.length;h++)for(o=msg.arg[h],i=0;i<canvas.getObjects().length;i++)if(canvas.item(i)._id==o._id){var obj=canvas.item(i);if(obj.dirty=!0,"link"!==obj.objType){obj.set("angle",o.rot),"shape"===o.type?(obj.set("width",o.scale_x),obj.set("height",o.scale_y)):"icon"===o.type&&(obj.set("scaleX",o.scale_x),obj.set("scaleY",o.scale_y));1<canvas.getActiveObjects().length&&-1<canvas.getActiveObjects().indexOf(obj)&&canvas.getActiveObject().removeWithUpdate(obj),obj.set({left:o.x,top:o.y});for(var j=0;j<obj.children.length;j++)"name"===obj.children[j].objType?(obj.children[j].set("top",0+obj.top+obj.height*obj.scaleY+4),obj.children[j].set("left",0+obj.left+obj.width*obj.scaleX/2),obj.children[j].setCoords()):"link"===obj.children[j].objType&&drawLink(obj.children[j]);obj.setCoords()}if(void 0!==o.z&&i!==2*o.z)if(i<2*o.z){obj.moveTo(2*o.z+1);for(k=0;k<obj.children.length;k++)"name"===obj.children[k].objType&&obj.children[k].moveTo(canvas.getObjects().indexOf(obj))}else{obj.moveTo(2*o.z);for(k=0;k<obj.children.length;k++)"name"===obj.children[k].objType&&obj.children[k].moveTo(canvas.getObjects().indexOf(obj)+1)}break}canvas.requestRenderAll(),updateMinimapBg();break;case"insert_object":for(h=0;h<msg.arg.length;h++){addObjectToCanvas(o=msg.arg[h],!1)}updateMinimapBg();break;case"delete_object":var _id=msg.arg;for(i=0;i<canvas.getObjects().length;i++)if(canvas.item(i)._id==_id){var object=canvas.item(i);if(void 0!==canvas.item(i).children)for(k=0;k<object.children.length;k++)"name"===object.children[k].objType&&canvas.remove(object.children[k]);1<canvas.getActiveObjects().indexOf(object)&&canvas.getActiveObject().removeWithUpdate(object),canvas.remove(object);break}updateMinimapBg(),canvas.requestRenderAll()}},socket.onclose=function(){canvas.clear(),canvas.requestRenderAll(),clearInterval(socket.pingInterval),$("#modal-close").hide(),$("#modal-title").text("Attention!"),$("#modal-body").html("<p>Connection lost! Please refesh the page to retry!</p>"),$("#modal-footer").html(""),$("#modal-content").removeAttr("style"),$("#modal-content").removeClass("modal-details"),$("#modal").removeData("bs.modal").modal({backdrop:"static",keyboard:!1})},$("#propObjectGroup").tabs({beforeActivate:function(e,u){$("#propType").val(u.newPanel.attr("id").split("-")[1]),"link"===$("#propType").val()?$("#propFillColorSpan").hide():$("#propFillColorSpan").show()}}),$.each(["icon","shape","link"],function(i,v){$("#prop-"+v).imagepicker({hide_select:!0,initialized:function(){permissions.modify_diagram||$("#propObjectGroup").find("div").unbind("click")},selected:function(){if(permissions.modify_diagram)if(null===canvas.getActiveObject()||void 0===canvas.getActiveObject()||"icon"!==canvas.getActiveObject().objType&&"shape"!==canvas.getActiveObject().objType){type=$(this).val().split("-")[2];$("#propType").val(type)}else{var obj=canvas.getActiveObject();canvas.getObjects().indexOf(canvas.getActiveObject());obj.image=$(this).val().replace(".png",".svg");var type=$(this).val().split("-")[2];if(obj.objType!==type)return;updatingObject=!0,changeObject(obj),updatingObject=!1}}})}),$("#chatTab").click(function(){toggleTable("chat")}),permissions.manage_users&&($("#settingsTab").show(),$("#settingsTabTag").show()),$("#settingsTab").click(function(){toggleTable("settings")}),$("#addUser").click(function(){addUser()}),settingsTabulator=new Tabulator("#settingsTable",{layout:"fitColumns",index:"_id",cellEdited:function(cell){socket.send(JSON.stringify({act:"update_user_mission",arg:cell.getRow().getData(),msgId:msgHandler()}))},columns:[{title:"_id",field:"_id",visible:!1},{title:"User ID",field:"user_id",visible:!1},{title:"Username",field:"username"},{title:"Manage Users",field:"permissions.manage_users",editor:"tickCross",formatter:"tickCross"},{title:"Modify Diagram",field:"permissions.modify_diagram",editor:"tickCross",formatter:"tickCross"},{title:"Modify Notes",field:"permissions.modify_notes",editor:"tickCross",formatter:"tickCross"},{title:"Modify Files",field:"permissions.modify_files",editor:"tickCross",formatter:"tickCross"},{title:"API Access",field:"permissions.api_access",editor:"tickCross",formatter:"tickCross"},{headerSort:!1,formatter:"buttonCross",width:40,align:"center",cellClick:function(e,cell){socket.send(JSON.stringify({act:"delete_user_mission",arg:{_id:cell.getRow().getData()._id},msgId:msgHandler()}))}}]}),$("#zoomInButton").click(function(){zoomIn()}),$("#zoomOutButton").click(function(){zoomOut()}),$("#objectSearch").change(function(){objectSearch(this.value)}),$("#nextObjectSearch").click(function(){nextObjectSearch()}),$("#prevObjectSearch").click(function(){prevObjectSearch()}),$("#downloadEventsButton").click(function(){downloadEvents()}),$("#downloadDiagramButton").click(function(){downloadDiagram(this)}),$("#downloadOpnotesButton").click(function(){downloadOpnotes()}),windowManager=new WindowManager({container:"#windowPane",windowTemplate:$("#details_template").html()}),$("#diagram").mousedown(startPan),$('[name="propFillColor"]').paletteColorPicker({colors:[{"#000000":"#000000"},{"#808080":"#808080"},{"#c0c0c0":"#c0c0c0"},{"#ffffff":"#ffffff"},{"#800000":"#800000"},{"#ff0000":"#ff0000"},{"#808000":"#808000"},{"#ffff00":"#ffff00"},{"#008000":"#008000"},{"#00ff00":"#00ff00"},{"#008080":"#008080"},{"#00ffff":"#00ffff"},{"#000080":"#000080"},{"#0000ff":"#0000ff"},{"#800080":"#800080"},{"#ff00ff":"#ff00ff"}],clear_btn:null,position:"upside",timeout:2e3,close_all_but_this:!0,onchange_callback:function(color){color!==$("#propFillColor").val()&&updatePropFillColor(color)}}),$('[name="propStrokeColor"]').paletteColorPicker({colors:[{"#000000":"#000000"},{"#808080":"#808080"},{"#c0c0c0":"#c0c0c0"},{"#ffffff":"#ffffff"},{"#800000":"#800000"},{"#ff0000":"#ff0000"},{"#808000":"#808000"},{"#ffff00":"#ffff00"},{"#008000":"#008000"},{"#00ff00":"#00ff00"},{"#008080":"#008080"},{"#00ffff":"#00ffff"},{"#000080":"#000080"},{"#0000ff":"#0000ff"},{"#800080":"#800080"},{"#ff00ff":"#ff00ff"}],position:"upside",timeout:2e3,close_all_but_this:!0,onchange_callback:function(color){color!==$("#propStrokeColor").val()&&updatePropStrokeColor(color)}}),$("#diagramJumbo").resizable({handles:"s",minHeight:350}),$("#bottomJumbo").resizable({handles:"s",minHeight:350}),$("#toolbarBody").resizable({handles:"w",maxWidth:$("#diagramJumbo").width()-60}),$("#diagramJumbo").on("resize",function(event,ui){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){settings[activeToolbar]=Math.round($("#toolbarBody").width()),settings.diagram=Math.round($("#diagramJumbo").height()),updateSettings(),resizeCanvas()},100)}),window.addEventListener("resize",function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){resizeCanvas()},100)},!1),$("#messageInput").keypress(function(e){(e.charCode||e.keyCode||0)===$.ui.keyCode.ENTER&&(sendChatMessage($("#messageInput").val(),activeChannel),$("#messageInput").val(""))}),window.addEventListener("keydown",function(e){if(lastClick===canvas.upperCanvasEl)if(!e.ctrlKey||e.keyCode!=="c".charCodeAt(0)&&e.keyCode!=="C".charCodeAt(0))if(!e.ctrlKey||e.keyCode!=="v".charCodeAt(0)&&e.keyCode!=="V".charCodeAt(0))if(46===e.keyCode)canvas.getActiveObject()&&deleteObjectConfirm();else if(37<=e.keyCode&&e.keyCode<=40&&canvas.getActiveObject()){var o=canvas.getActiveObject();switch(objectMovingTimer&&window.clearTimeout(objectMovingTimer),objectMovingTimer=setTimeout(function(){objectModified(o)},1e3),e.keyCode){case 37:o.left-=1;break;case 38:o.top-=1;break;case 39:o.left+=1;break;case 40:o.top+=1}objectMoving(o,0),o.setCoords(),canvas.requestRenderAll()}else(114===e.keyCode||e.ctrlKey&&70===e.keyCode)&&(e.preventDefault(),$("#objectSearchBar").is(":visible")?($("#foundCount").hide(),$("#objectSearchBar").hide(),$("#objectSearch").val("")):($("#objectSearchBar").show().css("display","table"),$("#objectSearch").focus()));else 0<canvasClipboard.length&&pasteObjects();else{canvasClipboard=[],o=canvas.getActiveObjects();for(var x=0,y=0,i=0;i<o.length;i++)y=1===o.length?(x=0-o[i].width/2,0-o[i].height/2):(x=o[i].left,o[i].top),canvasClipboard.push({_id:o[i]._id,x:x,y:y,z:Math.round(canvas.getObjects().indexOf(o[i]/2))})}}),$("#diagramJumbo").focus(),loadSettings(),resizeCanvas()}),MAXWIDTH=2e3,MAXHEIGHT=2e3,fabric.Object.prototype.originX="left",fabric.Object.prototype.originY="top",fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.cornerSize=7,fabric.Object.prototype.objectCaching=!0,fabric.Object.prototype.noScaleCache=!1,fabric.Object.NUM_FRACTION_DIGITS=10,fabric.Object.prototype.lockScalingFlip=!0,fabric.Group.prototype.hasControls=!1,fabric.Group.prototype.lockScalingX=!0,fabric.Group.prototype.lockScalingY=!0;var canvas=new fabric.Canvas("canvas",{preserveObjectStacking:!0,renderOnAddRemove:!1,enableRetinaScaling:!1,uniScaleTransform:!0,width:MAXWIDTH,height:MAXHEIGHT});function objectMoving(o,snap){o.set({left:1*Math.round(o.left/1),top:1*Math.round(o.top/1)});canvas.getZoom();var tmod=0,lmod=0;1<canvas.getActiveObjects().length&&(tmod=o.top+o.height/2,lmod=o.left+o.width/2),drawAlignmentGuides(o,snap),o=canvas.getActiveObjects();for(var i=0;i<o.length;i++){o[i].dirty=!0;for(var j=0;j<o[i].children.length;j++)"name"===o[i].children[j].objType?(o[i].children[j].set("top",o[i].top+tmod+o[i].height*o[i].scaleY+4),o[i].children[j].set("left",o[i].left+lmod+o[i].width*o[i].scaleX/2),o[i].children[j].setCoords()):"link"===o[i].children[j].objType&&drawLink(o[i].children[j])}}function objectModified(o){var tmod=0,lmod=0;for(var k in"icon"===o.objType?o.set({scaleX:Math.round(o.width*o.scaleX)/o.width,scaleY:Math.round(o.height*o.scaleY)/o.height}):"shape"===o.objType&&o.set({width:Math.round(o.width),height:Math.round(o.height)}),o.set({left:Math.round(o.left),top:Math.round(o.top)}),1<canvas.getActiveObjects().length&&(tmod=o.top+o.height/2,lmod=o.left+o.width/2),guides)guides.hasOwnProperty(k)&&(canvas.remove(guides[k]),delete guides[k]);o=canvas.getActiveObjects();for(var args=[],i=0;i<o.length;i++){var z=canvas.getObjects().indexOf(o[i])/2;"link"===o[i].objType?args.push({_id:o[i]._id,x:0,y:0,z:z,scale_x:0,scale_y:0,rot:0}):"icon"===o[i].objType?args.push({_id:o[i]._id,x:lmod+o[i].left,y:tmod+o[i].top,z:z,scale_x:o[i].scaleX,scale_y:o[i].scaleY,rot:o[i].angle}):"shape"===o[i].objType&&args.push({_id:o[i]._id,x:lmod+o[i].left,y:tmod+o[i].top,z:z,scale_x:o[i].width,scale_y:o[i].height,rot:o[i].angle})}updateMinimapBg(),socket.send(JSON.stringify({act:"move_object",arg:args,msgId:msgHandler()}))}function updateLinks(){for(var i=0;i<canvas.getObjects().length;i++){var link=canvas.item(i);link.objType&&"link"===link.objType&&updateLink(link)}}function updateLink(link){for(var foundFrom=!1,foundTo=!1,j=0;j<canvas.getObjects().length;j++){var jo=canvas.item(j);foundFrom||jo._id!=link.fromId?foundTo||jo._id!=link.toId||(-1===(link.toObj=jo).children.indexOf(link)&&jo.children.push(link),foundTo=!0):(-1===(link.fromObj=jo).children.indexOf(link)&&jo.children.push(link),foundFrom=!0)}return foundFrom&&foundTo&&drawLink(link),foundFrom&&foundTo}function setObjectLock(o,l){o.set({hasControls:!l,lockMovementX:l,lockMovementY:l,lockScalingX:l,lockScalingY:l,lockRotation:0})}function getObjectCenter(o){return{x:o.width*o.scaleX/2+o.left,y:o.height*o.scaleY/2+o.top}}function startPan(event){if(2==event.button){var x0=event.screenX,y0=event.screenY;canvas.isDragging=!0,canvas.selection=!1,$(window).mousemove(continuePan),$(window).mouseup(function stopPan(event){canvas.isDragging=!1,canvas.selection=!0,updateSettings(),$(window).off("mousemove",continuePan),$(window).off("mouseup",stopPan)}),$(window).contextmenu(cancelMenu)}function continuePan(event){var x=event.screenX,y=event.screenY;if(x-x0!=0||y-y0!=0){var deltaX=x-x0,deltaY=y-y0,zoom=canvas.getZoom();canvas.viewportTransform[4]+deltaX>MAXWIDTH*zoom?deltaX=Math.round(MAXWIDTH*zoom-canvas.viewportTransform[4]):canvas.viewportTransform[4]-canvas.width+deltaX<-MAXWIDTH*zoom&&(deltaX=Math.round(-MAXWIDTH*zoom-canvas.viewportTransform[4]+canvas.width)),canvas.viewportTransform[5]+deltaY>MAXHEIGHT*zoom?deltaY=Math.round(MAXHEIGHT*zoom-canvas.viewportTransform[5]):canvas.viewportTransform[5]-canvas.height+deltaY<-MAXHEIGHT*zoom&&(deltaY=Math.round(-MAXHEIGHT*zoom-canvas.viewportTransform[5]+canvas.height)),canvas.relativePan({x:deltaX,y:deltaY}),x0=x,y0=y,settings.x=Math.round(canvas.viewportTransform[4]),settings.y=Math.round(canvas.viewportTransform[5]),canvas.requestRenderAll(),updateMinimap()}}}function drawAlignmentGuides(o,snap){for(var vSnap=snap,hSnap=snap,zoom=canvas.getZoom(),hAligned=!1,vAligned=!1,tAligned=!1,bAligned=!1,lAligned=!1,rAligned=!1,hSpaced=!1,hAlignedObjects=[],vAlignedObjects=[],i=0;i<canvas.getObjects().length;i++)if(canvas.item(i).isOnScreen()&&(canvas.item(i).objType&&"icon"===canvas.item(i).objType||canvas.item(i).objType&&"shape"===canvas.item(i).objType)&&-1===canvas.getActiveObjects().indexOf(canvas.item(i))){if(Math.round(getObjectCenter(canvas.item(i)).x)<=Math.ceil(getObjectCenter(o).x)+vSnap&&Math.round(getObjectCenter(canvas.item(i)).x)>=Math.floor(getObjectCenter(o).x)-vSnap&&((canvas.item(i).top+canvas.item(i).height*canvas.item(i).scaleY<o.top||canvas.item(i).top>o.top+o.height*o.scaleY)&&vAlignedObjects.push(canvas.item(i)),!vAligned&&(1<vSnap&&o.set({left:Math.round(canvas.item(i).left+canvas.item(i).width*canvas.item(i).scaleX/2-o.width*o.scaleX/2)}),vAligned=!0,vSnap=0,!guides.vGuide))){var line=new fabric.Line([getObjectCenter(o).x,-canvas.viewportTransform[5]/zoom,getObjectCenter(o).x,(-canvas.viewportTransform[5]+canvas.height)/zoom],{objType:"guide",stroke:"#66bfff",strokeColor:"#66bfff",strokeDashArray:[2,2],strokeWidth:1,selectable:!1,evented:!1});canvas.add(line),guides.vGuide=line}if(!lAligned&&Math.round(canvas.item(i).left)<=Math.round(o.left)+vSnap&&Math.round(canvas.item(i).left)>=Math.round(o.left)-vSnap&&(1<vSnap&&!vAligned&&o.set({left:canvas.item(i).left}),lAligned=!0,vSnap=0,!guides.lGuide)){line=new fabric.Line([o.left,-canvas.viewportTransform[5]/zoom,o.left,(-canvas.viewportTransform[5]+canvas.height)/zoom],{objType:"guide",stroke:"#bf66ff",strokeColor:"#bf66ff",strokeDashArray:[2,2],strokeWidth:1,selectable:!1,evented:!1});canvas.add(line),guides.lGuide=line}if(!rAligned&&Math.round(canvas.item(i).left+canvas.item(i).width*canvas.item(i).scaleX)<=Math.round(o.left+o.width*o.scaleX)+vSnap&&Math.round(canvas.item(i).left+canvas.item(i).width*canvas.item(i).scaleX)>=Math.round(o.left+o.width*o.scaleX)-vSnap&&(1<vSnap&&!vAligned&&!lAligned&&o.set({left:canvas.item(i).left+canvas.item(i).width*canvas.item(i).scaleX-o.width*o.scaleX}),rAligned=!0,!guides.rGuide)){line=new fabric.Line([o.left+o.width*o.scaleX+1,-canvas.viewportTransform[5]/zoom,o.left+o.width*o.scaleX+1,(-canvas.viewportTransform[5]+canvas.height)/zoom],{objType:"guide",stroke:"#bf66ff",strokeColor:"#bf66ff",strokeDashArray:[2,2],strokeWidth:1,selectable:!1,evented:!1});canvas.add(line),guides.rGuide=line}if(Math.round(getObjectCenter(canvas.item(i)).y)<=Math.round(getObjectCenter(o).y)+hSnap&&Math.round(getObjectCenter(canvas.item(i)).y)>=Math.round(getObjectCenter(o).y)-hSnap&&((canvas.item(i).left+canvas.item(i).width*canvas.item(i).scaleX<o.left||canvas.item(i).left>o.left+o.width*o.scaleX)&&hAlignedObjects.push(canvas.item(i)),!hAligned&&(1<hSnap&&o.set({top:Math.round(canvas.item(i).top+canvas.item(i).height*canvas.item(i).scaleY/2-o.height*o.scaleY/2)}),hAligned=!0,hSnap=0,!guides.hGuide))){line=new fabric.Line([-canvas.viewportTransform[4]/zoom,getObjectCenter(o).y,(-canvas.viewportTransform[4]+canvas.width)/zoom,getObjectCenter(o).y],{objType:"guide",stroke:"#66bfff",strokeColor:"#66bfff",strokeDashArray:[2,2],strokeWidth:1,selectable:!1,evented:!1});canvas.add(line),guides.hGuide=line}if(!tAligned&&Math.round(canvas.item(i).top)<=Math.round(o.top)+hSnap&&Math.round(canvas.item(i).top)>=Math.round(o.top)-hSnap&&(1<hSnap&&o.set({top:canvas.item(i).top}),tAligned=!(hSnap=0),!guides.tGuide)){line=new fabric.Line([-canvas.viewportTransform[4]/zoom,o.top,(-canvas.viewportTransform[4]+canvas.width)/zoom,o.top],{objType:"guide",stroke:"#bf66ff",strokeColor:"#bf66ff",strokeDashArray:[2,2],strokeWidth:1,selectable:!1,evented:!1});canvas.add(line),guides.tGuide=line}if(!bAligned&&Math.round(canvas.item(i).top+canvas.item(i).height*canvas.item(i).scaleY)<=Math.round(o.top+o.height*o.scaleY)+hSnap&&Math.round(canvas.item(i).top+canvas.item(i).height*canvas.item(i).scaleY)>=Math.round(o.top+o.height*o.scaleY)-hSnap&&(1<hSnap&&o.set({top:canvas.item(i).top+canvas.item(i).height*canvas.item(i).scaleY-o.height*o.scaleY}),bAligned=!(hSnap=0),!guides.bGuide)){line=new fabric.Line([-canvas.viewportTransform[4]/zoom,o.top+o.height*o.scaleY+1,(-canvas.viewportTransform[4]+canvas.width)/zoom,o.top+o.height*o.scaleY+1],{objType:"guide",stroke:"#bf66ff",strokeColor:"#bf66ff",strokeDashArray:[2,2],strokeWidth:1,selectable:!1,evented:!1});canvas.add(line),guides.bGuide=line}}if(1<hAlignedObjects.length){hAlignedObjects.push(o),hAlignedObjects.sort(function(a,b){return a.left>b.left?1:b.left<=a.left?-1:0});var idx=hAlignedObjects.indexOf(o),alignedIcons=null;if(1<idx&&Math.round(getObjectCenter(hAlignedObjects[idx-2]).x)-Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)>=Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)-Math.round(getObjectCenter(hAlignedObjects[idx]).x)-vSnap&&Math.round(getObjectCenter(hAlignedObjects[idx-2]).x)-Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)<=Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)-Math.round(getObjectCenter(hAlignedObjects[idx]).x)+vSnap?(o.set({left:Math.round(getObjectCenter(hAlignedObjects[idx-1]).x-getObjectCenter(hAlignedObjects[idx-2]).x+Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)-o.width/2)}),alignedIcons=[idx-2,idx-1,idx],hSpaced=!0):idx<hAlignedObjects.length-2&&Math.round(getObjectCenter(hAlignedObjects[idx+1]).x)-Math.round(getObjectCenter(hAlignedObjects[idx+2]).x)>=Math.round(getObjectCenter(hAlignedObjects[idx]).x)-Math.round(getObjectCenter(hAlignedObjects[idx+1]).x)-vSnap&&Math.round(getObjectCenter(hAlignedObjects[idx+1]).x)-Math.round(getObjectCenter(hAlignedObjects[idx+2]).x)<=Math.round(getObjectCenter(hAlignedObjects[idx]).x)-Math.round(getObjectCenter(hAlignedObjects[idx+1]).x)+vSnap?(o.set({left:Math.round(getObjectCenter(hAlignedObjects[idx+1]).x-(Math.round(getObjectCenter(hAlignedObjects[idx+2]).x)-getObjectCenter(hAlignedObjects[idx+1]).x)-o.width/2)}),alignedIcons=[idx,idx+1,idx+2],hSpaced=!0):0<idx&&idx<hAlignedObjects.length-1&&Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)-Math.round(getObjectCenter(hAlignedObjects[idx]).x)>=Math.round(getObjectCenter(hAlignedObjects[idx]).x)-Math.round(getObjectCenter(hAlignedObjects[idx+1]).x)-vSnap&&hAlignedObjects.length-1&&Math.round(getObjectCenter(hAlignedObjects[idx-1]).x)-Math.round(getObjectCenter(hAlignedObjects[idx]).x)<=Math.round(getObjectCenter(hAlignedObjects[idx]).x)-Math.round(getObjectCenter(hAlignedObjects[idx+1]).x)+vSnap&&(o.set({left:Math.round(getObjectCenter(hAlignedObjects[idx+1]).x-(getObjectCenter(hAlignedObjects[idx+1]).x-getObjectCenter(hAlignedObjects[idx-1]).x)/2-o.width/2)}),alignedIcons=[idx-1,idx,idx+1],hSpaced=!0),alignedIcons&&!guides.hSGuide){var hSGuide=[];line=new fabric.Line([getObjectCenter(hAlignedObjects[alignedIcons[0]]).x,getObjectCenter(hAlignedObjects[alignedIcons[0]]).y-10,getObjectCenter(hAlignedObjects[alignedIcons[0]]).x,getObjectCenter(hAlignedObjects[alignedIcons[0]]).y+10],{objType:"guide",stroke:"#ff1111",strokeColor:"#ff1111",strokeDashArray:[2,2],strokeWidth:2,selectable:!1,evented:!1});hSGuide.push(line),line=new fabric.Line([getObjectCenter(hAlignedObjects[alignedIcons[1]]).x,getObjectCenter(hAlignedObjects[alignedIcons[1]]).y-10,getObjectCenter(hAlignedObjects[alignedIcons[1]]).x,getObjectCenter(hAlignedObjects[alignedIcons[1]]).y+10],{objType:"guide",stroke:"#ff1111",strokeColor:"#ff1111",strokeDashArray:[2,2],strokeWidth:2,selectable:!1,evented:!1}),hSGuide.push(line),line=new fabric.Line([getObjectCenter(hAlignedObjects[alignedIcons[2]]).x,getObjectCenter(hAlignedObjects[alignedIcons[2]]).y-10,getObjectCenter(hAlignedObjects[alignedIcons[2]]).x,getObjectCenter(hAlignedObjects[alignedIcons[2]]).y+10],{objType:"guide",stroke:"#ff1111",strokeColor:"#ff1111",strokeDashArray:[2,2],strokeWidth:2,selectable:!1,evented:!1}),hSGuide.push(line),line=new fabric.Line([getObjectCenter(hAlignedObjects[alignedIcons[0]]).x,getObjectCenter(hAlignedObjects[alignedIcons[0]]).y,getObjectCenter(hAlignedObjects[alignedIcons[2]]).x,getObjectCenter(hAlignedObjects[alignedIcons[2]]).y],{objType:"guide",stroke:"#ff1111",strokeColor:"#ff1111",strokeDashArray:[2,2],strokeWidth:2,selectable:!1,evented:!1}),hSGuide.push(line),guides.hSGuide=new fabric.Group(hSGuide),canvas.add(guides.hSGuide)}}!lAligned&&guides.lGuide&&(canvas.remove(guides.lGuide),delete guides.lGuide),!rAligned&&guides.rGuide&&(canvas.remove(guides.rGuide),delete guides.rGuide),!bAligned&&guides.bGuide&&(canvas.remove(guides.bGuide),delete guides.bGuide),!tAligned&&guides.tGuide&&(canvas.remove(guides.tGuide),delete guides.tGuide),!hAligned&&guides.hGuide&&(canvas.remove(guides.hGuide),delete guides.hGuide),!vAligned&&guides.vGuide&&(canvas.remove(guides.vGuide),delete guides.vGuide),!hSpaced&&guides.hSGuide&&(canvas.remove(guides.hSGuide),delete guides.hSGuide)}function drawLinks(){for(var i=0;i<canvas.getObjects().length;i++){var link=canvas.item(i);link.objType&&"link"===link.objType&&drawLink(link)}for(i=0;i<tempLinks.length;i++)"link"===tempLinks[i].objType?(tempLinks[i].set({x1:tempLinks[i].getObjectCenter(from).x,y1:tempLinks[i].getObjectCenter(from).y}),tempLinks[i].set({x2:tempLinks[i].getObjectCenter(to).x,y2:tempLinks[i].getObjectCenter(to).y})):"shape"===tempLinks[i].objType&&tempLinks[i].set({top:tempLinks[i].dad.top-7.5,left:tempLinks[i].dad.left-7.5})}function drawLink(link){if(link.toObj&&link.fromObj){var fromAbs=link.fromObj.calcTransformMatrix(),toAbs=link.toObj.calcTransformMatrix();link.set({x1:fromAbs[4],y1:fromAbs[5]}),link.set({x2:toAbs[4],y2:toAbs[5]}),link.setCoords();for(var j=0;j<link.children.length;j++)if("name"===link.children[j].objType){link.children[j].set({left:getObjectCenter(link).x,top:getObjectCenter(link).y});var angle=Math.atan2(link.y1-link.y2,link.x1-link.x2)*(180/Math.PI);90<Math.abs(angle)&&(angle+=180),link.children[j].set({angle:angle}),link.children[j].setCoords()}}}function objectSearch(s){objectSearchResults=[],objectSearchPtr=-1;for(var i=0;i<canvas.getObjects().length;i++)void 0!==canvas.item(i).name_val&&-1!==canvas.item(i).name_val.toLowerCase().indexOf(s.toLowerCase())&&objectSearchResults.push(canvas.item(i));nextObjectSearch()}function nextObjectSearch(){0<objectSearchResults.length?((++objectSearchPtr>=objectSearchResults.length||objectSearchPtr<0)&&(objectSearchPtr=0),$("#foundCount").text(objectSearchPtr+1+"/"+objectSearchResults.length),$("#foundCount").show(),focusObject(objectSearchResults[objectSearchPtr]),canvas.setActiveObject(objectSearchResults[objectSearchPtr])):$("#foundCount").hide()}function prevObjectSearch(){0<objectSearchResults.length&&(--objectSearchPtr<0&&(objectSearchPtr=objectSearchResults.length-1),$("#foundCount").text(objectSearchPtr+1+"/"+objectSearchResults.length),focusObject(objectSearchResults[objectSearchPtr]),canvas.setActiveObject(objectSearchResults[objectSearchPtr]))}function focusObject(o){var center=getObjectCenter(o);center.x=center.x*canvas.getZoom()-canvas.width/2+$("#toolbar").width()/2,center.y=center.y*canvas.getZoom()-canvas.height/2,canvas.absolutePan(center),updateMinimap(),updateSettings()}function zoomIn(){2<canvas.getZoom()||(canvas.zoomToPoint(new fabric.Point(canvas.width/2,canvas.height/2),(1.1*canvas.getZoom()).round(2)),settings.x=Math.round(canvas.viewportTransform[4]),settings.y=Math.round(canvas.viewportTransform[5]),settings.zoom=canvas.getZoom(),updateMinimap(),updateSettings())}function zoomOut(){if(!(canvas.getZoom()<.6)){canvas.zoomToPoint(new fabric.Point(canvas.width/2,canvas.height/2),(canvas.getZoom()/1.1).round(2)),settings.x=Math.round(canvas.viewportTransform[4]),settings.y=Math.round(canvas.viewportTransform[5]),settings.zoom=canvas.getZoom(),updateSettings();var deltaX=0,deltaY=0,zoom=canvas.getZoom();canvas.viewportTransform[4]>MAXWIDTH*zoom?deltaX=Math.round(MAXWIDTH*zoom-canvas.viewportTransform[4]):canvas.viewportTransform[4]-canvas.width<-MAXWIDTH*zoom&&(deltaX=Math.round(-MAXWIDTH*zoom-canvas.viewportTransform[4]+canvas.width)),canvas.viewportTransform[5]>MAXHEIGHT*zoom?deltaY=Math.round(MAXHEIGHT*zoom-canvas.viewportTransform[5]):canvas.viewportTransform[5]-canvas.height<-MAXHEIGHT*zoom&&(deltaY=Math.round(-MAXHEIGHT*zoom-canvas.viewportTransform[5]+canvas.height)),0===deltaX&&0===deltaY||canvas.relativePan({x:deltaX,y:deltaY}),updateMinimap()}}function addObjectToCanvas(o,selected,cb){if("link"===o.type){""===o.stroke_color&&(o.stroke_color="#000000");var line=new fabric.Line([0,0,0,0],{_id:o._id,objType:"link",image:o.image,name_val:o.name,fromId:o.obj_a,toId:o.obj_b,fill:"#eeeeee",stroke:o.stroke_color,strokeWidth:3,hasControls:!1,selctable:!0,locked:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0}),name=new fabric.Text(o.name,{parent_id:o._id,parent:line,objType:"name",selectable:!1,originX:"center",originY:"top",textAlign:"center",fill:"#eeeeee",angle:0,fontSize:12,fontFamily:"verdana",left:line.getCenterPoint().x,top:line.getCenterPoint().y});line.children=[name],canvas.add(line),canvas.add(name),line.moveTo(2*o.z),name.moveTo(2*o.z+1),updateLink(line)}else if("icon"===o.type&&void 0!==o.image&&null!==o.image)getIcon(o.image,function(){SVGCache[o.image].clone(function(shape){var name;if(shape.set({fill:o.fill_color,stroke:o.stroke_color,strokeWidth:1,scaleX:o.scale_x,scaleY:o.scale_y,angle:o.rot,_id:o._id,objType:o.type,image:o.image,name_val:o.name,originX:"left",originY:"top",left:o.x,top:o.y,locked:o.locked,hasControls:!(!permissions.modify_diagram||o.locked),lockMovementX:!permissions.modify_diagram||o.locked,lockMovementY:!permissions.modify_diagram||o.locked,lockScalingX:!permissions.modify_diagram||o.locked,lockScalingY:!permissions.modify_diagram||o.locked,lockRotation:!0}),shape.setControlVisible("mtr",!1),shape._objects&&!shape.image.includes("static"))for(var i=0;i<shape._objects.length;i++){var fill=shape._objects[i].fill,fillAlpha=1;try{fill.split("(")[1].split(")")[0].split(",")[3]<1&&(fillAlpha=1-fill.split("(")[1].split(")")[0].split(",")[3])}catch(e){}if("#FFFFFF"!=shape._objects[i].fill&&"rgba(255,255,255,1)"!==shape._objects[i].fill&&"rgba(254,254,254,1)"!==shape._objects[i].fill&&""!==shape._objects[i].fill){var color="#"+rgba2rgb(o.fill_color,fillAlpha);shape._objects[i].set("fill",color)}""!==o.stroke_color&&"rgba(254,254,254,1)"!==shape._objects[i].stroke&&shape._objects[i].set("stroke",o.stroke_color)}name=new fabric.Text(o.name,{parent_id:o._id,parent:shape,objType:"name",selectable:!1,originX:"center",originY:"top",textAlign:"center",fill:"#eeeeee",fontSize:12,fontFamily:"lato",left:o.x+shape.width*shape.scaleX/2,top:o.y+shape.height*shape.scaleY+4}),shape.children=[name],canvas.add(shape),canvas.add(name),"single"===selected?canvas.setActiveObject(shape):"group"===selected&&canvas.getActiveObject().addWithUpdate(shape),shape.moveTo(2*o.z),name.moveTo(2*o.z+1),cb&&cb()})});else if("shape"===o.type){var shape=o.image.split("-")[3].split(".")[0];if("rect"===shape)shape=new fabric.Rect({width:o.scale_x,height:o.scale_y,angle:o.rot,fill:o.fill_color,stroke:o.stroke_color,strokeWidth:2,_id:o._id,objType:o.type,image:o.image,name_val:o.name,name:name,originX:"left",originY:"top",left:o.x,top:o.y,locked:o.locked,hasControls:!(!permissions.modify_diagram||o.locked),lockMovementX:!permissions.modify_diagram||o.locked,lockMovementY:!permissions.modify_diagram||o.locked,lockScalingX:!permissions.modify_diagram||o.locked,lockScalingY:!permissions.modify_diagram||o.locked,lockRotation:!0});else{if("circle"!==shape)return;shape=new fabric.Ellipse({rx:o.scale_x/2,ry:o.scale_y/2,angle:o.rot,fill:o.fill_color,stroke:o.stroke_color,strokeWidth:2,_id:o._id,objType:o.type,image:o.image,name_val:o.name,name:name,originX:"left",originY:"top",left:o.x,top:o.y,locked:o.locked,hasControls:!(!permissions.modify_diagram||o.locked),lockMovementX:!permissions.modify_diagram||o.locked,lockMovementY:!permissions.modify_diagram||o.locked,lockScalingX:!permissions.modify_diagram||o.locked,lockScalingY:!permissions.modify_diagram||o.locked,lockRotation:!0})}name=new fabric.Text(o.name,{parent_id:o._id,parent:shape,objType:"name",selectable:!1,originX:"center",originY:"top",textAlign:"center",fill:"#000000",fontSize:10,fontFamily:"verdana",left:o.x+shape.width*shape.scaleX/2,top:o.y+shape.height*shape.scaleY+4}),shape.children=[name],canvas.add(shape),canvas.add(name),"single"===selected?canvas.setActiveObject(shape):"group"===selected&&canvas.getActiveObjects().addWithUpdate(shape),shape.moveTo(2*o.z),name.moveTo(2*o.z+1)}objectsLoaded.pop()}function toggleObjectLock(l){var o=canvas.getActiveObject();o&&(o.locked=l,changeObject(o))}function resizeCanvas(){canvas.getHeight()!=$("#diagram").height()&&canvas.setHeight($("#diagram").height()),canvas.getWidth()!=$("#diagram").width()&&canvas.setWidth($("#diagram").width()),updateMinimap()}function setObjectSize(){var o=canvas.getActiveObject();if(o){if("icon"===o.objType)o.set("scaleX",$("#objectWidth").val()/o.width),o.set("scaleY",$("#objectHeight").val()/o.height);else if("shape"===o.objType){o.set("width",$("#objectWidth").val()),o.set("height",$("#objectHeight").val()),o.resizeToScale(),o.setCoords();for(var j=0;j<o.children.length;j++)"name"===o.children[j].objType&&(o.children[j].set("top",o.top+o.height*o.scaleY+4),o.children[j].set("left",o.left+o.width*o.scaleX/2),o.children[j].setCoords())}changeObject(o)}}function deleteObject(){canvas.getActiveObject()._id&&socket.send(JSON.stringify({act:"delete_object",arg:{_id:canvas.getActiveObject()._id,type:canvas.getActiveObject().objType},msgId:msgHandler()}))}function pasteObjects(){for(var center=new fabric.Point(canvas.width/2,canvas.height/2),args=[],i=0;i<canvasClipboard.length;i++)args.push({_id:canvasClipboard[i]._id,x:Math.round(center.x/canvas.getZoom()-settings.x/canvas.getZoom())+canvasClipboard[i].x,y:Math.round(center.y/canvas.getZoom()-settings.y/canvas.getZoom())+canvasClipboard[i].y,z:canvas.getObjects().length+canvasClipboard[i].z});socket.send(JSON.stringify({act:"paste_object",arg:args,msgId:msgHandler()}))}function moveToZ(o,z){o&&("link"===o.objType?socket.send(JSON.stringify({act:"move_object",arg:[{_id:o._id,scale_x:0,scale_y:0,x:0,y:0,z:z,rot:0}],msgId:msgHandler()})):"icon"===o.objType?socket.send(JSON.stringify({act:"move_object",arg:[{_id:o._id,x:o.left,y:o.top,z:z,scale_x:o.scaleX,scale_y:o.scaleY,rot:o.angle}],msgId:msgHandler()})):"shape"===o.objType&&socket.send(JSON.stringify({act:"move_object",arg:[{_id:o._id,x:o.left,y:o.top,z:z,scale_x:o.width,scale_y:o.height,rot:o.angle}],msgId:msgHandler()})))}function moveToFront(){var zTop=canvas.getObjects().length-tempLinks.length-2;moveToZ(canvas.getActiveObject(),zTop/2)}function moveToBack(){moveToZ(canvas.getActiveObject(),0)}function moveUp(){var o=canvas.getActiveObject();canvas.getActiveObject()._id&&canvas.getObjects().indexOf(o)<canvas.getObjects().length-2-tempLinks.length&&moveToZ(o,canvas.getObjects().indexOf(o)/2+1)}function moveDown(){var o=canvas.getActiveObject();canvas.getActiveObject()._id&&0<canvas.getObjects().indexOf(o)&&moveToZ(o,canvas.getObjects().indexOf(o)/2-1)}function changeObject(o){var tempObj={};tempObj._id=o._id,tempObj.x=o.left,tempObj.y=o.top,tempObj.z=canvas.getObjects().indexOf(o),tempObj.scale_x=o.scaleX,tempObj.scale_y=o.scaleY,tempObj.rot=o.angle,tempObj.type=o.objType,tempObj.fill_color=o.fill,tempObj.stroke_color=o.stroke,tempObj.image=o.image,tempObj.locked=o.locked,tempObj.name="";for(var i=0;i<o.children.length;i++)"name"===o.children[i].objType&&(tempObj.name=o.children[i].text);socket.send(JSON.stringify({act:"change_object",arg:tempObj,msgId:msgHandler()}))}fabric.util.addListener(canvas.upperCanvasEl,"dblclick",function(e){var o=canvas.findTarget(e);if(1!==canvas.getActiveObjects().length||creatingLink)closeToolbar();else if(void 0!==o.objType){if($("#propID").val(o._id),$("#propFillColor").val(o.fill),$("#propFillColor").data("paletteColorPickerPlugin").reload(),$("#lockObject").prop("checked",o.locked),$("#propStrokeColor").val(o.stroke),$("#propStrokeColor").data("paletteColorPickerPlugin").reload(),$("#propName").val(""),void 0!==o.children)for(var i=0;i<o.children.length;i++)"name"===o.children[i].objType&&$("#propName").val(o.children[i].text);$("#propType").val(o.objType),$("#prop-"+o.objType).val(o.image.replace(".svg",".png")),$("#prop-"+o.objType).data("picker").sync_picker_with_select(),openToolbar("tools")}}),fabric.Object.prototype.resizeToScale=function(){switch(this.type){case"circle":this.radius*=this.scaleX,this.scaleX=1,this.scaleY=1;break;case"ellipse":this.rx*=this.scaleX,this.ry*=this.scaleY,this.width=2*this.rx,this.height=2*this.ry,this.scaleX=1,this.scaleY=1;break;case"polygon":case"polyline":for(var points=this.get("points"),i=0;i<points.length;i++){var p=points[i];p.x*=this.scaleX,p.y*=this.scaleY}this.scaleX=1,this.scaleY=1,this.width=this.getBoundingBox().width,this.height=this.getBoundingBox().height;break;case"triangle":case"line":case"rect":this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1}},fabric.Object.prototype.getBoundingBox=function(){var minX=null,minY=null,maxX=null,maxY=null;switch(this.type){case"polygon":case"polyline":for(var points=this.get("points"),i=0;i<points.length;i++)null==typeof minX?minX=points[i].x:points[i].x<minX&&(minX=points[i].x),null==typeof minY?minY=points[i].y:points[i].y<minY&&(minY=points[i].y),null==typeof maxX?maxX=points[i].x:points[i].x>maxX&&(maxX=points[i].x),null==typeof maxY?maxY=points[i].y:points[i].y>maxY&&(maxY=points[i].y);break;default:minX=this.left,minY=this.top,maxX=this.left+this.width,maxY=this.top+this.height}return{topLeft:new fabric.Point(minX,minY),bottomRight:new fabric.Point(maxX,maxY),width:maxX-minX,height:maxY-minY}},canvas.on("selection:created",function(options){if(1<canvas.getActiveObjects().length){closeToolbar();for(var i=options.selected.length-1;0<=i;i--)"link"!==options.selected[i].objType&&!options.selected[i].locked||canvas.getActiveObject().removeWithUpdate(options.selected[i])}}),canvas.on("object:rotating",function(options){options.target.set({angle:5*Math.round(options.target.angle/5)})}),canvas.on("object:moving",function(options){objectMoving(options.target,2)}),canvas.on("object:scaling",function(options){var o=options.target,tmod=0,lmod=0;1<canvas.getActiveObjects().length&&(tmod=options.target.top+options.target.height/2,lmod=options.target.left+options.target.width/2),$("#objectWidth").val(Math.round(o.width*o.scaleX)),$("#objectHeight").val(Math.round(o.height*o.scaleY)),drawAlignmentGuides(o,1);o=canvas.getActiveObjects();for(var i=0;i<o.length;i++){o[i].dirty=!0;for(var j=0;j<o[i].children.length;j++)"name"===o[i].children[j].objType?(o[i].children[j].set("top",o[i].top+tmod+o[i].height*o[i].scaleY+4),o[i].children[j].set("left",o[i].left+lmod+o[i].width*o[i].scaleX/2),o[i].children[j].setCoords()):"link"===o[i].children[j].objType&&drawLink(o[i].children[j])}}),canvas.on("object:modified",function(options){objectModified(options.target)}),canvas.on("selection:updated",function(options){updateSelection(options)}),canvas.on("object:selected",function(options){updateSelection(options)}),canvas.on("before:selection:cleared",function(options){updatingObject||closeToolbar()}),canvas.observe("object:modified",function(e){void 0!==e.target&&e.target.resizeToScale&&e.target.resizeToScale()});var f=function(e){var srcElement=e.srcElement?e.srcElement:e.target;if("dragleave"===e.type&&$(srcElement).hasClass("jstree-wholerow-hovered")&&$(srcElement).removeClass("jstree-wholerow-hovered"),-1<$.inArray("Files",e.dataTransfer.types)&&(e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect=$(srcElement).hasClass("droppable")?"copy":"none","copy"===e.dataTransfer.dropEffect&&"dragleave"!==e.type&&$(srcElement).addClass("jstree-wholerow-hovered"),"drop"==e.type)){var formData=new FormData;formData.append("dir",srcElement.id),$.each(e.dataTransfer.files,function(i,file){formData.append("file",file)}),formData.append("mission_id",mission_id),$.ajax({url:"upload",type:"POST",xhr:function(){var mxhr=$.ajaxSettings.xhr();return mxhr.upload&&($("#progressbar").progressbar({value:0}).children(".ui-progressbar-value").html("0%").css("display","block"),mxhr.upload.addEventListener("progress",progressHandler,!1)),mxhr},data:formData,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(){$("#progressbar").progressbar("value",100).children(".ui-progressbar-value").html("Upload successful!"),setTimeout(function(){$("#progressbar").fadeOut("slow")},5e3)},error:function(){$("#progressbar").progressbar("value",100).children(".ui-progressbar-value").html("Upload error!"),console.log("upload error")}})}};function progressHandler(e){if(e.lengthComputable){var p=Math.floor(e.loaded/e.total*100);$("#progressbar").progressbar("value",p).children(".ui-progressbar-value").html(p.toPrecision(3)+"%")}}function rgba2rgb(hex,a){hex=hex.replace("#","");var bigint=parseInt(hex,16);r1=255*(1-a)+a*(bigint>>16&255),g1=255*(1-a)+a*(bigint>>8&255),b1=255*(1-a)+a*(255&bigint);var h,bin=r1<<16|g1<<8|b1;return h=bin.toString(16).toUpperCase(),new Array(7-h.length).join("0")+h}function addZero(i){return i<10&&(i="0"+i),i}function msieversion(){return!!(0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./))}function JSONToCSVConvertor(JSONData,fileName){var arrData="object"!=typeof JSONData?JSON.parse(JSONData):JSONData,CSV="",row="";for(var index in arrData[0])row+=index+",";CSV+=(row=row.slice(0,-1))+"\r\n";for(var i=0;i<arrData.length;i++){row="";for(var index in arrData[i]){row+=(null==arrData[i][index]?"":'"'+arrData[i][index]+'"')+","}row.slice(0,row.length-1),CSV+=row+"\r\n"}if(""!=CSV){if(msieversion()){var IEwindow=window.open();IEwindow.document.write("sep=,\r\n"+CSV),IEwindow.document.close(),IEwindow.document.execCommand("SaveAs",!0,"Result.csv"),IEwindow.close()}else{var uri="data:application/csv;charset=utf-8,"+escape(CSV),link=document.createElement("a");link.href=uri,link.style="visibility:hidden",link.download="Result.csv",document.body.appendChild(link),link.click(),document.body.removeChild(link)}}}function epochToDateString(value){return isNaN(value)?value:getDate(parseInt(value))}function getDate(value){var date;return(date=void 0!==value?new Date(value):new Date).getFullYear()+"-"+addZero(date.getMonth()+1)+"-"+addZero(date.getDate())+" "+addZero(date.getHours())+":"+addZero(date.getMinutes())+":"+addZero(date.getSeconds())+"."+date.getMilliseconds()}function dateStringToEpoch(value){var parts=value.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})\.(\d+)/);return new Date(parts[1],parts[2]-1,parts[3],parts[4],parts[5],parts[6],parts[7]).getTime()}function createNotesTree(arg){$("#notes").on("select_node.jstree",function(e,data){var name="";data.node&&data.node.text&&(name=data.node.text),data.node.li_attr.isLeaf&&editDetails("m-"+mission_id+"-n-"+data.selected[0],name)}).jstree({core:{check_callback:!0,data:arg},plugins:["wholerow","contextmenu"],contextmenu:{select_node:!1,items:function(node){return{newnote:{separator_before:!1,separator_after:!1,label:"New Note",action:function(obj){bootbox.prompt("Note name?",function(name){socket.send(JSON.stringify({act:"insert_note",arg:{name:name},msgId:msgHandler()}))})}},renamenote:{separator_before:!1,separator_after:!1,label:"Rename",action:function(obj){bootbox.prompt("Rename note to?",function(name){socket.send(JSON.stringify({act:"rename_note",arg:{id:node.id,name:name},msgId:msgHandler()}))})}},del:{separator_before:!1,separator_after:!1,label:"Delete Note",action:function(obj){socket.send(JSON.stringify({act:"delete_note",arg:{id:node.id},msgId:msgHandler()}))}}}}}})}$(document).ready(function(){document.body.addEventListener("dragleave",f,!1),document.body.addEventListener("dragover",f,!1),document.body.addEventListener("drop",f,!1),$("#files").on("select_node.jstree",function(e,data){if(data.node.li_attr.isLeaf){var o="download/mission-"+mission_id+"/"+data.selected[0];$("<iframe />").attr("src",o).hide().appendTo("body")}}).jstree({core:{check_callback:!0,themes:{dots:!0},data:{method:"POST",url:function(node){return"dir/"},data:function(node){return{id:node.id,mission_id:mission_id}}}},plugins:["dnd","wholerow","contextmenu"],contextmenu:{select_node:!1,items:function(node){return{mkdir:{separator_before:!1,separator_after:!1,label:"mkdir",action:function(obj){var _node=node;bootbox.prompt("Directory name?",function(name){$.ajax({url:"mkdir",type:"POST",data:{id:_node.id,name:name,mission_id:mission_id},success:function(){},error:function(){console.log("mkdir error")}})})}},del:{separator_before:!1,separator_after:!1,label:"del",action:function(obj){$.ajax({url:"delete",type:"POST",data:{id:node.id,mission_id:mission_id},success:function(){},error:function(){console.log("delete error")}})}}}}}}),$(document).on("dnd_stop.vakata",function(e,data){var dst=$(data.event.target).closest(".jstree-node").attr("id"),src=data.data.nodes[0];$.ajax({url:"mv",type:"POST",data:{dst:dst,src:src},success:function(){},error:function(){console.log("mv error")}})})}),Number.prototype.round=function(places){return+(Math.round(this+"e+"+places)+"e-"+places)};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function toggleToolbar(mode){0===$("#toolbarBody").width()?openToolbar(mode):activeToolbar===mode?closeToolbar():openToolbar(mode)}function openToolbar(mode){if(!toolbarState||mode!=activeToolbar)switch($("#"+activeToolbar+"Tab").removeClass("activeTab"),$("#toolbarBody").animate({width:Math.max(10,Math.min($("#diagramJumbo").width()-60,settings[mode]))},{duration:100}),toolbarState=!0,activeToolbar=mode,$("#"+mode+"Tab").addClass("activeTab"),mode){case"tools":if($("#toolsForm").show(),$("#notesForm").hide(),$("#filesForm").hide(),$("#propFillColorSpan").show(),canvas.getActiveObject()){1<canvas.getActiveObjects().length?$("#toolbarBody").addClass("disabledDiv"):$("#toolbarBody").removeClass("disabledDiv"),permissions.modify_diagram?$("#toolbarTitle").html("Edit Object"):$("#toolbarTitle").text("View Object"),$("#propNameGroup").show(),$("#propObjectGroup").show(),$("#editDetailsButton").show(),$("#deleteObjectButton").show(),$("#insertObjectButton").hide(),$("#newObjectButton").show(),$("#propObjectGroup").tabs("disable");var objType=$("#propType").val();"link"===objType?($("#sizeObject").hide(),$("#lockObjectGroup").hide(),$("#propFillColorSpan").hide()):($("#sizeObject").show(),$("#lockObjectGroup").show());var index=$('#propObjectGroup a[href="#tabs-'+objType+'"]').parent().index();$("#moveObject").show(),$("#propObjectGroup").tabs("enable",index),$("#propObjectGroup").tabs("option","active",index)}else void 0!==canvas.getActiveObject()&&null!==canvas.getActiveObject()||($("#toolbarBody").removeClass("disabledDiv"),$("#toolbarTitle").html("New Object"),$("#propID").val(""),$("#propNameGroup").show(),$("#propName").val(""),$("#propFillColor").val(lastFillColor),$("#propFillColor").data("paletteColorPickerPlugin").reload(),$("#propStrokeColor").val(lastStrokeColor),$("#propStrokeColor").data("paletteColorPickerPlugin").reload(),$("#lockObject").prop("checked",!1),$("#propType").val("icon"),$("#prop-icon").val("00-000-icon-hub.png"),$("#prop-icon").data("picker").sync_picker_with_select(),$("#propObjectGroup").tabs("enable"),$("#propObjectGroup").tabs("option","active",0),$("#moveObject").hide(),$("#newObjectButton").hide(),$("#editDetailsButton").hide(),$("#deleteObjectButton").hide(),$("#insertObjectButton").show());break;case"notes":$("#toolsForm").hide(),$("#notesForm").show(),$("#filesForm").hide();break;case"files":$("#toolsForm").hide(),$("#notesForm").hide(),$("#filesForm").show()}}function closeToolbar(){activeToolbar&&$("#"+activeToolbar+"Tab").removeClass("activeTab"),toolbarState=!1,$("#propName").blur(),$("#toolbarBody").animate({width:"0px"},200)}function updateSelection(options){var o=options.target;if(o&&canvas.getActiveObject()&&void 0!==o.objType)if(creatingLink)"icon"!==o.objType&&"shape"!==o.objType||firstNode===o||(null===firstNode?(firstNode=o,showMessage("Click on a second node to complete the link.")):(showMessage("Link created.",5),$("#cancelLink").hide(),lastFillColor=$("#propFillColor").val(),lastFillColor=$("#propStrokeColor").val(),socket.send(JSON.stringify({act:"insert_object",arg:{name:$("#propName").val(),type:"link",image:$("#prop-link").val().replace(".png",".svg"),stroke_color:$("#propStrokeColor").val(),fill_color:$("#propFillColor").val(),obj_a:firstNode._id,obj_b:o._id,x:0,y:0,z:0,locked:$("#lockObject").is(":checked")},msgId:msgHandler()})),firstNode=null,creatingLink=!1));else{if($("#propID").val(o._id),$("#propFillColor").val(o.fill),$("#propFillColor").data("paletteColorPickerPlugin").reload(),$("#propStrokeColor").val(o.stroke),$("#propStrokeColor").data("paletteColorPickerPlugin").reload(),$("#objectWidth").val(Math.round(o.width*o.scaleX)),$("#objectHeight").val(Math.round(o.height*o.scaleY)),$("#lockObject").prop("checked",o.locked),$("#propName").val(""),void 0!==o.children)for(var i=0;i<o.children.length;i++)"name"===o.children[i].objType&&$("#propName").val(o.children[i].text);$("#propType").val(o.objType),$("#prop-"+o.objType).val(o.image.replace(".svg",".png")),$("#prop-"+o.objType).data("picker").sync_picker_with_select(),toolbarState&&openToolbar("tools"),options.e&&options.e.ctrlKey&&editDetails()}}function newNote(){bootbox.prompt("Note name?",function(name){socket.send(JSON.stringify({act:"insert_note",arg:{name:name},msgId:msgHandler()}))})}function newObject(){canvas.discardActiveObject(),canvas.requestRenderAll(),openToolbar("tools")}function cancelMenu(){return $(window).off("contextmenu",cancelMenu),!1}function insertLink(){creatingLink=!0,showMessage("Click on a node to start a new link."),$("#cancelLink").show()}function cancelLink(){creatingLink=!1,showMessage("Link cancelled.",5),$("#cancelLink").hide()}function updatePropFillColor(color){var o=canvas.getActiveObject();o&&(lastFillColor=$("#propFillColor").val(),o.fill=color,changeObject(o))}function updatePropStrokeColor(color){var o=canvas.getActiveObject();o&&(lastStrokeColor=$("#propStrokeColor").val(),o.stroke=color,changeObject(o))}function updatePropName(name){var o=canvas.getActiveObject();if(o){for(var i=0;i<o.children.length;i++)"name"===o.children[i].objType&&(o.children[i].text=name);changeObject(o),canvas.requestRenderAll()}}function editDetails(id,name){var rw=!1;name=name||"",!id&&canvas.getActiveObject()?(permissions.modify_notes&&(rw=!0),id="m-"+mission_id+"d-"+canvas.getActiveObject()._id,canvas.getActiveObject().name_val&&(name=canvas.getActiveObject().name_val.split("\n")[0])):permissions.modify_notes&&(rw=!0),id&&(""==name&&(name="Note Editor"),$("#modal-title").text(name),$("#modal-footer").html('<button type="button btn-primary" class="button btn btn-default" data-dismiss="modal">Close</button>'),$("#modal-content").addClass("modal-details"),openDocs[id]?console.log("document already open"):(openDocs[id]=shareDBConnection.get("sharedb",id),openDocs[id].subscribe(function(err){if(null===openDocs[id].type&&openDocs[id].create("","rich-text"),err)throw err;if("rich-text"===openDocs[id].type.name){(w=windowManager.createWindow({sticky:!1,title:name,effect:"none",bodyContent:'<div id="object_details_'+id+'" class="object-details" style="resize: none;"></div>',closeCallback:function(){openDocs[id].destroy(),delete openDocs[id]}})).$el.draggable({handle:".modal-header"}).children(".window-content").resizable({minHeight:153,minWidth:300});var quill=new Quill("#object_details_"+id,{theme:"snow",readOnly:!rw,modules:{syntax:!0,toolbar:[[{header:[1,2,!1]}],["bold","italic","underline"],["link","image","code-block"]]}});quill.root.setAttribute("spellcheck",!1),quill.setContents(openDocs[id].data),quill.on("text-change",function(delta,oldDelta,source){"user"===source&&openDocs[id].submitOp(delta,{source:quill})}),openDocs[id].on("op",function(op,source){source!==quill&&quill.updateContents(op)}),$("#object_details_"+id).overlayScrollbars({className:"os-theme-dark"})}else{var w,disabled=" disabled";permissions.modify_details&&(disabled=""),(w=windowManager.createWindow({sticky:!1,title:name,effect:"none",bodyContent:'<textarea id="object_details_'+id+'" class="object-details" style="resize: none; height: 100%"'+disabled+"></textarea>",closeCallback:function(){openDocs[id].destroy(),delete openDocs[id]}})).$el.children(".object-details").overlayScrollbars({className:"os-theme-dark"}),w.$el.draggable({handle:".modal-header"}).children(".window-content").resizable({minHeight:153,minWidth:300});var element=document.getElementById("object_details_"+id);new StringBinding(element,openDocs[id]).setup()}})))}function insertObject(){if(closeToolbar(),"link"===$("#propType").val())insertLink();else{var center=new fabric.Point(canvas.width/2,canvas.height/2);lastFillColor=$("#propFillColor").val(),lastStrokeColor=$("#propStrokeColor").val(),socket.send(JSON.stringify({act:"insert_object",arg:{name:$("#propName").val(),fill_color:$("#propFillColor").val(),stroke_color:$("#propStrokeColor").val(),locked:$("#lockObject").is(":checked"),image:$("#prop-"+$("#propType").val()).val().replace(".png",".svg"),type:$("#propType").val(),x:Math.round(center.x/canvas.getZoom()-settings.x/canvas.getZoom()),y:Math.round(center.y/canvas.getZoom()-settings.y/canvas.getZoom()),z:canvas.getObjects().length},msgId:msgHandler()}))}}function toggleTable(mode){switch($("#"+activeTable+"Tab").removeClass("activeTab"),$("#"+mode+"Tab").addClass("activeTab"),activeTable=mode){case"chat":$("#chat").show(),$("#settings").hide(),firstChat&&($("#log").scrollTop($("#log")[0].scrollHeight),firstChat=!1);break;case"settings":$("#chat").hide(),$("#settings").show(),settingsTabulator.redraw()}}!function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.Tabulator=factory()}(this,function(){"use strict";Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(predicate,argument_1){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=argument_1,k=0;k<len;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return k;k++}return-1}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(predicate,argument_1){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=argument_1,k=0;k<len;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return kValue;k++}}});var ColumnManager=function(table){this.table=table,this.blockHozScrollEvent=!1,this.headersElement=this.createHeadersElement(),this.element=this.createHeaderElement(),this.rowManager=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.element.insertBefore(this.headersElement,this.element.firstChild)};ColumnManager.prototype.createHeadersElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-headers"),el},ColumnManager.prototype.createHeaderElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-header"),this.table.options.headerVisible||el.classList.add("tabulator-header-hidden"),el},ColumnManager.prototype.initialize=function(){},ColumnManager.prototype.setRowManager=function(manager){this.rowManager=manager},ColumnManager.prototype.getElement=function(){return this.element},ColumnManager.prototype.getHeadersElement=function(){return this.headersElement},ColumnManager.prototype.scrollHorizontal=function(left){var scrollWidth=this.element.scrollWidth-this.table.element.clientWidth;this.element.scrollLeft=left,this.element.style.marginLeft=scrollWidth<left?-(left-scrollWidth)+"px":0,this.scrollLeft=left,this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.scrollHorizontal()},ColumnManager.prototype.generateColumnsFromRowData=function(data){var row,sorter,cols=[];if(data&&data.length){for(var key in row=data[0]){var col={field:key,title:key},value=row[key];switch(void 0===value?"undefined":_typeof(value)){case"undefined":sorter="string";break;case"boolean":sorter="boolean";break;case"object":sorter=Array.isArray(value)?"array":"string";break;default:sorter=isNaN(value)||""===value?value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?"alphanum":"string":"number"}col.sorter=sorter,cols.push(col)}this.table.options.columns=cols,this.setColumns(this.table.options.columns)}},ColumnManager.prototype.setColumns=function(cols,row){for(var self=this;self.headersElement.firstChild;)self.headersElement.removeChild(self.headersElement.firstChild);self.columns=[],self.columnsByIndex=[],self.columnsByField={},self.table.modExists("frozenColumns")&&self.table.modules.frozenColumns.reset(),cols.forEach(function(def,i){self._addColumn(def)}),self._reIndexColumns(),self.table.options.responsiveLayout&&self.table.modExists("responsiveLayout",!0)&&self.table.modules.responsiveLayout.initialize(),self.redraw(!0)},ColumnManager.prototype._addColumn=function(definition,before,nextToColumn){var column=new Column(definition,this),colEl=column.getElement(),index=nextToColumn?this.findColumnIndex(nextToColumn):nextToColumn;if(nextToColumn&&-1<index){var parentIndex=this.columns.indexOf(nextToColumn.getTopColumn()),nextEl=nextToColumn.getElement();before?(this.columns.splice(parentIndex,0,column),nextEl.parentNode.insertBefore(colEl,nextEl)):(this.columns.splice(parentIndex+1,0,column),nextEl.parentNode.insertBefore(colEl,nextEl.nextSibling))}else before?(this.columns.unshift(column),this.headersElement.insertBefore(column.getElement(),this.headersElement.firstChild)):(this.columns.push(column),this.headersElement.appendChild(column.getElement()));return column},ColumnManager.prototype.registerColumnField=function(col){col.definition.field&&(this.columnsByField[col.definition.field]=col)},ColumnManager.prototype.registerColumnPosition=function(col){this.columnsByIndex.push(col)},ColumnManager.prototype._reIndexColumns=function(){this.columnsByIndex=[],this.columns.forEach(function(column){column.reRegisterPosition()})},ColumnManager.prototype._verticalAlignHeaders=function(){var self=this,minHeight=0;self.columns.forEach(function(column){var height;column.clearVerticalAlign(),height=column.getHeight(),minHeight<height&&(minHeight=height)}),self.columns.forEach(function(column){column.verticalAlign(self.table.options.columnVertAlign,minHeight)}),self.rowManager.adjustTableSize()},ColumnManager.prototype.findColumn=function(subject){return"object"!=(void 0===subject?"undefined":_typeof(subject))?this.columnsByField[subject]||!1:subject instanceof Column?subject:subject instanceof ColumnComponent?subject._getSelf()||!1:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement&&this.columns.find(function(column){return column.element===subject})||!1},ColumnManager.prototype.getColumnByField=function(field){return this.columnsByField[field]},ColumnManager.prototype.getColumnByIndex=function(index){return this.columnsByIndex[index]},ColumnManager.prototype.getFirstVisibileColumn=function(index){return-1<(index=this.columnsByIndex.findIndex(function(col){return col.visible}))&&this.columnsByIndex[index]},ColumnManager.prototype.getColumns=function(){return this.columns},ColumnManager.prototype.findColumnIndex=function(column){return this.columnsByIndex.findIndex(function(col){return column===col})},ColumnManager.prototype.getRealColumns=function(){return this.columnsByIndex},ColumnManager.prototype.traverse=function(callback){this.columnsByIndex.forEach(function(column,i){callback(column,i)})},ColumnManager.prototype.getDefinitions=function(active){var output=[];return this.columnsByIndex.forEach(function(column){(!active||active&&column.visible)&&output.push(column.getDefinition())}),output},ColumnManager.prototype.getDefinitionTree=function(){var output=[];return this.columns.forEach(function(column){output.push(column.getDefinition(!0))}),output},ColumnManager.prototype.getComponents=function(structured){var output=[];return(structured?this.columns:this.columnsByIndex).forEach(function(column){output.push(column.getComponent())}),output},ColumnManager.prototype.getWidth=function(){var width=0;return this.columnsByIndex.forEach(function(column){column.visible&&(width+=column.getWidth())}),width},ColumnManager.prototype.moveColumn=function(from,to,after){this.moveColumnActual(from,to,after),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.initialize(),this.table.modExists("columnCalcs")&&this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows),to.element.parentNode.insertBefore(from.element,to.element),after&&to.element.parentNode.insertBefore(to.element,from.element),this._verticalAlignHeaders(),this.table.rowManager.reinitialize()},ColumnManager.prototype.moveColumnActual=function(from,to,after){this._moveColumnInArray(this.columns,from,to,after),this._moveColumnInArray(this.columnsByIndex,from,to,after,!0),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.initialize(),this.table.options.columnMoved&&this.table.options.columnMoved.call(this.table,from.getComponent(),this.table.columnManager.getComponents()),this.table.options.persistentLayout&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("columns")},ColumnManager.prototype._moveColumnInArray=function(columns,from,to,after,updateRows){var toIndex,fromIndex=columns.indexOf(from);-1<fromIndex&&(columns.splice(fromIndex,1),-1<(toIndex=columns.indexOf(to))?after&&(toIndex+=1):toIndex=fromIndex,columns.splice(toIndex,0,from),updateRows&&this.table.rowManager.rows.forEach(function(row){if(row.cells.length){var cell=row.cells.splice(fromIndex,1)[0];row.cells.splice(toIndex,0,cell)}}))},ColumnManager.prototype.scrollToColumn=function(column,position,ifVisible){var _this=this,left=0,offset=0,adjust=0,colEl=column.getElement();return new Promise(function(resolve,reject){if(void 0===position&&(position=_this.table.options.scrollToColumnPosition),void 0===ifVisible&&(ifVisible=_this.table.options.scrollToColumnIfVisible),column.visible){switch(position){case"middle":case"center":adjust=-_this.element.clientWidth/2;break;case"right":adjust=colEl.clientWidth-_this.headersElement.clientWidth}if(!ifVisible&&0<(offset=colEl.offsetLeft)&&offset+colEl.offsetWidth<_this.element.clientWidth)return!1;left=colEl.offsetLeft+_this.element.scrollLeft+adjust,left=Math.max(Math.min(left,_this.table.rowManager.element.scrollWidth-_this.table.rowManager.element.clientWidth),0),_this.table.rowManager.scrollHorizontal(left),_this.scrollHorizontal(left),resolve()}else console.warn("Scroll Error - Column not visible"),reject("Scroll Error - Column not visible")})},ColumnManager.prototype.generateCells=function(row){var cells=[];return this.columnsByIndex.forEach(function(column){cells.push(column.generateCell(row))}),cells},ColumnManager.prototype.getFlexBaseWidth=function(){var self=this,totalWidth=self.table.element.clientWidth,fixedWidth=0;return self.rowManager.element.scrollHeight>self.rowManager.element.clientHeight&&(totalWidth-=self.rowManager.element.offsetWidth-self.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(column){var width,minWidth,colWidth;column.visible&&(width=column.definition.width||0,minWidth=void 0===column.minWidth?self.table.options.columnMinWidth:parseInt(column.minWidth),colWidth="string"==typeof width?-1<width.indexOf("%")?totalWidth/100*parseInt(width):parseInt(width):width,fixedWidth+=minWidth<colWidth?colWidth:minWidth)}),fixedWidth},ColumnManager.prototype.addColumn=function(definition,before,nextToColumn){var column=this._addColumn(definition,before,nextToColumn);this._reIndexColumns(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.initialize(),this.table.modExists("columnCalcs")&&this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows),this.redraw(),"fitColumns"!=this.table.modules.layout.getMode()&&column.reinitializeWidth(),this._verticalAlignHeaders(),this.table.rowManager.reinitialize()},ColumnManager.prototype.deregisterColumn=function(column){var index,field=column.getField();field&&delete this.columnsByField[field],-1<(index=this.columnsByIndex.indexOf(column))&&this.columnsByIndex.splice(index,1),-1<(index=this.columns.indexOf(column))&&this.columns.splice(index,1),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.initialize(),this.redraw()},ColumnManager.prototype.redraw=function(force){force&&(Tabulator.prototype.helpers.elVisible(this.element)&&this._verticalAlignHeaders(),this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),"fitColumns"==this.table.modules.layout.getMode()?this.table.modules.layout.layout():force?this.table.modules.layout.layout():this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout(),this.table.modExists("columnCalcs")&&this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows),force&&(this.table.options.persistentLayout&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("columns"),this.table.modExists("columnCalcs")&&this.table.modules.columnCalcs.redraw()),this.table.footerManager.redraw()};var ColumnComponent=function(column){this._column=column,this.type="ColumnComponent"};ColumnComponent.prototype.getElement=function(){return this._column.getElement()},ColumnComponent.prototype.getDefinition=function(){return this._column.getDefinition()},ColumnComponent.prototype.getField=function(){return this._column.getField()},ColumnComponent.prototype.getCells=function(){var cells=[];return this._column.cells.forEach(function(cell){cells.push(cell.getComponent())}),cells},ColumnComponent.prototype.getVisibility=function(){return this._column.visible},ColumnComponent.prototype.show=function(){this._column.isGroup?this._column.columns.forEach(function(column){column.show()}):this._column.show()},ColumnComponent.prototype.hide=function(){this._column.isGroup?this._column.columns.forEach(function(column){column.hide()}):this._column.hide()},ColumnComponent.prototype.toggle=function(){this._column.visible?this.hide():this.show()},ColumnComponent.prototype.delete=function(){this._column.delete()},ColumnComponent.prototype.getSubColumns=function(){var output=[];return this._column.columns.length&&this._column.columns.forEach(function(column){output.push(column.getComponent())}),output},ColumnComponent.prototype.getParentColumn=function(){return this._column.parent instanceof Column&&this._column.parent.getComponent()},ColumnComponent.prototype._getSelf=function(){return this._column},ColumnComponent.prototype.scrollTo=function(){return this._column.table.columnManager.scrollToColumn(this._column)},ColumnComponent.prototype.getTable=function(){return this._column.table},ColumnComponent.prototype.headerFilterFocus=function(){this._column.table.modExists("filter",!0)&&this._column.table.modules.filter.setHeaderFilterFocus(this._column)},ColumnComponent.prototype.reloadHeaderFilter=function(){this._column.table.modExists("filter",!0)&&this._column.table.modules.filter.reloadHeaderFilter(this._column)},ColumnComponent.prototype.setHeaderFilterValue=function(value){this._column.table.modExists("filter",!0)&&this._column.table.modules.filter.setHeaderFilterValue(this._column,value)},ColumnComponent.prototype.move=function(to,after){var toColumn=this._column.table.columnManager.findColumn(to);toColumn?this._column.table.columnManager.moveColumn(this._column,toColumn,after):console.warn("Move Error - No matching column found:",toColumn)},ColumnComponent.prototype.getNextColumn=function(){var nextCol=this._column.nextColumn();return!!nextCol&&nextCol.getComponent()},ColumnComponent.prototype.getPrevColumn=function(){var prevCol=this._column.prevColumn();return!!prevCol&&prevCol.getComponent()};var Column=function Column(def,parent){var self=this;this.table=parent.table,this.definition=def,this.parent=parent,this.type="column",this.columns=[],this.cells=[],this.element=this.createElement(),this.contentElement=!1,this.groupElement=this.createGroupElement(),this.isGroup=!1,this.tooltip=!1,this.hozAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.setField(this.definition.field),this.table.options.invalidOptionWarnings&&this.checkDefinition(),this.modules={},this.cellEvents={cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1,cellMouseEnter:!1,cellMouseLeave:!1,cellMouseOver:!1,cellMouseOut:!1,cellMouseMove:!1},this.width=null,this.widthStyled="",this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this._mapDepricatedFunctionality(),def.columns?(this.isGroup=!0,def.columns.forEach(function(def,i){var newCol=new Column(def,self);self.attachColumn(newCol)}),self.checkColumnVisibility()):parent.registerColumnField(this),def.rowHandle&&!1!==this.table.options.movableRows&&this.table.modExists("moveRow")&&this.table.modules.moveRow.setHandle(!0),this._buildHeader()};Column.prototype.createElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-col"),el.setAttribute("role","columnheader"),el.setAttribute("aria-sort","none"),el},Column.prototype.createGroupElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-col-group-cols"),el},Column.prototype.checkDefinition=function(){var _this2=this;Object.keys(this.definition).forEach(function(key){-1===_this2.defaultOptionList.indexOf(key)&&console.warn("Invalid column definition option in '"+(_this2.field||_this2.definition.title)+"' column:",key)})},Column.prototype.setField=function(field){this.field=field,this.fieldStructure=field?this.table.options.nestedFieldSeparator?field.split(this.table.options.nestedFieldSeparator):[field]:[],this.getFieldValue=1<this.fieldStructure.length?this._getNestedData:this._getFlatData,this.setFieldValue=1<this.fieldStructure.length?this._setNesteData:this._setFlatData},Column.prototype.registerColumnPosition=function(column){this.parent.registerColumnPosition(column)},Column.prototype.registerColumnField=function(column){this.parent.registerColumnField(column)},Column.prototype.reRegisterPosition=function(){this.isGroup?this.columns.forEach(function(column){column.reRegisterPosition()}):this.registerColumnPosition(this)},Column.prototype._mapDepricatedFunctionality=function(){void 0!==this.definition.hideInHtml&&(this.definition.htmlOutput=!this.definition.hideInHtml,console.warn("hideInHtml column definition property is deprecated, you should now use htmlOutput"))},Column.prototype.setTooltip=function(){var self=this,def=self.definition,tooltip=def.headerTooltip||!1===def.tooltip?def.headerTooltip:self.table.options.tooltipsHeader;tooltip?!0===tooltip?def.field?self.table.modules.localize.bind("columns|"+def.field,function(value){self.element.setAttribute("title",value||def.title)}):self.element.setAttribute("title",def.title):("function"==typeof tooltip&&!1===(tooltip=tooltip(self.getComponent()))&&(tooltip=""),self.element.setAttribute("title",tooltip)):self.element.setAttribute("title","")},Column.prototype._buildHeader=function(){for(var self=this,def=self.definition;self.element.firstChild;)self.element.removeChild(self.element.firstChild);def.headerVertical&&(self.element.classList.add("tabulator-col-vertical"),"flip"===def.headerVertical&&self.element.classList.add("tabulator-col-vertical-flip")),self.contentElement=self._bindEvents(),self.contentElement=self._buildColumnHeaderContent(),self.element.appendChild(self.contentElement),self.isGroup?self._buildGroupHeader():self._buildColumnHeader(),self.setTooltip(),self.table.options.resizableColumns&&self.table.modExists("resizeColumns")&&self.table.modules.resizeColumns.initializeColumn("header",self,self.element),def.headerFilter&&self.table.modExists("filter")&&self.table.modExists("edit")&&(void 0!==def.headerFilterPlaceholder&&def.field&&self.table.modules.localize.setHeaderFilterColumnPlaceholder(def.field,def.headerFilterPlaceholder),self.table.modules.filter.initializeColumn(self)),self.table.modExists("frozenColumns")&&self.table.modules.frozenColumns.initializeColumn(self),self.table.options.movableColumns&&!self.isGroup&&self.table.modExists("moveColumn")&&self.table.modules.moveColumn.initializeColumn(self),(def.topCalc||def.bottomCalc)&&self.table.modExists("columnCalcs")&&self.table.modules.columnCalcs.initializeColumn(self),self.element.addEventListener("mouseenter",function(e){self.setTooltip()})},Column.prototype._bindEvents=function(){var dblTap,tapHold,tap,self=this,def=self.definition;"function"==typeof def.headerClick&&self.element.addEventListener("click",function(e){def.headerClick(e,self.getComponent())}),"function"==typeof def.headerDblClick&&self.element.addEventListener("dblclick",function(e){def.headerDblClick(e,self.getComponent())}),"function"==typeof def.headerContext&&self.element.addEventListener("contextmenu",function(e){def.headerContext(e,self.getComponent())}),"function"==typeof def.headerTap&&(tap=!1,self.element.addEventListener("touchstart",function(e){tap=!0},{passive:!0}),self.element.addEventListener("touchend",function(e){tap&&def.headerTap(e,self.getComponent()),tap=!1})),"function"==typeof def.headerDblTap&&(dblTap=null,self.element.addEventListener("touchend",function(e){dblTap?(clearTimeout(dblTap),dblTap=null,def.headerDblTap(e,self.getComponent())):dblTap=setTimeout(function(){clearTimeout(dblTap),dblTap=null},300)})),"function"==typeof def.headerTapHold&&(tapHold=null,self.element.addEventListener("touchstart",function(e){clearTimeout(tapHold),tapHold=setTimeout(function(){clearTimeout(tapHold),tapHold=null,tap=!1,def.headerTapHold(e,self.getComponent())},1e3)},{passive:!0}),self.element.addEventListener("touchend",function(e){clearTimeout(tapHold),tapHold=null})),"function"==typeof def.cellClick&&(self.cellEvents.cellClick=def.cellClick),"function"==typeof def.cellDblClick&&(self.cellEvents.cellDblClick=def.cellDblClick),"function"==typeof def.cellContext&&(self.cellEvents.cellContext=def.cellContext),"function"==typeof def.cellMouseEnter&&(self.cellEvents.cellMouseEnter=def.cellMouseEnter),"function"==typeof def.cellMouseLeave&&(self.cellEvents.cellMouseLeave=def.cellMouseLeave),"function"==typeof def.cellMouseOver&&(self.cellEvents.cellMouseOver=def.cellMouseOver),"function"==typeof def.cellMouseOut&&(self.cellEvents.cellMouseOut=def.cellMouseOut),"function"==typeof def.cellMouseMove&&(self.cellEvents.cellMouseMove=def.cellMouseMove),"function"==typeof def.cellTap&&(self.cellEvents.cellTap=def.cellTap),"function"==typeof def.cellDblTap&&(self.cellEvents.cellDblTap=def.cellDblTap),"function"==typeof def.cellTapHold&&(self.cellEvents.cellTapHold=def.cellTapHold),"function"==typeof def.cellEdited&&(self.cellEvents.cellEdited=def.cellEdited),"function"==typeof def.cellEditing&&(self.cellEvents.cellEditing=def.cellEditing),"function"==typeof def.cellEditCancelled&&(self.cellEvents.cellEditCancelled=def.cellEditCancelled)},Column.prototype._buildColumnHeader=function(){var self=this,def=self.definition,table=self.table;table.modExists("sort")&&table.modules.sort.initializeColumn(self,self.contentElement),table.modExists("format")&&table.modules.format.initializeColumn(self),void 0!==def.editor&&table.modExists("edit")&&table.modules.edit.initializeColumn(self),void 0!==def.validator&&table.modExists("validate")&&table.modules.validate.initializeColumn(self),table.modExists("mutator")&&table.modules.mutator.initializeColumn(self),table.modExists("accessor")&&table.modules.accessor.initializeColumn(self),_typeof(table.options.responsiveLayout)&&table.modExists("responsiveLayout")&&table.modules.responsiveLayout.initializeColumn(self),void 0!==def.visible&&(def.visible?self.show(!0):self.hide(!0)),def.cssClass&&def.cssClass.split(" ").forEach(function(className){self.element.classList.add(className)});def.field&&this.element.setAttribute("tabulator-field",def.field),self.setMinWidth(void 0===def.minWidth?self.table.options.columnMinWidth:parseInt(def.minWidth)),self.reinitializeWidth(),self.tooltip=self.definition.tooltip||!1===self.definition.tooltip?self.definition.tooltip:self.table.options.tooltips,self.hozAlign=void 0===self.definition.align?"":self.definition.align},Column.prototype._buildColumnHeaderContent=function(){this.definition,this.table;var contentElement=document.createElement("div");return contentElement.classList.add("tabulator-col-content"),contentElement.appendChild(this._buildColumnHeaderTitle()),contentElement},Column.prototype._buildColumnHeaderTitle=function(){var self=this,def=self.definition,table=self.table,titleHolderElement=document.createElement("div");if(titleHolderElement.classList.add("tabulator-col-title"),def.editableTitle){var titleElement=document.createElement("input");titleElement.classList.add("tabulator-title-editor"),titleElement.addEventListener("click",function(e){e.stopPropagation(),titleElement.focus()}),titleElement.addEventListener("change",function(){def.title=titleElement.value,table.options.columnTitleChanged.call(self.table,self.getComponent())}),titleHolderElement.appendChild(titleElement),def.field?table.modules.localize.bind("columns|"+def.field,function(text){titleElement.value=text||def.title||"&nbsp;"}):titleElement.value=def.title||"&nbsp;"}else def.field?table.modules.localize.bind("columns|"+def.field,function(text){self._formatColumnHeaderTitle(titleHolderElement,text||def.title||"&nbsp;")}):self._formatColumnHeaderTitle(titleHolderElement,def.title||"&nbsp;");return titleHolderElement},Column.prototype._formatColumnHeaderTitle=function(el,title){var formatter,contents,params,mockCell;if(this.definition.titleFormatter&&this.table.modExists("format"))switch(formatter=this.table.modules.format.getFormatter(this.definition.titleFormatter),mockCell={getValue:function(){return title},getElement:function(){return el}},params="function"==typeof(params=this.definition.titleFormatterParams||{})?params():params,void 0===(contents=formatter.call(this.table.modules.format,mockCell,params))?"undefined":_typeof(contents)){case"object":contents instanceof Node?el.appendChild(contents):(el.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",contents));break;case"undefined":case"null":el.innerHTML="";break;default:el.innerHTML=contents}else el.innerHTML=title},Column.prototype._buildGroupHeader=function(){this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.element.appendChild(this.groupElement)},Column.prototype._getFlatData=function(data){return data[this.field]},Column.prototype._getNestedData=function(data){for(var output,dataObj=data,structure=this.fieldStructure,length=structure.length,i=0;i<length&&(output=dataObj=dataObj[structure[i]]);i++);return output},Column.prototype._setFlatData=function(data,value){this.field&&(data[this.field]=value)},Column.prototype._setNesteData=function(data,value){for(var dataObj=data,structure=this.fieldStructure,length=structure.length,i=0;i<length;i++)i==length-1?dataObj[structure[i]]=value:(dataObj[structure[i]]||(dataObj[structure[i]]={}),dataObj=dataObj[structure[i]])},Column.prototype.attachColumn=function(column){this.groupElement?(this.columns.push(column),this.groupElement.appendChild(column.getElement())):console.warn("Column Warning - Column being attached to another column instead of column group")},Column.prototype.verticalAlign=function(alignment,height){var parentHeight=this.parent.isGroup?this.parent.getGroupElement().clientHeight:height||this.parent.getHeadersElement().clientHeight;this.element.style.height=parentHeight+"px",this.isGroup&&(this.groupElement.style.minHeight=parentHeight-this.contentElement.offsetHeight+"px"),this.isGroup||"top"===alignment||(this.element.style.paddingTop="bottom"===alignment?this.element.clientHeight-this.contentElement.offsetHeight+"px":(this.element.clientHeight-this.contentElement.offsetHeight)/2+"px"),this.columns.forEach(function(column){column.verticalAlign(alignment)})},Column.prototype.clearVerticalAlign=function(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(column){column.clearVerticalAlign()})},Column.prototype.getElement=function(){return this.element},Column.prototype.getGroupElement=function(){return this.groupElement},Column.prototype.getField=function(){return this.field},Column.prototype.getFirstColumn=function(){return this.isGroup?!!this.columns.length&&this.columns[0].getFirstColumn():this},Column.prototype.getLastColumn=function(){return this.isGroup?!!this.columns.length&&this.columns[this.columns.length-1].getLastColumn():this},Column.prototype.getColumns=function(){return this.columns},Column.prototype.getCells=function(){return this.cells},Column.prototype.getTopColumn=function(){return this.parent.isGroup?this.parent.getTopColumn():this},Column.prototype.getDefinition=function(updateBranches){var colDefs=[];return this.isGroup&&updateBranches&&(this.columns.forEach(function(column){colDefs.push(column.getDefinition(!0))}),this.definition.columns=colDefs),this.definition},Column.prototype.checkColumnVisibility=function(){var visible=!1;this.columns.forEach(function(column){column.visible&&(visible=!0)}),visible?(this.show(),this.parent.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!1)):this.hide()},Column.prototype.show=function(silent,responsiveToggle){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(cell){cell.show()}),this.isGroup||null!==this.width||this.reinitializeWidth(),this.table.columnManager._verticalAlignHeaders(),this.table.options.persistentLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.persistence.save("columns"),!responsiveToggle&&this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.updateColumnVisibility(this,this.visible),silent||this.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths())},Column.prototype.hide=function(silent,responsiveToggle){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager._verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(cell){cell.hide()}),this.table.options.persistentLayout&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("columns"),!responsiveToggle&&this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.updateColumnVisibility(this,this.visible),silent||this.table.options.columnVisibilityChanged.call(this.table,this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths())},Column.prototype.matchChildWidths=function(){var childWidth=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(column){column.visible&&(childWidth+=column.getWidth())}),this.contentElement.style.maxWidth=childWidth-1+"px")},Column.prototype.setWidth=function(width){this.widthFixed=!0,this.setWidthActual(width)},Column.prototype.setWidthActual=function(width){isNaN(width)&&(width=Math.floor(this.table.element.clientWidth/100*parseInt(width))),width=Math.max(this.minWidth,width),this.width=width,this.widthStyled=width?width+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(cell){cell.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()},Column.prototype.checkCellHeights=function(){var rows=[];this.cells.forEach(function(cell){cell.row.heightInitialized&&(null!==cell.row.getElement().offsetParent?(rows.push(cell.row),cell.row.clearCellHeight()):cell.row.heightInitialized=!1)}),rows.forEach(function(row){row.calcHeight()}),rows.forEach(function(row){row.setCellHeight()})},Column.prototype.getWidth=function(){return this.width},Column.prototype.getHeight=function(){return this.element.offsetHeight},Column.prototype.setMinWidth=function(minWidth){this.minWidth=minWidth,this.minWidthStyled=minWidth?minWidth+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(cell){cell.setMinWidth()})},Column.prototype.delete=function(){this.isGroup&&this.columns.forEach(function(column){column.delete()});for(var cellCount=this.cells.length,i=0;i<cellCount;i++)this.cells[0].delete();this.element.parentNode.removeChild(this.element),this.table.columnManager.deregisterColumn(this)},Column.prototype.generateCell=function(row){var cell=new Cell(this,row);return this.cells.push(cell),cell},Column.prototype.nextColumn=function(){var index=this.table.columnManager.findColumnIndex(this);return-1<index&&this._nextVisibleColumn(index+1)},Column.prototype._nextVisibleColumn=function(index){var column=this.table.columnManager.getColumnByIndex(index);return!column||column.visible?column:this._nextVisibleColumn(index+1)},Column.prototype.prevColumn=function(){var index=this.table.columnManager.findColumnIndex(this);return-1<index&&this._prevVisibleColumn(index-1)},Column.prototype._prevVisibleColumn=function(index){var column=this.table.columnManager.getColumnByIndex(index);return!column||column.visible?column:this._prevVisibleColumn(index-1)},Column.prototype.reinitializeWidth=function(force){this.widthFixed=!1,void 0===this.definition.width||force||this.setWidth(this.definition.width),this.table.modExists("filter")&&this.table.modules.filter.hideHeaderFilterElements(),this.fitToData(),this.table.modExists("filter")&&this.table.modules.filter.showHeaderFilterElements()},Column.prototype.fitToData=function(){this.widthFixed||(this.element.style.width="",this.cells.forEach(function(cell){cell.clearWidth()}));var maxWidth=this.element.offsetWidth;this.width&&this.widthFixed||(this.cells.forEach(function(cell){var width=cell.getWidth();maxWidth<width&&(maxWidth=width)}),maxWidth&&this.setWidthActual(maxWidth+1))},Column.prototype.deleteCell=function(cell){var index=this.cells.indexOf(cell);-1<index&&this.cells.splice(index,1)},Column.prototype.defaultOptionList=["title","field","columns","visible","align","width","minWidth","widthGrow","widthShrink","resizable","frozen","responsive","tooltip","cssClass","rowHandle","hideInHtml","print","htmlOutput","sorter","sorterParams","formatter","formatterParams","variableHeight","editable","editor","editorParams","validator","mutator","mutatorParams","mutatorData","mutatorDataParams","mutatorEdit","mutatorEditParams","mutatorClipboard","mutatorClipboardParams","accessor","accessorParams","accessorData","accessorDataParams","accessorDownload","accessorDownloadParams","accessorClipboard","accessorClipboardParams","clipboard","download","downloadTitle","topCalc","topCalcParams","topCalcFormatter","topCalcFormatterParams","bottomCalc","bottomCalcParams","bottomCalcFormatter","bottomCalcFormatterParams","cellClick","cellDblClick","cellContext","cellTap","cellDblTap","cellTapHold","cellMouseEnter","cellMouseLeave","cellMouseOver","cellMouseOut","cellMouseMove","cellEditing","cellEdited","cellEditCancelled","headerSort","headerSortStartingDir","headerSortTristate","headerClick","headerDblClick","headerContext","headerTap","headerDblTap","headerTapHold","headerTooltip","headerVertical","editableTitle","titleFormatter","titleFormatterParams","headerFilter","headerFilterPlaceholder","headerFilterParams","headerFilterEmptyCheck","headerFilterFunc","headerFilterFuncParams","headerFilterLiveFilter","print"],Column.prototype.getComponent=function(){return new ColumnComponent(this)};var RowManager=function(table){this.table=table,this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.columnManager=null,this.height=0,this.firstRender=!1,this.renderMode="classic",this.rows=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]};RowManager.prototype.createHolderElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-tableHolder"),el.setAttribute("tabindex",0),el},RowManager.prototype.createTableElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-table"),el},RowManager.prototype.getElement=function(){return this.element},RowManager.prototype.getTableElement=function(){return this.tableElement},RowManager.prototype.getRowPosition=function(row,active){return active?this.activeRows.indexOf(row):this.rows.indexOf(row)},RowManager.prototype.setColumnManager=function(manager){this.columnManager=manager},RowManager.prototype.initialize=function(){var self=this;self.setRenderMode(),self.element.appendChild(self.tableElement),self.firstRender=!0,self.element.addEventListener("scroll",function(){var left=self.element.scrollLeft;self.scrollLeft!=left&&(self.columnManager.scrollHorizontal(left),self.table.options.groupBy&&self.table.modules.groupRows.scrollHeaders(left),self.table.modExists("columnCalcs")&&self.table.modules.columnCalcs.scrollHorizontal(left)),self.scrollLeft=left}),"virtual"===this.renderMode&&self.element.addEventListener("scroll",function(){var top=self.element.scrollTop,dir=self.scrollTop>top;self.scrollTop!=top?(self.scrollTop=top,self.scrollVertical(dir),"scroll"==self.table.options.ajaxProgressiveLoad&&self.table.modules.ajax.nextPage(self.element.scrollHeight-self.element.clientHeight-top)):self.scrollTop=top})},RowManager.prototype.findRow=function(subject){var self=this;if("object"==(void 0===subject?"undefined":_typeof(subject))){if(subject instanceof Row)return subject;if(subject instanceof RowComponent)return subject._getSelf()||!1;if("undefined"!=typeof HTMLElement&&subject instanceof HTMLElement)return self.rows.find(function(row){return row.element===subject})||!1}else{return null!=subject&&(self.rows.find(function(row){return row.data[self.table.options.index]==subject})||!1)}return!1},RowManager.prototype.getRowFromDataObject=function(data){return this.rows.find(function(row){return row.data===data})||!1},RowManager.prototype.getRowFromPosition=function(position,active){return active?this.activeRows[position]:this.rows[position]},RowManager.prototype.scrollToRow=function(row,position,ifVisible){var rowTop,_this3=this,rowIndex=this.getDisplayRows().indexOf(row),rowEl=row.getElement(),offset=0;return new Promise(function(resolve,reject){if(-1<rowIndex){if(void 0===position&&(position=_this3.table.options.scrollToRowPosition),void 0===ifVisible&&(ifVisible=_this3.table.options.scrollToRowIfVisible),"nearest"===position)switch(_this3.renderMode){case"classic":rowTop=Tabulator.prototype.helpers.elOffset(rowEl).top,position=Math.abs(_this3.element.scrollTop-rowTop)>Math.abs(_this3.element.scrollTop+_this3.element.clientHeight-rowTop)?"bottom":"top";break;case"virtual":position=Math.abs(_this3.vDomTop-rowIndex)>Math.abs(_this3.vDomBottom-rowIndex)?"bottom":"top"}if(!ifVisible&&Tabulator.prototype.helpers.elVisible(rowEl)&&0<(offset=Tabulator.prototype.helpers.elOffset(rowEl).top-Tabulator.prototype.helpers.elOffset(_this3.element).top)&&offset<_this3.element.clientHeight-rowEl.offsetHeight)return!1;switch(_this3.renderMode){case"classic":_this3.element.scrollTop=Tabulator.prototype.helpers.elOffset(rowEl).top-Tabulator.prototype.helpers.elOffset(_this3.element).top+_this3.element.scrollTop;break;case"virtual":_this3._virtualRenderFill(rowIndex,!0)}switch(position){case"middle":case"center":_this3.element.scrollTop=_this3.element.scrollTop-_this3.element.clientHeight/2;break;case"bottom":_this3.element.scrollTop=_this3.element.scrollTop-_this3.element.clientHeight+rowEl.offsetHeight}resolve()}else console.warn("Scroll Error - Row not visible"),reject("Scroll Error - Row not visible")})},RowManager.prototype.setData=function(data,renderInPosition){var _this4=this,self=this;return new Promise(function(resolve,reject){renderInPosition&&_this4.getDisplayRows().length?self.table.options.pagination?self._setDataActual(data,!0):_this4.reRenderInPosition(function(){self._setDataActual(data)}):(_this4.table.options.autoColumns&&_this4.table.columnManager.generateColumnsFromRowData(data),_this4.resetScroll(),_this4._setDataActual(data)),resolve()})},RowManager.prototype._setDataActual=function(data,renderInPosition){var self=this;self.table.options.dataLoading.call(this.table,data),this._wipeElements(),this.table.options.history&&this.table.modExists("history")&&this.table.modules.history.clear(),Array.isArray(data)?(this.table.modExists("selectRow")&&this.table.modules.selectRow.clearSelectionData(),this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)&&this.table.modules.reactiveData.watchData(data),data.forEach(function(def,i){if(def&&"object"===(void 0===def?"undefined":_typeof(def))){var row=new Row(def,self);self.rows.push(row)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",def)}),self.table.options.dataLoaded.call(this.table,data),self.refreshActiveData(!1,!1,renderInPosition)):console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ",void 0===data?"undefined":_typeof(data),"\nData:     ",data)},RowManager.prototype._wipeElements=function(){this.rows.forEach(function(row){row.wipe()}),this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.wipe(),this.rows=[]},RowManager.prototype.deleteRow=function(row,blockRedraw){var allIndex=this.rows.indexOf(row),activeIndex=this.activeRows.indexOf(row);-1<activeIndex&&this.activeRows.splice(activeIndex,1),-1<allIndex&&this.rows.splice(allIndex,1),this.setActiveRows(this.activeRows),this.displayRowIterator(function(rows){var displayIndex=rows.indexOf(row);-1<displayIndex&&rows.splice(displayIndex,1)}),blockRedraw||this.reRenderInPosition(),this.table.options.rowDeleted.call(this.table,row.getComponent()),this.table.options.dataEdited.call(this.table,this.getData()),this.table.options.groupBy&&this.table.modExists("groupRows")?this.table.modules.groupRows.updateGroupRows(!0):this.table.options.pagination&&this.table.modExists("page")?this.refreshActiveData(!1,!1,!0):this.table.options.pagination&&this.table.modExists("page")&&this.refreshActiveData("page")},RowManager.prototype.addRow=function(data,pos,index,blockRedraw){var row=this.addRowActual(data,pos,index,blockRedraw);return this.table.options.history&&this.table.modExists("history")&&this.table.modules.history.action("rowAdd",row,{data:data,pos:pos,index:index}),row},RowManager.prototype.addRows=function(data,pos,index){var _this5=this,self=this,rows=[];return new Promise(function(resolve,reject){pos=_this5.findAddRowPos(pos),Array.isArray(data)||(data=[data]),data.length-1,(void 0===index&&pos||void 0!==index&&!pos)&&data.reverse(),data.forEach(function(item,i){var row=self.addRow(item,pos,index,!0);rows.push(row)}),_this5.table.options.groupBy&&_this5.table.modExists("groupRows")?_this5.table.modules.groupRows.updateGroupRows(!0):_this5.table.options.pagination&&_this5.table.modExists("page")?_this5.refreshActiveData(!1,!1,!0):_this5.reRenderInPosition(),_this5.table.modExists("columnCalcs")&&_this5.table.modules.columnCalcs.recalc(_this5.table.rowManager.activeRows),resolve(rows)})},RowManager.prototype.findAddRowPos=function(pos){return void 0===pos&&(pos=this.table.options.addRowPos),"pos"===pos&&(pos=!0),"bottom"===pos&&(pos=!1),pos},RowManager.prototype.addRowActual=function(data,pos,index,blockRedraw){var dispRows,row=data instanceof Row?data:new Row(data||{},this),top=this.findAddRowPos(pos);if(!index&&this.table.options.pagination&&"page"==this.table.options.paginationAddRow&&(dispRows=this.getDisplayRows(),top?dispRows.length?index=dispRows[0]:this.activeRows.length&&(index=this.activeRows[this.activeRows.length-1],top=!1):dispRows.length&&(index=dispRows[dispRows.length-1],top=!(dispRows.length<this.table.modules.page.getPageSize()))),index=index&&this.findRow(index),this.table.options.groupBy&&this.table.modExists("groupRows")){this.table.modules.groupRows.assignRowToGroup(row);var groupRows=row.getGroup().rows;1<groupRows.length&&(!index||index&&-1==groupRows.indexOf(index)?top?groupRows[0]!==row&&(index=groupRows[0],this._moveRowInArray(row.getGroup().rows,row,index,top)):groupRows[groupRows.length-1]!==row&&(index=groupRows[groupRows.length-1],this._moveRowInArray(row.getGroup().rows,row,index,top)):this._moveRowInArray(row.getGroup().rows,row,index,top))}if(index){var allIndex=this.rows.indexOf(index),activeIndex=this.activeRows.indexOf(index);this.displayRowIterator(function(rows){var displayIndex=rows.indexOf(index);-1<displayIndex&&rows.splice(top?displayIndex:displayIndex+1,0,row)}),-1<activeIndex&&this.activeRows.splice(top?activeIndex:activeIndex+1,0,row),-1<allIndex&&this.rows.splice(top?allIndex:allIndex+1,0,row)}else top?(this.displayRowIterator(function(rows){rows.unshift(row)}),this.activeRows.unshift(row),this.rows.unshift(row)):(this.displayRowIterator(function(rows){rows.push(row)}),this.activeRows.push(row),this.rows.push(row));return this.setActiveRows(this.activeRows),this.table.options.rowAdded.call(this.table,row.getComponent()),this.table.options.dataEdited.call(this.table,this.getData()),blockRedraw||this.reRenderInPosition(),row},RowManager.prototype.moveRow=function(from,to,after){this.table.options.history&&this.table.modExists("history")&&this.table.modules.history.action("rowMove",from,{pos:this.getRowPosition(from),to:to,after:after}),this.moveRowActual(from,to,after),this.table.options.rowMoved.call(this.table,from.getComponent())},RowManager.prototype.moveRowActual=function(from,to,after){var self=this;if(this._moveRowInArray(this.rows,from,to,after),this._moveRowInArray(this.activeRows,from,to,after),this.displayRowIterator(function(rows){self._moveRowInArray(rows,from,to,after)}),this.table.options.groupBy&&this.table.modExists("groupRows")){var toGroup=to.getGroup(),fromGroup=from.getGroup();toGroup===fromGroup?this._moveRowInArray(toGroup.rows,from,to,after):(fromGroup&&fromGroup.removeRow(from),toGroup.insertRow(from,to,after))}},RowManager.prototype._moveRowInArray=function(rows,from,to,after){var fromIndex,toIndex,end;if(from!==to&&(-1<(fromIndex=rows.indexOf(from))&&(rows.splice(fromIndex,1),-1<(toIndex=rows.indexOf(to))?after?rows.splice(toIndex+1,0,from):rows.splice(toIndex,0,from):rows.splice(fromIndex,0,from)),rows===this.getDisplayRows())){end=fromIndex<toIndex?toIndex:fromIndex+1;for(var i=fromIndex<toIndex?fromIndex:toIndex;i<=end;i++)rows[i]&&this.styleRow(rows[i],i)}},RowManager.prototype.clearData=function(){this.setData([])},RowManager.prototype.getRowIndex=function(row){return this.findRowIndex(row,this.rows)},RowManager.prototype.getDisplayRowIndex=function(row){var index=this.getDisplayRows().indexOf(row);return-1<index&&index},RowManager.prototype.nextDisplayRow=function(row,rowOnly){var index=this.getDisplayRowIndex(row),nextRow=!1;return!1!==index&&index<this.displayRowsCount-1&&(nextRow=this.getDisplayRows()[index+1]),!nextRow||nextRow instanceof Row&&"row"==nextRow.type?nextRow:this.nextDisplayRow(nextRow,rowOnly)},RowManager.prototype.prevDisplayRow=function(row,rowOnly){var index=this.getDisplayRowIndex(row),prevRow=!1;return index&&(prevRow=this.getDisplayRows()[index-1]),!prevRow||prevRow instanceof Row&&"row"==prevRow.type?prevRow:this.prevDisplayRow(prevRow,rowOnly)},RowManager.prototype.findRowIndex=function(row,list){var rowIndex;return!!((row=this.findRow(row))&&-1<(rowIndex=list.indexOf(row)))&&rowIndex},RowManager.prototype.getData=function(active,transform){var output=[];return(active?this.activeRows:this.rows).forEach(function(row){output.push(row.getData(transform||"data"))}),output},RowManager.prototype.getComponents=function(active){var output=[];return(active?this.activeRows:this.rows).forEach(function(row){output.push(row.getComponent())}),output},RowManager.prototype.getDataCount=function(active){return active?this.activeRows.length:this.rows.length},RowManager.prototype._genRemoteRequest=function(){var self=this,table=self.table,options=table.options,params={};if(table.modExists("page")){if(options.ajaxSorting){var sorters=self.table.modules.sort.getSort();sorters.forEach(function(item){delete item.column}),params[self.table.modules.page.paginationDataSentNames.sorters]=sorters}if(options.ajaxFiltering){var filters=self.table.modules.filter.getFilters(!0,!0);params[self.table.modules.page.paginationDataSentNames.filters]=filters}self.table.modules.ajax.setParams(params,!0)}table.modules.ajax.sendRequest().then(function(data){self.setData(data)}).catch(function(e){})},RowManager.prototype.filterRefresh=function(){var table=this.table,options=table.options,left=this.scrollLeft;options.ajaxFiltering?"remote"==options.pagination&&table.modExists("page")?(table.modules.page.reset(!0),table.modules.page.setPage(1).then(function(){}).catch(function(){})):options.ajaxProgressiveLoad?table.modules.ajax.loadData().then(function(){}).catch(function(){}):this._genRemoteRequest():this.refreshActiveData("filter"),this.scrollHorizontal(left)},RowManager.prototype.sorterRefresh=function(loadOrignalData){var table=this.table,options=this.table.options,left=this.scrollLeft;options.ajaxSorting?("remote"==options.pagination||options.progressiveLoad)&&table.modExists("page")?(table.modules.page.reset(!0),table.modules.page.setPage(1).then(function(){}).catch(function(){})):options.ajaxProgressiveLoad?table.modules.ajax.loadData().then(function(){}).catch(function(){}):this._genRemoteRequest():this.refreshActiveData(loadOrignalData?"filter":"sort"),this.scrollHorizontal(left)},RowManager.prototype.scrollHorizontal=function(left){this.scrollLeft=left,this.element.scrollLeft=left,this.table.options.groupBy&&this.table.modules.groupRows.scrollHeaders(left),this.table.modExists("columnCalcs")&&this.table.modules.columnCalcs.scrollHorizontal(left)},RowManager.prototype.refreshActiveData=function(stage,skipStage,renderInPosition){var displayIndex,table=this.table;switch(this.table.modExists("edit")&&this.table.modules.edit.cancelEdit(),stage=stage||"all",table.options.selectable&&!table.options.selectablePersistence&&table.modExists("selectRow")&&table.modules.selectRow.deselectRows(),stage){case"all":case"filter":skipStage?skipStage=!1:table.modExists("filter")?this.setActiveRows(table.modules.filter.filter(this.rows)):this.setActiveRows(this.rows.slice(0));case"sort":skipStage?skipStage=!1:table.modExists("sort")&&table.modules.sort.sort(this.activeRows);case"display":this.resetDisplayRows();case"freeze":skipStage?skipStage=!1:this.table.modExists("frozenRows")&&table.modules.frozenRows.isFrozen()&&(table.modules.frozenRows.getDisplayIndex()||table.modules.frozenRows.setDisplayIndex(this.getNextDisplayIndex()),displayIndex=table.modules.frozenRows.getDisplayIndex(),!0!==(displayIndex=this.setDisplayRows(table.modules.frozenRows.getRows(this.getDisplayRows(displayIndex-1)),displayIndex))&&table.modules.frozenRows.setDisplayIndex(displayIndex));case"group":skipStage?skipStage=!1:table.options.groupBy&&table.modExists("groupRows")&&(table.modules.groupRows.getDisplayIndex()||table.modules.groupRows.setDisplayIndex(this.getNextDisplayIndex()),displayIndex=table.modules.groupRows.getDisplayIndex(),!0!==(displayIndex=this.setDisplayRows(table.modules.groupRows.getRows(this.getDisplayRows(displayIndex-1)),displayIndex))&&table.modules.groupRows.setDisplayIndex(displayIndex));case"tree":skipStage?skipStage=!1:table.options.dataTree&&table.modExists("dataTree")&&(table.modules.dataTree.getDisplayIndex()||table.modules.dataTree.setDisplayIndex(this.getNextDisplayIndex()),displayIndex=table.modules.dataTree.getDisplayIndex(),!0!==(displayIndex=this.setDisplayRows(table.modules.dataTree.getRows(this.getDisplayRows(displayIndex-1)),displayIndex))&&table.modules.dataTree.setDisplayIndex(displayIndex)),table.options.pagination&&table.modExists("page")&&!renderInPosition&&"local"==table.modules.page.getMode()&&table.modules.page.reset();case"page":skipStage?skipStage=!1:table.options.pagination&&table.modExists("page")&&(table.modules.page.getDisplayIndex()||table.modules.page.setDisplayIndex(this.getNextDisplayIndex()),displayIndex=table.modules.page.getDisplayIndex(),"local"==table.modules.page.getMode()&&table.modules.page.setMaxRows(this.getDisplayRows(displayIndex-1).length),!0!==(displayIndex=this.setDisplayRows(table.modules.page.getRows(this.getDisplayRows(displayIndex-1)),displayIndex))&&table.modules.page.setDisplayIndex(displayIndex))}Tabulator.prototype.helpers.elVisible(this.element)&&(renderInPosition?this.reRenderInPosition():(this.renderTable(),table.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0))),table.modExists("columnCalcs")&&table.modules.columnCalcs.recalc(this.activeRows)},RowManager.prototype.setActiveRows=function(activeRows){this.activeRows=activeRows,this.activeRowsCount=this.activeRows.length},RowManager.prototype.resetDisplayRows=function(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length,this.table.modExists("frozenRows")&&this.table.modules.frozenRows.setDisplayIndex(0),this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.setDisplayIndex(0),this.table.options.pagination&&this.table.modExists("page")&&this.table.modules.page.setDisplayIndex(0)},RowManager.prototype.getNextDisplayIndex=function(){return this.displayRows.length},RowManager.prototype.setDisplayRows=function(displayRows,index){var output=!0;return output=index&&void 0!==this.displayRows[index]?(this.displayRows[index]=displayRows,!0):(this.displayRows.push(displayRows),index=this.displayRows.length-1),index==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length),output},RowManager.prototype.getDisplayRows=function(index){return void 0===index?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[index]||[]},RowManager.prototype.getVisibleRows=function(viewable){var topEdge=this.element.scrollTop,bottomEdge=this.element.clientHeight+topEdge,topFound=!1,topRow=0,bottomRow=0,rows=this.getDisplayRows();if(viewable){this.getDisplayRows();for(var i=this.vDomTop;i<=this.vDomBottom;i++)if(rows[i])if(topFound){if(!(0<=bottomEdge-rows[i].getElement().offsetTop))break;bottomRow=i}else 0<=topEdge-rows[i].getElement().offsetTop?topRow=i:topFound=!0}else topRow=this.vDomTop,bottomRow=this.vDomBottom;return rows.slice(topRow,bottomRow+1)},RowManager.prototype.displayRowIterator=function(callback){this.displayRows.forEach(callback),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length},RowManager.prototype.getRows=function(){return this.rows},RowManager.prototype.reRenderInPosition=function(callback){if("virtual"==this.getRenderMode()){for(var scrollTop=this.element.scrollTop,topRow=!1,topOffset=!1,left=this.scrollLeft,rows=this.getDisplayRows(),i=this.vDomTop;i<=this.vDomBottom;i++)if(rows[i]){var diff=scrollTop-rows[i].getElement().offsetTop;if(!(!1===topOffset||Math.abs(diff)<topOffset))break;topOffset=diff,topRow=i}callback&&callback(),this._virtualRenderFill(!1===topRow?this.displayRowsCount-1:topRow,!0,topOffset||0),this.scrollHorizontal(left)}else this.renderTable(),callback&&callback()},RowManager.prototype.setRenderMode=function(){(this.table.element.clientHeight||this.table.options.height)&&this.table.options.virtualDom?this.renderMode="virtual":this.renderMode="classic"},RowManager.prototype.getRenderMode=function(){return this.renderMode},RowManager.prototype.renderTable=function(){switch(this.table.options.renderStarted.call(this.table),this.element.scrollTop=0,this.renderMode){case"classic":this._simpleRender();break;case"virtual":this._virtualRenderFill()}this.firstRender&&(this.displayRowsCount?(this.firstRender=!1,this.table.modules.layout.layout()):this.renderEmptyScroll()),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout(),this.displayRowsCount||this.table.options.placeholder&&(this.renderMode&&this.table.options.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.table.options.placeholder)),this.table.options.renderComplete.call(this.table)},RowManager.prototype._simpleRender=function(){this._clearVirtualDom(),this.displayRowsCount?this.checkClassicModeGroupHeaderWidth():this.renderEmptyScroll()},RowManager.prototype.checkClassicModeGroupHeaderWidth=function(){var self=this,element=this.tableElement,onlyGroupHeaders=!0;self.getDisplayRows().forEach(function(row,index){self.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(!0),"group"!==row.type&&(onlyGroupHeaders=!1)}),element.style.minWidth=onlyGroupHeaders?self.table.columnManager.getWidth()+"px":""},RowManager.prototype.renderEmptyScroll=function(){this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px",this.tableElement.style.minHeight="1px",this.tableElement.style.visibility="hidden"},RowManager.prototype._clearVirtualDom=function(){var element=this.tableElement;for(this.table.options.placeholder&&this.table.options.placeholder.parentNode&&this.table.options.placeholder.parentNode.removeChild(this.table.options.placeholder);element.firstChild;)element.removeChild(element.firstChild);element.style.paddingTop="",element.style.paddingBottom="",element.style.minWidth="",element.style.minHeight="",element.style.visibility="",this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0},RowManager.prototype.styleRow=function(row,index){var rowEl=row.getElement();index%2?(rowEl.classList.add("tabulator-row-even"),rowEl.classList.remove("tabulator-row-odd")):(rowEl.classList.add("tabulator-row-odd"),rowEl.classList.remove("tabulator-row-even"))},RowManager.prototype._virtualRenderFill=function(position,forceMove,offset){var element=this.tableElement,holder=this.element,topPad=0,rowsHeight=0,topPadHeight=0,i=0,onlyGroupHeaders=!0,rows=this.getDisplayRows();if(offset=offset||0,position=position||0){for(;element.firstChild;)element.removeChild(element.firstChild);var heightOccupied=(this.displayRowsCount-position+1)*this.vDomRowHeight;heightOccupied<this.height&&(position-=Math.ceil((this.height-heightOccupied)/this.vDomRowHeight))<0&&(position=0),position-=topPad=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),position)}else this._clearVirtualDom();if(this.displayRowsCount&&Tabulator.prototype.helpers.elVisible(this.element)){for(this.vDomTop=position,this.vDomBottom=position-1;(rowsHeight<=this.height+this.vDomWindowBuffer||i<this.vDomWindowMinTotalRows)&&this.vDomBottom<this.displayRowsCount-1;){var rowHeight,index=this.vDomBottom+1,row=rows[index];this.styleRow(row,index),element.appendChild(row.getElement()),row.initialized?row.heightInitialized||row.normalizeHeight(!0):row.initialize(!0),rowHeight=row.getHeight(),i<topPad?topPadHeight+=rowHeight:rowsHeight+=rowHeight,rowHeight>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),"group"!==row.type&&(onlyGroupHeaders=!1),this.vDomBottom++,i++}position?(this.vDomTopPad=forceMove?this.vDomRowHeight*this.vDomTop+offset:this.scrollTop-topPadHeight,this.vDomBottomPad=this.vDomBottom==this.displayRowsCount-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-rowsHeight-topPadHeight,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((rowsHeight+topPadHeight)/i),this.vDomBottomPad=this.vDomRowHeight*(this.displayRowsCount-this.vDomBottom-1),this.vDomScrollHeight=topPadHeight+rowsHeight+this.vDomBottomPad-this.height),element.style.paddingTop=this.vDomTopPad+"px",element.style.paddingBottom=this.vDomBottomPad+"px",forceMove&&(this.scrollTop=this.vDomTopPad+topPadHeight+offset-(this.element.scrollWidth>this.element.clientWidth?this.element.offsetHeight-this.element.clientHeight:0)),this.scrollTop=Math.min(this.scrollTop,this.element.scrollHeight-this.height),this.element.scrollWidth>this.element.offsetWidth&&forceMove&&(this.scrollTop+=this.element.offsetHeight-this.element.clientHeight),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,holder.scrollTop=this.scrollTop,element.style.minWidth=onlyGroupHeaders?this.table.columnManager.getWidth()+"px":"",this.table.options.groupBy&&"fitDataFill"!=this.table.modules.layout.getMode()&&this.displayRowsCount==this.table.modules.groupRows.countGroups()&&(this.tableElement.style.minWidth=this.table.columnManager.getWidth())}else this.renderEmptyScroll()},RowManager.prototype.scrollVertical=function(dir){var topDiff=this.scrollTop-this.vDomScrollPosTop,bottomDiff=this.scrollTop-this.vDomScrollPosBottom,margin=2*this.vDomWindowBuffer;if(margin<-topDiff||margin<bottomDiff){var left=this.scrollLeft;this._virtualRenderFill(Math.floor(this.element.scrollTop/this.element.scrollHeight*this.displayRowsCount)),this.scrollHorizontal(left)}else dir?(topDiff<0&&this._addTopRow(-topDiff),bottomDiff<0&&this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer&&this._removeBottomRow(-bottomDiff)):(0<=topDiff&&this.scrollTop>this.vDomWindowBuffer&&this._removeTopRow(topDiff),0<=bottomDiff&&this._addBottomRow(bottomDiff))},RowManager.prototype._addTopRow=function(topDiff){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,table=this.tableElement,rows=this.getDisplayRows();if(this.vDomTop){var index=this.vDomTop-1,topRow=rows[index],topRowHeight=topRow.getHeight()||this.vDomRowHeight;topRowHeight<=topDiff&&(this.styleRow(topRow,index),table.insertBefore(topRow.getElement(),table.firstChild),topRow.initialized&&topRow.heightInitialized||(this.vDomTopNewRows.push(topRow),topRow.heightInitialized||topRow.clearCellHeight()),topRow.initialize(),this.vDomTopPad-=topRowHeight,this.vDomTopPad<0&&(this.vDomTopPad=index*this.vDomRowHeight),index||(this.vDomTopPad=0),table.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=topRowHeight,this.vDomTop--),topDiff=-(this.scrollTop-this.vDomScrollPosTop),topRow.getHeight()>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*topRow.getHeight()),i<this.vDomMaxRenderChain&&this.vDomTop&&topDiff>=(rows[this.vDomTop-1].getHeight()||this.vDomRowHeight)?this._addTopRow(topDiff,i+1):this._quickNormalizeRowHeight(this.vDomTopNewRows)}},RowManager.prototype._removeTopRow=function(topDiff){var table=this.tableElement,topRow=this.getDisplayRows()[this.vDomTop],topRowHeight=topRow.getHeight()||this.vDomRowHeight;if(topRowHeight<=topDiff){var rowEl=topRow.getElement();rowEl.parentNode.removeChild(rowEl),this.vDomTopPad+=topRowHeight,table.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?topRowHeight:topRowHeight+this.vDomWindowBuffer,this.vDomTop++,topDiff=this.scrollTop-this.vDomScrollPosTop,this._removeTopRow(topDiff)}},RowManager.prototype._addBottomRow=function(bottomDiff){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,table=this.tableElement,rows=this.getDisplayRows();if(this.vDomBottom<this.displayRowsCount-1){var index=this.vDomBottom+1,bottomRow=rows[index],bottomRowHeight=bottomRow.getHeight()||this.vDomRowHeight;bottomRowHeight<=bottomDiff&&(this.styleRow(bottomRow,index),table.appendChild(bottomRow.getElement()),bottomRow.initialized&&bottomRow.heightInitialized||(this.vDomBottomNewRows.push(bottomRow),bottomRow.heightInitialized||bottomRow.clearCellHeight()),bottomRow.initialize(),this.vDomBottomPad-=bottomRowHeight,(this.vDomBottomPad<0||index==this.displayRowsCount-1)&&(this.vDomBottomPad=0),table.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=bottomRowHeight,this.vDomBottom++),bottomDiff=this.scrollTop-this.vDomScrollPosBottom,bottomRow.getHeight()>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*bottomRow.getHeight()),i<this.vDomMaxRenderChain&&this.vDomBottom<this.displayRowsCount-1&&bottomDiff>=(rows[this.vDomBottom+1].getHeight()||this.vDomRowHeight)?this._addBottomRow(bottomDiff,i+1):this._quickNormalizeRowHeight(this.vDomBottomNewRows)}},RowManager.prototype._removeBottomRow=function(bottomDiff){var table=this.tableElement,bottomRow=this.getDisplayRows()[this.vDomBottom],bottomRowHeight=bottomRow.getHeight()||this.vDomRowHeight;if(bottomRowHeight<=bottomDiff){var rowEl=bottomRow.getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl),this.vDomBottomPad+=bottomRowHeight,this.vDomBottomPad<0&&(this.vDomBottomPad=0),table.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=bottomRowHeight,this.vDomBottom--,bottomDiff=-(this.scrollTop-this.vDomScrollPosBottom),this._removeBottomRow(bottomDiff)}},RowManager.prototype._quickNormalizeRowHeight=function(rows){rows.forEach(function(row){row.calcHeight()}),rows.forEach(function(row){row.setCellHeight()}),rows.length=0},RowManager.prototype.normalizeHeight=function(){this.activeRows.forEach(function(row){row.normalizeHeight()})},RowManager.prototype.adjustTableSize=function(){if("virtual"===this.renderMode){this.height=this.element.clientHeight,this.vDomWindowBuffer=this.table.options.virtualDomBuffer||this.height;var otherHeight=this.columnManager.getElement().offsetHeight+(this.table.footerManager&&!this.table.footerManager.external?this.table.footerManager.getElement().offsetHeight:0);this.element.style.minHeight="calc(100% - "+otherHeight+"px)",this.element.style.height="calc(100% - "+otherHeight+"px)",this.element.style.maxHeight="calc(100% - "+otherHeight+"px)"}},RowManager.prototype.reinitialize=function(){this.rows.forEach(function(row){row.reinitialize()})},RowManager.prototype.redraw=function(force){var left=this.scrollLeft;this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,force?this.renderTable():("classic"==this.renderMode?this.table.options.groupBy?this.refreshActiveData("group",!1,!1):this._simpleRender():(this.reRenderInPosition(),this.scrollHorizontal(left)),this.displayRowsCount||this.table.options.placeholder&&this.getElement().appendChild(this.table.options.placeholder))},RowManager.prototype.resetScroll=function(){if(this.element.scrollLeft=0,this.element.scrollTop=0,"ie"===this.table.browser){var event=document.createEvent("Event");event.initEvent("scroll",!1,!0),this.element.dispatchEvent(event)}else this.element.dispatchEvent(new Event("scroll"))};var RowComponent=function(row){this._row=row};RowComponent.prototype.getData=function(transform){return this._row.getData(transform)},RowComponent.prototype.getElement=function(){return this._row.getElement()},RowComponent.prototype.getCells=function(){var cells=[];return this._row.getCells().forEach(function(cell){cells.push(cell.getComponent())}),cells},RowComponent.prototype.getCell=function(column){var cell=this._row.getCell(column);return!!cell&&cell.getComponent()},RowComponent.prototype.getIndex=function(){return this._row.getData("data")[this._row.table.options.index]},RowComponent.prototype.getPosition=function(active){return this._row.table.rowManager.getRowPosition(this._row,active)},RowComponent.prototype.delete=function(){return this._row.delete()},RowComponent.prototype.scrollTo=function(){return this._row.table.rowManager.scrollToRow(this._row)},RowComponent.prototype.pageTo=function(){if(this._row.table.modExists("page",!0))return this._row.table.modules.page.setPageToRow(this._row)},RowComponent.prototype.move=function(to,after){this._row.moveToRow(to,after)},RowComponent.prototype.update=function(data){return this._row.updateData(data)},RowComponent.prototype.normalizeHeight=function(){this._row.normalizeHeight(!0)},RowComponent.prototype.select=function(){this._row.table.modules.selectRow.selectRows(this._row)},RowComponent.prototype.deselect=function(){this._row.table.modules.selectRow.deselectRows(this._row)},RowComponent.prototype.toggleSelect=function(){this._row.table.modules.selectRow.toggleRow(this._row)},RowComponent.prototype.isSelected=function(){return this._row.table.modules.selectRow.isRowSelected(this._row)},RowComponent.prototype._getSelf=function(){return this._row},RowComponent.prototype.freeze=function(){this._row.table.modExists("frozenRows",!0)&&this._row.table.modules.frozenRows.freezeRow(this._row)},RowComponent.prototype.unfreeze=function(){this._row.table.modExists("frozenRows",!0)&&this._row.table.modules.frozenRows.unfreezeRow(this._row)},RowComponent.prototype.treeCollapse=function(){this._row.table.modExists("dataTree",!0)&&this._row.table.modules.dataTree.collapseRow(this._row)},RowComponent.prototype.treeExpand=function(){this._row.table.modExists("dataTree",!0)&&this._row.table.modules.dataTree.expandRow(this._row)},RowComponent.prototype.treeToggle=function(){this._row.table.modExists("dataTree",!0)&&this._row.table.modules.dataTree.toggleRow(this._row)},RowComponent.prototype.getTreeParent=function(){return!!this._row.table.modExists("dataTree",!0)&&this._row.table.modules.dataTree.getTreeParent(this._row)},RowComponent.prototype.getTreeChildren=function(){return!!this._row.table.modExists("dataTree",!0)&&this._row.table.modules.dataTree.getTreeChildren(this._row)},RowComponent.prototype.reformat=function(){return this._row.reinitialize()},RowComponent.prototype.getGroup=function(){return this._row.getGroup().getComponent()},RowComponent.prototype.getTable=function(){return this._row.table},RowComponent.prototype.getNextRow=function(){var row=this._row.nextRow();return row?row.getComponent():row},RowComponent.prototype.getPrevRow=function(){var row=this._row.prevRow();return row?row.getComponent():row};var Row=function(data,parent){this.table=parent.table,this.parent=parent,this.data={},this.type="row",this.element=this.createElement(),this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.setData(data),this.generateElement()};Row.prototype.createElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-row"),el.setAttribute("role","row"),el},Row.prototype.getElement=function(){return this.element},Row.prototype.detachElement=function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)},Row.prototype.generateElement=function(){var dblTap,tapHold,tap,self=this;!1!==self.table.options.selectable&&self.table.modExists("selectRow")&&self.table.modules.selectRow.initializeRow(this),!1!==self.table.options.movableRows&&self.table.modExists("moveRow")&&self.table.modules.moveRow.initializeRow(this),!1!==self.table.options.dataTree&&self.table.modExists("dataTree")&&self.table.modules.dataTree.initializeRow(this),self.table.options.rowClick&&self.element.addEventListener("click",function(e){self.table.options.rowClick(e,self.getComponent())}),self.table.options.rowDblClick&&self.element.addEventListener("dblclick",function(e){self.table.options.rowDblClick(e,self.getComponent())}),self.table.options.rowContext&&self.element.addEventListener("contextmenu",function(e){self.table.options.rowContext(e,self.getComponent())}),self.table.options.rowMouseEnter&&self.element.addEventListener("mouseenter",function(e){self.table.options.rowMouseEnter(e,self.getComponent())}),self.table.options.rowMouseLeave&&self.element.addEventListener("mouseleave",function(e){self.table.options.rowMouseLeave(e,self.getComponent())}),self.table.options.rowMouseOver&&self.element.addEventListener("mouseover",function(e){self.table.options.rowMouseOver(e,self.getComponent())}),self.table.options.rowMouseOut&&self.element.addEventListener("mouseout",function(e){self.table.options.rowMouseOut(e,self.getComponent())}),self.table.options.rowMouseMove&&self.element.addEventListener("mousemove",function(e){self.table.options.rowMouseMove(e,self.getComponent())}),self.table.options.rowTap&&(tap=!1,self.element.addEventListener("touchstart",function(e){tap=!0},{passive:!0}),self.element.addEventListener("touchend",function(e){tap&&self.table.options.rowTap(e,self.getComponent()),tap=!1})),self.table.options.rowDblTap&&(dblTap=null,self.element.addEventListener("touchend",function(e){dblTap?(clearTimeout(dblTap),dblTap=null,self.table.options.rowDblTap(e,self.getComponent())):dblTap=setTimeout(function(){clearTimeout(dblTap),dblTap=null},300)})),self.table.options.rowTapHold&&(tapHold=null,self.element.addEventListener("touchstart",function(e){clearTimeout(tapHold),tapHold=setTimeout(function(){clearTimeout(tapHold),tapHold=null,tap=!1,self.table.options.rowTapHold(e,self.getComponent())},1e3)},{passive:!0}),self.element.addEventListener("touchend",function(e){clearTimeout(tapHold),tapHold=null}))},Row.prototype.generateCells=function(){this.cells=this.table.columnManager.generateCells(this)},Row.prototype.initialize=function(force){var self=this;if(!self.initialized||force){for(self.deleteCells();self.element.firstChild;)self.element.removeChild(self.element.firstChild);this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layoutRow(this),this.generateCells(),self.cells.forEach(function(cell){self.element.appendChild(cell.getElement()),cell.cellRendered()}),force&&self.normalizeHeight(),self.table.options.dataTree&&self.table.modExists("dataTree")&&self.table.modules.dataTree.layoutRow(this),"collapse"===self.table.options.responsiveLayout&&self.table.modExists("responsiveLayout")&&self.table.modules.responsiveLayout.layoutRow(this),self.table.options.rowFormatter&&self.table.options.rowFormatter(self.getComponent()),self.table.options.resizableRows&&self.table.modExists("resizeRows")&&self.table.modules.resizeRows.initializeRow(self),self.initialized=!0}},Row.prototype.reinitializeHeight=function(){this.heightInitialized=!1,null!==this.element.offsetParent&&this.normalizeHeight(!0)},Row.prototype.reinitialize=function(){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),null!==this.element.offsetParent&&this.initialize(!0)},Row.prototype.calcHeight=function(force){var maxHeight=0,minHeight=this.table.options.resizableRows?this.element.clientHeight:0;this.cells.forEach(function(cell){var height=cell.getHeight();maxHeight<height&&(maxHeight=height)}),this.height=force?Math.max(maxHeight,minHeight):this.manualHeight?this.height:Math.max(maxHeight,minHeight),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight},Row.prototype.setCellHeight=function(){this.cells.forEach(function(cell){cell.setHeight()}),this.heightInitialized=!0},Row.prototype.clearCellHeight=function(){this.cells.forEach(function(cell){cell.clearHeight()})},Row.prototype.normalizeHeight=function(force){force&&this.clearCellHeight(),this.calcHeight(force),this.setCellHeight()},Row.prototype.setHeight=function(height,force){this.height==height&&!force||(this.manualHeight=!0,this.height=height,this.heightStyled=height?height+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)},Row.prototype.getHeight=function(){return this.outerHeight},Row.prototype.getWidth=function(){return this.element.offsetWidth},Row.prototype.deleteCell=function(cell){var index=this.cells.indexOf(cell);-1<index&&this.cells.splice(index,1)},Row.prototype.setData=function(data){this.table.modExists("mutator")&&(data=this.table.modules.mutator.transformRow(data,"data")),this.data=data,this.table.options.reactiveData&&this.table.modExists("reactiveData",!0)&&this.table.modules.reactiveData.watchRow(this)},Row.prototype.updateData=function(data){var _this6=this,self=this,visible=Tabulator.prototype.helpers.elVisible(this.element);return new Promise(function(resolve,reject){for(var attrname in"string"==typeof data&&(data=JSON.parse(data)),_this6.table.options.reactiveData&&_this6.table.modExists("reactiveData",!0)&&_this6.table.modules.reactiveData.block(),self.table.modExists("mutator")&&(data=self.table.modules.mutator.transformRow(data,"data",!0)),data)self.data[attrname]=data[attrname];_this6.table.options.reactiveData&&_this6.table.modExists("reactiveData",!0)&&_this6.table.modules.reactiveData.unblock();var cellNameArray=[],found=!1;for(var attrname in data){if(data[attrname].constructor==Object){for(var nestedAtt in data[attrname])cellNameArray.push(attrname+"."+nestedAtt);found=!0}found||cellNameArray.push(attrname),found=!1}cellNameArray.forEach(function(cellName,idx){var cell=_this6.getCell(cellName);if(cell){if(cellV=cellName.split("."),1<cellV.length)var dataValue=data[cellV[0]][cellV[1]];else dataValue=data[cellV[0]];cell.getValue()!=dataValue&&(cell.setValueProcessData(dataValue),visible&&cell.cellRendered())}}),visible?(self.normalizeHeight(),self.table.options.rowFormatter&&self.table.options.rowFormatter(self.getComponent())):(_this6.initialized=!1,_this6.height=0,_this6.heightStyled=""),!1!==self.table.options.dataTree&&self.table.modExists("dataTree")&&void 0!==data[_this6.table.modules.dataTree.getChildField()]&&(_this6.table.modules.dataTree.initializeRow(_this6),_this6.table.rowManager.refreshActiveData("tree",!1,!0)),self.table.options.rowUpdated.call(_this6.table,self.getComponent()),resolve()})},Row.prototype.getData=function(transform){return transform?this.table.modExists("accessor")?this.table.modules.accessor.transformRow(this.data,transform):void 0:this.data},Row.prototype.getCell=function(column){return column=this.table.columnManager.findColumn(column),this.cells.find(function(cell){return cell.column===column})},Row.prototype.getCellIndex=function(findCell){return this.cells.findIndex(function(cell){return cell===findCell})},Row.prototype.findNextEditableCell=function(index){var nextCell=!1;if(index<this.cells.length-1)for(var i=index+1;i<this.cells.length;i++){var cell=this.cells[i];if(cell.column.modules.edit&&Tabulator.prototype.helpers.elVisible(cell.getElement())){var allowEdit=!0;if("function"==typeof cell.column.modules.edit.check&&(allowEdit=cell.column.modules.edit.check(cell.getComponent())),allowEdit){nextCell=cell;break}}}return nextCell},Row.prototype.findPrevEditableCell=function(index){var prevCell=!1;if(0<index)for(var i=index-1;0<=i;i--){var cell=this.cells[i],allowEdit=!0;if(cell.column.modules.edit&&Tabulator.prototype.helpers.elVisible(cell.getElement())&&("function"==typeof cell.column.modules.edit.check&&(allowEdit=cell.column.modules.edit.check(cell.getComponent())),allowEdit)){prevCell=cell;break}}return prevCell},Row.prototype.getCells=function(){return this.cells},Row.prototype.nextRow=function(){return this.table.rowManager.nextDisplayRow(this,!0)||!1},Row.prototype.prevRow=function(){return this.table.rowManager.prevDisplayRow(this,!0)||!1},Row.prototype.moveToRow=function(to,before){var toRow=this.table.rowManager.findRow(to);toRow?(this.table.rowManager.moveRowActual(this,toRow,!before),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",to)},Row.prototype.delete=function(){var _this7=this;return new Promise(function(resolve,reject){var index=_this7.table.rowManager.getRowIndex(_this7);_this7.deleteActual(),_this7.table.options.history&&_this7.table.modExists("history")&&(index=index&&_this7.table.rowManager.rows[index-1],_this7.table.modules.history.action("rowDelete",_this7,{data:_this7.getData(),pos:!index,index:index})),resolve()})},Row.prototype.deleteActual=function(blockRedraw){this.table.rowManager.getRowIndex(this);this.table.modExists("selectRow")&&this.table.modules.selectRow._deselectRow(this,!0),this.table.options.reactiveData&&this.table.modExists("reactiveData",!0),this.modules.group&&this.modules.group.removeRow(this),this.table.rowManager.deleteRow(this,blockRedraw),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.table.modExists("columnCalcs")&&(this.table.options.groupBy&&this.table.modExists("groupRows")?this.table.modules.columnCalcs.recalcRowGroup(this):this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows))},Row.prototype.deleteCells=function(){for(var cellCount=this.cells.length,i=0;i<cellCount;i++)this.cells[0].delete()},Row.prototype.wipe=function(){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element=!1,this.modules={},this.element.parentNode&&this.element.parentNode.removeChild(this.element)},Row.prototype.getGroup=function(){return this.modules.group||!1},Row.prototype.getComponent=function(){return new RowComponent(this)};var CellComponent=function(cell){this._cell=cell};CellComponent.prototype.getValue=function(){return this._cell.getValue()},CellComponent.prototype.getOldValue=function(){return this._cell.getOldValue()},CellComponent.prototype.getElement=function(){return this._cell.getElement()},CellComponent.prototype.getRow=function(){return this._cell.row.getComponent()},CellComponent.prototype.getData=function(){return this._cell.row.getData()},CellComponent.prototype.getField=function(){return this._cell.column.getField()},CellComponent.prototype.getColumn=function(){return this._cell.column.getComponent()},CellComponent.prototype.setValue=function(value,mutate){void 0===mutate&&(mutate=!0),this._cell.setValue(value,mutate)},CellComponent.prototype.restoreOldValue=function(){this._cell.setValueActual(this._cell.getOldValue())},CellComponent.prototype.edit=function(force){return this._cell.edit(force)},CellComponent.prototype.cancelEdit=function(){this._cell.cancelEdit()},CellComponent.prototype.nav=function(){return this._cell.nav()},CellComponent.prototype.checkHeight=function(){this._cell.checkHeight()},CellComponent.prototype.getTable=function(){return this._cell.table},CellComponent.prototype._getSelf=function(){return this._cell};var Cell=function(column,row){this.table=column.table,this.column=column,this.row=row,this.element=null,this.value=null,this.oldValue=null,this.height=null,this.width=null,this.minWidth=null,this.build()};Cell.prototype.build=function(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data))},Cell.prototype.generateElement=function(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.element=this.element},Cell.prototype._configureCell=function(){var self=this,cellEvents=self.column.cellEvents,element=self.element,field=this.column.getField();element.style.textAlign=self.column.hozAlign,field&&element.setAttribute("tabulator-field",field),self.column.definition.cssClass&&self.column.definition.cssClass.split(" ").forEach(function(className){element.classList.add(className)});"hover"===this.table.options.tooltipGenerationMode&&element.addEventListener("mouseenter",function(e){self._generateTooltip()}),self._bindClickEvents(cellEvents),self._bindTouchEvents(cellEvents),self._bindMouseEvents(cellEvents),self.column.modules.edit&&self.table.modules.edit.bindEditor(self),self.column.definition.rowHandle&&!1!==self.table.options.movableRows&&self.table.modExists("moveRow")&&self.table.modules.moveRow.initializeCell(self),self.column.visible||self.hide()},Cell.prototype._bindClickEvents=function(cellEvents){var self=this,element=self.element;(cellEvents.cellClick||self.table.options.cellClick)&&element.addEventListener("click",function(e){var component=self.getComponent();cellEvents.cellClick&&cellEvents.cellClick.call(self.table,e,component),self.table.options.cellClick&&self.table.options.cellClick.call(self.table,e,component)}),cellEvents.cellDblClick||this.table.options.cellDblClick?element.addEventListener("dblclick",function(e){var component=self.getComponent();cellEvents.cellDblClick&&cellEvents.cellDblClick.call(self.table,e,component),self.table.options.cellDblClick&&self.table.options.cellDblClick.call(self.table,e,component)}):element.addEventListener("dblclick",function(e){if(e.preventDefault(),document.selection)(range=document.body.createTextRange()).moveToElementText(self.element),range.select();else if(window.getSelection){var range;(range=document.createRange()).selectNode(self.element),window.getSelection().removeAllRanges(),window.getSelection().addRange(range)}}),(cellEvents.cellContext||this.table.options.cellContext)&&element.addEventListener("contextmenu",function(e){var component=self.getComponent();cellEvents.cellContext&&cellEvents.cellContext.call(self.table,e,component),self.table.options.cellContext&&self.table.options.cellContext.call(self.table,e,component)})},Cell.prototype._bindMouseEvents=function(cellEvents){var self=this,element=self.element;(cellEvents.cellMouseEnter||self.table.options.cellMouseEnter)&&element.addEventListener("mouseenter",function(e){var component=self.getComponent();cellEvents.cellMouseEnter&&cellEvents.cellMouseEnter.call(self.table,e,component),self.table.options.cellMouseEnter&&self.table.options.cellMouseEnter.call(self.table,e,component)}),(cellEvents.cellMouseLeave||self.table.options.cellMouseLeave)&&element.addEventListener("mouseleave",function(e){var component=self.getComponent();cellEvents.cellMouseLeave&&cellEvents.cellMouseLeave.call(self.table,e,component),self.table.options.cellMouseLeave&&self.table.options.cellMouseLeave.call(self.table,e,component)}),(cellEvents.cellMouseOver||self.table.options.cellMouseOver)&&element.addEventListener("mouseover",function(e){var component=self.getComponent();cellEvents.cellMouseOver&&cellEvents.cellMouseOver.call(self.table,e,component),self.table.options.cellMouseOver&&self.table.options.cellMouseOver.call(self.table,e,component)}),(cellEvents.cellMouseOut||self.table.options.cellMouseOut)&&element.addEventListener("mouseout",function(e){var component=self.getComponent();cellEvents.cellMouseOut&&cellEvents.cellMouseOut.call(self.table,e,component),self.table.options.cellMouseOut&&self.table.options.cellMouseOut.call(self.table,e,component)}),(cellEvents.cellMouseMove||self.table.options.cellMouseMove)&&element.addEventListener("mousemove",function(e){var component=self.getComponent();cellEvents.cellMouseMove&&cellEvents.cellMouseMove.call(self.table,e,component),self.table.options.cellMouseMove&&self.table.options.cellMouseMove.call(self.table,e,component)})},Cell.prototype._bindTouchEvents=function(cellEvents){var dblTap,tapHold,tap,self=this,element=self.element;(cellEvents.cellTap||this.table.options.cellTap)&&(tap=!1,element.addEventListener("touchstart",function(e){tap=!0},{passive:!0}),element.addEventListener("touchend",function(e){if(tap){var component=self.getComponent();cellEvents.cellTap&&cellEvents.cellTap.call(self.table,e,component),self.table.options.cellTap&&self.table.options.cellTap.call(self.table,e,component)}tap=!1})),(cellEvents.cellDblTap||this.table.options.cellDblTap)&&(dblTap=null,element.addEventListener("touchend",function(e){if(dblTap){clearTimeout(dblTap),dblTap=null;var component=self.getComponent();cellEvents.cellDblTap&&cellEvents.cellDblTap.call(self.table,e,component),self.table.options.cellDblTap&&self.table.options.cellDblTap.call(self.table,e,component)}else dblTap=setTimeout(function(){clearTimeout(dblTap),dblTap=null},300)})),(cellEvents.cellTapHold||this.table.options.cellTapHold)&&(tapHold=null,element.addEventListener("touchstart",function(e){clearTimeout(tapHold),tapHold=setTimeout(function(){clearTimeout(tapHold),tapHold=null,tap=!1;var component=self.getComponent();cellEvents.cellTapHold&&cellEvents.cellTapHold.call(self.table,e,component),self.table.options.cellTapHold&&self.table.options.cellTapHold.call(self.table,e,component)},1e3)},{passive:!0}),element.addEventListener("touchend",function(e){clearTimeout(tapHold),tapHold=null}))},Cell.prototype._generateContents=function(){var val;switch(void 0===(val=this.table.modExists("format")?this.table.modules.format.formatValue(this):this.element.innerHTML=this.value)?"undefined":_typeof(val)){case"object":if(val instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(val)}else this.element.innerHTML="",null!=val&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",val);break;case"undefined":case"null":this.element.innerHTML="";break;default:this.element.innerHTML=val}},Cell.prototype.cellRendered=function(){this.table.modExists("format")&&this.table.modules.format.cellRendered&&this.table.modules.format.cellRendered(this)},Cell.prototype._generateTooltip=function(){var tooltip=this.column.tooltip;tooltip?(!0===tooltip?tooltip=this.value:"function"==typeof tooltip&&!1===(tooltip=tooltip(this.getComponent()))&&(tooltip=""),void 0===tooltip&&(tooltip=""),this.element.setAttribute("title",tooltip)):this.element.setAttribute("title","")},Cell.prototype.getElement=function(){return this.element},Cell.prototype.getValue=function(){return this.value},Cell.prototype.getOldValue=function(){return this.oldValue},Cell.prototype.setValue=function(value,mutate){var component;this.setValueProcessData(value,mutate)&&(this.table.options.history&&this.table.modExists("history")&&this.table.modules.history.action("cellEdit",this,{oldValue:this.oldValue,newValue:this.value}),component=this.getComponent(),this.column.cellEvents.cellEdited&&this.column.cellEvents.cellEdited.call(this.table,component),this.table.options.cellEdited.call(this.table,component),this.table.options.dataEdited.call(this.table,this.table.rowManager.getData()))},Cell.prototype.setValueProcessData=function(value,mutate){var changed=!1;return this.value!=value&&(changed=!0,mutate&&this.column.modules.mutate&&(value=this.table.modules.mutator.transformCell(this,value))),this.setValueActual(value),changed&&this.table.modExists("columnCalcs")&&(this.column.definition.topCalc||this.column.definition.bottomCalc)&&(this.table.options.groupBy&&this.table.modExists("groupRows")?("table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs||this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows),"table"!=this.table.options.columnCalcs&&this.table.modules.columnCalcs.recalcRowGroup(this.row)):this.table.modules.columnCalcs.recalc(this.table.rowManager.activeRows)),changed},Cell.prototype.setValueActual=function(value){this.oldValue=this.value,this.value=value,this.table.options.reactiveData&&this.table.modExists("reactiveData")&&this.table.modules.reactiveData.block(),this.column.setFieldValue(this.row.data,value),this.table.options.reactiveData&&this.table.modExists("reactiveData")&&this.table.modules.reactiveData.unblock(),this._generateContents(),this._generateTooltip(),this.table.options.resizableColumns&&this.table.modExists("resizeColumns")&&this.table.modules.resizeColumns.initializeColumn("cell",this.column,this.element),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layoutElement(this.element,this.column)},Cell.prototype.setWidth=function(){this.width=this.column.width,this.element.style.width=this.column.widthStyled},Cell.prototype.clearWidth=function(){this.width="",this.element.style.width=""},Cell.prototype.getWidth=function(){return this.width||this.element.offsetWidth},Cell.prototype.setMinWidth=function(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled},Cell.prototype.checkHeight=function(){this.row.reinitializeHeight()},Cell.prototype.clearHeight=function(){this.element.style.height="",this.height=null},Cell.prototype.setHeight=function(){this.height=this.row.height,this.element.style.height=this.row.heightStyled},Cell.prototype.getHeight=function(){return this.height||this.element.offsetHeight},Cell.prototype.show=function(){this.element.style.display=""},Cell.prototype.hide=function(){this.element.style.display="none"},Cell.prototype.edit=function(force){if(this.table.modExists("edit",!0))return this.table.modules.edit.editCell(this,force)},Cell.prototype.cancelEdit=function(){if(this.table.modExists("edit",!0)){var editing=this.table.modules.edit.getCurrentCell();editing&&editing._getSelf()===this?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}},Cell.prototype.delete=function(){this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}},Cell.prototype.nav=function(){var self=this,nextCell=!1,index=this.row.getCellIndex(this);return{next:function(){var nextRow,nextCell=this.right();return!!nextCell||!(!(nextRow=self.table.rowManager.nextDisplayRow(self.row,!0))||!(nextCell=nextRow.findNextEditableCell(-1)))&&(nextCell.edit(),!0)},prev:function(){var prevRow,nextCell=this.left();return!!nextCell||!(!(prevRow=self.table.rowManager.prevDisplayRow(self.row,!0))||!(nextCell=prevRow.findPrevEditableCell(prevRow.cells.length)))&&(nextCell.edit(),!0)},left:function(){return!!(nextCell=self.row.findPrevEditableCell(index))&&(nextCell.edit(),!0)},right:function(){return!!(nextCell=self.row.findNextEditableCell(index))&&(nextCell.edit(),!0)},up:function(){var nextRow=self.table.rowManager.prevDisplayRow(self.row,!0);nextRow&&nextRow.cells[index].edit()},down:function(){var nextRow=self.table.rowManager.nextDisplayRow(self.row,!0);nextRow&&nextRow.cells[index].edit()}}},Cell.prototype.getIndex=function(){this.row.getCellIndex(this)},Cell.prototype.getComponent=function(){return new CellComponent(this)};var FooterManager=function(table){this.table=table,this.active=!1,this.element=this.createElement(),this.external=!1,this.links=[],this._initialize()};FooterManager.prototype.createElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-footer"),el},FooterManager.prototype._initialize=function(element){if(this.table.options.footerElement)switch(_typeof(this.table.options.footerElement)){case"string":"<"===this.table.options.footerElement[0]?this.element.innerHTML=this.table.options.footerElement:(this.external=!0,this.element=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement}},FooterManager.prototype.getElement=function(){return this.element},FooterManager.prototype.append=function(element,parent){this.activate(parent),this.element.appendChild(element),this.table.rowManager.adjustTableSize()},FooterManager.prototype.prepend=function(element,parent){this.activate(parent),this.element.insertBefore(element,this.element.firstChild),this.table.rowManager.adjustTableSize()},FooterManager.prototype.remove=function(element){element.parentNode.removeChild(element),this.deactivate()},FooterManager.prototype.deactivate=function(force){this.element.firstChild&&!force||(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)},FooterManager.prototype.activate=function(parent){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display="")),parent&&this.links.push(parent)},FooterManager.prototype.redraw=function(){this.links.forEach(function(link){link.footerRedraw()})};var Tabulator=function Tabulator(element,options){this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.browser="",this.browserSlow=!1,this.modules={},this.initializeElement(element),this.initializeOptions(options||{}),this._create(),Tabulator.prototype.comms.register(this)};Tabulator.prototype.defaultOptions={height:!1,layout:"fitData",layoutColumnsOnNewData:!1,columnMinWidth:40,columnVertAlign:"top",resizableColumns:!0,resizableRows:!1,autoResize:!0,columns:[],data:[],autoColumns:!1,reactiveData:!1,nestedFieldSeparator:".",tooltips:!1,tooltipsHeader:!1,tooltipGenerationMode:"load",initialSort:!1,initialFilter:!1,initialHeaderFilter:!1,columnHeaderSortMulti:!0,sortOrderReverse:!1,headerSort:!0,headerSortTristate:!1,footerElement:!1,index:"id",keybindings:[],tabEndNewRow:!1,invalidOptionWarnings:!0,clipboard:!1,clipboardCopyStyled:!0,clipboardCopySelector:"active",clipboardCopyFormatter:"table",clipboardPasteParser:"table",clipboardPasteAction:"insert",clipboardCopyConfig:!1,clipboardCopied:function(){},clipboardPasted:function(){},clipboardPasteError:function(){},downloadDataFormatter:!1,downloadReady:function(data,blob){return blob},downloadComplete:!1,downloadConfig:!1,dataTree:!1,dataTreeElementColumn:!1,dataTreeBranchElement:!0,dataTreeChildIndent:9,dataTreeChildField:"_children",dataTreeCollapseElement:!1,dataTreeExpandElement:!1,dataTreeStartExpanded:!1,dataTreeRowExpanded:function(){},dataTreeRowCollapsed:function(){},printAsHtml:!1,printFormatter:!1,printHeader:!1,printFooter:!1,printCopyStyle:!0,printVisibleRows:!0,printConfig:{},addRowPos:"bottom",selectable:"highlight",selectableRangeMode:"drag",selectableRollingSelection:!0,selectablePersistence:!0,selectableCheck:function(data,row){return!0},headerFilterPlaceholder:!1,headerVisible:!0,history:!1,locale:!1,langs:{},virtualDom:!0,virtualDomBuffer:0,persistentLayout:!1,persistentSort:!1,persistentFilter:!1,persistenceID:"",persistenceMode:!0,responsiveLayout:!1,responsiveLayoutCollapseStartOpen:!0,responsiveLayoutCollapseUseFormatters:!0,responsiveLayoutCollapseFormatter:!1,pagination:!1,paginationSize:!1,paginationButtonCount:5,paginationSizeSelector:!1,paginationElement:!1,paginationDataSent:{},paginationDataReceived:{},paginationAddRow:"page",ajaxURL:!1,ajaxURLGenerator:!1,ajaxParams:{},ajaxConfig:"get",ajaxContentType:"form",ajaxRequestFunc:!1,ajaxLoader:!0,ajaxLoaderLoading:!1,ajaxLoaderError:!1,ajaxFiltering:!1,ajaxSorting:!1,ajaxProgressiveLoad:!1,ajaxProgressiveLoadDelay:0,ajaxProgressiveLoadScrollMargin:0,groupBy:!1,groupStartOpen:!0,groupValues:!1,groupHeader:!1,htmlOutputConfig:!1,movableColumns:!1,movableRows:!1,movableRowsConnectedTables:!1,movableRowsSender:!1,movableRowsReceiver:"insert",movableRowsSendingStart:function(){},movableRowsSent:function(){},movableRowsSentFailed:function(){},movableRowsSendingStop:function(){},movableRowsReceivingStart:function(){},movableRowsReceived:function(){},movableRowsReceivedFailed:function(){},movableRowsReceivingStop:function(){},scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,placeholder:!1,tableBuilding:function(){},tableBuilt:function(){},renderStarted:function(){},renderComplete:function(){},rowClick:!1,rowDblClick:!1,rowContext:!1,rowTap:!1,rowDblTap:!1,rowTapHold:!1,rowMouseEnter:!1,rowMouseLeave:!1,rowMouseOver:!1,rowMouseOut:!1,rowMouseMove:!1,rowAdded:function(){},rowDeleted:function(){},rowMoved:function(){},rowUpdated:function(){},rowSelectionChanged:function(){},rowSelected:function(){},rowDeselected:function(){},rowResized:function(){},cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1,cellMouseEnter:!1,cellMouseLeave:!1,cellMouseOver:!1,cellMouseOut:!1,cellMouseMove:!1,cellEditing:function(){},cellEdited:function(){},cellEditCancelled:function(){},columnMoved:!1,columnResized:function(){},columnTitleChanged:function(){},columnVisibilityChanged:function(){},htmlImporting:function(){},htmlImported:function(){},dataLoading:function(){},dataLoaded:function(){},dataEdited:function(){},ajaxRequesting:function(){},ajaxResponse:!1,ajaxError:function(){},dataFiltering:!1,dataFiltered:!1,dataSorting:function(){},dataSorted:function(){},groupToggleElement:"arrow",groupClosedShowCalcs:!1,dataGrouping:function(){},dataGrouped:!1,groupVisibilityChanged:function(){},groupClick:!1,groupDblClick:!1,groupContext:!1,groupTap:!1,groupDblTap:!1,groupTapHold:!1,columnCalcs:!0,pageLoaded:function(){},localized:function(){},validationFailed:function(){},historyUndo:function(){},historyRedo:function(){}},Tabulator.prototype.initializeOptions=function(options){if(!1!==options.invalidOptionWarnings)for(var key in options)void 0===this.defaultOptions[key]&&console.warn("Invalid table constructor option:",key);for(var key in this.defaultOptions)key in options?this.options[key]=options[key]:Array.isArray(this.defaultOptions[key])?this.options[key]=[]:"object"===_typeof(this.defaultOptions[key])?this.options[key]={}:this.options[key]=this.defaultOptions[key]},Tabulator.prototype.initializeElement=function(element){return"undefined"!=typeof HTMLElement&&element instanceof HTMLElement?(this.element=element,!0):"string"==typeof element?(this.element=document.querySelector(element),!!this.element||(console.error("Tabulator Creation Error - no element found matching selector: ",element),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",element),!1)},Tabulator.prototype._mapDepricatedFunctionality=function(){},Tabulator.prototype._clearSelection=function(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")},Tabulator.prototype._create=function(){this._clearObjectPointers(),this._mapDepricatedFunctionality(),this.bindModules(),"TABLE"===this.element.tagName&&this.modExists("htmlTableImport",!0)&&this.modules.htmlTableImport.parseTable(),this.columnManager=new ColumnManager(this),this.rowManager=new RowManager(this),this.footerManager=new FooterManager(this),this.columnManager.setRowManager(this.rowManager),this.rowManager.setColumnManager(this.columnManager),this._buildElement(),this._loadInitialData()},Tabulator.prototype._clearObjectPointers=function(){this.options.columns=this.options.columns.slice(0),this.options.reactiveData||(this.options.data=this.options.data.slice(0))},Tabulator.prototype._buildElement=function(){var _this8=this,element=this.element,mod=this.modules,options=this.options;for(options.tableBuilding.call(this),element.classList.add("tabulator"),element.setAttribute("role","grid");element.firstChild;)element.removeChild(element.firstChild);for(var locale in options.height&&(options.height=isNaN(options.height)?options.height:options.height+"px",element.style.height=options.height),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modExists("layout",!0)&&mod.layout.initialize(options.layout),!1!==options.headerFilterPlaceholder&&mod.localize.setHeaderFilterPlaceholder(options.headerFilterPlaceholder),options.langs)mod.localize.installLang(locale,options.langs[locale]);if(mod.localize.setLocale(options.locale),"string"==typeof options.placeholder){var el=document.createElement("div");el.classList.add("tabulator-placeholder");var span=document.createElement("span");span.innerHTML=options.placeholder,el.appendChild(span),options.placeholder=el}if(element.appendChild(this.columnManager.getElement()),element.appendChild(this.rowManager.getElement()),options.footerElement&&this.footerManager.activate(),(options.persistentLayout||options.persistentSort||options.persistentFilter)&&this.modExists("persistence",!0)&&mod.persistence.initialize(options.persistenceMode,options.persistenceID),options.persistentLayout&&this.modExists("persistence",!0)&&(options.columns=mod.persistence.load("columns",options.columns)),options.movableRows&&this.modExists("moveRow")&&mod.moveRow.initialize(),options.autoColumns&&this.options.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modExists("columnCalcs")&&mod.columnCalcs.initialize(),this.columnManager.setColumns(options.columns),options.dataTree&&this.modExists("dataTree",!0)&&mod.dataTree.initialize(),this.modExists("frozenRows")&&this.modules.frozenRows.initialize(),(options.persistentSort||options.initialSort)&&this.modExists("sort",!0)){var sorters=[];options.persistentSort&&this.modExists("persistence",!0)?!1===(sorters=mod.persistence.load("sort"))&&options.initialSort&&(sorters=options.initialSort):options.initialSort&&(sorters=options.initialSort),mod.sort.setSort(sorters)}if((options.persistentFilter||options.initialFilter)&&this.modExists("filter",!0)){var filters=[];options.persistentFilter&&this.modExists("persistence",!0)?!1===(filters=mod.persistence.load("filter"))&&options.initialFilter&&(filters=options.initialFilter):options.initialFilter&&(filters=options.initialFilter),mod.filter.setFilter(filters)}options.initialHeaderFilter&&this.modExists("filter",!0)&&options.initialHeaderFilter.forEach(function(item){var column=_this8.columnManager.findColumn(item.field);if(!column)return console.warn("Column Filter Error - No matching column found:",item.field),!1;mod.filter.setHeaderFilterValue(column,item.value)}),this.modExists("ajax")&&mod.ajax.initialize(),options.pagination&&this.modExists("page",!0)&&mod.page.initialize(),options.groupBy&&this.modExists("groupRows",!0)&&mod.groupRows.initialize(),this.modExists("keybindings")&&mod.keybindings.initialize(),this.modExists("selectRow")&&mod.selectRow.clearSelectionData(!0),options.autoResize&&this.modExists("resizeTable")&&mod.resizeTable.initialize(),this.modExists("clipboard")&&mod.clipboard.initialize(),options.printAsHtml&&this.modExists("print")&&mod.print.initialize(),options.tableBuilt.call(this)},Tabulator.prototype._loadInitialData=function(){this.options.pagination&&this.modExists("page")?(this.modules.page.reset(!0),"local"==this.options.pagination?this.options.data.length?this.rowManager.setData(this.options.data):(this.options.ajaxURL||this.options.ajaxURLGenerator)&&this.modExists("ajax")?this.modules.ajax.loadData().then(function(){}).catch(function(){}):this.rowManager.setData(this.options.data):this.options.ajaxURL?this.modules.page.setPage(1).then(function(){}).catch(function(){}):this.rowManager.setData([])):this.options.data.length?this.rowManager.setData(this.options.data):(this.options.ajaxURL||this.options.ajaxURLGenerator)&&this.modExists("ajax")?this.modules.ajax.loadData().then(function(){}).catch(function(){}):this.rowManager.setData(this.options.data)},Tabulator.prototype.destroy=function(){var element=this.element;for(Tabulator.prototype.comms.deregister(this),this.options.reactiveData&&this.modExists("reactiveData",!0)&&this.modules.reactiveData.unwatchData(),this.rowManager.rows.forEach(function(row){row.wipe()}),this.rowManager.rows=[],this.rowManager.activeRows=[],this.rowManager.displayRows=[],this.options.autoResize&&this.modExists("resizeTable")&&this.modules.resizeTable.clearBindings(),this.modExists("keybindings")&&this.modules.keybindings.clearBindings();element.firstChild;)element.removeChild(element.firstChild);element.classList.remove("tabulator")},Tabulator.prototype._detectBrowser=function(){var ua=navigator.userAgent;-1<ua.indexOf("Trident")?(this.browser="ie",this.browserSlow=!0):-1<ua.indexOf("Edge")?(this.browser="edge",this.browserSlow=!0):(-1<ua.indexOf("Firefox")?this.browser="firefox":this.browser="other",this.browserSlow=!1)},Tabulator.prototype.setDataFromLocalFile=function(extensions){var _this9=this;return new Promise(function(resolve,reject){var input=document.createElement("input");input.type="file",input.accept=extensions||".json,application/json",input.addEventListener("change",function(e){var data,file=input.files[0],reader=new FileReader;reader.readAsText(file),reader.onload=function(e){try{data=JSON.parse(reader.result)}catch(e){return console.warn("File Load Error - File contents is invalid JSON",e),void reject(e)}_this9._setData(data).then(function(data){resolve(data)}).catch(function(err){resolve(err)})},reader.onerror=function(e){console.warn("File Load Error - Unable to read file"),reject()}}),input.click()})},Tabulator.prototype.setData=function(data,params,config){return this.modExists("ajax")&&this.modules.ajax.blockActiveRequest(),this._setData(data,params,config)},Tabulator.prototype._setData=function(data,params,config,inPosition){return"string"!=typeof data?data?this.rowManager.setData(data,inPosition):this.modExists("ajax")&&(this.modules.ajax.getUrl||this.options.ajaxURLGenerator)?"remote"==this.options.pagination&&this.modExists("page",!0)?(this.modules.page.reset(!0),this.modules.page.setPage(1)):this.modules.ajax.loadData(inPosition):this.rowManager.setData([],inPosition):0==data.indexOf("{")||0==data.indexOf("[")?this.rowManager.setData(JSON.parse(data),inPosition):this.modExists("ajax",!0)?(params&&this.modules.ajax.setParams(params),config&&this.modules.ajax.setConfig(config),this.modules.ajax.setUrl(data),"remote"==this.options.pagination&&this.modExists("page",!0)?(this.modules.page.reset(!0),this.modules.page.setPage(1)):this.modules.ajax.loadData(inPosition)):void 0},Tabulator.prototype.clearData=function(){this.modExists("ajax")&&this.modules.ajax.blockActiveRequest(),this.rowManager.clearData()},Tabulator.prototype.getData=function(active){return this.rowManager.getData(active)},Tabulator.prototype.getDataCount=function(active){return this.rowManager.getDataCount(active)},Tabulator.prototype.searchRows=function(field,type,value){if(this.modExists("filter",!0))return this.modules.filter.search("rows",field,type,value)},Tabulator.prototype.searchData=function(field,type,value){if(this.modExists("filter",!0))return this.modules.filter.search("data",field,type,value)},Tabulator.prototype.getHtml=function(visible,style,config){if(this.modExists("htmlTableExport",!0))return this.modules.htmlTableExport.getHtml(visible,style,config)},Tabulator.prototype.print=function(visible,style,config){if(this.modExists("print",!0))return this.modules.print.printFullscreen(visible,style,config)},Tabulator.prototype.getAjaxUrl=function(){if(this.modExists("ajax",!0))return this.modules.ajax.getUrl()},Tabulator.prototype.replaceData=function(data,params,config){return this.modExists("ajax")&&this.modules.ajax.blockActiveRequest(),this._setData(data,params,config,!0)},Tabulator.prototype.updateData=function(data){var _this10=this,self=this,responses=0;return new Promise(function(resolve,reject){_this10.modExists("ajax")&&_this10.modules.ajax.blockActiveRequest(),"string"==typeof data&&(data=JSON.parse(data)),data?data.forEach(function(item){var row=self.rowManager.findRow(item[self.options.index]);row&&(responses++,row.updateData(item).then(function(){--responses||resolve()}))}):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))})},Tabulator.prototype.addData=function(data,pos,index){var _this11=this;return new Promise(function(resolve,reject){_this11.modExists("ajax")&&_this11.modules.ajax.blockActiveRequest(),"string"==typeof data&&(data=JSON.parse(data)),data?_this11.rowManager.addRows(data,pos,index).then(function(rows){var output=[];rows.forEach(function(row){output.push(row.getComponent())}),resolve(output)}):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))})},Tabulator.prototype.updateOrAddData=function(data){var _this12=this,self=this,rows=[],responses=0;return new Promise(function(resolve,reject){_this12.modExists("ajax")&&_this12.modules.ajax.blockActiveRequest(),"string"==typeof data&&(data=JSON.parse(data)),data?data.forEach(function(item){var row=self.rowManager.findRow(item[self.options.index]);responses++,row?row.updateData(item).then(function(){responses--,rows.push(row.getComponent()),responses||resolve(rows)}):self.rowManager.addRows(item).then(function(newRows){responses--,rows.push(newRows[0].getComponent()),responses||resolve(rows)})}):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))})},Tabulator.prototype.getRow=function(index){var row=this.rowManager.findRow(index);return row?row.getComponent():(console.warn("Find Error - No matching row found:",index),!1)},Tabulator.prototype.getRowFromPosition=function(position,active){var row=this.rowManager.getRowFromPosition(position,active);return row?row.getComponent():(console.warn("Find Error - No matching row found:",position),!1)},Tabulator.prototype.deleteRow=function(index){var _this13=this;return new Promise(function(resolve,reject){var row=_this13.rowManager.findRow(index);row?row.delete().then(function(){resolve()}).catch(function(err){reject(err)}):(console.warn("Delete Error - No matching row found:",index),reject("Delete Error - No matching row found"))})},Tabulator.prototype.addRow=function(data,pos,index){var _this14=this;return new Promise(function(resolve,reject){"string"==typeof data&&(data=JSON.parse(data)),_this14.rowManager.addRows(data,pos,index).then(function(rows){_this14.modExists("columnCalcs")&&_this14.modules.columnCalcs.recalc(_this14.rowManager.activeRows),resolve(rows[0].getComponent())})})},Tabulator.prototype.updateOrAddRow=function(index,data){var _this15=this;return new Promise(function(resolve,reject){var row=_this15.rowManager.findRow(index);"string"==typeof data&&(data=JSON.parse(data)),row?row.updateData(data).then(function(){_this15.modExists("columnCalcs")&&_this15.modules.columnCalcs.recalc(_this15.rowManager.activeRows),resolve(row.getComponent())}).catch(function(err){reject(err)}):row=_this15.rowManager.addRows(data).then(function(rows){_this15.modExists("columnCalcs")&&_this15.modules.columnCalcs.recalc(_this15.rowManager.activeRows),resolve(rows[0].getComponent())}).catch(function(err){reject(err)})})},Tabulator.prototype.updateRow=function(index,data){var _this16=this;return new Promise(function(resolve,reject){var row=_this16.rowManager.findRow(index);"string"==typeof data&&(data=JSON.parse(data)),row?row.updateData(data).then(function(){resolve(row.getComponent())}).catch(function(err){reject(err)}):(console.warn("Update Error - No matching row found:",index),reject("Update Error - No matching row found"))})},Tabulator.prototype.scrollToRow=function(index,position,ifVisible){var _this17=this;return new Promise(function(resolve,reject){var row=_this17.rowManager.findRow(index);row?_this17.rowManager.scrollToRow(row,position,ifVisible).then(function(){resolve()}).catch(function(err){reject(err)}):(console.warn("Scroll Error - No matching row found:",index),reject("Scroll Error - No matching row found"))})},Tabulator.prototype.moveRow=function(from,to,after){var fromRow=this.rowManager.findRow(from);fromRow?fromRow.moveToRow(to,after):console.warn("Move Error - No matching row found:",from)},Tabulator.prototype.getRows=function(active){return this.rowManager.getComponents(active)},Tabulator.prototype.getRowPosition=function(index,active){var row=this.rowManager.findRow(index);return row?this.rowManager.getRowPosition(row,active):(console.warn("Position Error - No matching row found:",index),!1)},Tabulator.prototype.copyToClipboard=function(selector,selectorParams,formatter,formatterParams){this.modExists("clipboard",!0)&&this.modules.clipboard.copy(selector,selectorParams,formatter,formatterParams)},Tabulator.prototype.setColumns=function(definition){this.columnManager.setColumns(definition)},Tabulator.prototype.getColumns=function(structured){return this.columnManager.getComponents(structured)},Tabulator.prototype.getColumn=function(field){var col=this.columnManager.findColumn(field);return col?col.getComponent():(console.warn("Find Error - No matching column found:",field),!1)},Tabulator.prototype.getColumnDefinitions=function(){return this.columnManager.getDefinitionTree()},Tabulator.prototype.getColumnLayout=function(){if(this.modExists("persistence",!0))return this.modules.persistence.parseColumns(this.columnManager.getColumns())},Tabulator.prototype.setColumnLayout=function(layout){return!!this.modExists("persistence",!0)&&(this.columnManager.setColumns(this.modules.persistence.mergeDefinition(this.options.columns,layout)),!0)},Tabulator.prototype.showColumn=function(field){var column=this.columnManager.findColumn(field);if(!column)return console.warn("Column Show Error - No matching column found:",field),!1;column.show(),this.options.responsiveLayout&&this.modExists("responsiveLayout",!0)&&this.modules.responsiveLayout.update()},Tabulator.prototype.hideColumn=function(field){var column=this.columnManager.findColumn(field);if(!column)return console.warn("Column Hide Error - No matching column found:",field),!1;column.hide(),this.options.responsiveLayout&&this.modExists("responsiveLayout",!0)&&this.modules.responsiveLayout.update()},Tabulator.prototype.toggleColumn=function(field){var column=this.columnManager.findColumn(field);if(!column)return console.warn("Column Visibility Toggle Error - No matching column found:",field),!1;column.visible?column.hide():column.show()},Tabulator.prototype.addColumn=function(definition,before,field){var column=this.columnManager.findColumn(field);this.columnManager.addColumn(definition,before,column)},Tabulator.prototype.deleteColumn=function(field){var column=this.columnManager.findColumn(field);if(!column)return console.warn("Column Delete Error - No matching column found:",field),!1;column.delete()},Tabulator.prototype.moveColumn=function(from,to,after){var fromColumn=this.columnManager.findColumn(from),toColumn=this.columnManager.findColumn(to);fromColumn?toColumn?this.columnManager.moveColumn(fromColumn,toColumn,after):console.warn("Move Error - No matching column found:",toColumn):console.warn("Move Error - No matching column found:",from)},Tabulator.prototype.scrollToColumn=function(field,position,ifVisible){var _this18=this;return new Promise(function(resolve,reject){var column=_this18.columnManager.findColumn(field);column?_this18.columnManager.scrollToColumn(column,position,ifVisible).then(function(){resolve()}).catch(function(err){reject(err)}):(console.warn("Scroll Error - No matching column found:",field),reject("Scroll Error - No matching column found"))})},Tabulator.prototype.setLocale=function(locale){this.modules.localize.setLocale(locale)},Tabulator.prototype.getLocale=function(){return this.modules.localize.getLocale()},Tabulator.prototype.getLang=function(locale){return this.modules.localize.getLang(locale)},Tabulator.prototype.redraw=function(force){this.columnManager.redraw(force),this.rowManager.redraw(force)},Tabulator.prototype.setHeight=function(height){this.options.height=isNaN(height)?height:height+"px",this.element.style.height=this.options.height,this.rowManager.redraw()},Tabulator.prototype.setSort=function(sortList,dir){this.modExists("sort",!0)&&(this.modules.sort.setSort(sortList,dir),this.rowManager.sorterRefresh())},Tabulator.prototype.getSorters=function(){if(this.modExists("sort",!0))return this.modules.sort.getSort()},Tabulator.prototype.clearSort=function(){this.modExists("sort",!0)&&(this.modules.sort.clear(),this.rowManager.sorterRefresh())},Tabulator.prototype.setFilter=function(field,type,value){this.modExists("filter",!0)&&(this.modules.filter.setFilter(field,type,value),this.rowManager.filterRefresh())},Tabulator.prototype.addFilter=function(field,type,value){this.modExists("filter",!0)&&(this.modules.filter.addFilter(field,type,value),this.rowManager.filterRefresh())},Tabulator.prototype.getFilters=function(all){if(this.modExists("filter",!0))return this.modules.filter.getFilters(all)},Tabulator.prototype.setHeaderFilterFocus=function(field){if(this.modExists("filter",!0)){var column=this.columnManager.findColumn(field);if(!column)return console.warn("Column Filter Focus Error - No matching column found:",field),!1;this.modules.filter.setHeaderFilterFocus(column)}},Tabulator.prototype.setHeaderFilterValue=function(field,value){if(this.modExists("filter",!0)){var column=this.columnManager.findColumn(field);if(!column)return console.warn("Column Filter Error - No matching column found:",field),!1;this.modules.filter.setHeaderFilterValue(column,value)}},Tabulator.prototype.getHeaderFilters=function(){if(this.modExists("filter",!0))return this.modules.filter.getHeaderFilters()},Tabulator.prototype.removeFilter=function(field,type,value){this.modExists("filter",!0)&&(this.modules.filter.removeFilter(field,type,value),this.rowManager.filterRefresh())},Tabulator.prototype.clearFilter=function(all){this.modExists("filter",!0)&&(this.modules.filter.clearFilter(all),this.rowManager.filterRefresh())},Tabulator.prototype.clearHeaderFilter=function(){this.modExists("filter",!0)&&(this.modules.filter.clearHeaderFilter(),this.rowManager.filterRefresh())},Tabulator.prototype.selectRow=function(rows){this.modExists("selectRow",!0)&&this.modules.selectRow.selectRows(rows)},Tabulator.prototype.deselectRow=function(rows){this.modExists("selectRow",!0)&&this.modules.selectRow.deselectRows(rows)},Tabulator.prototype.toggleSelectRow=function(row){this.modExists("selectRow",!0)&&this.modules.selectRow.toggleRow(row)},Tabulator.prototype.getSelectedRows=function(){if(this.modExists("selectRow",!0))return this.modules.selectRow.getSelectedRows()},Tabulator.prototype.getSelectedData=function(){if(this.modExists("selectRow",!0))return this.modules.selectRow.getSelectedData()},Tabulator.prototype.setMaxPage=function(max){if(!this.options.pagination||!this.modExists("page"))return!1;this.modules.page.setMaxPage(max)},Tabulator.prototype.setPage=function(page){return this.options.pagination&&this.modExists("page")?this.modules.page.setPage(page):new Promise(function(resolve,reject){reject()})},Tabulator.prototype.setPageToRow=function(row){var _this19=this;return new Promise(function(resolve,reject){_this19.options.pagination&&_this19.modExists("page")&&(row=_this19.rowManager.findRow(row))?_this19.modules.page.setPageToRow(row).then(function(){resolve()}).catch(function(){reject()}):reject()})},Tabulator.prototype.setPageSize=function(size){if(!this.options.pagination||!this.modExists("page"))return!1;this.modules.page.setPageSize(size),this.modules.page.setPage(1).then(function(){}).catch(function(){})},Tabulator.prototype.getPageSize=function(){if(this.options.pagination&&this.modExists("page",!0))return this.modules.page.getPageSize()},Tabulator.prototype.previousPage=function(){if(!this.options.pagination||!this.modExists("page"))return!1;this.modules.page.previousPage()},Tabulator.prototype.nextPage=function(){if(!this.options.pagination||!this.modExists("page"))return!1;this.modules.page.nextPage()},Tabulator.prototype.getPage=function(){return!(!this.options.pagination||!this.modExists("page"))&&this.modules.page.getPage()},Tabulator.prototype.getPageMax=function(){return!(!this.options.pagination||!this.modExists("page"))&&this.modules.page.getPageMax()},Tabulator.prototype.setGroupBy=function(groups){if(!this.modExists("groupRows",!0))return!1;this.options.groupBy=groups,this.modules.groupRows.initialize(),this.rowManager.refreshActiveData("display")},Tabulator.prototype.setGroupStartOpen=function(values){if(!this.modExists("groupRows",!0))return!1;this.options.groupStartOpen=values,this.modules.groupRows.initialize(),this.options.groupBy?this.rowManager.refreshActiveData("group"):console.warn("Grouping Update - cant refresh view, no groups have been set")},Tabulator.prototype.setGroupHeader=function(values){if(!this.modExists("groupRows",!0))return!1;this.options.groupHeader=values,this.modules.groupRows.initialize(),this.options.groupBy?this.rowManager.refreshActiveData("group"):console.warn("Grouping Update - cant refresh view, no groups have been set")},Tabulator.prototype.getGroups=function(values){return!!this.modExists("groupRows",!0)&&this.modules.groupRows.getGroups(!0)},Tabulator.prototype.getGroupedData=function(){if(this.modExists("groupRows",!0))return this.options.groupBy?this.modules.groupRows.getGroupedData():this.getData()},Tabulator.prototype.getCalcResults=function(){return!!this.modExists("columnCalcs",!0)&&this.modules.columnCalcs.getResults()},Tabulator.prototype.navigatePrev=function(){var cell=!1;return!(!this.modExists("edit",!0)||!(cell=this.modules.edit.currentCell))&&cell.nav().prev()},Tabulator.prototype.navigateNext=function(){var cell=!1;return!(!this.modExists("edit",!0)||!(cell=this.modules.edit.currentCell))&&cell.nav().next()},Tabulator.prototype.navigateLeft=function(){var cell=!1;return!(!this.modExists("edit",!0)||!(cell=this.modules.edit.currentCell))&&(e.preventDefault(),cell.nav().left())},Tabulator.prototype.navigateRight=function(){var cell=!1;return!(!this.modExists("edit",!0)||!(cell=this.modules.edit.currentCell))&&(e.preventDefault(),cell.nav().right())},Tabulator.prototype.navigateUp=function(){var cell=!1;return!(!this.modExists("edit",!0)||!(cell=this.modules.edit.currentCell))&&(e.preventDefault(),cell.nav().up())},Tabulator.prototype.navigateDown=function(){var cell=!1;return!(!this.modExists("edit",!0)||!(cell=this.modules.edit.currentCell))&&(e.preventDefault(),cell.nav().down())},Tabulator.prototype.undo=function(){return!(!this.options.history||!this.modExists("history",!0))&&this.modules.history.undo()},Tabulator.prototype.redo=function(){return!(!this.options.history||!this.modExists("history",!0))&&this.modules.history.redo()},Tabulator.prototype.getHistoryUndoSize=function(){return!(!this.options.history||!this.modExists("history",!0))&&this.modules.history.getHistoryUndoSize()},Tabulator.prototype.getHistoryRedoSize=function(){return!(!this.options.history||!this.modExists("history",!0))&&this.modules.history.getHistoryRedoSize()},Tabulator.prototype.download=function(type,filename,options){this.modExists("download",!0)&&this.modules.download.download(type,filename,options)},Tabulator.prototype.downloadToTab=function(type,filename,options){this.modExists("download",!0)&&this.modules.download.download(type,filename,options,!0)},Tabulator.prototype.tableComms=function(table,module,action,data){this.modules.comms.receive(table,module,action,data)},Tabulator.prototype.moduleBindings={},Tabulator.prototype.extendModule=function(name,property,values){if(Tabulator.prototype.moduleBindings[name]){var source=Tabulator.prototype.moduleBindings[name].prototype[property];if(source)if("object"==(void 0===values?"undefined":_typeof(values)))for(var key in values)source[key]=values[key];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",property)}else console.warn("Module Error - module does not exist:",name)},Tabulator.prototype.registerModule=function(name,module){Tabulator.prototype.moduleBindings[name]=module},Tabulator.prototype.bindModules=function(){for(var name in this.modules={},Tabulator.prototype.moduleBindings)this.modules[name]=new Tabulator.prototype.moduleBindings[name](this)},Tabulator.prototype.modExists=function(plugin,required){return!!this.modules[plugin]||(required&&console.error("Tabulator Module Not Installed: "+plugin),!1)},Tabulator.prototype.helpers={elVisible:function(el){return!(el.offsetWidth<=0&&el.offsetHeight<=0)},elOffset:function(el){var box=el.getBoundingClientRect();return{top:box.top+window.pageYOffset-document.documentElement.clientTop,left:box.left+window.pageXOffset-document.documentElement.clientLeft}},deepClone:function(obj){var clone=Array.isArray(obj)?[]:{};for(var i in obj)null!=obj[i]&&"object"===_typeof(obj[i])?obj[i]instanceof Date?clone[i]=new Date(obj[i]):clone[i]=this.deepClone(obj[i]):clone[i]=obj[i];return clone}},Tabulator.prototype.comms={tables:[],register:function(table){Tabulator.prototype.comms.tables.push(table)},deregister:function(table){var index=Tabulator.prototype.comms.tables.indexOf(table);-1<index&&Tabulator.prototype.comms.tables.splice(index,1)},lookupTable:function(query){var matches,match,results=[];if("string"==typeof query){if((matches=document.querySelectorAll(query)).length)for(var i=0;i<matches.length;i++)(match=Tabulator.prototype.comms.matchElement(matches[i]))&&results.push(match)}else"undefined"!=typeof HTMLElement&&query instanceof HTMLElement||query instanceof Tabulator?(match=Tabulator.prototype.comms.matchElement(query))&&results.push(match):Array.isArray(query)?query.forEach(function(item){results=results.concat(Tabulator.prototype.comms.lookupTable(item))}):console.warn("Table Connection Error - Invalid Selector",query);return results},matchElement:function(element){return Tabulator.prototype.comms.tables.find(function(table){return element instanceof Tabulator?table===element:table.element===element})}};var Layout=function(table){this.table=table,this.mode=null};Layout.prototype.initialize=function(layout){this.modes[layout]?this.mode=layout:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+layout),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode)},Layout.prototype.getMode=function(){return this.mode},Layout.prototype.layout=function(){this.modes[this.mode].call(this,this.table.columnManager.columnsByIndex)},Layout.prototype.modes={fitData:function(columns){columns.forEach(function(column){column.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitDataFill:function(columns){columns.forEach(function(column){column.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitColumns:function(columns){var flexColWidth,overflowWidth,totalWidth=this.table.element.clientWidth,fixedWidth=0,flexWidth=0,flexGrowUnits=0,flexColumns=[],fixedShrinkColumns=[],flexShrinkUnits=0,gapFill=0;function calcWidth(width){return"string"==typeof width?-1<width.indexOf("%")?totalWidth/100*parseInt(width):parseInt(width):width}function scaleColumns(columns,freeSpace,colWidth,shrinkCols){var oversizeCols=[],oversizeSpace=0,remainingSpace=0,nextColWidth=0,gap=0,changeUnits=0,undersizeCols=[];function calcGrow(col){return colWidth*(col.column.definition.widthGrow||1)}function calcShrink(col){return calcWidth(col.width)-colWidth*(col.column.definition.widthShrink||0)}return columns.forEach(function(col,i){var width=shrinkCols?calcShrink(col):calcGrow(col);col.column.minWidth>=width?oversizeCols.push(col):(undersizeCols.push(col),changeUnits+=shrinkCols?col.column.definition.widthShrink||1:col.column.definition.widthGrow||1)}),oversizeCols.length?(oversizeCols.forEach(function(col){oversizeSpace+=shrinkCols?col.width-col.column.minWidth:col.column.minWidth,col.width=col.column.minWidth}),gap=(remainingSpace=freeSpace-oversizeSpace)-(nextColWidth=changeUnits?Math.floor(remainingSpace/changeUnits):remainingSpace)*changeUnits,gap+=scaleColumns(undersizeCols,remainingSpace,nextColWidth,shrinkCols)):(gap=changeUnits?freeSpace-Math.floor(freeSpace/changeUnits)*changeUnits:freeSpace,undersizeCols.forEach(function(column){column.width=shrinkCols?calcShrink(column):calcGrow(column)})),gap}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(totalWidth-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),columns.forEach(function(column){var width,minWidth,colWidth;column.visible&&(width=column.definition.width,minWidth=parseInt(column.minWidth),width?(colWidth=calcWidth(width),fixedWidth+=minWidth<colWidth?colWidth:minWidth,column.definition.widthShrink&&(fixedShrinkColumns.push({column:column,width:minWidth<colWidth?colWidth:minWidth}),flexShrinkUnits+=column.definition.widthShrink)):(flexColumns.push({column:column,width:0}),flexGrowUnits+=column.definition.widthGrow||1))}),flexWidth=totalWidth-fixedWidth,flexColWidth=Math.floor(flexWidth/flexGrowUnits);gapFill=scaleColumns(flexColumns,flexWidth,flexColWidth,!1);flexColumns.length&&0<gapFill&&(flexColumns[flexColumns.length-1].width+=+gapFill),flexColumns.forEach(function(col){flexWidth-=col.width}),0<(overflowWidth=Math.abs(gapFill)+flexWidth)&&flexShrinkUnits&&(gapFill=scaleColumns(fixedShrinkColumns,overflowWidth,Math.floor(overflowWidth/flexShrinkUnits),!0)),fixedShrinkColumns.length&&(fixedShrinkColumns[fixedShrinkColumns.length-1].width-=gapFill),flexColumns.forEach(function(col){col.column.setWidth(col.width)}),fixedShrinkColumns.forEach(function(col){col.column.setWidth(col.width)})}},Tabulator.prototype.registerModule("layout",Layout);var Localize=function(table){this.table=table,this.locale="default",this.lang=!1,this.bindings={}};Localize.prototype.setHeaderFilterPlaceholder=function(placeholder){this.langs.default.headerFilters.default=placeholder},Localize.prototype.setHeaderFilterColumnPlaceholder=function(column,placeholder){this.langs.default.headerFilters.columns[column]=placeholder,this.lang&&!this.lang.headerFilters.columns[column]&&(this.lang.headerFilters.columns[column]=placeholder)},Localize.prototype.installLang=function(locale,lang){this.langs[locale]?this._setLangProp(this.langs[locale],lang):this.langs[locale]=lang},Localize.prototype._setLangProp=function(lang,values){for(var key in values)lang[key]&&"object"==_typeof(lang[key])?this._setLangProp(lang[key],values[key]):lang[key]=values[key]},Localize.prototype.setLocale=function(desiredLocale){if(!0===(desiredLocale=desiredLocale||"default")&&navigator.language&&(desiredLocale=navigator.language.toLowerCase()),desiredLocale&&!this.langs[desiredLocale]){var prefix=desiredLocale.split("-")[0];desiredLocale=this.langs[prefix]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",desiredLocale,prefix),prefix):(console.warn("Localization Error - Matching locale not found, using default: ",desiredLocale),"default")}this.locale=desiredLocale,this.lang=Tabulator.prototype.helpers.deepClone(this.langs.default||{}),"default"!=desiredLocale&&function traverseLang(trans,path){for(var prop in trans)"object"==_typeof(trans[prop])?(path[prop]||(path[prop]={}),traverseLang(trans[prop],path[prop])):path[prop]=trans[prop]}(this.langs[desiredLocale],this.lang),this.table.options.localized.call(this.table,this.locale,this.lang),this._executeBindings()},Localize.prototype.getLocale=function(locale){return self.locale},Localize.prototype.getLang=function(locale){return locale?this.langs[locale]:this.lang},Localize.prototype.getText=function(path,value){var pathArray=(path=value?path+"|"+value:path).split("|");return this._getLangElement(pathArray,this.locale)||""},Localize.prototype._getLangElement=function(path,locale){var root=this.lang;return path.forEach(function(level){var rootPath;root&&(rootPath=root[level],root=void 0!==rootPath&&rootPath)}),root},Localize.prototype.bind=function(path,callback){this.bindings[path]||(this.bindings[path]=[]),this.bindings[path].push(callback),callback(this.getText(path),this.lang)},Localize.prototype._executeBindings=function(){var self=this,_loop=function(path){self.bindings[path].forEach(function(binding){binding(self.getText(path),self.lang)})};for(var path in self.bindings)_loop(path)},Localize.prototype.langs={default:{groups:{item:"item",items:"items"},columns:{},ajax:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page"},headerFilters:{default:"filter column...",columns:{}}}},Tabulator.prototype.registerModule("localize",Localize);var Comms=function(table){this.table=table};Comms.prototype.getConnections=function(selectors){var self=this,connections=[];return Tabulator.prototype.comms.lookupTable(selectors).forEach(function(con){self.table!==con&&connections.push(con)}),connections},Comms.prototype.send=function(selectors,module,action,data){var self=this,connections=this.getConnections(selectors);connections.forEach(function(connection){connection.tableComms(self.table.element,module,action,data)}),!connections.length&&selectors&&console.warn("Table Connection Error - No tables matching selector found",selectors)},Comms.prototype.receive=function(table,module,action,data){if(this.table.modExists(module))return this.table.modules[module].commsReceived(table,action,data);console.warn("Inter-table Comms Error - no such module:",module)},Tabulator.prototype.registerModule("comms",Comms);var Accessor=function(table){this.table=table,this.allowedTypes=["","data","download","clipboard"]};Accessor.prototype.initializeColumn=function(column){var self=this,match=!1,config={};this.allowedTypes.forEach(function(type){var accessor,key="accessor"+(type.charAt(0).toUpperCase()+type.slice(1));column.definition[key]&&(accessor=self.lookupAccessor(column.definition[key]))&&(match=!0,config[key]={accessor:accessor,params:column.definition[key+"Params"]||{}})}),match&&(column.modules.accessor=config)},Accessor.prototype.lookupAccessor=function(value){var accessor=!1;switch(void 0===value?"undefined":_typeof(value)){case"string":this.accessors[value]?accessor=this.accessors[value]:console.warn("Accessor Error - No such accessor found, ignoring: ",value);break;case"function":accessor=value}return accessor},Accessor.prototype.transformRow=function(dataIn,type){var key="accessor"+(type.charAt(0).toUpperCase()+type.slice(1)),data=Tabulator.prototype.helpers.deepClone(dataIn||{});return this.table.columnManager.traverse(function(column){var value,accessor,params,component;column.modules.accessor&&(accessor=column.modules.accessor[key]||column.modules.accessor.accessor||!1)&&"undefined"!=(value=column.getFieldValue(data))&&(component=column.getComponent(),params="function"==typeof accessor.params?accessor.params(value,data,type,component):accessor.params,column.setFieldValue(data,accessor.accessor(value,data,type,params,component)))}),data},Accessor.prototype.accessors={},Tabulator.prototype.registerModule("accessor",Accessor);var Ajax=function(table){this.table=table,this.config=!1,this.url="",this.urlGenerator=!1,this.params=!1,this.loaderElement=this.createLoaderElement(),this.msgElement=this.createMsgElement(),this.loadingElement=!1,this.errorElement=!1,this.loaderPromise=!1,this.progressiveLoad=!1,this.loading=!1,this.requestOrder=0};Ajax.prototype.initialize=function(){var template;this.loaderElement.appendChild(this.msgElement),this.table.options.ajaxLoaderLoading&&("string"==typeof this.table.options.ajaxLoaderLoading?((template=document.createElement("template")).innerHTML=this.table.options.ajaxLoaderLoading.trim(),this.loadingElement=template.content.firstChild):this.loadingElement=this.table.options.ajaxLoaderLoading),this.loaderPromise=this.table.options.ajaxRequestFunc||this.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||this.defaultURLGenerator,this.table.options.ajaxLoaderError&&("string"==typeof this.table.options.ajaxLoaderError?((template=document.createElement("template")).innerHTML=this.table.options.ajaxLoaderError.trim(),this.errorElement=template.content.firstChild):this.errorElement=this.table.options.ajaxLoaderError),this.table.options.ajaxParams&&this.setParams(this.table.options.ajaxParams),this.table.options.ajaxConfig&&this.setConfig(this.table.options.ajaxConfig),this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.table.options.ajaxProgressiveLoad&&(this.table.options.pagination?(this.progressiveLoad=!1,console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time")):this.table.modExists("page")?(this.progressiveLoad=this.table.options.ajaxProgressiveLoad,this.table.modules.page.initializeProgressive(this.progressiveLoad)):console.error("Pagination plugin is required for progressive ajax loading"))},Ajax.prototype.createLoaderElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-loader"),el},Ajax.prototype.createMsgElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-loader-msg"),el.setAttribute("role","alert"),el},Ajax.prototype.setParams=function(params,update){if(update)for(var key in this.params=this.params||{},params)this.params[key]=params[key];else this.params=params},Ajax.prototype.getParams=function(){return this.params||{}},Ajax.prototype.setConfig=function(config){if(this._loadDefaultConfig(),"string"==typeof config)this.config.method=config;else for(var key in config)this.config[key]=config[key]},Ajax.prototype._loadDefaultConfig=function(force){if(!this.config||force)for(var key in this.config={},this.defaultConfig)this.config[key]=this.defaultConfig[key]},Ajax.prototype.setUrl=function(url){this.url=url},Ajax.prototype.getUrl=function(){return this.url},Ajax.prototype.loadData=function(inPosition){return this.progressiveLoad?this._loadDataProgressive():this._loadDataStandard(inPosition)},Ajax.prototype.nextPage=function(diff){this.loading||diff<(this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.getElement().clientHeight)&&this.table.modules.page.nextPage().then(function(){}).catch(function(){})},Ajax.prototype.blockActiveRequest=function(){this.requestOrder++},Ajax.prototype._loadDataProgressive=function(){return this.table.rowManager.setData([]),this.table.modules.page.setPage(1)},Ajax.prototype._loadDataStandard=function(inPosition){var _this20=this;return new Promise(function(resolve,reject){_this20.sendRequest(inPosition).then(function(data){_this20.table.rowManager.setData(data,inPosition).then(function(){resolve()}).catch(function(e){reject(e)})}).catch(function(e){reject(e)})})},Ajax.prototype.generateParamsList=function(data,prefix){var self=this,output=[];if(prefix=prefix||"",Array.isArray(data))data.forEach(function(item,i){output=output.concat(self.generateParamsList(item,prefix?prefix+"["+i+"]":i))});else if("object"===(void 0===data?"undefined":_typeof(data)))for(var key in data)output=output.concat(self.generateParamsList(data[key],prefix?prefix+"["+key+"]":key));else output.push({key:prefix,value:data});return output},Ajax.prototype.serializeParams=function(params){var output=this.generateParamsList(params),encoded=[];return output.forEach(function(item){encoded.push(encodeURIComponent(item.key)+"="+encodeURIComponent(item.value))}),encoded.join("&")},Ajax.prototype.sendRequest=function(silent){var requestNo,_this21=this,self=this,url=self.url;return self.requestOrder++,requestNo=self.requestOrder,self._loadDefaultConfig(),new Promise(function(resolve,reject){!1!==self.table.options.ajaxRequesting.call(_this21.table,self.url,self.params)?(self.loading=!0,silent||self.showLoader(),_this21.loaderPromise(url,self.config,self.params).then(function(data){requestNo===self.requestOrder?(self.table.options.ajaxResponse&&(data=self.table.options.ajaxResponse.call(self.table,self.url,self.params,data)),resolve(data)):console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made"),self.hideLoader(),self.loading=!1}).catch(function(error){console.error("Ajax Load Error: ",error),self.table.options.ajaxError.call(self.table,error),self.showError(),setTimeout(function(){self.hideLoader()},3e3),self.loading=!1,reject()})):reject()})},Ajax.prototype.showLoader=function(){if("function"==typeof this.table.options.ajaxLoader?this.table.options.ajaxLoader():this.table.options.ajaxLoader){for(this.hideLoader();this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.remove("tabulator-error"),this.msgElement.classList.add("tabulator-loading"),this.loadingElement?this.msgElement.appendChild(this.loadingElement):this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|loading"),this.table.element.appendChild(this.loaderElement)}},Ajax.prototype.showError=function(){for(this.hideLoader();this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.remove("tabulator-loading"),this.msgElement.classList.add("tabulator-error"),this.errorElement?this.msgElement.appendChild(this.errorElement):this.msgElement.innerHTML=this.table.modules.localize.getText("ajax|error"),this.table.element.appendChild(this.loaderElement)},Ajax.prototype.hideLoader=function(){this.loaderElement.parentNode&&this.loaderElement.parentNode.removeChild(this.loaderElement)},Ajax.prototype.defaultConfig={method:"GET"},Ajax.prototype.defaultURLGenerator=function(url,config,params){return url&&params&&Object.keys(params).length&&(config.method&&"get"!=config.method.toLowerCase()||(config.method="get",url+="?"+this.serializeParams(params))),url},Ajax.prototype.defaultLoaderPromise=function(url,config,params){var contentType,self=this;return new Promise(function(resolve,reject){if(url=self.urlGenerator(url,config,params),"GET"!=config.method.toUpperCase())if(contentType="object"===_typeof(self.table.options.ajaxContentType)?self.table.options.ajaxContentType:self.contentTypeFormatters[self.table.options.ajaxContentType]){for(var key in contentType.headers)config.headers||(config.headers={}),void 0===config.headers[key]&&(config.headers[key]=contentType.headers[key]);config.body=contentType.body.call(self,url,config,params)}else console.warn("Ajax Error - Invalid ajaxContentType value:",self.table.options.ajaxContentType);url?(void 0===config.headers&&(config.headers={}),void 0===config.headers.Accept&&(config.headers.Accept="application/json"),void 0===config.headers["X-Requested-With"]&&(config.headers["X-Requested-With"]="XMLHttpRequest"),void 0===config.mode&&(config.mode="cors"),"cors"==config.mode?(void 0===config.headers["Access-Control-Allow-Origin"]&&(config.headers["Access-Control-Allow-Origin"]=window.location.origin),void 0===config.credentials&&(config.credentials="same-origin")):void 0===config.credentials&&(config.credentials="include"),fetch(url,config).then(function(response){response.ok?response.json().then(function(data){resolve(data)}).catch(function(error){reject(error),console.warn("Ajax Load Error - Invalid JSON returned",error)}):(console.error("Ajax Load Error - Connection Error: "+response.status,response.statusText),reject(response))}).catch(function(error){console.error("Ajax Load Error - Connection Error: ",error),reject(error)})):(console.warn("Ajax Load Error - No URL Set"),resolve([]))})},Ajax.prototype.contentTypeFormatters={json:{headers:{"Content-Type":"application/json"},body:function(url,config,params){return JSON.stringify(params)}},form:{headers:{},body:function(url,config,params){var output=this.generateParamsList(params),form=new FormData;return output.forEach(function(item){form.append(item.key,item.value)}),form}}},Tabulator.prototype.registerModule("ajax",Ajax);var ColumnCalcs=function(table){this.table=table,this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.initialize()};ColumnCalcs.prototype.createElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-calcs-holder"),el},ColumnCalcs.prototype.initialize=function(){this.genColumn=new Column({field:"value"},this)},ColumnCalcs.prototype.registerColumnField=function(){},ColumnCalcs.prototype.initializeColumn=function(column){var def=column.definition,config={topCalcParams:def.topCalcParams||{},botCalcParams:def.bottomCalcParams||{}};if(def.topCalc){switch(_typeof(def.topCalc)){case"string":this.calculations[def.topCalc]?config.topCalc=this.calculations[def.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",def.topCalc);break;case"function":config.topCalc=def.topCalc}config.topCalc&&(column.modules.columnCalcs=config,this.topCalcs.push(column),"group"!=this.table.options.columnCalcs&&this.initializeTopRow())}if(def.bottomCalc){switch(_typeof(def.bottomCalc)){case"string":this.calculations[def.bottomCalc]?config.botCalc=this.calculations[def.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",def.bottomCalc);break;case"function":config.botCalc=def.bottomCalc}config.botCalc&&(column.modules.columnCalcs=config,this.botCalcs.push(column),"group"!=this.table.options.columnCalcs&&this.initializeBottomRow())}},ColumnCalcs.prototype.removeCalcs=function(){var changed=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),changed=!0),this.botInitialized&&(this.botInitialized=!1,this.table.footerManager.remove(this.botElement),changed=!0),changed&&this.table.rowManager.adjustTableSize()},ColumnCalcs.prototype.initializeTopRow=function(){this.topInitialized||(this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)},ColumnCalcs.prototype.initializeBottomRow=function(){this.botInitialized||(this.table.footerManager.prepend(this.botElement),this.botInitialized=!0)},ColumnCalcs.prototype.scrollHorizontal=function(left){this.table.columnManager.getElement().scrollWidth,this.table.element.clientWidth;this.botInitialized&&(this.botRow.getElement().style.marginLeft=-left+"px")},ColumnCalcs.prototype.recalc=function(rows){var row;if(this.topInitialized||this.botInitialized){if(this.rowsToData(rows),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),row=this.generateRow("top",this.rowsToData(rows)),this.topRow=row;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(row.getElement()),row.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),row=this.generateRow("bottom",this.rowsToData(rows)),this.botRow=row;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(row.getElement()),row.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}},ColumnCalcs.prototype.recalcRowGroup=function(row){this.recalcGroup(this.table.modules.groupRows.getRowGroup(row))},ColumnCalcs.prototype.recalcGroup=function(group){var data,rowData;group&&group.calcs&&(group.calcs.bottom&&(data=this.rowsToData(group.rows),rowData=this.generateRowData("bottom",data),group.calcs.bottom.updateData(rowData),group.calcs.bottom.reinitialize()),group.calcs.top&&(data=this.rowsToData(group.rows),rowData=this.generateRowData("top",data),group.calcs.top.updateData(rowData),group.calcs.top.reinitialize()))},ColumnCalcs.prototype.generateTopRow=function(rows){return this.generateRow("top",this.rowsToData(rows))},ColumnCalcs.prototype.generateBottomRow=function(rows){return this.generateRow("bottom",this.rowsToData(rows))},ColumnCalcs.prototype.rowsToData=function(rows){var data=[];return rows.forEach(function(row){data.push(row.getData())}),data},ColumnCalcs.prototype.generateRow=function(pos,data){var row,self=this,rowData=this.generateRowData(pos,data);return self.table.modExists("mutator")&&self.table.modules.mutator.disable(),row=new Row(rowData,this),self.table.modExists("mutator")&&self.table.modules.mutator.enable(),row.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+pos),row.type="calc",row.generateCells=function(){var cells=[];self.table.columnManager.columnsByIndex.forEach(function(column){self.genColumn.setField(column.getField()),self.genColumn.hozAlign=column.hozAlign,column.definition[pos+"CalcFormatter"]&&self.table.modExists("format")?self.genColumn.modules.format={formatter:self.table.modules.format.getFormatter(column.definition[pos+"CalcFormatter"]),params:column.definition[pos+"CalcFormatterParams"]}:self.genColumn.modules.format={formatter:self.table.modules.format.getFormatter("plaintext"),params:{}},self.genColumn.definition.cssClass=column.definition.cssClass;var cell=new Cell(self.genColumn,row);cell.column=column,cell.setWidth(),column.cells.push(cell),cells.push(cell),column.visible||cell.hide()}),this.cells=cells},row},ColumnCalcs.prototype.generateRowData=function(pos,data){var params,paramKey,rowData={},calcs="top"==pos?this.topCalcs:this.botCalcs,type="top"==pos?"topCalc":"botCalc";return calcs.forEach(function(column){var values=[];column.modules.columnCalcs&&column.modules.columnCalcs[type]&&(data.forEach(function(item){values.push(column.getFieldValue(item))}),paramKey=type+"Params",params="function"==typeof column.modules.columnCalcs[paramKey]?column.modules.columnCalcs[paramKey](values,data):column.modules.columnCalcs[paramKey],column.setFieldValue(rowData,column.modules.columnCalcs[type](values,data,params)))}),rowData},ColumnCalcs.prototype.hasTopCalcs=function(){return!!this.topCalcs.length},ColumnCalcs.prototype.hasBottomCalcs=function(){return!!this.botCalcs.length},ColumnCalcs.prototype.redraw=function(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)},ColumnCalcs.prototype.getResults=function(){var self=this,results={};return this.table.options.groupBy&&this.table.modExists("groupRows")?this.table.modules.groupRows.getGroups(!0).forEach(function(group){results[group.getKey()]=self.getGroupResults(group)}):results={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},results},ColumnCalcs.prototype.getGroupResults=function(group){var self=this,groupObj=group._getSelf(),subGroups=group.getSubGroups(),subGroupResults={};return subGroups.forEach(function(subgroup){subGroupResults[subgroup.getKey()]=self.getGroupResults(subgroup)}),{top:groupObj.calcs.top?groupObj.calcs.top.getData():{},bottom:groupObj.calcs.bottom?groupObj.calcs.bottom.getData():{},groups:subGroupResults}},ColumnCalcs.prototype.calculations={avg:function(values,data,calcParams){var output=0,precision=void 0!==calcParams.precision?calcParams.precision:2;return values.length&&(output=values.reduce(function(sum,value){return sum+(value=Number(value))}),output/=values.length,output=!1!==precision?output.toFixed(precision):output),parseFloat(output).toString()},max:function(values,data,calcParams){var output=null,precision=void 0!==calcParams.precision&&calcParams.precision;return values.forEach(function(value){value=Number(value),(output<value||null===output)&&(output=value)}),null!==output?!1!==precision?output.toFixed(precision):output:""},min:function(values,data,calcParams){var output=null,precision=void 0!==calcParams.precision&&calcParams.precision;return values.forEach(function(value){((value=Number(value))<output||null===output)&&(output=value)}),null!==output?!1!==precision?output.toFixed(precision):output:""},sum:function(values,data,calcParams){var output=0,precision=void 0!==calcParams.precision&&calcParams.precision;return values.length&&values.forEach(function(value){value=Number(value),output+=isNaN(value)?0:Number(value)}),!1!==precision?output.toFixed(precision):output},concat:function(values,data,calcParams){var output=0;return values.length&&(output=values.reduce(function(sum,value){return String(sum)+String(value)})),output},count:function(values,data,calcParams){var output=0;return values.length&&values.forEach(function(value){value&&output++}),output}},Tabulator.prototype.registerModule("columnCalcs",ColumnCalcs);var Clipboard=function(table){this.table=table,this.mode=!0,this.copySelector=!1,this.copySelectorParams={},this.copyFormatter=!1,this.copyFormatterParams={},this.pasteParser=function(){},this.pasteAction=function(){},this.htmlElement=!1,this.config={},this.blocked=!0};Clipboard.prototype.initialize=function(){var self=this;this.mode=this.table.options.clipboard,!0!==this.mode&&"copy"!==this.mode||this.table.element.addEventListener("copy",function(e){var data;self.processConfig(),self.blocked||(e.preventDefault(),data=self.generateContent(),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",data):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",data),self.htmlElement&&e.clipboardData.setData("text/html",self.htmlElement.outerHTML)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",data),self.htmlElement&&e.originalEvent.clipboardData.setData("text/html",self.htmlElement.outerHTML)),self.table.options.clipboardCopied.call(this.table,data),self.reset())}),!0!==this.mode&&"paste"!==this.mode||this.table.element.addEventListener("paste",function(e){self.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction)},Clipboard.prototype.processConfig=function(){var config={columnHeaders:"groups",rowGroups:!0,columnCalcs:!0};if(void 0!==this.table.options.clipboardCopyHeader&&(config.columnHeaders=this.table.options.clipboardCopyHeader,console.warn("DEPRECATION WARNING - clipboardCopyHeader option has been deprecated, please use the columnHeaders property on the clipboardCopyConfig option")),this.table.options.clipboardCopyConfig)for(var key in this.table.options.clipboardCopyConfig)config[key]=this.table.options.clipboardCopyConfig[key];config.rowGroups&&this.table.options.groupBy&&this.table.modExists("groupRows")&&(this.config.rowGroups=!0),config.columnHeaders?"groups"!==config.columnHeaders&&!0!==config||this.table.columnManager.columns.length==this.table.columnManager.columnsByIndex.length?this.config.columnHeaders="columns":this.config.columnHeaders="groups":this.config.columnHeaders=!1,config.columnCalcs&&this.table.modExists("columnCalcs")&&(this.config.columnCalcs=!0)},Clipboard.prototype.reset=function(){this.blocked=!1,this.originalSelectionText=""},Clipboard.prototype.setPasteAction=function(action){switch(void 0===action?"undefined":_typeof(action)){case"string":this.pasteAction=this.pasteActions[action],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",action);break;case"function":this.pasteAction=action}},Clipboard.prototype.setPasteParser=function(parser){switch(void 0===parser?"undefined":_typeof(parser)){case"string":this.pasteParser=this.pasteParsers[parser],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",parser);break;case"function":this.pasteParser=parser}},Clipboard.prototype.paste=function(e){var data,rowData,rows;this.checkPaseOrigin(e)&&(data=this.getPasteData(e),(rowData=this.pasteParser.call(this,data))?(e.preventDefault(),this.table.modExists("mutator")&&(rowData=this.mutateData(rowData)),rows=this.pasteAction.call(this,rowData),this.table.options.clipboardPasted.call(this.table,data,rowData,rows)):this.table.options.clipboardPasteError.call(this.table,data))},Clipboard.prototype.mutateData=function(data){var self=this,output=[];return Array.isArray(data)?data.forEach(function(row){output.push(self.table.modules.mutator.transformRow(row,"clipboard"))}):output=data,output},Clipboard.prototype.checkPaseOrigin=function(e){var valid=!0;return"DIV"==e.target.tagName&&!this.table.modules.edit.currentCell||(valid=!1),valid},Clipboard.prototype.getPasteData=function(e){var data;return window.clipboardData&&window.clipboardData.getData?data=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?data=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(data=e.originalEvent.clipboardData.getData("text/plain")),data},Clipboard.prototype.copy=function(selector,selectorParams,formatter,formatterParams,internal){var range,sel,textRange;!(this.blocked=!1)!==this.mode&&"copy"!==this.mode||(void 0!==window.getSelection&&void 0!==document.createRange?((range=document.createRange()).selectNodeContents(this.table.element),(sel=window.getSelection()).toString()&&internal&&(selector="userSelection",formatter="raw",selectorParams=sel.toString()),sel.removeAllRanges(),sel.addRange(range)):void 0!==document.selection&&void 0!==document.body.createTextRange&&((textRange=document.body.createTextRange()).moveToElementText(this.table.element),textRange.select()),this.setSelector(selector),this.copySelectorParams=void 0!==selectorParams&&null!=selectorParams?selectorParams:this.config.columnHeaders,this.setFormatter(formatter),this.copyFormatterParams=void 0!==formatterParams&&null!=formatterParams?formatterParams:{},document.execCommand("copy"),sel&&sel.removeAllRanges())},Clipboard.prototype.setSelector=function(selector){switch(void 0===(selector=selector||this.table.options.clipboardCopySelector)?"undefined":_typeof(selector)){case"string":this.copySelectors[selector]?this.copySelector=this.copySelectors[selector]:console.warn("Clipboard Error - No such selector found:",selector);break;case"function":this.copySelector=selector}},Clipboard.prototype.setFormatter=function(formatter){switch(void 0===(formatter=formatter||this.table.options.clipboardCopyFormatter)?"undefined":_typeof(formatter)){case"string":this.copyFormatters[formatter]?this.copyFormatter=this.copyFormatters[formatter]:console.warn("Clipboard Error - No such formatter found:",formatter);break;case"function":this.copyFormatter=formatter}},Clipboard.prototype.generateContent=function(){var data;return this.htmlElement=!1,data=this.copySelector.call(this,this.config,this.copySelectorParams),this.copyFormatter.call(this,data,this.config,this.copyFormatterParams)},Clipboard.prototype.generateSimpleHeaders=function(columns){var headers=[];return columns.forEach(function(column){headers.push(column.definition.title)}),headers},Clipboard.prototype.generateColumnGroupHeaders=function(columns){var _this22=this,output=[];return this.table.columnManager.columns.forEach(function(column){var colData=_this22.processColumnGroup(column);colData&&output.push(colData)}),output},Clipboard.prototype.processColumnGroup=function(column){var _this23=this,subGroups=column.columns,groupData={type:"group",title:column.definition.title,column:column};if(subGroups.length){if(groupData.subGroups=[],groupData.width=0,subGroups.forEach(function(subGroup){var subGroupData=_this23.processColumnGroup(subGroup);subGroupData&&(groupData.width+=subGroupData.width,groupData.subGroups.push(subGroupData))}),!groupData.width)return!1}else{if(!column.field||!(column.definition.clipboard||column.visible&&!1!==column.definition.clipboard))return!1;groupData.width=1}return groupData},Clipboard.prototype.groupHeadersToRows=function(columns){var headers=[];function parseColumnGroup(column,level){void 0===headers[level]&&(headers[level]=[]),headers[level].push(column.title),column.subGroups?column.subGroups.forEach(function(subGroup){parseColumnGroup(subGroup,level+1)}):function(){var max=0;headers.forEach(function(title){var len=title.length;max<len&&(max=len)}),headers.forEach(function(title){var len=title.length;if(len<max)for(var i=len;i<max;i++)title.push("")})}()}return columns.forEach(function(column){parseColumnGroup(column,0)}),headers},Clipboard.prototype.rowsToData=function(rows,columns,config,params){var data=[];return rows.forEach(function(row){var rowArray=[],rowData=row instanceof RowComponent?row.getData("clipboard"):row;columns.forEach(function(column){var value=column.getFieldValue(rowData);switch(void 0===value?"undefined":_typeof(value)){case"object":value=JSON.stringify(value);break;case"undefined":case"null":value="";break;default:value=value}rowArray.push(value)}),data.push(rowArray)}),data},Clipboard.prototype.buildComplexRows=function(config){var _this24=this,output=[];return this.table.modules.groupRows.getGroups().forEach(function(group){output.push(_this24.processGroupData(group))}),output},Clipboard.prototype.processGroupData=function(group){var _this25=this,subGroups=group.getSubGroups(),groupData={type:"group",key:group.key};return subGroups.length?(groupData.subGroups=[],subGroups.forEach(function(subGroup){groupData.subGroups.push(_this25.processGroupData(subGroup))})):groupData.rows=group.getRows(!0),groupData},Clipboard.prototype.getCalcRow=function(calcs,columns,selector,pos){var calcData=calcs[selector];return calcData&&(pos&&(calcData=calcData[pos]),Object.keys(calcData).length)?this.rowsToData([calcData],columns):[]},Clipboard.prototype.buildOutput=function(rows,config,params){var calcs,_this26=this,output=[],columns=[];return config.columnHeaders&&("groups"==config.columnHeaders?(columns=this.generateColumnGroupHeaders(this.table.columnManager.columns),output=output.concat(this.groupHeadersToRows(columns))):(this.table.columnManager.columnsByIndex.forEach(function(column){(column.definition.clipboard||column.visible&&!1!==column.definition.clipboard)&&columns.push(column)}),output.push(this.generateSimpleHeaders(columns)))),this.config.columnCalcs&&(calcs=this.table.getCalcResults()),this.table.options.clipboardCopyStyled&&this.generateHTML(rows,columns,calcs,config,params),config.rowGroups?rows.forEach(function(row){output=output.concat(_this26.parseRowGroupData(row,columns,config,params,calcs||{}))}):(config.columnCalcs&&(output=output.concat(this.getCalcRow(calcs,columns,"top"))),output=output.concat(this.rowsToData(rows,columns,config,params)),config.columnCalcs&&(output=output.concat(this.getCalcRow(calcs,columns,"bottom")))),output},Clipboard.prototype.parseRowGroupData=function(group,columns,config,params,calcObj){var _this27=this,groupData=[];return groupData.push([group.key]),group.subGroups?group.subGroups.forEach(function(subGroup){groupData=groupData.concat(_this27.parseRowGroupData(subGroup,config,params,calcObj[group.key]&&calcObj[group.key].groups||{}))}):(config.columnCalcs&&(groupData=groupData.concat(this.getCalcRow(calcObj,columns,group.key,"top"))),groupData=groupData.concat(this.rowsToData(group.rows,columns,config,params)),config.columnCalcs&&(groupData=groupData.concat(this.getCalcRow(calcObj,columns,group.key,"bottom")))),groupData},Clipboard.prototype.generateHTML=function(rows,columns,calcs,config,params){var body,oddRow,evenRow,calcRow,firstRow,firstCell,firstGroup,styleCells,headerEl,self=this,headers=[];function addCalcRow(calcs,selector,pos){var calcData=calcs[selector];calcData&&(pos&&(calcData=calcData[pos]),Object.keys(calcData).length&&processRows([calcData]))}function processRows(rowArray){rowArray.forEach(function(row,i){var rowData,rowEl=document.createElement("tr"),styleRow=firstRow,isCalc=!1;row instanceof RowComponent?rowData=row.getData("clipboard"):(rowData=row,isCalc=!0),columns.forEach(function(column,j){var cellEl=document.createElement("td"),value=column.getFieldValue(rowData);switch(void 0===value?"undefined":_typeof(value)){case"object":value=JSON.stringify(value);break;case"undefined":case"null":value="";break;default:value=value}cellEl.innerHTML=value,column.definition.align&&(cellEl.style.textAlign=column.definition.align),columns.length,firstCell&&self.mapElementStyles(firstCell,cellEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size"]),rowEl.appendChild(cellEl)}),isCalc?styleRow=calcRow:(i%2||!oddRow||(styleRow=oddRow),i%2&&evenRow&&(styleRow=evenRow)),styleRow&&self.mapElementStyles(styleRow,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),body.appendChild(rowEl)})}this.htmlElement=document.createElement("table"),self.mapElementStyles(this.table.element,this.htmlElement,["border-top","border-left","border-right","border-bottom"]),config.columnHeaders&&("groups"==config.columnHeaders?(columns.forEach(function(column){!function parseColumnGroup(column,level){void 0===headers[level]&&(headers[level]=[]),headers[level].push({title:column.title,width:column.width,height:1,children:!!column.subGroups,element:column.column.getElement()}),column.subGroups&&column.subGroups.forEach(function(subGroup){parseColumnGroup(subGroup,level+1)})}(column,0)}),headers.forEach(function(row,index){row.forEach(function(header){header.children||(header.height=headers.length-index)})}),function(headers){var headerHolderEl=document.createElement("thead");headers.forEach(function(columns){var headerEl=document.createElement("tr");columns.forEach(function(column){var columnEl=document.createElement("th");1<column.width&&(columnEl.colSpan=column.width),1<column.height&&(columnEl.rowSpan=column.height),columnEl.innerHTML=column.title,self.mapElementStyles(column.element,columnEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),headerEl.appendChild(columnEl)}),self.mapElementStyles(self.table.columnManager.getHeadersElement(),headerEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),headerHolderEl.appendChild(headerEl)}),self.htmlElement.appendChild(headerHolderEl)}(headers)):(headerEl=document.createElement("tr"),columns.forEach(function(column){var columnEl=document.createElement("th");columnEl.innerHTML=column.definition.title,self.mapElementStyles(column.getElement(),columnEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),headerEl.appendChild(columnEl)}),self.mapElementStyles(self.table.columnManager.getHeadersElement(),headerEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),self.htmlElement.appendChild(document.createElement("thead").appendChild(headerEl)))),body=document.createElement("tbody"),window.getComputedStyle&&(oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],firstRow&&(styleCells=firstRow.getElementsByClassName("tabulator-cell"),firstCell=styleCells[0],styleCells[styleCells.length-1])),config.rowGroups?rows.forEach(function(group){!function processGroup(group,calcObj){var groupEl=document.createElement("tr"),groupCellEl=document.createElement("td");groupCellEl.colSpan=columns.length,groupCellEl.innerHTML=group.key,groupEl.appendChild(groupCellEl),body.appendChild(groupEl),self.mapElementStyles(firstGroup,groupEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),group.subGroups?group.subGroups.forEach(function(subGroup){processGroup(subGroup,calcObj[group.key]&&calcObj[group.key].groups||{})}):(config.columnCalcs&&addCalcRow(calcObj,group.key,"top"),processRows(group.rows),config.columnCalcs&&addCalcRow(calcObj,group.key,"bottom"))}(group,calcs||{})}):(config.columnCalcs&&addCalcRow(calcs,"top"),processRows(rows),config.columnCalcs&&addCalcRow(calcs,"bottom")),this.htmlElement.appendChild(body)},Clipboard.prototype.mapElementStyles=function(from,to,props){var lookup={"background-color":"backgroundColor",color:"fontColor","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom"};if(window.getComputedStyle){var fromStyle=window.getComputedStyle(from);props.forEach(function(prop){to.style[lookup[prop]]=fromStyle.getPropertyValue(prop)})}},Clipboard.prototype.copySelectors={userSelection:function(config,params){return params},selected:function(config,params){var rows=[];return this.table.modExists("selectRow",!0)&&(rows=this.table.modules.selectRow.getSelectedRows()),config.rowGroups&&console.warn("Clipboard Warning - select coptSelector does not support row groups"),this.buildOutput(rows,config,params)},table:function(config,params){return config.rowGroups&&console.warn("Clipboard Warning - table coptSelector does not support row groups"),this.buildOutput(this.table.rowManager.getComponents(),config,params)},active:function(config,params){var rows;return rows=config.rowGroups?this.buildComplexRows(config):this.table.rowManager.getComponents(!0),this.buildOutput(rows,config,params)}},Clipboard.prototype.copyFormatters={raw:function(data,params){return data},table:function(data,params){var output=[];return data.forEach(function(row){row.forEach(function(value){void 0===value&&(value=""),(value=null==value?"":value.toString()).match(/\r|\n/)&&(value='"'+(value=value.split('"').join('""'))+'"')}),output.push(row.join("\t"))}),output.join("\n")}},Clipboard.prototype.pasteParsers={table:function(clipboard){var data=[],headerFindSuccess=!0,columns=this.table.columnManager.columns,columnMap=[],rows=[];return(clipboard=clipboard.split("\n")).forEach(function(row){data.push(row.split("\t"))}),!(!data.length||1===data.length&&data[0].length<2)&&(!0,data[0].forEach(function(value){var column=columns.find(function(column){return value&&column.definition.title&&value.trim()&&column.definition.title.trim()===value.trim()});column?columnMap.push(column):headerFindSuccess=!1}),headerFindSuccess||(headerFindSuccess=!0,columnMap=[],data[0].forEach(function(value){var column=columns.find(function(column){return value&&column.field&&value.trim()&&column.field.trim()===value.trim()});column?columnMap.push(column):headerFindSuccess=!1}),headerFindSuccess||(columnMap=this.table.columnManager.columnsByIndex)),headerFindSuccess&&data.shift(),data.forEach(function(item){var row={};item.forEach(function(value,i){columnMap[i]&&(row[columnMap[i].field]=value)}),rows.push(row)}),rows)}},Clipboard.prototype.pasteActions={replace:function(rows){return this.table.setData(rows)},update:function(rows){return this.table.updateOrAddData(rows)},insert:function(rows){return this.table.addData(rows)}},Tabulator.prototype.registerModule("clipboard",Clipboard);var DataTree=function(table){this.table=table,this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.displayIndex=0};DataTree.prototype.initialize=function(){var dummyEl=null,firstCol=this.table.columnManager.getFirstVisibileColumn(),options=this.table.options;switch(this.field=options.dataTreeChildField,this.indent=options.dataTreeChildIndent,this.elementField=options.dataTreeElementColumn||!!firstCol&&firstCol.field,options.dataTreeBranchElement&&(!0===options.dataTreeBranchElement?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):"string"==typeof options.dataTreeBranchElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeBranchElement,this.branchEl=dummyEl.firstChild):this.branchEl=options.dataTreeBranchElement),options.dataTreeCollapseElement?"string"==typeof options.dataTreeCollapseElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeCollapseElement,this.collapseEl=dummyEl.firstChild):this.collapseEl=options.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),options.dataTreeExpandElement?"string"==typeof options.dataTreeExpandElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeExpandElement,this.expandEl=dummyEl.firstChild):this.expandEl=options.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),_typeof(options.dataTreeStartExpanded)){case"boolean":this.startOpen=function(row,index){return options.dataTreeStartExpanded};break;case"function":this.startOpen=options.dataTreeStartExpanded;break;default:this.startOpen=function(row,index){return options.dataTreeStartExpanded[index]}}},DataTree.prototype.initializeRow=function(row){var childArray=row.getData()[this.field],isArray=Array.isArray(childArray),children=isArray||!isArray&&"object"===(void 0===childArray?"undefined":_typeof(childArray))&&null!==childArray;row.modules.dataTree={index:0,open:!!children&&this.startOpen(row.getComponent(),0),controlEl:!1,branchEl:!1,parent:!1,children:children}},DataTree.prototype.layoutRow=function(row){var el=(this.elementField?row.getCell(this.elementField):row.getCells()[0]).getElement(),config=row.modules.dataTree;config.branchEl&&config.branchEl.parentNode.removeChild(config.branchEl),this.generateControlElement(row,el),config.index&&(this.branchEl?(config.branchEl=this.branchEl.cloneNode(!0),el.insertBefore(config.branchEl,el.firstChild),config.branchEl.style.marginLeft=(config.branchEl.offsetWidth+config.branchEl.style.marginRight)*(config.index-1)+config.index*this.indent+"px"):el.style.paddingLeft=parseInt(window.getComputedStyle(el,null).getPropertyValue("padding-left"))+config.index*this.indent+"px")},DataTree.prototype.generateControlElement=function(row,el){var _this28=this,config=row.modules.dataTree,oldControl=(el=el||row.getCells()[0].getElement(),config.controlEl);!1!==config.children&&(config.open?(config.controlEl=this.collapseEl.cloneNode(!0),config.controlEl.addEventListener("click",function(e){e.stopPropagation(),_this28.collapseRow(row)})):(config.controlEl=this.expandEl.cloneNode(!0),config.controlEl.addEventListener("click",function(e){e.stopPropagation(),_this28.expandRow(row)})),config.controlEl.addEventListener("mousedown",function(e){e.stopPropagation()}),oldControl&&oldControl.parentNode===el?oldControl.parentNode.replaceChild(config.controlEl,oldControl):el.insertBefore(config.controlEl,el.firstChild))},DataTree.prototype.setDisplayIndex=function(index){this.displayIndex=index},DataTree.prototype.getDisplayIndex=function(){return this.displayIndex},DataTree.prototype.getRows=function(rows){var _this29=this,output=[];return rows.forEach(function(row,i){var config;output.push(row),row instanceof Row&&((config=row.modules.dataTree.children).index||!1===config.children||_this29.getChildren(row).forEach(function(child){output.push(child)}))}),output},DataTree.prototype.getChildren=function(row){var _this30=this,config=row.modules.dataTree,children=[],output=[];return!1!==config.children&&config.open&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),children=this.table.modExists("filter")?this.table.modules.filter.filter(config.children):config.children,this.table.modExists("sort")&&this.table.modules.sort.sort(children),children.forEach(function(child){output.push(child),_this30.getChildren(child).forEach(function(sub){output.push(sub)})})),output},DataTree.prototype.generateChildren=function(row){var _this31=this,children=[],childArray=row.getData()[this.field];return Array.isArray(childArray)||(childArray=[childArray]),childArray.forEach(function(childData){var childRow=new Row(childData||{},_this31.table.rowManager);childRow.modules.dataTree.index=row.modules.dataTree.index+1,childRow.modules.dataTree.parent=row,childRow.modules.dataTree.children&&(childRow.modules.dataTree.open=_this31.startOpen(childRow.getComponent(),childRow.modules.dataTree.index)),children.push(childRow)}),children},DataTree.prototype.expandRow=function(row,silent){var config=row.modules.dataTree;!1!==config.children&&(config.open=!0,row.reinitialize(),this.table.rowManager.refreshActiveData("tree",!1,!0),this.table.options.dataTreeRowExpanded(row.getComponent(),row.modules.dataTree.index))},DataTree.prototype.collapseRow=function(row){var config=row.modules.dataTree;!1!==config.children&&(config.open=!1,row.reinitialize(),this.table.rowManager.refreshActiveData("tree",!1,!0),this.table.options.dataTreeRowCollapsed(row.getComponent(),row.modules.dataTree.index))},DataTree.prototype.toggleRow=function(row){var config=row.modules.dataTree;!1!==config.children&&(config.open?this.collapseRow(row):this.expandRow(row))},DataTree.prototype.getTreeParent=function(row){return!!row.modules.dataTree.parent&&row.modules.dataTree.parent.getComponent()},DataTree.prototype.getTreeChildren=function(row){var config=row.modules.dataTree,output=[];return config.children&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),config.children.forEach(function(childRow){childRow instanceof Row&&output.push(childRow.getComponent())})),output},DataTree.prototype.checkForRestyle=function(cell){cell.row.cells.indexOf(cell)||!1!==cell.row.modules.dataTree.children&&cell.row.reinitialize()},DataTree.prototype.getChildField=function(){return this.field},Tabulator.prototype.registerModule("dataTree",DataTree);var Download=function(table){this.table=table,this.fields={},this.columnsByIndex=[],this.columnsByField={},this.config={}};Download.prototype.download=function(type,filename,options,interceptCallback){var self=this,downloadFunc=!1;this.processConfig(),"function"==typeof type?downloadFunc=type:self.downloaders[type]?downloadFunc=self.downloaders[type]:console.warn("Download Error - No such download type found: ",type),this.processColumns(),downloadFunc&&downloadFunc.call(this,self.processDefinitions(),self.processData(),options||{},function(data,mime){interceptCallback?!0===interceptCallback?self.triggerDownload(data,mime,type,filename,!0):interceptCallback(data):self.triggerDownload(data,mime,type,filename)},this.config)},Download.prototype.processConfig=function(){var config={columnGroups:!0,rowGroups:!0,columnCalcs:!0};if(this.table.options.downloadConfig)for(var key in this.table.options.downloadConfig)config[key]=this.table.options.downloadConfig[key];config.rowGroups&&this.table.options.groupBy&&this.table.modExists("groupRows")&&(this.config.rowGroups=!0),config.columnGroups&&this.table.columnManager.columns.length!=this.table.columnManager.columnsByIndex.length&&(this.config.columnGroups=!0),config.columnCalcs&&this.table.modExists("columnCalcs")&&(this.config.columnCalcs=!0)},Download.prototype.processColumns=function(){var self=this;self.columnsByIndex=[],self.columnsByField={},self.table.columnManager.columnsByIndex.forEach(function(column){column.field&&!1!==column.definition.download&&(column.visible||!column.visible&&column.definition.download)&&(self.columnsByIndex.push(column),self.columnsByField[column.field]=column)})},Download.prototype.processDefinitions=function(){var self=this,processedDefinitions=[];return this.config.columnGroups?self.table.columnManager.columns.forEach(function(column){var colData=self.processColumnGroup(column);colData&&processedDefinitions.push(colData)}):self.columnsByIndex.forEach(function(column){!1!==column.download&&processedDefinitions.push(self.processDefinition(column))}),processedDefinitions},Download.prototype.processColumnGroup=function(column){var _this32=this,subGroups=column.columns,maxDepth=0,processedColumn=this.processDefinition(column),groupData={type:"group",title:processedColumn.title,depth:1};if(subGroups.length){if(groupData.subGroups=[],groupData.width=0,subGroups.forEach(function(subGroup){var subGroupData=_this32.processColumnGroup(subGroup);subGroupData.depth>maxDepth&&(maxDepth=subGroupData.depth),subGroupData&&(groupData.width+=subGroupData.width,groupData.subGroups.push(subGroupData))}),groupData.depth+=maxDepth,!groupData.width)return!1}else{if(!column.field||!1===column.definition.download||!(column.visible||!column.visible&&column.definition.download))return!1;groupData.width=1,groupData.definition=processedColumn}return groupData},Download.prototype.processDefinition=function(column){var def={};for(var key in column.definition)def[key]=column.definition[key];return void 0!==column.definition.downloadTitle&&(def.title=column.definition.downloadTitle),def},Download.prototype.processData=function(){var _this33=this,data=[],calcs={};return this.config.rowGroups?this.table.modules.groupRows.getGroups().forEach(function(group){data.push(_this33.processGroupData(group))}):data=this.table.rowManager.getData(!0,"download"),this.config.columnCalcs&&(calcs=this.table.getCalcResults(),data={calcs:calcs,data:data}),"function"==typeof this.table.options.downloadDataFormatter&&(data=this.table.options.downloadDataFormatter(data)),data},Download.prototype.processGroupData=function(group){var _this34=this,subGroups=group.getSubGroups(),groupData={type:"group",key:group.key};return subGroups.length?(groupData.subGroups=[],subGroups.forEach(function(subGroup){groupData.subGroups.push(_this34.processGroupData(subGroup))})):groupData.rows=group.getData(!0,"download"),groupData},Download.prototype.triggerDownload=function(data,mime,type,filename,newTab){var element=document.createElement("a"),blob=new Blob([data],{type:mime});filename=filename||"Tabulator."+("function"==typeof type?"txt":type);(blob=this.table.options.downloadReady.call(this.table,data,blob))&&(newTab?window.open(window.URL.createObjectURL(blob)):navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(blob,filename):(element.setAttribute("href",window.URL.createObjectURL(blob)),element.setAttribute("download",filename),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)),this.table.options.downloadComplete&&this.table.options.downloadComplete())},Download.prototype.getFieldValue=function(field,data){var column=this.columnsByField[field];return!!column&&column.getFieldValue(data)},Download.prototype.commsReceived=function(table,action,data){switch(action){case"intercept":this.download(data.type,"",data.options,data.intercept)}},Download.prototype.downloaders={csv:function(columns,data,options,setFileContents,config){var fileContents,output,self=this,titles=[],fields=[],delimiter=options&&options.delimiter?options.delimiter:",";function parseRows(data){data.forEach(function(row){var rowData=[];fields.forEach(function(field){var value=self.getFieldValue(field,row);switch(void 0===value?"undefined":_typeof(value)){case"object":value=JSON.stringify(value);break;case"undefined":case"null":value="";break;default:value=value}rowData.push('"'+String(value).split('"').join('""')+'"')}),fileContents.push(rowData.join(delimiter))})}config.columnGroups?(console.warn("Download Warning - CSV downloader cannot process column groups"),columns.forEach(function(column){!function parseColumnGroup(column,level){column.subGroups?column.subGroups.forEach(function(subGroup){parseColumnGroup(subGroup,level+1)}):(titles.push('"'+String(column.title).split('"').join('""')+'"'),fields.push(column.definition.field))}(column,0)})):columns.forEach(function(column){titles.push('"'+String(column.title).split('"').join('""')+'"'),fields.push(column.field)}),fileContents=[titles.join(delimiter)],config.columnCalcs&&(console.warn("Download Warning - CSV downloader cannot process column calculations"),data=data.data),config.rowGroups?(console.warn("Download Warning - CSV downloader cannot process row groups"),data.forEach(function(group){!function parseGroup(group){group.subGroups?group.subGroups.forEach(function(subGroup){parseGroup(subGroup)}):parseRows(group.rows)}(group)})):parseRows(data),output=fileContents.join("\n"),options.bom&&(output="\ufeff"+output),setFileContents(output,"text/csv")},json:function(columns,data,options,setFileContents,config){config.columnCalcs&&(console.warn("Download Warning - CSV downloader cannot process column calculations"),data=data.data),setFileContents(JSON.stringify(data,null,"\t"),"application/json")},pdf:function(columns,data,options,setFileContents,config){var self=this,fields=[],header=[],body=[],calcs={},headerDepth=1,autoTableParams={},rowGroupStyles=options.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},rowCalcStyles=options.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},jsPDFParams=options.jsPDF||{},title=options&&options.title?options.title:"";if(config.columnCalcs&&(calcs=data.calcs,data=data.data),jsPDFParams.orientation||(jsPDFParams.orientation=options.orientation||"landscape"),jsPDFParams.unit||(jsPDFParams.unit="pt"),config.columnGroups){columns.forEach(function(column){column.depth>headerDepth&&(headerDepth=column.depth)});for(var i=0;i<headerDepth;i++)header.push([]);columns.forEach(function(column){!function parseColumnGroup(column,level){var colSpan=column.width,rowSpan=1,col={content:column.title||""};if(rowSpan=column.subGroups?(column.subGroups.forEach(function(subGroup){parseColumnGroup(subGroup,level+1)}),1):(fields.push(column.definition.field),headerDepth-level),col.rowSpan=rowSpan,header[level].push(col),colSpan--,1<rowSpan)for(var i=level+1;i<headerDepth;i++)header[i].push("");for(i=0;i<colSpan;i++)header[level].push("")}(column,0)})}else columns.forEach(function(column){column.field&&(header.push(column.title||""),fields.push(column.field))}),header=[header];function parseValue(value){switch(void 0===value?"undefined":_typeof(value)){case"object":value=JSON.stringify(value);break;case"undefined":case"null":value="";break;default:value=value}return value}function parseRows(data){data.forEach(function(row){body.push(parseRow(row))})}function parseRow(row,styles){var rowData=[];return fields.forEach(function(field){var value=self.getFieldValue(field,row);value=parseValue(value),styles?rowData.push({content:value,styles:styles}):rowData.push(value)}),rowData}function addCalcRow(calcs,selector,pos){var calcData=calcs[selector];calcData&&(pos&&(calcData=calcData[pos]),Object.keys(calcData).length&&body.push(parseRow(calcData,rowCalcStyles)))}config.rowGroups?data.forEach(function(group){!function parseGroup(group,calcObj){var groupData=[];groupData.push({content:parseValue(group.key),colSpan:fields.length,styles:rowGroupStyles}),body.push(groupData),group.subGroups?group.subGroups.forEach(function(subGroup){parseGroup(subGroup,calcObj[group.key]&&calcObj[group.key].groups||{})}):(config.columnCalcs&&addCalcRow(calcObj,group.key,"top"),parseRows(group.rows),config.columnCalcs&&addCalcRow(calcObj,group.key,"bottom"))}(group,calcs)}):(config.columnCalcs&&addCalcRow(calcs,"top"),parseRows(data),config.columnCalcs&&addCalcRow(calcs,"bottom"));var doc=new jsPDF(jsPDFParams);options&&options.autoTable&&(autoTableParams="function"==typeof options.autoTable?options.autoTable(doc)||{}:options.autoTable),title&&(autoTableParams.addPageContent=function(data){doc.text(title,40,30)}),autoTableParams.head=header,autoTableParams.body=body,doc.autoTable(autoTableParams),options&&options.documentProcessing&&options.documentProcessing(doc),setFileContents(doc.output("arraybuffer"),"application/pdf")},xlsx:function(columns,data,options,setFileContents,config){var self=this,sheetName=options.sheetName||"Sheet1",workbook={SheetNames:[],Sheets:{}},calcs={},groupRowIndexs=[],groupColumnIndexs=[],calcRowIndexs=[];function generateSheet(){var titles=[],fields=[],rows=[];function parseColumnGroup(column,level){void 0===titles[level]&&(titles[level]=[]),void 0===groupColumnIndexs[level]&&(groupColumnIndexs[level]=[]),1<column.width&&groupColumnIndexs[level].push({type:"hoz",start:titles[level].length,end:titles[level].length+column.width-1}),titles[level].push(column.title),column.subGroups?column.subGroups.forEach(function(subGroup){parseColumnGroup(subGroup,level+1)}):(fields.push(column.definition.field),function(){var max=0;titles.forEach(function(title){var len=title.length;max<len&&(max=len)}),titles.forEach(function(title){var len=title.length;if(len<max)for(var i=len;i<max;i++)title.push("")})}(fields.length),groupColumnIndexs[level].push({type:"vert",start:fields.length-1}))}function parseRows(data){data.forEach(function(row){rows.push(parseRow(row))})}function parseRow(row){var rowData=[];return fields.forEach(function(field){var value=self.getFieldValue(field,row);rowData.push(value instanceof Date||"object"!==(void 0===value?"undefined":_typeof(value))?value:JSON.stringify(value))}),rowData}function addCalcRow(calcs,selector,pos){var calcData=calcs[selector];calcData&&(pos&&(calcData=calcData[pos]),Object.keys(calcData).length&&(calcRowIndexs.push(rows.length),rows.push(parseRow(calcData))))}return config.columnGroups?(columns.forEach(function(column){parseColumnGroup(column,0)}),titles.forEach(function(title){rows.push(title)})):(columns.forEach(function(column){titles.push(column.title),fields.push(column.field)}),rows.push(titles)),config.rowGroups?data.forEach(function(group){!function parseGroup(group,calcObj){var groupData=[];groupData.push(group.key),groupRowIndexs.push(rows.length),rows.push(groupData),group.subGroups?group.subGroups.forEach(function(subGroup){parseGroup(subGroup,calcObj[group.key]&&calcObj[group.key].groups||{})}):(config.columnCalcs&&addCalcRow(calcObj,group.key,"top"),parseRows(group.rows),config.columnCalcs&&addCalcRow(calcObj,group.key,"bottom"))}(group,calcs)}):(config.columnCalcs&&addCalcRow(calcs,"top"),parseRows(data),config.columnCalcs&&addCalcRow(calcs,"bottom")),function(){var sheet={},range={s:{c:0,r:0},e:{c:fields.length,r:rows.length}};XLSX.utils.sheet_add_aoa(sheet,rows),sheet["!ref"]=XLSX.utils.encode_range(range);var merges=function(){var output=[];return groupRowIndexs.forEach(function(index){output.push({s:{r:index,c:0},e:{r:index,c:fields.length-1}})}),groupColumnIndexs.forEach(function(merges,level){merges.forEach(function(merge){"hoz"===merge.type?output.push({s:{r:level,c:merge.start},e:{r:level,c:merge.end}}):level!=titles.length-1&&output.push({s:{r:level,c:merge.start},e:{r:titles.length-1,c:merge.start}})})}),output}();return merges.length&&(sheet["!merges"]=merges),sheet}()}if(config.columnCalcs&&(calcs=data.calcs,data=data.data),options.sheetOnly)setFileContents(generateSheet());else{if(options.sheets)for(var sheet in options.sheets)!0===options.sheets[sheet]?(workbook.SheetNames.push(sheet),workbook.Sheets[sheet]=generateSheet()):(workbook.SheetNames.push(sheet),this.table.modules.comms.send(options.sheets[sheet],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},intercept:function(data){workbook.Sheets[sheet]=data}}));else workbook.SheetNames.push(sheetName),workbook.Sheets[sheetName]=generateSheet();setFileContents(function(s){for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}(XLSX.write(workbook,{bookType:"xlsx",bookSST:!0,type:"binary"})),"application/octet-stream")}}},Tabulator.prototype.registerModule("download",Download);var Edit=function(table){this.table=table,this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1};Edit.prototype.initializeColumn=function(column){var config={editor:!1,blocked:!1,check:column.definition.editable,params:column.definition.editorParams||{}};switch(_typeof(column.definition.editor)){case"string":"tick"===column.definition.editor&&(column.definition.editor="tickCross",console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor")),this.editors[column.definition.editor]?config.editor=this.editors[column.definition.editor]:console.warn("Editor Error - No such editor found: ",column.definition.editor);break;case"function":config.editor=column.definition.editor;break;case"boolean":!0===column.definition.editor&&("function"!=typeof column.definition.formatter?("tick"===column.definition.formatter&&(column.definition.formatter="tickCross",console.warn("DEPRECATION WARNING - the tick editor has been deprecated, please use the tickCross editor")),this.editors[column.definition.formatter]?config.editor=this.editors[column.definition.formatter]:config.editor=this.editors.input):console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",column.definition.formatter))}config.editor&&(column.modules.edit=config)},Edit.prototype.getCurrentCell=function(){return!!this.currentCell&&this.currentCell.getComponent()},Edit.prototype.clearEditor=function(){var cellEl,cell=this.currentCell;if(this.invalidEdit=!1,cell){for(this.currentCell=!1,(cellEl=cell.getElement()).classList.remove("tabulator-validation-fail"),cellEl.classList.remove("tabulator-editing");cellEl.firstChild;)cellEl.removeChild(cellEl.firstChild);cell.row.getElement().classList.remove("tabulator-row-editing")}},Edit.prototype.cancelEdit=function(){if(this.currentCell){var cell=this.currentCell,component=this.currentCell.getComponent();this.clearEditor(),cell.setValueActual(cell.getValue()),cell.column.cellEvents.cellEditCancelled&&cell.column.cellEvents.cellEditCancelled.call(this.table,component),this.table.options.cellEditCancelled.call(this.table,component)}},Edit.prototype.bindEditor=function(cell){var self=this,element=cell.getElement();element.setAttribute("tabindex",0),element.addEventListener("click",function(e){element.classList.contains("tabulator-editing")||element.focus()}),element.addEventListener("mousedown",function(e){self.mouseClick=!0}),element.addEventListener("focus",function(e){self.recursionBlock||self.edit(cell,e,!1)})},Edit.prototype.focusCellNoEvent=function(cell){this.recursionBlock=!0,"ie"!==this.table.browser&&cell.getElement().focus(),this.recursionBlock=!1},Edit.prototype.editCell=function(cell,forceEdit){this.focusCellNoEvent(cell),this.edit(cell,!1,forceEdit)},Edit.prototype.edit=function(cell,e,forceEdit){var cellEditor,component,params,self=this,allowEdit=!0,rendered=function(){},element=cell.getElement();if(!this.currentCell){if(cell.column.modules.edit.blocked)return this.mouseClick=!1,element.blur(),!1;switch(e&&e.stopPropagation(),_typeof(cell.column.modules.edit.check)){case"function":allowEdit=cell.column.modules.edit.check(cell.getComponent());break;case"boolean":allowEdit=cell.column.modules.edit.check}if(allowEdit||forceEdit){if(self.cancelEdit(),component=(self.currentCell=cell).getComponent(),this.mouseClick&&(this.mouseClick=!1,cell.column.cellEvents.cellClick&&cell.column.cellEvents.cellClick.call(this.table,e,component)),cell.column.cellEvents.cellEditing&&cell.column.cellEvents.cellEditing.call(this.table,component),self.table.options.cellEditing.call(this.table,component),params="function"==typeof cell.column.modules.edit.params?cell.column.modules.edit.params(component):cell.column.modules.edit.params,!1===(cellEditor=cell.column.modules.edit.editor.call(self,component,function(callback){rendered=callback},function(value){if(self.currentCell===cell){var valid=!0;cell.column.modules.validate&&self.table.modExists("validate")&&(valid=self.table.modules.validate.validate(cell.column.modules.validate,cell.getComponent(),value)),!0===valid?(self.clearEditor(),cell.setValue(value,!0),self.table.options.dataTree&&self.table.modExists("dataTree")&&self.table.modules.dataTree.checkForRestyle(cell)):(self.invalidEdit=!0,element.classList.add("tabulator-validation-fail"),self.focusCellNoEvent(cell),rendered(),self.table.options.validationFailed.call(self.table,cell.getComponent(),value,valid))}},function(){self.currentCell===cell&&(self.cancelEdit(),self.table.options.dataTree&&self.table.modExists("dataTree")&&self.table.modules.dataTree.checkForRestyle(cell))},params)))return element.blur(),!1;if(!(cellEditor instanceof Node))return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",cellEditor),element.blur(),!1;for(element.classList.add("tabulator-editing"),cell.row.getElement().classList.add("tabulator-row-editing");element.firstChild;)element.removeChild(element.firstChild);element.appendChild(cellEditor),rendered();for(var children=element.children,i=0;i<children.length;i++)children[i].addEventListener("click",function(e){e.stopPropagation()});return!0}return this.mouseClick=!1,element.blur(),!1}this.invalidEdit||this.cancelEdit()},Edit.prototype.editors={input:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type",editorParams.search?"search":"text"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){null==cellValue&&""!==input.value||input.value!=cellValue?success(input.value):cancel()}return input.value=void 0!==cellValue?cellValue:"",onRendered(function(){input.focus(),input.style.height="100%"}),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",function(e){switch(e.keyCode){case 13:success(input.value);break;case 27:cancel()}}),input},textarea:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),value=String(null!=cellValue?cellValue:""),input=((value.match(/(?:\r\n|\r|\n)/g)||[]).length,document.createElement("textarea")),scrollHeight=0;if(input.style.display="block",input.style.padding="2px",input.style.height="100%",input.style.width="100%",input.style.boxSizing="border-box",input.style.whiteSpace="pre-wrap",input.style.resize="none",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){null==cellValue&&""!==input.value||input.value!=cellValue?(success(input.value),setTimeout(function(){cell.getRow().normalizeHeight()},300)):cancel()}return input.value=value,onRendered(function(){input.focus(),input.style.height="100%"}),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keyup",function(){input.style.height="";var heightNow=input.scrollHeight;input.style.height=heightNow+"px",heightNow!=scrollHeight&&(scrollHeight=heightNow,cell.getRow().normalizeHeight())}),input.addEventListener("keydown",function(e){27==e.keyCode&&cancel()}),input},number:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type","number"),void 0!==editorParams.max&&input.setAttribute("max",editorParams.max),void 0!==editorParams.min&&input.setAttribute("min",editorParams.min),void 0!==editorParams.step&&input.setAttribute("step",editorParams.step),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);input.value=cellValue;var blurFunc=function(e){onChange()};function onChange(){var value=input.value;isNaN(value)||""===value||(value=Number(value)),value!=cellValue?success(value):cancel()}return onRendered(function(){input.removeEventListener("blur",blurFunc),input.focus(),input.style.height="100%",input.addEventListener("blur",blurFunc)}),input.addEventListener("keydown",function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel()}}),input},range:function(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type","range"),void 0!==editorParams.max&&input.setAttribute("max",editorParams.max),void 0!==editorParams.min&&input.setAttribute("min",editorParams.min),void 0!==editorParams.step&&input.setAttribute("step",editorParams.step),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(){var value=input.value;isNaN(value)||""===value||(value=Number(value)),value!=cellValue?success(value):cancel()}return input.value=cellValue,onRendered(function(){input.focus(),input.style.height="100%"}),input.addEventListener("blur",function(e){onChange()}),input.addEventListener("keydown",function(e){switch(e.keyCode){case 13:case 9:onChange();break;case 27:cancel()}}),input},select:function(cell,onRendered,success,cancel,editorParams){var self=this,cellEl=cell.getElement(),initialValue=cell.getValue(),initialDisplayValue=void 0!==initialValue||null===initialValue?initialValue:void 0!==editorParams.defaultValue?editorParams.defaultValue:"",input=document.createElement("input"),listEl=document.createElement("div"),dataItems=[],displayItems=[],currentItem={},blurable=!0;function getUniqueColumnValues(field){var column,output={},data=self.table.getData();return(column=field?self.table.columnManager.getColumnByField(field):cell.getColumn()._getSelf())?(data.forEach(function(row){var val=column.getFieldValue(row);null!=val&&""!==val&&(output[val]=!0)}),output=editorParams.sortValuesList?"asc"==editorParams.sortValuesList?Object.keys(output).sort():Object.keys(output).sort().reverse():Object.keys(output)):console.warn("unable to find matching column to create select lookup list:",field),output}function parseItems(inputValues,curentValue){var dataList=[],displayList=[];function processComplexListItem(item){return(item={label:editorParams.listItemFormatter?editorParams.listItemFormatter(item.value,item.label):item.label,value:item.value,element:!1}).value!==curentValue&&(isNaN(parseFloat(item.value))||isNaN(parseFloat(item.value))||parseFloat(item.value)!==parseFloat(curentValue))||setCurrentItem(item),dataList.push(item),displayList.push(item),item}if("function"==typeof inputValues&&(inputValues=inputValues(cell)),Array.isArray(inputValues))inputValues.forEach(function(value){var item;"object"===(void 0===value?"undefined":_typeof(value))?value.options?(item={label:value.label,group:!0,element:!1},displayList.push(item),value.options.forEach(function(item){processComplexListItem(item)})):processComplexListItem(value):((item={label:editorParams.listItemFormatter?editorParams.listItemFormatter(value,value):value,value:value,element:!1}).value!==curentValue&&(isNaN(parseFloat(item.value))||isNaN(parseFloat(item.value))||parseFloat(item.value)!==parseFloat(curentValue))||setCurrentItem(item),dataList.push(item),displayList.push(item))});else for(var key in inputValues){var item={label:editorParams.listItemFormatter?editorParams.listItemFormatter(key,inputValues[key]):inputValues[key],value:key,element:!1};item.value!==curentValue&&(isNaN(parseFloat(item.value))||isNaN(parseFloat(item.value))||parseFloat(item.value)!==parseFloat(curentValue))||setCurrentItem(item),dataList.push(item),displayList.push(item)}dataItems=dataList,displayItems=displayList,function(){for(;listEl.firstChild;)listEl.removeChild(listEl.firstChild);displayItems.forEach(function(item){var el=item.element;el||(item.group?((el=document.createElement("div")).classList.add("tabulator-edit-select-list-group"),el.tabIndex=0,el.innerHTML=""===item.label?"&nbsp;":item.label):((el=document.createElement("div")).classList.add("tabulator-edit-select-list-item"),el.tabIndex=0,el.innerHTML=""===item.label?"&nbsp;":item.label,el.addEventListener("click",function(){setCurrentItem(item),chooseItem()}),item===currentItem&&el.classList.add("active")),el.addEventListener("mousedown",function(){blurable=!1,setTimeout(function(){blurable=!0},10)}),item.element=el),listEl.appendChild(el)})}()}function setCurrentItem(item){currentItem&&currentItem.element&&currentItem.element.classList.remove("active"),currentItem=item,input.value="&nbsp;"===item.label?"":item.label,item.element&&item.element.classList.add("active")}function chooseItem(){hideList(),initialValue!==currentItem.value?(initialValue=currentItem.value,success(currentItem.value)):cancel()}function cancelItem(){hideList(),cancel()}function hideList(){listEl.parentNode&&listEl.parentNode.removeChild(listEl),self.table.rowManager.element.removeEventListener("scroll",cancelItem)}if(this.table.rowManager.element.addEventListener("scroll",cancelItem),!Array.isArray(editorParams)&&(Array.isArray(editorParams)||"object"!==(void 0===editorParams?"undefined":_typeof(editorParams))||editorParams.values)||(console.warn("DEPRECATION WANRING - values for the select editor must now be passed into the values property of the editorParams object, not as the editorParams object"),editorParams={values:editorParams}),input.setAttribute("type","text"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",input.style.cursor="default",input.readOnly=0!=this.currentCell,editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);return input.value=void 0!==initialValue||null===initialValue?initialValue:"",!0===editorParams.values?parseItems(getUniqueColumnValues(),initialValue):"string"==typeof editorParams.values?parseItems(getUniqueColumnValues(editorParams.values),initialValue):parseItems(editorParams.values||[],initialValue),input.addEventListener("keydown",function(e){var index;switch(e.keyCode){case 38:e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),0<(index=dataItems.indexOf(currentItem))&&setCurrentItem(dataItems[index-1]);break;case 40:e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),(index=dataItems.indexOf(currentItem))<dataItems.length-1&&setCurrentItem(-1==index?dataItems[0]:dataItems[index+1]);break;case 37:case 39:e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();break;case 13:chooseItem();break;case 27:cancelItem()}}),input.addEventListener("blur",function(e){blurable&&cancelItem()}),input.addEventListener("focus",function(e){!function(){if(!listEl.parentNode){!0===editorParams.values?parseItems(getUniqueColumnValues(),initialDisplayValue):"string"==typeof editorParams.values?parseItems(getUniqueColumnValues(editorParams.values),initialDisplayValue):parseItems(editorParams.values||[],initialDisplayValue);var offset=Tabulator.prototype.helpers.elOffset(cellEl);listEl.style.minWidth=cellEl.offsetWidth+"px",listEl.style.top=offset.top+cellEl.offsetHeight+"px",listEl.style.left=offset.left+"px",document.body.appendChild(listEl)}}()}),(listEl=document.createElement("div")).classList.add("tabulator-edit-select-list"),onRendered(function(){input.style.height="100%",input.focus()}),input},autocomplete:function(cell,onRendered,success,cancel,editorParams){var self=this,cellEl=cell.getElement(),initialValue=cell.getValue(),initialDisplayValue=void 0!==initialValue||null===initialValue?initialValue:void 0!==editorParams.defaultValue?editorParams.defaultValue:"",input=document.createElement("input"),listEl=document.createElement("div"),allItems=[],displayItems=[],currentItem={},blurable=!0;function getUniqueColumnValues(field){var column,output={},data=self.table.getData();return(column=field?self.table.columnManager.getColumnByField(field):cell.getColumn()._getSelf())?(data.forEach(function(row){var val=column.getFieldValue(row);null!=val&&""!==val&&(output[val]=!0)}),output=editorParams.sortValuesList?"asc"==editorParams.sortValuesList?Object.keys(output).sort():Object.keys(output).sort().reverse():Object.keys(output)):console.warn("unable to find matching column to create autocomplete lookup list:",field),output}function filterList(term,intialLoad){var matches=[],searchObjs=[];editorParams.searchFunc?(allItems.forEach(function(item){searchObjs.push(item.search)}),editorParams.searchFunc(term,searchObjs).forEach(function(result){var match=allItems.find(function(item){return item.search===result});match&&matches.push(match)})):""===term?editorParams.showListOnEmpty&&allItems.forEach(function(item){matches.push(item)}):allItems.forEach(function(item){null===item.value&&void 0===item.value||(-1<String(item.value).toLowerCase().indexOf(String(term).toLowerCase())||-1<String(item.title).toLowerCase().indexOf(String(term).toLowerCase()))&&matches.push(item)}),displayItems=matches,function(intialLoad){var current=!1;for(;listEl.firstChild;)listEl.removeChild(listEl.firstChild);displayItems.forEach(function(item){var el=item.element;el||((el=document.createElement("div")).classList.add("tabulator-edit-select-list-item"),el.tabIndex=0,el.innerHTML=item.title,el.addEventListener("click",function(){setCurrentItem(item),chooseItem()}),el.addEventListener("mousedown",function(){blurable=!1,setTimeout(function(){blurable=!0},10)}),item.element=el,intialLoad&&item.value==initialValue&&(input.value=item.title,item.element.classList.add("active"),current=!0),item===currentItem&&(item.element.classList.add("active"),current=!0)),listEl.appendChild(el)}),current||setCurrentItem(!1)}(intialLoad)}function setCurrentItem(item){currentItem&&currentItem.element&&currentItem.element.classList.remove("active"),(currentItem=item)&&item.element&&item.element.classList.add("active")}function chooseItem(){hideList(),currentItem?initialValue!==currentItem.value?(initialValue=currentItem.value,input.value=currentItem.title,success(currentItem.value)):cancel():editorParams.freetext?(initialValue=input.value,success(input.value)):editorParams.allowEmpty&&""===input.value?(initialValue=input.value,success(input.value)):cancel()}function cancelItem(){hideList(),cancel()}function showList(){if(!listEl.parentNode){for(;listEl.firstChild;)listEl.removeChild(listEl.firstChild);(function(inputValues,curentValue){var itemList=[];if(Array.isArray(inputValues))inputValues.forEach(function(value){var item={title:editorParams.listItemFormatter?editorParams.listItemFormatter(value,value):value,value:value,element:!1};item.value!==curentValue&&(isNaN(parseFloat(item.value))||isNaN(parseFloat(item.value))||parseFloat(item.value)!==parseFloat(curentValue))||setCurrentItem(item),itemList.push(item)});else for(var key in inputValues){var item={title:editorParams.listItemFormatter?editorParams.listItemFormatter(key,inputValues[key]):inputValues[key],value:key,element:!1};item.value!==curentValue&&(isNaN(parseFloat(item.value))||isNaN(parseFloat(item.value))||parseFloat(item.value)!==parseFloat(curentValue))||setCurrentItem(item),itemList.push(item)}editorParams.searchFunc&&itemList.forEach(function(item){item.search={title:item.title,value:item.value}}),allItems=itemList})(!0===editorParams.values?getUniqueColumnValues():"string"==typeof editorParams.values?getUniqueColumnValues(editorParams.values):editorParams.values||[],initialValue);var offset=Tabulator.prototype.helpers.elOffset(cellEl);listEl.style.minWidth=cellEl.offsetWidth+"px",listEl.style.top=offset.top+cellEl.offsetHeight+"px",listEl.style.left=offset.left+"px",document.body.appendChild(listEl)}}function hideList(){listEl.parentNode&&listEl.parentNode.removeChild(listEl),self.table.rowManager.element.removeEventListener("scroll",cancelItem)}if(this.table.rowManager.element.addEventListener("scroll",cancelItem),input.setAttribute("type","search"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);return input.addEventListener("keydown",function(e){var index;switch(e.keyCode){case 38:e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),setCurrentItem(0<(index=displayItems.indexOf(currentItem))&&displayItems[index-1]);break;case 40:e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),(index=displayItems.indexOf(currentItem))<displayItems.length-1&&setCurrentItem(-1==index?displayItems[0]:displayItems[index+1]);break;case 37:case 39:e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();break;case 13:chooseItem();break;case 27:cancelItem();break;case 36:case 35:e.stopImmediatePropagation()}}),input.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:filterList(input.value)}}),input.addEventListener("search",function(e){filterList(input.value)}),input.addEventListener("blur",function(e){blurable&&chooseItem()}),input.addEventListener("focus",function(e){var value=initialDisplayValue;showList(),filterList(input.value=value,!0)}),(listEl=document.createElement("div")).classList.add("tabulator-edit-select-list"),onRendered(function(){input.style.height="100%",input.focus()}),input},star:function(cell,onRendered,success,cancel,editorParams){var self=this,element=cell.getElement(),value=cell.getValue(),maxStars=element.getElementsByTagName("svg").length||5,size=element.getElementsByTagName("svg")[0]?element.getElementsByTagName("svg")[0].getAttribute("width"):14,stars=[],starsHolder=document.createElement("div"),star=document.createElementNS("http://www.w3.org/2000/svg","svg");function starChange(val){stars.forEach(function(star,i){i<val?("ie"==self.table.browser?star.setAttribute("class","tabulator-star-active"):star.classList.replace("tabulator-star-inactive","tabulator-star-active"),star.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):("ie"==self.table.browser?star.setAttribute("class","tabulator-star-inactive"):star.classList.replace("tabulator-star-active","tabulator-star-inactive"),star.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function buildStar(i){var starHolder=document.createElement("span"),nextStar=star.cloneNode(!0);stars.push(nextStar),starHolder.addEventListener("mouseenter",function(e){e.stopPropagation(),e.stopImmediatePropagation(),starChange(i)}),starHolder.addEventListener("mousemove",function(e){e.stopPropagation(),e.stopImmediatePropagation()}),starHolder.addEventListener("click",function(e){e.stopPropagation(),e.stopImmediatePropagation(),success(i)}),starHolder.appendChild(nextStar),starsHolder.appendChild(starHolder)}function changeValue(val){starChange(value=val)}if(element.style.whiteSpace="nowrap",element.style.overflow="hidden",element.style.textOverflow="ellipsis",starsHolder.style.verticalAlign="middle",starsHolder.style.display="inline-block",starsHolder.style.padding="4px",star.setAttribute("width",size),star.setAttribute("height",size),star.setAttribute("viewBox","0 0 512 512"),star.setAttribute("xml:space","preserve"),star.style.padding="0 1px",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),starsHolder.setAttribute(key,starsHolder.getAttribute(key)+editorParams.elementAttributes["+"+key])):starsHolder.setAttribute(key,editorParams.elementAttributes[key]);for(var i=1;i<=maxStars;i++)buildStar(i);return starChange(value=Math.min(parseInt(value),maxStars)),starsHolder.addEventListener("mousemove",function(e){starChange(0)}),starsHolder.addEventListener("click",function(e){success(0)}),element.addEventListener("blur",function(e){cancel()}),element.addEventListener("keydown",function(e){switch(e.keyCode){case 39:changeValue(value+1);break;case 37:changeValue(value-1);break;case 13:success(value);break;case 27:cancel()}}),starsHolder},progress:function(cell,onRendered,success,cancel,editorParams){var mouseDrag,mouseDragWidth,element=cell.getElement(),max=void 0===editorParams.max?element.getElementsByTagName("div")[0].getAttribute("max")||100:editorParams.max,min=void 0===editorParams.min?element.getElementsByTagName("div")[0].getAttribute("min")||0:editorParams.min,percent=(max-min)/100,value=cell.getValue()||0,handle=document.createElement("div"),bar=document.createElement("div");function updateValue(){var calcVal=percent*Math.round(bar.offsetWidth/(element.clientWidth/100))+min;success(calcVal),element.setAttribute("aria-valuenow",calcVal),element.setAttribute("aria-label",value)}if(handle.style.position="absolute",handle.style.right="0",handle.style.top="0",handle.style.bottom="0",handle.style.width="5px",handle.classList.add("tabulator-progress-handle"),bar.style.display="inline-block",bar.style.position="relative",bar.style.height="100%",bar.style.backgroundColor="#488CE9",bar.style.maxWidth="100%",bar.style.minWidth="0%",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),bar.setAttribute(key,bar.getAttribute(key)+editorParams.elementAttributes["+"+key])):bar.setAttribute(key,editorParams.elementAttributes[key]);return element.style.padding="4px 4px",value=Math.min(parseFloat(value),max),value=Math.max(parseFloat(value),min),value=Math.round((value-min)/percent),bar.style.width=value+"%",element.setAttribute("aria-valuemin",min),element.setAttribute("aria-valuemax",max),bar.appendChild(handle),handle.addEventListener("mousedown",function(e){mouseDrag=e.screenX,mouseDragWidth=bar.offsetWidth}),handle.addEventListener("mouseover",function(){handle.style.cursor="ew-resize"}),element.addEventListener("mousemove",function(e){mouseDrag&&(bar.style.width=mouseDragWidth+e.screenX-mouseDrag+"px")}),element.addEventListener("mouseup",function(e){mouseDrag&&(e.stopPropagation(),e.stopImmediatePropagation(),mouseDragWidth=mouseDrag=!1,updateValue())}),element.addEventListener("keydown",function(e){switch(e.keyCode){case 39:bar.style.width=bar.clientWidth+element.clientWidth/100+"px";break;case 37:bar.style.width=bar.clientWidth-element.clientWidth/100+"px";break;case 13:updateValue();break;case 27:cancel()}}),element.addEventListener("blur",function(){cancel()}),bar},tickCross:function(cell,onRendered,success,cancel,editorParams){var value=cell.getValue(),input=document.createElement("input"),tristate=editorParams.tristate,indetermValue=void 0===editorParams.indeterminateValue?null:editorParams.indeterminateValue,indetermState=!1;if(input.setAttribute("type","checkbox"),input.style.marginTop="5px",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function setValue(blur){return tristate?blur?indetermState?indetermValue:input.checked:input.checked&&!indetermState?(input.checked=!1,input.indeterminate=!0,indetermState=!0,indetermValue):(indetermState=!1,input.checked):input.checked}return input.value=value,!tristate||void 0!==value&&value!==indetermValue&&""!==value||(indetermState=!0,input.indeterminate=!0),"firefox"!=this.table.browser&&onRendered(function(){input.focus()}),input.checked=!0===value||"true"===value||"True"===value||1===value,input.addEventListener("change",function(e){success(setValue())}),input.addEventListener("blur",function(e){success(setValue(!0))}),input.addEventListener("keydown",function(e){13==e.keyCode&&success(setValue()),27==e.keyCode&&cancel()}),input}},Tabulator.prototype.registerModule("edit",Edit);var Filter=function(table){this.table=table,this.filterList=[],this.headerFilters={},this.headerFilterElements=[],this.headerFilterColumns=[],this.changed=!1};Filter.prototype.initializeColumn=function(column,value){var self=this,field=column.getField();column.modules.filter={success:function(value){var filterFunc,filterType="input"==column.modules.filter.tagType&&"text"==column.modules.filter.attrType||"textarea"==column.modules.filter.tagType?"partial":"match",type="";if(void 0===column.modules.filter.prevSuccess||column.modules.filter.prevSuccess!==value){if(column.modules.filter.prevSuccess=value,column.modules.filter.emptyFunc(value))delete self.headerFilters[field];else{switch(column.modules.filter.value=value,_typeof(column.definition.headerFilterFunc)){case"string":self.filters[column.definition.headerFilterFunc]?(type=column.definition.headerFilterFunc,filterFunc=function(data){var params=column.definition.headerFilterFuncParams||{},fieldVal=column.getFieldValue(data);return params="function"==typeof params?params(value,fieldVal,data):params,self.filters[column.definition.headerFilterFunc](value,fieldVal,data,params)}):console.warn("Header Filter Error - Matching filter function not found: ",column.definition.headerFilterFunc);break;case"function":type=filterFunc=function(data){var params=column.definition.headerFilterFuncParams||{},fieldVal=column.getFieldValue(data);return params="function"==typeof params?params(value,fieldVal,data):params,column.definition.headerFilterFunc(value,fieldVal,data,params)}}if(!filterFunc)switch(filterType){case"partial":filterFunc=function(data){var colVal=column.getFieldValue(data);return null!=colVal&&-1<String(colVal).toLowerCase().indexOf(String(value).toLowerCase())},type="like";break;default:filterFunc=function(data){return column.getFieldValue(data)==value},type="="}self.headerFilters[field]={value:value,func:filterFunc,type:type}}self.changed=!0,self.table.rowManager.filterRefresh()}},attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(column)},Filter.prototype.generateHeaderFilterElement=function(column,initialValue){var filterElement,editor,editorElement,cellWrapper,typingTimer,searchTrigger,params,_this35=this,self=this,success=column.modules.filter.success,field=column.getField();if(column.modules.filter.headerElement&&column.modules.filter.headerElement.parentNode){var oldFilterElement=column.modules.filter.headerElement.parentNode,oldFilterElementIndex=self.headerFilterElements.indexOf(oldFilterElement);0<=oldFilterElementIndex&&self.headerFilterElements.splice(oldFilterElementIndex,1);var oldColumnIndex=self.headerFilterColumns.indexOf(oldColumnIndex);0<=oldColumnIndex&&self.headerFilterColumns.splice(oldColumnIndex,1),column.contentElement.removeChild(oldFilterElement)}if(field){switch(column.modules.filter.emptyFunc=column.definition.headerFilterEmptyCheck||function(value){return!value&&"0"!==value},(filterElement=document.createElement("div")).classList.add("tabulator-header-filter"),_typeof(column.definition.headerFilter)){case"string":self.table.modules.edit.editors[column.definition.headerFilter]?(editor=self.table.modules.edit.editors[column.definition.headerFilter],"tick"!==column.definition.headerFilter&&"tickCross"!==column.definition.headerFilter||column.definition.headerFilterEmptyCheck||(column.modules.filter.emptyFunc=function(value){return!0!==value&&!1!==value})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",column.definition.editor);break;case"function":editor=column.definition.headerFilter;break;case"boolean":column.modules.edit&&column.modules.edit.editor?editor=column.modules.edit.editor:column.definition.formatter&&self.table.modules.edit.editors[column.definition.formatter]?(editor=self.table.modules.edit.editors[column.definition.formatter],"tick"!==column.definition.formatter&&"tickCross"!==column.definition.formatter||column.definition.headerFilterEmptyCheck||(column.modules.filter.emptyFunc=function(value){return!0!==value&&!1!==value})):editor=self.table.modules.edit.editors.input}if(editor){if(cellWrapper={getValue:function(){return void 0!==initialValue?initialValue:""},getField:function(){return column.definition.field},getElement:function(){return filterElement},getColumn:function(){return column.getComponent()},getRow:function(){return{normalizeHeight:function(){}}}},params="function"==typeof(params=column.definition.headerFilterParams||{})?params.call(self.table):params,!(editorElement=editor.call(this.table.modules.edit,cellWrapper,function(){},success,function(){},params)))return void console.warn("Filter Error - Cannot add filter to "+field+" column, editor returned a value of false");if(!(editorElement instanceof Node))return void console.warn("Filter Error - Cannot add filter to "+field+" column, editor should return an instance of Node, the editor returned:",editorElement);field?self.table.modules.localize.bind("headerFilters|columns|"+column.definition.field,function(value){editorElement.setAttribute("placeholder",void 0!==value&&value?value:self.table.modules.localize.getText("headerFilters|default"))}):self.table.modules.localize.bind("headerFilters|default",function(value){editorElement.setAttribute("placeholder",void 0!==self.column.definition.headerFilterPlaceholder&&self.column.definition.headerFilterPlaceholder?self.column.definition.headerFilterPlaceholder:value)}),editorElement.addEventListener("click",function(e){e.stopPropagation(),editorElement.focus()}),editorElement.addEventListener("focus",function(e){var left=_this35.table.columnManager.element.scrollLeft;left!==_this35.table.rowManager.element.scrollLeft&&(_this35.table.rowManager.scrollHorizontal(left),_this35.table.columnManager.scrollHorizontal(left))}),typingTimer=!1,searchTrigger=function(e){typingTimer&&clearTimeout(typingTimer),typingTimer=setTimeout(function(){success(editorElement.value)},300)},column.modules.filter.headerElement=editorElement,column.modules.filter.attrType=editorElement.hasAttribute("type")?editorElement.getAttribute("type").toLowerCase():"",column.modules.filter.tagType=editorElement.tagName.toLowerCase(),!1!==column.definition.headerFilterLiveFilter&&("autocomplete"!==column.definition.headerFilter&&"tickCross"!==column.definition.headerFilter&&("autocomplete"!==column.definition.editor&&"tickCross"!==column.definition.editor||!0!==column.definition.headerFilter)&&(editorElement.addEventListener("keyup",searchTrigger),editorElement.addEventListener("search",searchTrigger),"number"==column.modules.filter.attrType&&editorElement.addEventListener("change",function(e){success(editorElement.value)}),"text"==column.modules.filter.attrType&&"ie"!==this.table.browser&&editorElement.setAttribute("type","search")),"input"!=column.modules.filter.tagType&&"select"!=column.modules.filter.tagType&&"textarea"!=column.modules.filter.tagType||editorElement.addEventListener("mousedown",function(e){e.stopPropagation()})),filterElement.appendChild(editorElement),column.contentElement.appendChild(filterElement),self.headerFilterElements.push(editorElement),self.headerFilterColumns.push(column)}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",column.definition.title)},Filter.prototype.hideHeaderFilterElements=function(){this.headerFilterElements.forEach(function(element){element.style.display="none"})},Filter.prototype.showHeaderFilterElements=function(){this.headerFilterElements.forEach(function(element){element.style.display=""})},Filter.prototype.setHeaderFilterFocus=function(column){column.modules.filter&&column.modules.filter.headerElement?column.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",column.getField())},Filter.prototype.setHeaderFilterValue=function(column,value){column&&(column.modules.filter&&column.modules.filter.headerElement?(this.generateHeaderFilterElement(column,value),column.modules.filter.success(value)):console.warn("Column Filter Error - No header filter set on column:",column.getField()))},Filter.prototype.reloadHeaderFilter=function(column){column&&(column.modules.filter&&column.modules.filter.headerElement?this.generateHeaderFilterElement(column,column.modules.filter.value):console.warn("Column Filter Error - No header filter set on column:",column.getField()))},Filter.prototype.hasChanged=function(){var changed=this.changed;return this.changed=!1,changed},Filter.prototype.setFilter=function(field,type,value){this.filterList=[],Array.isArray(field)||(field=[{field:field,type:type,value:value}]),this.addFilter(field)},Filter.prototype.addFilter=function(field,type,value){var self=this;Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach(function(filter){(filter=self.findFilter(filter))&&(self.filterList.push(filter),self.changed=!0)}),this.table.options.persistentFilter&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("filter")},Filter.prototype.findFilter=function(filter){var column,self=this;if(Array.isArray(filter))return this.findSubFilters(filter);var filterFunc=!1;return"function"==typeof filter.field?filterFunc=function(data){return filter.field(data,filter.type||{})}:self.filters[filter.type]?filterFunc=(column=self.table.columnManager.getColumnByField(filter.field))?function(data){return self.filters[filter.type](filter.value,column.getFieldValue(data))}:function(data){return self.filters[filter.type](filter.value,data[filter.field])}:console.warn("Filter Error - No such filter type found, ignoring: ",filter.type),filter.func=filterFunc,!!filter.func&&filter},Filter.prototype.findSubFilters=function(filters){var self=this,output=[];return filters.forEach(function(filter){(filter=self.findFilter(filter))&&output.push(filter)}),!!output.length&&output},Filter.prototype.getFilters=function(all,ajax){var output=[];return all&&(output=this.getHeaderFilters()),ajax&&output.forEach(function(item){"function"==typeof item.type&&(item.type="function")}),output=output.concat(this.filtersToArray(this.filterList,ajax))},Filter.prototype.filtersToArray=function(filterList,ajax){var _this36=this,output=[];return filterList.forEach(function(filter){var item;Array.isArray(filter)?output.push(_this36.filtersToArray(filter,ajax)):(item={field:filter.field,type:filter.type,value:filter.value},ajax&&"function"==typeof item.type&&(item.type="function"),output.push(item))}),output},Filter.prototype.getHeaderFilters=function(){var output=[];for(var key in this.headerFilters)output.push({field:key,type:this.headerFilters[key].type,value:this.headerFilters[key].value});return output},Filter.prototype.removeFilter=function(field,type,value){var self=this;Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach(function(filter){var index=-1;-1<(index="object"==_typeof(filter.field)?self.filterList.findIndex(function(element){return filter===element}):self.filterList.findIndex(function(element){return filter.field===element.field&&filter.type===element.type&&filter.value===element.value}))?(self.filterList.splice(index,1),self.changed=!0):console.warn("Filter Error - No matching filter type found, ignoring: ",filter.type)}),this.table.options.persistentFilter&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("filter")},Filter.prototype.clearFilter=function(all){this.filterList=[],all&&this.clearHeaderFilter(),this.changed=!0,this.table.options.persistentFilter&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("filter")},Filter.prototype.clearHeaderFilter=function(){var self=this;this.headerFilters={},this.headerFilterColumns.forEach(function(column){column.modules.filter.value=null,column.modules.filter.prevSuccess=void 0,self.reloadHeaderFilter(column)}),this.changed=!0},Filter.prototype.search=function(searchType,field,type,value){var self=this,activeRows=[],filterList=[];return Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach(function(filter){(filter=self.findFilter(filter))&&filterList.push(filter)}),this.table.rowManager.rows.forEach(function(row){var match=!0;filterList.forEach(function(filter){self.filterRecurse(filter,row.getData())||(match=!1)}),match&&activeRows.push("data"===searchType?row.getData("data"):row.getComponent())}),activeRows},Filter.prototype.filter=function(rowList,filters){var self=this,activeRows=[],activeRowComponents=[];return self.table.options.dataFiltering&&self.table.options.dataFiltering.call(self.table,self.getFilters()),self.table.options.ajaxFiltering||!self.filterList.length&&!Object.keys(self.headerFilters).length?activeRows=rowList.slice(0):rowList.forEach(function(row){self.filterRow(row)&&activeRows.push(row)}),self.table.options.dataFiltered&&(activeRows.forEach(function(row){activeRowComponents.push(row.getComponent())}),self.table.options.dataFiltered.call(self.table,self.getFilters(),activeRowComponents)),activeRows},Filter.prototype.filterRow=function(row,filters){var self=this,match=!0,data=row.getData();for(var field in self.filterList.forEach(function(filter){self.filterRecurse(filter,data)||(match=!1)}),self.headerFilters)self.headerFilters[field].func(data)||(match=!1);return match},Filter.prototype.filterRecurse=function(filter,data){var self=this,match=!1;return Array.isArray(filter)?filter.forEach(function(subFilter){self.filterRecurse(subFilter,data)&&(match=!0)}):match=filter.func(data),match},Filter.prototype.filters={"=":function(filterVal,rowVal,rowData,filterParams){return rowVal==filterVal},"<":function(filterVal,rowVal,rowData,filterParams){return rowVal<filterVal},"<=":function(filterVal,rowVal,rowData,filterParams){return rowVal<=filterVal},">":function(filterVal,rowVal,rowData,filterParams){return filterVal<rowVal},">=":function(filterVal,rowVal,rowData,filterParams){return filterVal<=rowVal},"!=":function(filterVal,rowVal,rowData,filterParams){return rowVal!=filterVal},regex:function(filterVal,rowVal,rowData,filterParams){return"string"==typeof filterVal&&(filterVal=new RegExp(filterVal)),filterVal.test(rowVal)},like:function(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&-1<String(rowVal).toLowerCase().indexOf(filterVal.toLowerCase())},in:function(filterVal,rowVal,rowData,filterParams){return Array.isArray(filterVal)?-1<filterVal.indexOf(rowVal):(console.warn("Filter Error - filter value is not an array:",filterVal),!1)}},Tabulator.prototype.registerModule("filter",Filter);var Format=function(table){this.table=table};Format.prototype.initializeColumn=function(column){var config={params:column.definition.formatterParams||{}};switch(_typeof(column.definition.formatter)){case"string":"tick"===column.definition.formatter&&(column.definition.formatter="tickCross",void 0===config.params.crossElement&&(config.params.crossElement=!1),console.warn("DEPRECATION WARNING - the tick formatter has been deprecated, please use the tickCross formatter with the crossElement param set to false")),this.formatters[column.definition.formatter]?config.formatter=this.formatters[column.definition.formatter]:(console.warn("Formatter Error - No such formatter found: ",column.definition.formatter),config.formatter=this.formatters.plaintext);break;case"function":config.formatter=column.definition.formatter;break;default:config.formatter=this.formatters.plaintext}column.modules.format=config},Format.prototype.cellRendered=function(cell){cell.column.modules.format.renderedCallback&&cell.column.modules.format.renderedCallback()},Format.prototype.formatValue=function(cell){var component=cell.getComponent(),params="function"==typeof cell.column.modules.format.params?cell.column.modules.format.params(component):cell.column.modules.format.params;return cell.column.modules.format.formatter.call(this,component,params,function(callback){cell.column.modules.format.renderedCallback=callback})},Format.prototype.sanitizeHTML=function(value){if(value){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(value).replace(/[&<>"'`=\/]/g,function(s){return entityMap[s]})}return value},Format.prototype.emptyToSpace=function(value){return null==value?"&nbsp;":value},Format.prototype.getFormatter=function(formatter){switch(void 0===formatter?"undefined":_typeof(formatter)){case"string":formatter=this.formatters[formatter]?this.formatters[formatter]:(console.warn("Formatter Error - No such formatter found: ",formatter),this.formatters.plaintext);break;case"function":formatter=formatter;break;default:formatter=this.formatters.plaintext}return formatter},Format.prototype.formatters={plaintext:function(cell,formatterParams,onRendered){return this.emptyToSpace(this.sanitizeHTML(cell.getValue()))},html:function(cell,formatterParams,onRendered){return cell.getValue()},textarea:function(cell,formatterParams,onRendered){return cell.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(cell.getValue()))},money:function(cell,formatterParams,onRendered){var number,integer,decimal,rgx,floatVal=parseFloat(cell.getValue()),decimalSym=formatterParams.decimal||".",thousandSym=formatterParams.thousand||",",symbol=formatterParams.symbol||"",after=!!formatterParams.symbolAfter,precision=void 0!==formatterParams.precision?formatterParams.precision:2;if(isNaN(floatVal))return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));for(number=!1!==precision?floatVal.toFixed(precision):floatVal,integer=(number=String(number).split("."))[0],decimal=1<number.length?decimalSym+number[1]:"",rgx=/(\d+)(\d{3})/;rgx.test(integer);)integer=integer.replace(rgx,"$1"+thousandSym+"$2");return after?integer+decimal+symbol:symbol+integer+decimal},link:function(cell,formatterParams,onRendered){var value=cell.getValue(),urlPrefix=formatterParams.urlPrefix||"",label=this.emptyToSpace(value),el=document.createElement("a");if(formatterParams.labelField&&(label=cell.getData()[formatterParams.labelField]),formatterParams.label)switch(_typeof(formatterParams.label)){case"string":label=formatterParams.label;break;case"function":label=formatterParams.label(cell)}if(formatterParams.urlField&&(value=cell.getData()[formatterParams.urlField]),formatterParams.url)switch(_typeof(formatterParams.url)){case"string":value=formatterParams.url;break;case"function":value=formatterParams.url(cell)}return el.setAttribute("href",urlPrefix+value),formatterParams.target&&el.setAttribute("target",formatterParams.target),el.innerHTML=this.emptyToSpace(this.sanitizeHTML(label)),el},image:function(cell,formatterParams,onRendered){var el=document.createElement("img");switch(el.setAttribute("src",cell.getValue()),_typeof(formatterParams.height)){case"number":el.style.height=formatterParams.height+"px";break;case"string":el.style.height=formatterParams.height}switch(_typeof(formatterParams.width)){case"number":el.style.width=formatterParams.width+"px";break;case"string":el.style.width=formatterParams.width}return el.addEventListener("load",function(){cell.getRow().normalizeHeight()}),el},tickCross:function(cell,formatterParams,onRendered){var value=cell.getValue(),element=cell.getElement(),empty=formatterParams.allowEmpty,truthy=formatterParams.allowTruthy,tick=void 0!==formatterParams.tickElement?formatterParams.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',cross=void 0!==formatterParams.crossElement?formatterParams.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return truthy&&value||!0===value||"true"===value||"True"===value||1===value||"1"===value?(element.setAttribute("aria-checked",!0),tick||""):!empty||"null"!==value&&""!==value&&null!=value?(element.setAttribute("aria-checked",!1),cross||""):(element.setAttribute("aria-checked","mixed"),"")},datetime:function(cell,formatterParams,onRendered){var inputFormat=formatterParams.inputFormat||"YYYY-MM-DD hh:mm:ss",outputFormat=formatterParams.outputFormat||"DD/MM/YYYY hh:mm:ss",invalid=void 0!==formatterParams.invalidPlaceholder?formatterParams.invalidPlaceholder:"",value=cell.getValue(),newDatetime=moment(value,inputFormat);return newDatetime.isValid()?newDatetime.format(outputFormat):!0===invalid?value:"function"==typeof invalid?invalid(value):invalid},datetimediff:function(cell,formatterParams,onRendered){var inputFormat=formatterParams.inputFormat||"YYYY-MM-DD hh:mm:ss",invalid=void 0!==formatterParams.invalidPlaceholder?formatterParams.invalidPlaceholder:"",suffix=void 0!==formatterParams.suffix&&formatterParams.suffix,unit=void 0!==formatterParams.unit?formatterParams.unit:void 0,humanize=void 0!==formatterParams.humanize&&formatterParams.humanize,date=void 0!==formatterParams.date?formatterParams.date:moment(),value=cell.getValue(),newDatetime=moment(value,inputFormat);return newDatetime.isValid()?humanize?moment.duration(newDatetime.diff(date)).humanize(suffix):newDatetime.diff(date,unit)+(suffix?" "+suffix:""):!0===invalid?value:"function"==typeof invalid?invalid(value):invalid},lookup:function(cell,formatterParams,onRendered){var value=cell.getValue();return void 0===formatterParams[value]?(console.warn("Missing display value for "+value),value):formatterParams[value]},star:function(cell,formatterParams,onRendered){var value=cell.getValue(),element=cell.getElement(),maxStars=formatterParams&&formatterParams.stars?formatterParams.stars:5,stars=document.createElement("span"),star=document.createElementNS("http://www.w3.org/2000/svg","svg");stars.style.verticalAlign="middle",star.setAttribute("width","14"),star.setAttribute("height","14"),star.setAttribute("viewBox","0 0 512 512"),star.setAttribute("xml:space","preserve"),star.style.padding="0 1px",value=parseInt(value)<maxStars?parseInt(value):maxStars;for(var i=1;i<=maxStars;i++){var nextStar=star.cloneNode(!0);nextStar.innerHTML=i<=value?'<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>':'<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',stars.appendChild(nextStar)}return element.style.whiteSpace="nowrap",element.style.overflow="hidden",element.style.textOverflow="ellipsis",element.setAttribute("aria-label",value),stars},traffic:function(cell,formatterParams,onRendered){var percent,percentValue,value=this.sanitizeHTML(cell.getValue())||0,el=document.createElement("span"),max=formatterParams&&formatterParams.max?formatterParams.max:100,min=formatterParams&&formatterParams.min?formatterParams.min:0,colors=formatterParams&&void 0!==formatterParams.color?formatterParams.color:["red","orange","green"],color="#666666";if(!isNaN(value)&&void 0!==cell.getValue()){switch(el.classList.add("tabulator-traffic-light"),percentValue=parseFloat(value)<=max?parseFloat(value):max,percentValue=parseFloat(percentValue)>=min?parseFloat(percentValue):min,percent=(max-min)/100,percentValue=Math.round((percentValue-min)/percent),void 0===colors?"undefined":_typeof(colors)){case"string":color=colors;break;case"function":color=colors(value);break;case"object":if(Array.isArray(colors)){var unit=100/colors.length,index=Math.floor(percentValue/unit);index=Math.min(index,colors.length-1),color=colors[index=Math.max(index,0)];break}}return el.style.backgroundColor=color,el}},progress:function(cell,formatterParams,onRendered){var percent,percentValue,color,legend,legendColor,value=this.sanitizeHTML(cell.getValue())||0,element=cell.getElement(),max=formatterParams&&formatterParams.max?formatterParams.max:100,min=formatterParams&&formatterParams.min?formatterParams.min:0,legendAlign=formatterParams&&formatterParams.legendAlign?formatterParams.legendAlign:"center";switch(percentValue=parseFloat(value)<=max?parseFloat(value):max,percentValue=parseFloat(percentValue)>=min?parseFloat(percentValue):min,percent=(max-min)/100,percentValue=Math.round((percentValue-min)/percent),_typeof(formatterParams.color)){case"string":color=formatterParams.color;break;case"function":color=formatterParams.color(value);break;case"object":if(Array.isArray(formatterParams.color)){var unit=100/formatterParams.color.length,index=Math.floor(percentValue/unit);index=Math.min(index,formatterParams.color.length-1),index=Math.max(index,0),color=formatterParams.color[index];break}default:color="#2DC214"}switch(_typeof(formatterParams.legend)){case"string":legend=formatterParams.legend;break;case"function":legend=formatterParams.legend(value);break;case"boolean":legend=value;break;default:legend=!1}switch(_typeof(formatterParams.legendColor)){case"string":legendColor=formatterParams.legendColor;break;case"function":legendColor=formatterParams.legendColor(value);break;case"object":if(Array.isArray(formatterParams.legendColor)){unit=100/formatterParams.legendColor.length,index=Math.floor(percentValue/unit);index=Math.min(index,formatterParams.legendColor.length-1),index=Math.max(index,0),legendColor=formatterParams.legendColor[index]}break;default:legendColor="#000"}return element.style.minWidth="30px",element.style.position="relative",element.setAttribute("aria-label",percentValue),"<div style='position:relative; height:100%;'  data-max='"+max+"' data-min='"+min+"'><div style='position:relative; height:100%; width:calc("+percentValue+"%); background-color:"+color+"; display:inline-block;'></div></div>"+(legend?"<div style='position:absolute; top:4px; left:0; text-align:"+legendAlign+"; width:100%; color:"+legendColor+";'>"+legend+"</div>":"")},color:function(cell,formatterParams,onRendered){return cell.getElement().style.backgroundColor=this.sanitizeHTML(cell.getValue()),""},buttonTick:function(cell,formatterParams,onRendered){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'},buttonCross:function(cell,formatterParams,onRendered){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'},rownum:function(cell,formatterParams,onRendered){return this.table.rowManager.activeRows.indexOf(cell.getRow()._getSelf())+1},handle:function(cell,formatterParams,onRendered){return cell.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"},responsiveCollapse:function(cell,formatterParams,onRendered){var open=!1,el=document.createElement("div");function toggleList(isOpen){var collapse=cell.getRow().getElement().getElementsByClassName("tabulator-responsive-collapse")[0];(open=isOpen)?(el.classList.add("open"),collapse&&(collapse.style.display="")):(el.classList.remove("open"),collapse&&(collapse.style.display="none"))}return el.classList.add("tabulator-responsive-collapse-toggle"),el.innerHTML="<span class='tabulator-responsive-collapse-toggle-open'>+</span><span class='tabulator-responsive-collapse-toggle-close'>-</span>",cell.getElement().classList.add("tabulator-row-handle"),this.table.options.responsiveLayoutCollapseStartOpen&&(open=!0),el.addEventListener("click",function(e){e.stopImmediatePropagation(),toggleList(!open)}),toggleList(open),el},rowSelection:function(cell){var _this37=this,checkbox=document.createElement("input");if(checkbox.type="checkbox",this.table.modExists("selectRow",!0))if(checkbox.addEventListener("click",function(e){e.stopPropagation()}),"function"==typeof cell.getRow){var row=cell.getRow();checkbox.addEventListener("change",function(e){row.toggleSelect()}),checkbox.checked=row.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(row,checkbox)}else checkbox.addEventListener("change",function(e){_this37.table.modules.selectRow.selectedRows.length?_this37.table.deselectRow():_this37.table.selectRow()}),this.table.modules.selectRow.registerHeaderSelectCheckbox(checkbox);return checkbox}},Tabulator.prototype.registerModule("format",Format);var FrozenColumns=function(table){this.table=table,this.leftColumns=[],this.rightColumns=[],this.leftMargin=0,this.rightMargin=0,this.rightPadding=0,this.initializationMode="left",this.active=!1,this.scrollEndTimer=!1};FrozenColumns.prototype.reset=function(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.leftMargin=0,this.rightMargin=0,this.rightMargin=0,this.active=!1,this.table.columnManager.headersElement.style.marginLeft=0,this.table.columnManager.element.style.paddingRight=0},FrozenColumns.prototype.initializeColumn=function(column){var config={margin:0,edge:!1};column.definition.frozen?column.parent.isGroup?console.warn("Frozen Column Error - Grouped columns cannot be frozen"):column.isGroup?console.warn("Frozen Column Error - Column Groups cannot be frozen"):(config.position=this.initializationMode,"left"==this.initializationMode?this.leftColumns.push(column):this.rightColumns.unshift(column),this.active=!0,column.modules.frozen=config):this.initializationMode="right"},FrozenColumns.prototype.scrollHorizontal=function(){var rows,_this38=this;this.active&&(clearTimeout(this.scrollEndTimer),this.scrollEndTimer=setTimeout(function(){_this38.layout()},100),rows=this.table.rowManager.getVisibleRows(),this.calcMargins(),this.layoutColumnPosition(),this.layoutCalcRows(),rows.forEach(function(row){"row"===row.type&&_this38.layoutRow(row)}),this.table.rowManager.tableElement.style.marginRight=this.rightMargin)},FrozenColumns.prototype.calcMargins=function(){this.leftMargin=this._calcSpace(this.leftColumns,this.leftColumns.length)+"px",this.table.columnManager.headersElement.style.marginLeft=this.leftMargin,this.rightMargin=this._calcSpace(this.rightColumns,this.rightColumns.length)+"px",this.table.columnManager.element.style.paddingRight=this.rightMargin,this.rightPadding=this.table.rowManager.element.clientWidth+this.table.columnManager.scrollLeft},FrozenColumns.prototype.layoutCalcRows=function(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow))},FrozenColumns.prototype.layoutColumnPosition=function(allCells){var _this39=this;this.leftColumns.forEach(function(column,i){column.modules.frozen.margin=_this39._calcSpace(_this39.leftColumns,i)+_this39.table.columnManager.scrollLeft+"px",i==_this39.leftColumns.length-1?column.modules.frozen.edge=!0:column.modules.frozen.edge=!1,_this39.layoutElement(column.getElement(),column),allCells&&column.cells.forEach(function(cell){_this39.layoutElement(cell.getElement(),column)})}),this.rightColumns.forEach(function(column,i){column.modules.frozen.margin=_this39.rightPadding-_this39._calcSpace(_this39.rightColumns,i+1)+"px",i==_this39.rightColumns.length-1?column.modules.frozen.edge=!0:column.modules.frozen.edge=!1,_this39.layoutElement(column.getElement(),column),allCells&&column.cells.forEach(function(cell){_this39.layoutElement(cell.getElement(),column)})})},FrozenColumns.prototype.layout=function(){var self=this;self.active&&(this.calcMargins(),self.table.rowManager.getDisplayRows().forEach(function(row){"row"===row.type&&self.layoutRow(row)}),this.layoutCalcRows(),this.layoutColumnPosition(!0),this.table.rowManager.tableElement.style.marginRight=this.rightMargin)},FrozenColumns.prototype.layoutRow=function(row){var _this40=this;row.getElement().style.paddingLeft=this.leftMargin,this.leftColumns.forEach(function(column){var cell=row.getCell(column);cell&&_this40.layoutElement(cell.getElement(),column)}),this.rightColumns.forEach(function(column){var cell=row.getCell(column);cell&&_this40.layoutElement(cell.getElement(),column)})},FrozenColumns.prototype.layoutElement=function(element,column){column.modules.frozen&&(element.style.position="absolute",element.style.left=column.modules.frozen.margin,element.classList.add("tabulator-frozen"),column.modules.frozen.edge&&element.classList.add("tabulator-frozen-"+column.modules.frozen.position))},FrozenColumns.prototype._calcSpace=function(columns,index){for(var width=0,i=0;i<index;i++)columns[i].visible&&(width+=columns[i].getWidth());return width},Tabulator.prototype.registerModule("frozenColumns",FrozenColumns);var FrozenRows=function(table){this.table=table,this.topElement=document.createElement("div"),this.rows=[],this.displayIndex=0};FrozenRows.prototype.initialize=function(){this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling)},FrozenRows.prototype.setDisplayIndex=function(index){this.displayIndex=index},FrozenRows.prototype.getDisplayIndex=function(){return this.displayIndex},FrozenRows.prototype.isFrozen=function(){return!!this.rows.length},FrozenRows.prototype.getRows=function(rows){var output=rows.slice(0);return this.rows.forEach(function(row){var index=output.indexOf(row);-1<index&&output.splice(index,1)}),output},FrozenRows.prototype.freezeRow=function(row){row.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(row.modules.frozen=!0,this.topElement.appendChild(row.getElement()),row.initialize(),row.normalizeHeight(),this.table.rowManager.adjustTableSize(),this.rows.push(row),this.table.rowManager.refreshActiveData("display"),this.styleRows())},FrozenRows.prototype.unfreezeRow=function(row){var index=this.rows.indexOf(row);if(row.modules.frozen){row.modules.frozen=!1;var rowEl=row.getElement();rowEl.parentNode.removeChild(rowEl),this.table.rowManager.adjustTableSize(),this.rows.splice(index,1),this.table.rowManager.refreshActiveData("display"),this.rows.length&&this.styleRows()}else console.warn("Freeze Error - Row is already unfrozen")},FrozenRows.prototype.styleRows=function(row){var self=this;this.rows.forEach(function(row,i){self.table.rowManager.styleRow(row,i)})},Tabulator.prototype.registerModule("frozenRows",FrozenRows);var GroupComponent=function(group){this._group=group,this.type="GroupComponent"};GroupComponent.prototype.getKey=function(){return this._group.key},GroupComponent.prototype.getField=function(){return this._group.field},GroupComponent.prototype.getElement=function(){return this._group.element},GroupComponent.prototype.getRows=function(){return this._group.getRows(!0)},GroupComponent.prototype.getSubGroups=function(){return this._group.getSubGroups(!0)},GroupComponent.prototype.getParentGroup=function(){return!!this._group.parent&&this._group.parent.getComponent()},GroupComponent.prototype.getVisibility=function(){return this._group.visible},GroupComponent.prototype.show=function(){this._group.show()},GroupComponent.prototype.hide=function(){this._group.hide()},GroupComponent.prototype.toggle=function(){this._group.toggleVisibility()},GroupComponent.prototype._getSelf=function(){return this._group},GroupComponent.prototype.getTable=function(){return this._group.groupManager.table};var Group=function(groupManager,parent,level,key,field,generator,oldGroup){this.groupManager=groupManager,this.parent=parent,this.key=key,this.level=level,this.field=field,this.hasSubGroups=level<groupManager.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=oldGroup,this.rows=[],this.groups=[],this.groupList=[],this.generator=generator,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=oldGroup?oldGroup.visible:void 0!==groupManager.startOpen[level]?groupManager.startOpen[level]:groupManager.startOpen[0],this.createElements(),this.addBindings(),this.createValueGroups()};Group.prototype.wipe=function(){this.groupList.length?this.groupList.forEach(function(group){group.wipe()}):(this.element=!1,this.arrowElement=!1,this.elementContents=!1)},Group.prototype.createElements=function(){this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-arrow"),!1!==this.groupManager.table.options.movableRows&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)},Group.prototype.createValueGroups=function(){var _this41=this,level=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[level]&&this.groupManager.allowedValues[level].forEach(function(value){_this41._createGroup(value,level)})},Group.prototype.addBindings=function(){var dblTap,tapHold,tap,self=this;self.groupManager.table.options.groupClick&&self.element.addEventListener("click",function(e){self.groupManager.table.options.groupClick(e,self.getComponent())}),self.groupManager.table.options.groupDblClick&&self.element.addEventListener("dblclick",function(e){self.groupManager.table.options.groupDblClick(e,self.getComponent())}),self.groupManager.table.options.groupContext&&self.element.addEventListener("contextmenu",function(e){self.groupManager.table.options.groupContext(e,self.getComponent())}),self.groupManager.table.options.groupTap&&(tap=!1,self.element.addEventListener("touchstart",function(e){tap=!0},{passive:!0}),self.element.addEventListener("touchend",function(e){tap&&self.groupManager.table.options.groupTap(e,self.getComponent()),tap=!1})),self.groupManager.table.options.groupDblTap&&(dblTap=null,self.element.addEventListener("touchend",function(e){dblTap?(clearTimeout(dblTap),dblTap=null,self.groupManager.table.options.groupDblTap(e,self.getComponent())):dblTap=setTimeout(function(){clearTimeout(dblTap),dblTap=null},300)})),self.groupManager.table.options.groupTapHold&&(tapHold=null,self.element.addEventListener("touchstart",function(e){clearTimeout(tapHold),tapHold=setTimeout(function(){clearTimeout(tapHold),tapHold=null,tap=!1,self.groupManager.table.options.groupTapHold(e,self.getComponent())},1e3)},{passive:!0}),self.element.addEventListener("touchend",function(e){clearTimeout(tapHold),tapHold=null})),self.groupManager.table.options.groupToggleElement&&("arrow"==self.groupManager.table.options.groupToggleElement?self.arrowElement:self.element).addEventListener("click",function(e){e.stopPropagation(),e.stopImmediatePropagation(),self.toggleVisibility()})},Group.prototype._createGroup=function(groupID,level){var groupKey=level+"_"+groupID,group=new Group(this.groupManager,this,level,groupID,this.groupManager.groupIDLookups[level].field,this.groupManager.headerGenerator[level]||this.groupManager.headerGenerator[0],!!this.old&&this.old.groups[groupKey]);this.groups[groupKey]=group,this.groupList.push(group)},Group.prototype._addRowToGroup=function(row){var level=this.level+1;if(this.hasSubGroups){var groupID=this.groupManager.groupIDLookups[level].func(row.getData()),groupKey=level+"_"+groupID;this.groupManager.allowedValues&&this.groupManager.allowedValues[level]?this.groups[groupKey]&&this.groups[groupKey].addRow(row):(this.groups[groupKey]||this._createGroup(groupID,level),this.groups[groupKey].addRow(row))}},Group.prototype._addRow=function(row){this.rows.push(row),row.modules.group=this},Group.prototype.insertRow=function(row,to,after){var data=this.conformRowData({});row.updateData(data);var toIndex=this.rows.indexOf(to);-1<toIndex?after?this.rows.splice(toIndex+1,0,row):this.rows.splice(toIndex,0,row):after?this.rows.push(row):this.rows.unshift(row),(row.modules.group=this).generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)},Group.prototype.scrollHeader=function(left){this.arrowElement.style.marginLeft=left,this.groupList.forEach(function(child){child.scrollHeader(left)})},Group.prototype.getRowIndex=function(row){},Group.prototype.conformRowData=function(data){return this.field?data[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(data=this.parent.conformRowData(data)),data},Group.prototype.removeRow=function(row){var index=this.rows.indexOf(row),el=row.getElement();-1<index&&this.rows.splice(index,1),this.groupManager.table.options.groupValues||this.rows.length?(el.parentNode&&el.parentNode.removeChild(el),this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)):(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0))},Group.prototype.removeGroup=function(group){var index,groupKey=group.level+"_"+group.key;this.groups[groupKey]&&(delete this.groups[groupKey],-1<(index=this.groupList.indexOf(group))&&this.groupList.splice(index,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))},Group.prototype.getHeadersAndRows=function(noCalc){var output=[];return output.push(this),this._visSet(),this.visible?this.groupList.length?this.groupList.forEach(function(group){output=output.concat(group.getHeadersAndRows(noCalc))}):(!noCalc&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),output.push(this.calcs.top)),output=output.concat(this.rows),!noCalc&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),output.push(this.calcs.bottom))):this.groupList.length||"table"==this.groupManager.table.options.columnCalcs||this.groupManager.table.modExists("columnCalcs")&&(!noCalc&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),output.push(this.calcs.top))),!noCalc&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),output.push(this.calcs.bottom)))),output},Group.prototype.getData=function(visible,transform){var output=[];return this._visSet(),(!visible||visible&&this.visible)&&this.rows.forEach(function(row){output.push(row.getData(transform||"data"))}),output},Group.prototype.getRowCount=function(){var count=0;return this.groupList.length?this.groupList.forEach(function(group){count+=group.getRowCount()}):count=this.rows.length,count},Group.prototype.toggleVisibility=function(){this.visible?this.hide():this.show()},Group.prototype.hide=function(){this.visible=!1,"classic"!=this.groupManager.table.rowManager.getRenderMode()||this.groupManager.table.options.pagination?this.groupManager.updateGroupRows(!0):(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(function(group){group.getHeadersAndRows().forEach(function(row){row.detachElement()})}):this.rows.forEach(function(row){var rowEl=row.getElement();rowEl.parentNode.removeChild(rowEl)}),this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex()),this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth()),this.groupManager.table.options.groupVisibilityChanged.call(this.table,this.getComponent(),!1)},Group.prototype.show=function(){if(this.visible=!0,"classic"!=this.groupManager.table.rowManager.getRenderMode()||this.groupManager.table.options.pagination)this.groupManager.updateGroupRows(!0);else{this.element.classList.add("tabulator-group-visible");var prev=this.getElement();this.groupList.length?this.groupList.forEach(function(group){group.getHeadersAndRows().forEach(function(row){var rowEl=row.getElement();prev.parentNode.insertBefore(rowEl,prev.nextSibling),row.initialize(),prev=rowEl})}):this.rows.forEach(function(row){var rowEl=row.getElement();prev.parentNode.insertBefore(rowEl,prev.nextSibling),row.initialize(),prev=rowEl}),this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex()),this.groupManager.table.rowManager.checkClassicModeGroupHeaderWidth()}this.groupManager.table.options.groupVisibilityChanged.call(this.table,this.getComponent(),!0)},Group.prototype._visSet=function(){var data=[];"function"==typeof this.visible&&(this.rows.forEach(function(row){data.push(row.getData())}),this.visible=this.visible(this.key,this.getRowCount(),data,this.getComponent()))},Group.prototype.getRowGroup=function(row){var match=!1;return this.groupList.length?this.groupList.forEach(function(group){var result=group.getRowGroup(row);result&&(match=result)}):this.rows.find(function(item){return item===row})&&(match=this),match},Group.prototype.getSubGroups=function(component){var output=[];return this.groupList.forEach(function(child){output.push(component?child.getComponent():child)}),output},Group.prototype.getRows=function(compoment){var output=[];return this.rows.forEach(function(row){output.push(compoment?row.getComponent():row)}),output},Group.prototype.generateGroupHeaderContents=function(){var data=[];for(this.rows.forEach(function(row){data.push(row.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),data,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);"string"==typeof this.elementContents?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)},Group.prototype.getElement=function(){this.addBindingsd=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var i=0;i<this.element.childNodes.length;++i)this.element.childNodes[i].parentNode.removeChild(this.element.childNodes[i]);return this.generateGroupHeaderContents(),this.element},Group.prototype.detachElement=function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)},Group.prototype.normalizeHeight=function(){this.setHeight(this.element.clientHeight)},Group.prototype.initialize=function(force){this.initialized&&!force||(this.normalizeHeight(),this.initialized=!0)},Group.prototype.reinitialize=function(){this.initialized=!1,this.height=0,Tabulator.prototype.helpers.elVisible(this.element)&&this.initialize(!0)},Group.prototype.setHeight=function(height){this.height!=height&&(this.height=height,this.outerHeight=this.element.offsetHeight)},Group.prototype.getHeight=function(){return this.outerHeight},Group.prototype.getGroup=function(){return this},Group.prototype.reinitializeHeight=function(){},Group.prototype.calcHeight=function(){},Group.prototype.setCellHeight=function(){},Group.prototype.clearCellHeight=function(){},Group.prototype.getComponent=function(){return new GroupComponent(this)};var GroupRows=function(table){this.table=table,this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayIndex=0};GroupRows.prototype.initialize=function(){var self=this,groupBy=self.table.options.groupBy,startOpen=self.table.options.groupStartOpen,groupHeader=self.table.options.groupHeader;(this.allowedValues=self.table.options.groupValues,Array.isArray(groupBy)&&Array.isArray(groupHeader)&&groupBy.length>groupHeader.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),self.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],self.table.modules.localize.bind("groups|item",function(langValue,lang){self.headerGenerator[0]=function(value,count,data){return(void 0===value?"":value)+"<span>("+count+" "+(1===count?langValue:lang.groups.items)+")</span>"}}),this.groupIDLookups=[],Array.isArray(groupBy)||groupBy)?this.table.modExists("columnCalcs")&&"table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs&&this.table.modules.columnCalcs.removeCalcs():this.table.modExists("columnCalcs")&&"group"!=this.table.options.columnCalcs&&this.table.columnManager.getRealColumns().forEach(function(col){col.definition.topCalc&&self.table.modules.columnCalcs.initializeTopRow(),col.definition.bottomCalc&&self.table.modules.columnCalcs.initializeBottomRow()});Array.isArray(groupBy)||(groupBy=[groupBy]),groupBy.forEach(function(group,i){var lookupFunc,column;lookupFunc="function"==typeof group?group:(column=self.table.columnManager.getColumnByField(group))?function(data){return column.getFieldValue(data)}:function(data){return data[group]},self.groupIDLookups.push({field:"function"!=typeof group&&group,func:lookupFunc,values:!!self.allowedValues&&self.allowedValues[i]})}),startOpen&&(Array.isArray(startOpen)||(startOpen=[startOpen]),startOpen.forEach(function(level){level="function"==typeof level?level:function(){return!0}}),self.startOpen=startOpen),groupHeader&&(self.headerGenerator=Array.isArray(groupHeader)?groupHeader:[groupHeader]),this.initialized=!0},GroupRows.prototype.setDisplayIndex=function(index){this.displayIndex=index},GroupRows.prototype.getDisplayIndex=function(){return this.displayIndex},GroupRows.prototype.getRows=function(rows){return this.groupIDLookups.length?(this.table.options.dataGrouping.call(this.table),this.generateGroups(rows),this.table.options.dataGrouped&&this.table.options.dataGrouped.call(this.table,this.getGroups(!0)),this.updateGroupRows()):rows.slice(0)},GroupRows.prototype.getGroups=function(compoment){var groupComponents=[];return this.groupList.forEach(function(group){groupComponents.push(compoment?group.getComponent():group)}),groupComponents},GroupRows.prototype.wipe=function(){this.groupList.forEach(function(group){group.wipe()})},GroupRows.prototype.pullGroupListData=function(groupList){var self=this,groupListData=[];return groupList.forEach(function(group){var groupHeader={level:0,rowCount:0,headerContent:""},childData=[];group.hasSubGroups?(childData=self.pullGroupListData(group.groupList),groupHeader.level=group.level,groupHeader.rowCount=childData.length-group.groupList.length,groupHeader.headerContent=group.generator(group.key,groupHeader.rowCount,group.rows,group),groupListData.push(groupHeader),groupListData=groupListData.concat(childData)):(groupHeader.level=group.level,groupHeader.headerContent=group.generator(group.key,group.rows.length,group.rows,group),groupHeader.rowCount=group.getRows().length,groupListData.push(groupHeader),group.getRows().forEach(function(row){groupListData.push(row.getData("data"))}))}),groupListData},GroupRows.prototype.getGroupedData=function(){return this.pullGroupListData(this.groupList)},GroupRows.prototype.getRowGroup=function(row){var match=!1;return this.groupList.forEach(function(group){var result=group.getRowGroup(row);result&&(match=result)}),match},GroupRows.prototype.countGroups=function(){return this.groupList.length},GroupRows.prototype.generateGroups=function(rows){var self=this,oldGroups=self.groups;self.groups={},self.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(function(value){self.createGroup(value,0,oldGroups)}),rows.forEach(function(row){self.assignRowToExistingGroup(row,oldGroups)})):rows.forEach(function(row){self.assignRowToGroup(row,oldGroups)})},GroupRows.prototype.createGroup=function(groupID,level,oldGroups){var group,groupKey=level+"_"+groupID;oldGroups=oldGroups||[],group=new Group(this,!1,level,groupID,this.groupIDLookups[0].field,this.headerGenerator[0],oldGroups[groupKey]),this.groups[groupKey]=group,this.groupList.push(group)},GroupRows.prototype.assignRowToGroup=function(row,oldGroups){var groupID=this.groupIDLookups[0].func(row.getData()),groupKey="0_"+groupID;this.groups[groupKey]||this.createGroup(groupID,0,oldGroups),this.groups[groupKey].addRow(row)},GroupRows.prototype.assignRowToExistingGroup=function(row,oldGroups){var groupKey="0_"+this.groupIDLookups[0].func(row.getData());this.groups[groupKey]&&this.groups[groupKey].addRow(row)},GroupRows.prototype.assignRowToGroup=function(row,oldGroups){var groupID=this.groupIDLookups[0].func(row.getData()),newGroupNeeded=!this.groups["0_"+groupID];return newGroupNeeded&&this.createGroup(groupID,0,oldGroups),this.groups["0_"+groupID].addRow(row),!newGroupNeeded},GroupRows.prototype.updateGroupRows=function(force){var output=[];if(this.groupList.forEach(function(group){output=output.concat(group.getHeadersAndRows())}),force){var displayIndex=this.table.rowManager.setDisplayRows(output,this.getDisplayIndex());!0!==displayIndex&&this.setDisplayIndex(displayIndex),this.table.rowManager.refreshActiveData("group",!0,!0)}return output},GroupRows.prototype.scrollHeaders=function(left){left+="px",this.groupList.forEach(function(group){group.scrollHeader(left)})},GroupRows.prototype.removeGroup=function(group){var index,groupKey=group.level+"_"+group.key;this.groups[groupKey]&&(delete this.groups[groupKey],-1<(index=this.groupList.indexOf(group))&&this.groupList.splice(index,1))},Tabulator.prototype.registerModule("groupRows",GroupRows);var History=function(table){this.table=table,this.history=[],this.index=-1};History.prototype.clear=function(){this.history=[],this.index=-1},History.prototype.action=function(type,component,data){this.history=this.history.slice(0,this.index+1),this.history.push({type:type,component:component,data:data}),this.index++},History.prototype.getHistoryUndoSize=function(){return this.index+1},History.prototype.getHistoryRedoSize=function(){return this.history.length-(this.index+1)},History.prototype.undo=function(){if(-1<this.index){var action=this.history[this.index];return this.undoers[action.type].call(this,action),this.index--,this.table.options.historyUndo.call(this.table,action.type,action.component.getComponent(),action.data),!0}return console.warn("History Undo Error - No more history to undo"),!1},History.prototype.redo=function(){if(this.history.length-1>this.index){this.index++;var action=this.history[this.index];return this.redoers[action.type].call(this,action),this.table.options.historyRedo.call(this.table,action.type,action.component.getComponent(),action.data),!0}return console.warn("History Redo Error - No more history to redo"),!1},History.prototype.undoers={cellEdit:function(action){action.component.setValueProcessData(action.data.oldValue)},rowAdd:function(action){action.component.deleteActual()},rowDelete:function(action){var newRow=this.table.rowManager.addRowActual(action.data.data,action.data.pos,action.data.index);this._rebindRow(action.component,newRow)},rowMove:function(action){this.table.rowManager.moveRowActual(action.component,this.table.rowManager.rows[action.data.pos],!1),this.table.rowManager.redraw()}},History.prototype.redoers={cellEdit:function(action){action.component.setValueProcessData(action.data.newValue)},rowAdd:function(action){var newRow=this.table.rowManager.addRowActual(action.data.data,action.data.pos,action.data.index);this._rebindRow(action.component,newRow)},rowDelete:function(action){action.component.deleteActual()},rowMove:function(action){this.table.rowManager.moveRowActual(action.component,this.table.rowManager.rows[action.data.pos],!1),this.table.rowManager.redraw()}},History.prototype._rebindRow=function(oldRow,newRow){this.history.forEach(function(action){if(action.component instanceof Row)action.component===oldRow&&(action.component=newRow);else if(action.component instanceof Cell&&action.component.row===oldRow){var field=action.component.column.getField();field&&(action.component=newRow.getCell(field))}})},Tabulator.prototype.registerModule("history",History);var HtmlTableImport=function(table){this.table=table,this.fieldIndex=[],this.hasIndex=!1};HtmlTableImport.prototype.parseTable=function(){var element=this.table.element,options=this.table.options,headers=(options.columns,element.getElementsByTagName("th")),rows=element.getElementsByTagName("tbody")[0],data=[];this.hasIndex=!1,this.table.options.htmlImporting.call(this.table),rows=rows?rows.getElementsByTagName("tr"):[],this._extractOptions(element,options),headers.length?this._extractHeaders(headers,rows):this._generateBlankHeaders(headers,rows);for(var index=0;index<rows.length;index++){var cells=rows[index].getElementsByTagName("td"),item={};this.hasIndex||(item[options.index]=index);for(var i=0;i<cells.length;i++){var cell=cells[i];void 0!==this.fieldIndex[i]&&(item[this.fieldIndex[i]]=cell.innerHTML)}data.push(item)}var newElement=document.createElement("div"),attributes=element.attributes;for(var i in attributes)"object"==_typeof(attributes[i])&&newElement.setAttribute(attributes[i].name,attributes[i].value);element.parentNode.replaceChild(newElement,element),options.data=data,this.table.options.htmlImported.call(this.table),this.table.element=newElement},HtmlTableImport.prototype._extractOptions=function(element,options,defaultOptions){var attributes=element.attributes,optionsArr=defaultOptions?Object.assign([],defaultOptions):Object.keys(options),optionsList={};for(var index in optionsArr.forEach(function(item){optionsList[item.toLowerCase()]=item}),attributes){var name,attrib=attributes[index];attrib&&"object"==(void 0===attrib?"undefined":_typeof(attrib))&&attrib.name&&0===attrib.name.indexOf("tabulator-")&&(name=attrib.name.replace("tabulator-",""),void 0!==optionsList[name]&&(options[optionsList[name]]=this._attribValue(attrib.value)))}},HtmlTableImport.prototype._attribValue=function(value){return"true"===value||"false"!==value&&value},HtmlTableImport.prototype._findCol=function(title){return this.table.options.columns.find(function(column){return column.title===title})||!1},HtmlTableImport.prototype._extractHeaders=function(headers,rows){for(var index=0;index<headers.length;index++){var width,attributes,header=headers[index],exists=!1,col=this._findCol(header.textContent);for(var i in col?exists=!0:col={title:header.textContent.trim()},col.field||(col.field=header.textContent.trim().toLowerCase().replace(" ","_")),(width=header.getAttribute("width"))&&!col.width&&(col.width=width),attributes=header.attributes,this._extractOptions(header,col,Column.prototype.defaultOptionList),attributes){var attrib=attributes[i];attrib&&"object"==(void 0===attrib?"undefined":_typeof(attrib))&&attrib.name&&0===attrib.name.indexOf("tabulator-")&&(col[attrib.name.replace("tabulator-","")]=this._attribValue(attrib.value))}this.fieldIndex[index]=col.field,col.field==this.table.options.index&&(this.hasIndex=!0),exists||this.table.options.columns.push(col)}},HtmlTableImport.prototype._generateBlankHeaders=function(headers,rows){for(var index=0;index<headers.length;index++){var header=headers[index],col={title:"",field:"col"+index};this.fieldIndex[index]=col.field;var width=header.getAttribute("width");width&&(col.width=width),this.table.options.columns.push(col)}},Tabulator.prototype.registerModule("htmlTableImport",HtmlTableImport);var HtmlTableExport=function(table){this.table=table,this.config={},this.cloneTableStyle=!0,this.colVisProp=""};HtmlTableExport.prototype.genereateTable=function(config,style,visible,colVisProp){this.cloneTableStyle=style,this.config=config||{},this.colVisProp=colVisProp;var headers=this.generateHeaderElements(),body=this.generateBodyElements(visible),table=document.createElement("table");return table.classList.add("tabulator-print-table"),table.appendChild(headers),table.appendChild(body),this.mapElementStyles(this.table.element,table,["border-top","border-left","border-right","border-bottom"]),table},HtmlTableExport.prototype.generateColumnGroupHeaders=function(){var _this42=this,output=[];return(!1!==this.config.columnGroups?this.table.columnManager.columns:this.table.columnManager.columnsByIndex).forEach(function(column){var colData=_this42.processColumnGroup(column);colData&&output.push(colData)}),output},HtmlTableExport.prototype.processColumnGroup=function(column){var _this43=this,subGroups=column.columns,maxDepth=0,groupData={title:column.definition.title,column:column,depth:1};if(subGroups.length){if(groupData.subGroups=[],groupData.width=0,subGroups.forEach(function(subGroup){var subGroupData=_this43.processColumnGroup(subGroup);subGroupData&&(groupData.width+=subGroupData.width,groupData.subGroups.push(subGroupData),subGroupData.depth>maxDepth&&(maxDepth=subGroupData.depth))}),groupData.depth+=maxDepth,!groupData.width)return!1}else{if(!column.field||!this.columnVisCheck(column))return!1;groupData.width=1}return groupData},HtmlTableExport.prototype.groupHeadersToRows=function(columns){var headers=[],headerDepth=0;return columns.forEach(function(column){column.depth>headerDepth&&(headerDepth=column.depth)}),columns.forEach(function(column){!function parseColumnGroup(column,level){var depth=headerDepth-level;void 0===headers[level]&&(headers[level]=[]),column.height=column.subGroups?1:depth-column.depth+1,headers[level].push(column),column.subGroups&&column.subGroups.forEach(function(subGroup){parseColumnGroup(subGroup,level+1)})}(column,0)}),headers},HtmlTableExport.prototype.generateHeaderElements=function(){var _this44=this,headerEl=document.createElement("thead");return this.groupHeadersToRows(this.generateColumnGroupHeaders()).forEach(function(row){var rowEl=document.createElement("tr");_this44.mapElementStyles(_this44.table.columnManager.getHeadersElement(),headerEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),row.forEach(function(column){var cellEl=document.createElement("th");cellEl.colSpan=column.width,cellEl.rowSpan=column.height,cellEl.innerHTML=column.column.definition.title,_this44.cloneTableStyle&&(cellEl.style.boxSizing="border-box"),_this44.mapElementStyles(column.column.getElement(),cellEl,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),_this44.mapElementStyles(column.column.contentElement,cellEl,["padding-top","padding-left","padding-right","padding-bottom"]),column.column.visible?_this44.mapElementStyles(column.column.getElement(),cellEl,["width"]):column.column.definition.width&&(cellEl.style.width=column.column.definition.width+"px"),column.column.parent&&_this44.mapElementStyles(column.column.parent.groupElement,cellEl,["border-top"]),rowEl.appendChild(cellEl)}),headerEl.appendChild(rowEl)}),headerEl},HtmlTableExport.prototype.generateBodyElements=function(visible){var oddRow,evenRow,calcRow,firstRow,firstCell,firstGroup,styleCells,styleRow,_this45=this;this.cloneTableStyle&&window.getComputedStyle&&(oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],firstRow&&(styleCells=firstRow.getElementsByClassName("tabulator-cell"),firstCell=styleCells[0],styleCells[styleCells.length-1]));var bodyEl=document.createElement("tbody"),rows=visible?this.table.rowManager.getVisibleRows(!0):this.table.rowManager.getDisplayRows(),columns=[];return!1!==this.config.columnCalcs&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&rows.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&rows.push(this.table.modules.columnCalcs.botRow)),this.table.columnManager.columnsByIndex.forEach(function(column){_this45.columnVisCheck(column)&&columns.push(column)}),1e3<(rows=rows.filter(function(row){switch(row.type){case"group":return!1!==_this45.config.rowGroups;case"calc":return!1!==_this45.config.columnCalcs}return!0})).length&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),rows.forEach(function(row,i){var rowData=row.getData(),rowEl=document.createElement("tr");switch(rowEl.classList.add("tabulator-print-table-row"),row.type){case"group":var cellEl=document.createElement("td");cellEl.colSpan=columns.length,cellEl.innerHTML=row.key,rowEl.classList.add("tabulator-print-table-group"),_this45.mapElementStyles(firstGroup,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),_this45.mapElementStyles(firstGroup,cellEl,["padding-top","padding-left","padding-right","padding-bottom"]),rowEl.appendChild(cellEl);break;case"calc":rowEl.classList.add("tabulator-print-table-calcs");case"row":columns.forEach(function(column){var cellEl=document.createElement("td"),value=column.getFieldValue(rowData),cellWrapper={getValue:function(){return value},getField:function(){return column.definition.field},getElement:function(){return cellEl},getColumn:function(){return column.getComponent()},getData:function(){return rowData},getRow:function(){return row.getComponent()},getComponent:function(){return cellWrapper},column:column};if(_this45.table.modExists("format"))value=_this45.table.modules.format.formatValue(cellWrapper);else switch(void 0===value?"undefined":_typeof(value)){case"object":value=JSON.stringify(value);break;case"undefined":case"null":value="";break;default:value=value}value instanceof Node?cellEl.appendChild(value):cellEl.innerHTML=value,firstCell&&_this45.mapElementStyles(firstCell,cellEl,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),rowEl.appendChild(cellEl)}),styleRow="calc"==row.type?calcRow:i%2&&evenRow?evenRow:oddRow,_this45.mapElementStyles(styleRow,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"])}bodyEl.appendChild(rowEl)}),bodyEl},HtmlTableExport.prototype.columnVisCheck=function(column){return!1!==column.definition[this.colVisProp]&&(column.visible||!column.visible&&column.definition[this.colVisProp])},HtmlTableExport.prototype.getHtml=function(visible,style,config){var holder=document.createElement("div");return holder.appendChild(this.genereateTable(config||this.table.options.htmlOutputConfig,style,visible,"htmlOutput")),holder.innerHTML},HtmlTableExport.prototype.mapElementStyles=function(from,to,props){if(this.cloneTableStyle&&from&&to){var lookup={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var fromStyle=window.getComputedStyle(from);props.forEach(function(prop){to.style[lookup[prop]]=fromStyle.getPropertyValue(prop)})}}},Tabulator.prototype.registerModule("htmlTableExport",HtmlTableExport);var Keybindings=function(table){this.table=table,this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1};Keybindings.prototype.initialize=function(){var bindings=this.table.options.keybindings,mergedBindings={};if(this.watchKeys={},!(this.pressedKeys=[])!==bindings){for(var key in this.bindings)mergedBindings[key]=this.bindings[key];if(Object.keys(bindings).length)for(var _key in bindings)mergedBindings[_key]=bindings[_key];this.mapBindings(mergedBindings),this.bindEvents()}},Keybindings.prototype.mapBindings=function(bindings){var _this46=this,self=this,_loop2=function(key){_this46.actions[key]?bindings[key]&&("object"!==_typeof(bindings[key])&&(bindings[key]=[bindings[key]]),bindings[key].forEach(function(binding){self.mapBinding(key,binding)})):console.warn("Key Binding Error - no such action:",key)};for(var key in bindings)_loop2(key)},Keybindings.prototype.mapBinding=function(action,symbolsList){var self=this,binding={action:this.actions[action],keys:[],ctrl:!1,shift:!1};symbolsList.toString().toLowerCase().split(" ").join("").split("+").forEach(function(symbol){switch(symbol){case"ctrl":binding.ctrl=!0;break;case"shift":binding.shift=!0;break;default:symbol=parseInt(symbol),binding.keys.push(symbol),self.watchKeys[symbol]||(self.watchKeys[symbol]=[]),self.watchKeys[symbol].push(binding)}})},Keybindings.prototype.bindEvents=function(){var self=this;this.keyupBinding=function(e){var code=e.keyCode,bindings=self.watchKeys[code];bindings&&(self.pressedKeys.push(code),bindings.forEach(function(binding){self.checkBinding(e,binding)}))},this.keydownBinding=function(e){var code=e.keyCode;if(self.watchKeys[code]){var index=self.pressedKeys.indexOf(code);-1<index&&self.pressedKeys.splice(index,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)},Keybindings.prototype.clearBindings=function(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)},Keybindings.prototype.checkBinding=function(e,binding){var self=this,match=!0;return e.ctrlKey==binding.ctrl&&e.shiftKey==binding.shift&&(binding.keys.forEach(function(key){-1==self.pressedKeys.indexOf(key)&&(match=!1)}),match&&binding.action.call(self,e),!0)},Keybindings.prototype.bindings={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:"ctrl + 90",redo:"ctrl + 89",copyToClipboard:"ctrl + 67"},Keybindings.prototype.actions={keyBlock:function(e){e.stopPropagation(),e.preventDefault()},scrollPageUp:function(e){var rowManager=this.table.rowManager,newPos=rowManager.scrollTop-rowManager.height;rowManager.element.scrollHeight;e.preventDefault(),rowManager.displayRowsCount&&(0<=newPos?rowManager.element.scrollTop=newPos:rowManager.scrollToRow(rowManager.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(e){var rowManager=this.table.rowManager,newPos=rowManager.scrollTop+rowManager.height,scrollMax=rowManager.element.scrollHeight;e.preventDefault(),rowManager.displayRowsCount&&(newPos<=scrollMax?rowManager.element.scrollTop=newPos:rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(e){var rowManager=this.table.rowManager;e.preventDefault(),rowManager.displayRowsCount&&rowManager.scrollToRow(rowManager.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(e){var rowManager=this.table.rowManager;e.preventDefault(),rowManager.displayRowsCount&&rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount-1]),this.table.element.focus()},navPrev:function(e){var cell=!1;this.table.modExists("edit")&&(cell=this.table.modules.edit.currentCell)&&(e.preventDefault(),cell.nav().prev())},navNext:function(e){var cell=!1,newRow=this.table.options.tabEndNewRow;this.table.modExists("edit")&&(cell=this.table.modules.edit.currentCell)&&(e.preventDefault(),cell.nav().next()||newRow&&(newRow=!0===newRow?this.table.addRow({}):"function"==typeof newRow?this.table.addRow(newRow(cell.row.getComponent())):this.table.addRow(newRow)).then(function(){cell.nav().next()}))},navLeft:function(e){var cell=!1;this.table.modExists("edit")&&(cell=this.table.modules.edit.currentCell)&&(e.preventDefault(),cell.nav().left())},navRight:function(e){var cell=!1;this.table.modExists("edit")&&(cell=this.table.modules.edit.currentCell)&&(e.preventDefault(),cell.nav().right())},navUp:function(e){var cell=!1;this.table.modExists("edit")&&(cell=this.table.modules.edit.currentCell)&&(e.preventDefault(),cell.nav().up())},navDown:function(e){var cell=!1;this.table.modExists("edit")&&(cell=this.table.modules.edit.currentCell)&&(e.preventDefault(),cell.nav().down())},undo:function(e){this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(this.table.modules.edit.currentCell||(e.preventDefault(),this.table.modules.history.undo()))},redo:function(e){this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(this.table.modules.edit.currentCell||(e.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(e){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(this.table.options.selectable&&"highlight"!=this.table.options.selectable?"selected":"active",null,null,null,!0)}},Tabulator.prototype.registerModule("keybindings",Keybindings);var MoveColumns=function(table){this.table=table,this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this)};MoveColumns.prototype.createPlaceholderElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-col"),el.classList.add("tabulator-col-placeholder"),el},MoveColumns.prototype.initializeColumn=function(column){var colEl,self=this,config={};column.modules.frozen||(colEl=column.getElement(),config.mousemove=function(e){column.parent===self.moving.parent&&((self.touchMove?e.touches[0].pageX:e.pageX)-Tabulator.prototype.helpers.elOffset(colEl).left+self.table.columnManager.element.scrollLeft>column.getWidth()/2?self.toCol===column&&self.toColAfter||(colEl.parentNode.insertBefore(self.placeholderElement,colEl.nextSibling),self.moveColumn(column,!0)):self.toCol===column&&!self.toColAfter||(colEl.parentNode.insertBefore(self.placeholderElement,colEl),self.moveColumn(column,!1)))}.bind(self),colEl.addEventListener("mousedown",function(e){self.touchMove=!1,1===e.which&&(self.checkTimeout=setTimeout(function(){self.startMove(e,column)},self.checkPeriod))}),colEl.addEventListener("mouseup",function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)}),self.bindTouchEvents(column)),column.modules.moveColumn=config},MoveColumns.prototype.bindTouchEvents=function(column){var nextCol,prevCol,nextColWidth,prevColWidth,nextColWidthLast,prevColWidthLast,self=this,colEl=column.getElement(),startXMove=!1;colEl.addEventListener("touchstart",function(e){self.checkTimeout=setTimeout(function(){self.touchMove=!0,nextCol=column.nextColumn(),nextColWidth=nextCol?nextCol.getWidth()/2:0,prevCol=column.prevColumn(),prevColWidth=prevCol?prevCol.getWidth()/2:0,prevColWidthLast=nextColWidthLast=0,startXMove=!1,self.startMove(e,column)},self.checkPeriod)},{passive:!0}),colEl.addEventListener("touchmove",function(e){var diff,moveToCol;self.moving&&(self.moveHover(e),startXMove=startXMove||e.touches[0].pageX,0<(diff=e.touches[0].pageX-startXMove)?nextCol&&nextColWidth<diff-nextColWidthLast&&(moveToCol=nextCol)!==column&&(startXMove=e.touches[0].pageX,moveToCol.getElement().parentNode.insertBefore(self.placeholderElement,moveToCol.getElement().nextSibling),self.moveColumn(moveToCol,!0)):prevCol&&prevColWidth<-diff-prevColWidthLast&&(moveToCol=prevCol)!==column&&(startXMove=e.touches[0].pageX,moveToCol.getElement().parentNode.insertBefore(self.placeholderElement,moveToCol.getElement()),self.moveColumn(moveToCol,!1)),moveToCol&&(nextCol=moveToCol.nextColumn(),nextColWidthLast=nextColWidth,nextColWidth=nextCol?nextCol.getWidth()/2:0,prevCol=moveToCol.prevColumn(),prevColWidthLast=prevColWidth,prevColWidth=prevCol?prevCol.getWidth()/2:0))},{passive:!0}),colEl.addEventListener("touchend",function(e){self.checkTimeout&&clearTimeout(self.checkTimeout),self.moving&&self.endMove(e)})},MoveColumns.prototype.startMove=function(e,column){var element=column.getElement();this.moving=column,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Tabulator.prototype.helpers.elOffset(element).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=column.getWidth()+"px",this.placeholderElement.style.height=column.getHeight()+"px",element.parentNode.insertBefore(this.placeholderElement,element),element.parentNode.removeChild(element),this.hoverElement=element.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.table.columnManager.getElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom="0",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)},MoveColumns.prototype._bindMouseMove=function(){this.table.columnManager.columnsByIndex.forEach(function(column){column.modules.moveColumn.mousemove&&column.getElement().addEventListener("mousemove",column.modules.moveColumn.mousemove)})},MoveColumns.prototype._unbindMouseMove=function(){this.table.columnManager.columnsByIndex.forEach(function(column){column.modules.moveColumn.mousemove&&column.getElement().removeEventListener("mousemove",column.modules.moveColumn.mousemove)})},MoveColumns.prototype.moveColumn=function(column,after){var movingCells=this.moving.getCells();this.toCol=column,(this.toColAfter=after)?column.getCells().forEach(function(cell,i){var cellEl=cell.getElement();cellEl.parentNode.insertBefore(movingCells[i].getElement(),cellEl.nextSibling)}):column.getCells().forEach(function(cell,i){var cellEl=cell.getElement();cellEl.parentNode.insertBefore(movingCells[i].getElement(),cellEl)})},MoveColumns.prototype.endMove=function(e){1!==e.which&&!this.touchMove||(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))},MoveColumns.prototype.moveHover=function(e){var scrollPos,self=this,columnHolder=self.table.columnManager.getElement(),scrollLeft=columnHolder.scrollLeft,xPos=(self.touchMove?e.touches[0].pageX:e.pageX)-Tabulator.prototype.helpers.elOffset(columnHolder).left+scrollLeft;self.hoverElement.style.left=xPos-self.startX+"px",xPos-scrollLeft<self.autoScrollMargin&&(self.autoScrollTimeout||(self.autoScrollTimeout=setTimeout(function(){scrollPos=Math.max(0,scrollLeft-5),self.table.rowManager.getElement().scrollLeft=scrollPos,self.autoScrollTimeout=!1},1))),scrollLeft+columnHolder.clientWidth-xPos<self.autoScrollMargin&&(self.autoScrollTimeout||(self.autoScrollTimeout=setTimeout(function(){scrollPos=Math.min(columnHolder.clientWidth,scrollLeft+5),self.table.rowManager.getElement().scrollLeft=scrollPos,self.autoScrollTimeout=!1},1)))},Tabulator.prototype.registerModule("moveColumn",MoveColumns);var MoveRows=function(table){this.table=table,this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connections=[],this.connectedTable=!1,this.connectedRow=!1};MoveRows.prototype.createPlaceholderElement=function(){var el=document.createElement("div");return el.classList.add("tabulator-row"),el.classList.add("tabulator-row-placeholder"),el},MoveRows.prototype.initialize=function(handle){this.connection=this.table.options.movableRowsConnectedTables},MoveRows.prototype.setHandle=function(handle){this.hasHandle=handle},MoveRows.prototype.initializeGroupHeader=function(group){var self=this,config={};config.mouseup=function(e){self.tableRowDrop(e,row)}.bind(self),config.mousemove=function(e){var rowEl;e.pageY-Tabulator.prototype.helpers.elOffset(group.element).top+self.table.rowManager.element.scrollTop>group.getHeight()/2?self.toRow===group&&self.toRowAfter||((rowEl=group.getElement()).parentNode.insertBefore(self.placeholderElement,rowEl.nextSibling),self.moveRow(group,!0)):(self.toRow!==group||self.toRowAfter)&&(rowEl=group.getElement()).previousSibling&&(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl),self.moveRow(group,!1))}.bind(self),group.modules.moveRow=config},MoveRows.prototype.initializeRow=function(row){var rowEl,self=this,config={};config.mouseup=function(e){self.tableRowDrop(e,row)}.bind(self),config.mousemove=function(e){var rowEl;e.pageY-Tabulator.prototype.helpers.elOffset(row.element).top+self.table.rowManager.element.scrollTop>row.getHeight()/2?self.toRow===row&&self.toRowAfter||((rowEl=row.getElement()).parentNode.insertBefore(self.placeholderElement,rowEl.nextSibling),self.moveRow(row,!0)):self.toRow===row&&!self.toRowAfter||((rowEl=row.getElement()).parentNode.insertBefore(self.placeholderElement,rowEl),self.moveRow(row,!1))}.bind(self),this.hasHandle||((rowEl=row.getElement()).addEventListener("mousedown",function(e){1===e.which&&(self.checkTimeout=setTimeout(function(){self.startMove(e,row)},self.checkPeriod))}),rowEl.addEventListener("mouseup",function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)}),this.bindTouchEvents(row,row.getElement())),row.modules.moveRow=config},MoveRows.prototype.initializeCell=function(cell){var self=this,cellEl=cell.getElement();cellEl.addEventListener("mousedown",function(e){1===e.which&&(self.checkTimeout=setTimeout(function(){self.startMove(e,cell.row)},self.checkPeriod))}),cellEl.addEventListener("mouseup",function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)}),this.bindTouchEvents(cell.row,cell.getElement())},MoveRows.prototype.bindTouchEvents=function(row,element){var nextRow,prevRow,nextRowHeight,prevRowHeight,nextRowHeightLast,prevRowHeightLast,self=this,startYMove=!1;element.addEventListener("touchstart",function(e){self.checkTimeout=setTimeout(function(){self.touchMove=!0,nextRow=row.nextRow(),nextRowHeight=nextRow?nextRow.getHeight()/2:0,prevRow=row.prevRow(),prevRowHeight=prevRow?prevRow.getHeight()/2:0,prevRowHeightLast=nextRowHeightLast=0,startYMove=!1,self.startMove(e,row)},self.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,element.addEventListener("touchmove",function(e){var diff,moveToRow;self.moving&&(e.preventDefault(),self.moveHover(e),startYMove=startYMove||e.touches[0].pageY,0<(diff=e.touches[0].pageY-startYMove)?nextRow&&nextRowHeight<diff-nextRowHeightLast&&(moveToRow=nextRow)!==row&&(startYMove=e.touches[0].pageY,moveToRow.getElement().parentNode.insertBefore(self.placeholderElement,moveToRow.getElement().nextSibling),self.moveRow(moveToRow,!0)):prevRow&&prevRowHeight<-diff-prevRowHeightLast&&(moveToRow=prevRow)!==row&&(startYMove=e.touches[0].pageY,moveToRow.getElement().parentNode.insertBefore(self.placeholderElement,moveToRow.getElement()),self.moveRow(moveToRow,!1)),moveToRow&&(nextRow=moveToRow.nextRow(),nextRowHeightLast=nextRowHeight,nextRowHeight=nextRow?nextRow.getHeight()/2:0,prevRow=moveToRow.prevRow(),prevRowHeightLast=prevRowHeight,prevRowHeight=prevRow?prevRow.getHeight()/2:0))}),element.addEventListener("touchend",function(e){self.checkTimeout&&clearTimeout(self.checkTimeout),self.moving&&(self.endMove(e),self.touchMove=!1)})},MoveRows.prototype._bindMouseMove=function(){this.table.rowManager.getDisplayRows().forEach(function(row){"row"!==row.type&&"group"!==row.type||!row.modules.moveRow.mousemove||row.getElement().addEventListener("mousemove",row.modules.moveRow.mousemove)})},MoveRows.prototype._unbindMouseMove=function(){this.table.rowManager.getDisplayRows().forEach(function(row){"row"!==row.type&&"group"!==row.type||!row.modules.moveRow.mousemove||row.getElement().removeEventListener("mousemove",row.modules.moveRow.mousemove)})},MoveRows.prototype.startMove=function(e,row){var element=row.getElement();this.setStartPosition(e,row),this.moving=row,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=row.getWidth()+"px",this.placeholderElement.style.height=row.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(row)):(element.parentNode.insertBefore(this.placeholderElement,element),element.parentNode.removeChild(element)),this.hoverElement=element.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.moveHover(e)},MoveRows.prototype.setStartPosition=function(e,row){var element,position,pageX=this.touchMove?e.touches[0].pageX:e.pageX,pageY=this.touchMove?e.touches[0].pageY:e.pageY;element=row.getElement(),this.connection?(position=element.getBoundingClientRect(),this.startX=position.left-pageX+window.pageXOffset,this.startY=position.top-pageY+window.pageYOffset):this.startY=pageY-element.getBoundingClientRect().top},MoveRows.prototype.endMove=function(e){e&&1!==e.which&&!this.touchMove||(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow&&this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))},MoveRows.prototype.moveRow=function(row,after){this.toRow=row,this.toRowAfter=after},MoveRows.prototype.moveHover=function(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)},MoveRows.prototype.moveHoverTable=function(e){var rowHolder=this.table.rowManager.getElement(),scrollTop=rowHolder.scrollTop,yPos=(this.touchMove?e.touches[0].pageY:e.pageY)-rowHolder.getBoundingClientRect().top+scrollTop;this.hoverElement.style.top=yPos-this.startY+"px"},MoveRows.prototype.moveHoverConnections=function(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"},MoveRows.prototype.connectToTables=function(row){var connections=this.table.modules.comms.getConnections(this.connection);this.table.options.movableRowsSendingStart.call(this.table,connections),this.table.modules.comms.send(this.connection,"moveRow","connect",{row:row})},MoveRows.prototype.disconnectFromTables=function(){var connections=this.table.modules.comms.getConnections(this.connection);this.table.options.movableRowsSendingStop.call(this.table,connections),this.table.modules.comms.send(this.connection,"moveRow","disconnect")},MoveRows.prototype.connect=function(table,row){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=table,this.connectedRow=row,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(function(row){"row"===row.type&&row.modules.moveRow&&row.modules.moveRow.mouseup&&row.getElement().addEventListener("mouseup",row.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.table.options.movableRowsReceivingStart.call(this.table,row,table),!0)},MoveRows.prototype.disconnect=function(table){table===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(function(row){"row"===row.type&&row.modules.moveRow&&row.modules.moveRow.mouseup&&row.getElement().removeEventListener("mouseup",row.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.table.options.movableRowsReceivingStop.call(this.table,table)):console.warn("Move Row Error - trying to disconnect from non connected table")},MoveRows.prototype.dropComplete=function(table,row,success){var sender=!1;if(success){switch(_typeof(this.table.options.movableRowsSender)){case"string":sender=this.senders[this.table.options.movableRowsSender];break;case"function":sender=this.table.options.movableRowsSender}sender?sender.call(this,this.moving.getComponent(),row?row.getComponent():void 0,table):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.table.options.movableRowsSent.call(this.table,this.moving.getComponent(),row?row.getComponent():void 0,table)}else this.table.options.movableRowsSentFailed.call(this.table,this.moving.getComponent(),row?row.getComponent():void 0,table);this.endMove()},MoveRows.prototype.tableRowDrop=function(e,row){var receiver=!1,success=!1;switch(e.stopImmediatePropagation(),_typeof(this.table.options.movableRowsReceiver)){case"string":receiver=this.receivers[this.table.options.movableRowsReceiver];break;case"function":receiver=this.table.options.movableRowsReceiver}receiver?success=receiver.call(this,this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),success?this.table.options.movableRowsReceived.call(this.table,this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable):this.table.options.movableRowsReceivedFailed.call(this.table,this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable),this.table.modules.comms.send(this.connectedTable,"moveRow","dropcomplete",{row:row,success:success})},MoveRows.prototype.receivers={insert:function(fromRow,toRow,fromTable){return this.table.addRow(fromRow.getData(),void 0,toRow),!0},add:function(fromRow,toRow,fromTable){return this.table.addRow(fromRow.getData()),!0},update:function(fromRow,toRow,fromTable){return!!toRow&&(toRow.update(fromRow.getData()),!0)},replace:function(fromRow,toRow,fromTable){return!!toRow&&(this.table.addRow(fromRow.getData(),void 0,toRow),toRow.delete(),!0)}},MoveRows.prototype.senders={delete:function(fromRow,toRow,toTable){fromRow.delete()}},MoveRows.prototype.commsReceived=function(table,action,data){switch(action){case"connect":return this.connect(table,data.row);case"disconnect":return this.disconnect(table);case"dropcomplete":return this.dropComplete(table,data.row,data.success)}},Tabulator.prototype.registerModule("moveRow",MoveRows);var Mutator=function(table){this.table=table,this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0};Mutator.prototype.initializeColumn=function(column){var self=this,match=!1,config={};this.allowedTypes.forEach(function(type){var mutator,key="mutator"+(type.charAt(0).toUpperCase()+type.slice(1));column.definition[key]&&(mutator=self.lookupMutator(column.definition[key]))&&(match=!0,config[key]={mutator:mutator,params:column.definition[key+"Params"]||{}})}),match&&(column.modules.mutate=config)},Mutator.prototype.lookupMutator=function(value){var mutator=!1;switch(void 0===value?"undefined":_typeof(value)){case"string":this.mutators[value]?mutator=this.mutators[value]:console.warn("Mutator Error - No such mutator found, ignoring: ",value);break;case"function":mutator=value}return mutator},Mutator.prototype.transformRow=function(data,type,update){var value,key="mutator"+(type.charAt(0).toUpperCase()+type.slice(1));return this.enabled&&this.table.columnManager.traverse(function(column){var mutator,params,component;column.modules.mutate&&(mutator=column.modules.mutate[key]||column.modules.mutate.mutator||!1)&&(value=column.getFieldValue(data),(!update||update&&void 0!==value)&&(component=column.getComponent(),params="function"==typeof mutator.params?mutator.params(value,data,type,component):mutator.params,column.setFieldValue(data,mutator.mutator(value,data,type,params,component))))}),data},Mutator.prototype.transformCell=function(cell,value){var mutator=cell.column.modules.mutate.mutatorEdit||cell.column.modules.mutate.mutator||!1;return mutator?mutator.mutator(value,cell.row.getData(),"edit",mutator.params,cell.getComponent()):value},Mutator.prototype.enable=function(){this.enabled=!0},Mutator.prototype.disable=function(){this.enabled=!1},Mutator.prototype.mutators={},Tabulator.prototype.registerModule("mutator",Mutator);var Page=function(table){this.table=table,this.mode="local",this.progressiveLoad=!1,this.size=0,this.page=1,this.count=5,this.max=1,this.displayIndex=0,this.pageSizes=[],this.createElements()};Page.prototype.createElements=function(){var button;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),(button=document.createElement("button")).classList.add("tabulator-page"),button.setAttribute("type","button"),button.setAttribute("role","button"),button.setAttribute("aria-label",""),button.setAttribute("title",""),this.firstBut=button.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=button.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=button.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=button.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))},Page.prototype.generatePageSizeSelectList=function(){var _this47=this,pageSizes=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))pageSizes=this.table.options.paginationSizeSelector,this.pageSizes=pageSizes,-1==this.pageSizes.indexOf(this.size)&&pageSizes.unshift(this.size);else if(-1==this.pageSizes.indexOf(this.size)){pageSizes=[];for(var i=1;i<5;i++)pageSizes.push(this.size*i);this.pageSizes=pageSizes}else pageSizes=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);pageSizes.forEach(function(item){var itemEl=document.createElement("option");itemEl.value=item,itemEl.innerHTML=item,_this47.pageSizeSelect.appendChild(itemEl)}),this.pageSizeSelect.value=this.size}},Page.prototype.initialize=function(hidden){var pageSelectLabel,self=this;for(var key in self.table.options.paginationDataSent)self.paginationDataSentNames[key]=self.table.options.paginationDataSent[key];for(var _key2 in self.table.options.paginationDataReceived)self.paginationDataReceivedNames[_key2]=self.table.options.paginationDataReceived[_key2];self.table.modules.localize.bind("pagination|first",function(value){self.firstBut.innerHTML=value}),self.table.modules.localize.bind("pagination|first_title",function(value){self.firstBut.setAttribute("aria-label",value),self.firstBut.setAttribute("title",value)}),self.table.modules.localize.bind("pagination|prev",function(value){self.prevBut.innerHTML=value}),self.table.modules.localize.bind("pagination|prev_title",function(value){self.prevBut.setAttribute("aria-label",value),self.prevBut.setAttribute("title",value)}),self.table.modules.localize.bind("pagination|next",function(value){self.nextBut.innerHTML=value}),self.table.modules.localize.bind("pagination|next_title",function(value){self.nextBut.setAttribute("aria-label",value),self.nextBut.setAttribute("title",value)}),self.table.modules.localize.bind("pagination|last",function(value){self.lastBut.innerHTML=value}),self.table.modules.localize.bind("pagination|last_title",function(value){self.lastBut.setAttribute("aria-label",value),self.lastBut.setAttribute("title",value)}),self.firstBut.addEventListener("click",function(){self.setPage(1)}),self.prevBut.addEventListener("click",function(){self.previousPage()}),self.nextBut.addEventListener("click",function(){self.nextPage().then(function(){}).catch(function(){})}),self.lastBut.addEventListener("click",function(){self.setPage(self.max)}),self.table.options.paginationElement&&(self.element=self.table.options.paginationElement),this.pageSizeSelect&&(pageSelectLabel=document.createElement("label"),self.table.modules.localize.bind("pagination|page_size",function(value){self.pageSizeSelect.setAttribute("aria-label",value),self.pageSizeSelect.setAttribute("title",value),pageSelectLabel.innerHTML=value}),self.element.appendChild(pageSelectLabel),self.element.appendChild(self.pageSizeSelect),self.pageSizeSelect.addEventListener("change",function(e){self.setPageSize(self.pageSizeSelect.value),self.setPage(1).then(function(){}).catch(function(){})})),self.element.appendChild(self.firstBut),self.element.appendChild(self.prevBut),self.element.appendChild(self.pagesElement),self.element.appendChild(self.nextBut),self.element.appendChild(self.lastBut),self.table.options.paginationElement||hidden||self.table.footerManager.append(self.element,self),self.mode=self.table.options.pagination,self.size=self.table.options.paginationSize||Math.floor(self.table.rowManager.getElement().clientHeight/24),self.count=self.table.options.paginationButtonCount,self.generatePageSizeSelectList()},Page.prototype.initializeProgressive=function(mode){this.initialize(!0),this.mode="progressive_"+mode,this.progressiveLoad=!0},Page.prototype.setDisplayIndex=function(index){this.displayIndex=index},Page.prototype.getDisplayIndex=function(){return this.displayIndex},Page.prototype.setMaxRows=function(rowCount){this.max=rowCount?Math.ceil(rowCount/this.size):1,this.page>this.max&&(this.page=this.max)},Page.prototype.reset=function(force){return"local"!=this.mode&&!force||(this.page=1),!0},Page.prototype.setMaxPage=function(max){max=parseInt(max),this.max=max||1,this.page>this.max&&(this.page=this.max,this.trigger())},Page.prototype.setPage=function(page){var _this48=this;return new Promise(function(resolve,reject){0<(page=parseInt(page))&&page<=_this48.max?(_this48.page=page,_this48.trigger().then(function(){resolve()}).catch(function(){reject()})):(console.warn("Pagination Error - Requested page is out of range of 1 - "+_this48.max+":",page),reject())})},Page.prototype.setPageToRow=function(row){var _this49=this;return new Promise(function(resolve,reject){var index=_this49.table.rowManager.getDisplayRows(_this49.displayIndex-1).indexOf(row);if(-1<index){var page=Math.ceil((index+1)/_this49.size);_this49.setPage(page).then(function(){resolve()}).catch(function(){reject()})}else console.warn("Pagination Error - Requested row is not visible"),reject()})},Page.prototype.setPageSize=function(size){0<(size=parseInt(size))&&(this.size=size),this.pageSizeSelect&&this.generatePageSizeSelectList()},Page.prototype._setPageButtons=function(){for(var leftSize=Math.floor((this.count-1)/2),rightSize=Math.ceil((this.count-1)/2),min=this.max-this.page+leftSize+1<this.count?this.max-this.count+1:Math.max(this.page-leftSize,1),max=this.page<=rightSize?Math.min(this.count,this.max):Math.min(this.page+rightSize,this.max);this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);1==this.page?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(var i=min;i<=max;i++)0<i&&i<=this.max&&this.pagesElement.appendChild(this._generatePageButton(i));this.footerRedraw()},Page.prototype._generatePageButton=function(page){var self=this,button=document.createElement("button");return button.classList.add("tabulator-page"),page==self.page&&button.classList.add("active"),button.setAttribute("type","button"),button.setAttribute("role","button"),button.setAttribute("aria-label","Show Page "+page),button.setAttribute("title","Show Page "+page),button.setAttribute("data-page",page),button.textContent=page,button.addEventListener("click",function(e){self.setPage(page)}),button},Page.prototype.previousPage=function(){var _this50=this;return new Promise(function(resolve,reject){1<_this50.page?(_this50.page--,_this50.trigger().then(function(){resolve()}).catch(function(){reject()})):(console.warn("Pagination Error - Previous page would be less than page 1:",0),reject())})},Page.prototype.nextPage=function(){var _this51=this;return new Promise(function(resolve,reject){_this51.page<_this51.max?(_this51.page++,_this51.trigger().then(function(){resolve()}).catch(function(){reject()})):(_this51.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+_this51.max+":",_this51.max+1),reject())})},Page.prototype.getPage=function(){return this.page},Page.prototype.getPageMax=function(){return this.max},Page.prototype.getPageSize=function(size){return this.size},Page.prototype.getMode=function(){return this.mode},Page.prototype.getRows=function(data){var output,start,end;if("local"!=this.mode)return this._setPageButtons(),data.slice(0);output=[],end=(start=this.size*(this.page-1))+parseInt(this.size),this._setPageButtons();for(var i=start;i<end;i++)data[i]&&output.push(data[i]);return output},Page.prototype.trigger=function(){var left,_this52=this;return new Promise(function(resolve,reject){switch(_this52.mode){case"local":left=_this52.table.rowManager.scrollLeft,_this52.table.rowManager.refreshActiveData("page"),_this52.table.rowManager.scrollHorizontal(left),_this52.table.options.pageLoaded.call(_this52.table,_this52.getPage()),resolve();break;case"remote":case"progressive_load":case"progressive_scroll":_this52.table.modules.ajax.blockActiveRequest(),_this52._getRemotePage().then(function(){resolve()}).catch(function(){reject()});break;default:console.warn("Pagination Error - no such pagination mode:",_this52.mode),reject()}})},Page.prototype._getRemotePage=function(){var oldParams,pageParams,_this53=this,self=this;return new Promise(function(resolve,reject){if(self.table.modExists("ajax",!0)||reject(),oldParams=Tabulator.prototype.helpers.deepClone(self.table.modules.ajax.getParams()||{}),(pageParams=self.table.modules.ajax.getParams())[_this53.paginationDataSentNames.page]=self.page,_this53.size&&(pageParams[_this53.paginationDataSentNames.size]=_this53.size),_this53.table.options.ajaxSorting&&_this53.table.modExists("sort")){var sorters=self.table.modules.sort.getSort();sorters.forEach(function(item){delete item.column}),pageParams[_this53.paginationDataSentNames.sorters]=sorters}if(_this53.table.options.ajaxFiltering&&_this53.table.modExists("filter")){var filters=self.table.modules.filter.getFilters(!0,!0);pageParams[_this53.paginationDataSentNames.filters]=filters}self.table.modules.ajax.setParams(pageParams),self.table.modules.ajax.sendRequest(_this53.progressiveLoad).then(function(data){self._parseRemoteData(data),resolve()}).catch(function(e){reject()}),self.table.modules.ajax.setParams(oldParams)})},Page.prototype._parseRemoteData=function(data){var left,margin,self=this;if(void 0===data[this.paginationDataReceivedNames.last_page]&&console.warn("Remote Pagination Error - Server response missing '"+this.paginationDataReceivedNames.last_page+"' property"),data[this.paginationDataReceivedNames.data])if(this.max=parseInt(data[this.paginationDataReceivedNames.last_page])||1,this.progressiveLoad)switch(this.mode){case"progressive_load":this.table.rowManager.addRows(data[this.paginationDataReceivedNames.data]),this.page<this.max&&setTimeout(function(){self.nextPage().then(function(){}).catch(function(){})},self.table.options.ajaxProgressiveLoadDelay);break;case"progressive_scroll":data=this.table.rowManager.getData().concat(data[this.paginationDataReceivedNames.data]),this.table.rowManager.setData(data,!0),margin=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.element.clientHeight,self.table.rowManager.element.scrollHeight<=self.table.rowManager.element.clientHeight+margin&&self.nextPage().then(function(){}).catch(function(){})}else left=this.table.rowManager.scrollLeft,this.table.rowManager.setData(data[this.paginationDataReceivedNames.data]),this.table.rowManager.scrollHorizontal(left),this.table.columnManager.scrollHorizontal(left),this.table.options.pageLoaded.call(this.table,this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+this.paginationDataReceivedNames.data+"' property")},Page.prototype.footerRedraw=function(){var footer=this.table.footerManager.element;Math.ceil(footer.clientWidth)-footer.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(footer.clientWidth)-footer.scrollWidth<0&&(this.pagesElement.style.display="none"))},Page.prototype.paginationDataSentNames={page:"page",size:"size",sorters:"sorters",filters:"filters"},Page.prototype.paginationDataReceivedNames={current_page:"current_page",last_page:"last_page",data:"data"},Tabulator.prototype.registerModule("page",Page);var Persistence=function(table){this.table=table,this.mode="",this.id="",this.persistProps=["field","width","visible"]};Persistence.prototype.localStorageTest=function(){var testKey="_tabulator_test";try{return window.localStorage.setItem(testKey,testKey),window.localStorage.removeItem(testKey),!0}catch(e){return!1}},Persistence.prototype.initialize=function(mode,id){this.mode=!0!==mode?mode:this.localStorageTest()?"local":"cookie",this.id="tabulator-"+(id||this.table.element.getAttribute("id")||"")},Persistence.prototype.load=function(type,current){var data=this.retreiveData(type);return current&&(data=data?this.mergeDefinition(current,data):current),data},Persistence.prototype.retreiveData=function(type){var data="",id=this.id+("columns"===type?"":"-"+type);switch(this.mode){case"local":data=localStorage.getItem(id);break;case"cookie":var cookie=document.cookie,cookiePos=cookie.indexOf(id+"="),end=void 0;-1<cookiePos&&(-1<(end=(cookie=cookie.substr(cookiePos)).indexOf(";"))&&(cookie=cookie.substr(0,end)),data=cookie.replace(id+"=",""));break;default:console.warn("Persistence Load Error - invalid mode selected",this.mode)}return!!data&&JSON.parse(data)},Persistence.prototype.mergeDefinition=function(oldCols,newCols){var self=this,output=[];return(newCols=newCols||[]).forEach(function(column,to){var from=self._findColumn(oldCols,column);from&&(from.width=column.width,from.visible=column.visible,from.columns&&(from.columns=self.mergeDefinition(from.columns,column.columns)),output.push(from))}),oldCols.forEach(function(column,i){self._findColumn(newCols,column)||(output.length>i?output.splice(i,0,column):output.push(column))}),output},Persistence.prototype._findColumn=function(columns,subject){var type=subject.columns?"group":subject.field?"field":"object";return columns.find(function(col){switch(type){case"group":return col.title===subject.title&&col.columns.length===subject.columns.length;case"field":return col.field===subject.field;case"object":return col===subject}})},Persistence.prototype.save=function(type){var data={};switch(type){case"columns":data=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":data=this.table.modules.filter.getFilters();break;case"sort":data=this.validateSorters(this.table.modules.sort.getSort())}var id=this.id+("columns"===type?"":"-"+type);this.saveData(id,data)},Persistence.prototype.validateSorters=function(data){return data.forEach(function(item){item.column=item.field,delete item.field}),data},Persistence.prototype.saveData=function(id,data){switch(data=JSON.stringify(data),this.mode){case"local":localStorage.setItem(id,data);break;case"cookie":var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1e4),document.cookie=id+"="+data+"; expires="+expireDate.toUTCString();break;default:console.warn("Persistence Save Error - invalid mode selected",this.mode)}},Persistence.prototype.parseColumns=function(columns){var self=this,definitions=[];return columns.forEach(function(column){var def={};column.isGroup?(def.title=column.getDefinition().title,def.columns=self.parseColumns(column.getColumns())):(def.title=column.getDefinition().title,def.field=column.getField(),def.width=column.getWidth(),def.visible=column.visible),definitions.push(def)}),definitions},Tabulator.prototype.registerModule("persistence",Persistence);var Print=function(table){this.table=table,this.element=!1,this.manualBlock=!1};Print.prototype.initialize=function(){window.addEventListener("beforeprint",this.replaceTable.bind(this)),window.addEventListener("afterprint",this.cleanup.bind(this))},Print.prototype.replaceTable=function(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.htmlTableExport.genereateTable(this.table.options.printConfig,this.table.options.printCopyStyle,this.table.options.printVisibleRows,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))},Print.prototype.cleanup=function(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")},Print.prototype.printFullscreen=function(visible,style,config){var headerContent,footerContent,scrollX=window.scrollX,scrollY=window.scrollY,headerEl=document.createElement("div"),footerEl=document.createElement("div"),tableEl=this.table.modules.htmlTableExport.genereateTable(void 0!==config?config:this.table.options.printConfig,void 0!==style?style:this.table.options.printCopyStyle,visible,"print");this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(headerEl.classList.add("tabulator-print-header"),"string"==typeof(headerContent="function"==typeof this.table.options.printHeader?this.table.options.printHeader.call(this.table):this.table.options.printHeader)?headerEl.innerHTML=headerContent:headerEl.appendChild(headerContent),this.element.appendChild(headerEl)),this.element.appendChild(tableEl),this.table.options.printFooter&&(footerEl.classList.add("tabulator-print-footer"),"string"==typeof(footerContent="function"==typeof this.table.options.printFooter?this.table.options.printFooter.call(this.table):this.table.options.printFooter)?footerEl.innerHTML=footerContent:footerEl.appendChild(footerContent),this.element.appendChild(footerEl)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,tableEl),window.print(),this.cleanup(),window.scrollTo(scrollX,scrollY),this.manualBlock=!1},Tabulator.prototype.registerModule("print",Print);var ReactiveData=function(table){this.table=table,this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0};ReactiveData.prototype.watchData=function(data){var version,self=this;this.currentVersion++,version=this.currentVersion,self.unwatchData(),self.data=data,self.origFuncs.push=data.push,Object.defineProperty(self.data,"push",{enumerable:!1,configurable:!0,value:function(){var args=Array.from(arguments);return self.blocked||version!==self.currentVersion||args.forEach(function(arg){self.table.rowManager.addRowActual(arg,!1)}),self.origFuncs.push.apply(data,arguments)}}),self.origFuncs.unshift=data.unshift,Object.defineProperty(self.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var args=Array.from(arguments);return self.blocked||version!==self.currentVersion||args.forEach(function(arg){self.table.rowManager.addRowActual(arg,!0)}),self.origFuncs.unshift.apply(data,arguments)}}),self.origFuncs.shift=data.shift,Object.defineProperty(self.data,"shift",{enumerable:!1,configurable:!0,value:function(){var row;return self.blocked||version!==self.currentVersion||self.data.length&&(row=self.table.rowManager.getRowFromDataObject(self.data[0]))&&row.deleteActual(),self.origFuncs.shift.call(data)}}),self.origFuncs.pop=data.pop,Object.defineProperty(self.data,"pop",{enumerable:!1,configurable:!0,value:function(){var row;return self.blocked||version!==self.currentVersion||self.data.length&&(row=self.table.rowManager.getRowFromDataObject(self.data[self.data.length-1]))&&row.deleteActual(),self.origFuncs.pop.call(data)}}),self.origFuncs.splice=data.splice,Object.defineProperty(self.data,"splice",{enumerable:!1,configurable:!0,value:function(){var startRow,args=Array.from(arguments),start=args[0]<0?data.length+args[0]:args[0],end=args[1],newRows=!!args[2]&&args.slice(2);if(!self.blocked&&version===self.currentVersion){if(newRows&&((startRow=!!data[start]&&self.table.rowManager.getRowFromDataObject(data[start]))?newRows.forEach(function(rowData){self.table.rowManager.addRowActual(rowData,!0,startRow,!0)}):(newRows=newRows.slice().reverse()).forEach(function(rowData){self.table.rowManager.addRowActual(rowData,!0,!1,!0)})),0!==end){var oldRows=data.slice(start,void 0===args[1]?args[1]:start+end);oldRows.forEach(function(rowData,i){var row=self.table.rowManager.getRowFromDataObject(rowData);row&&row.deleteActual(i!==oldRows.length-1)})}!newRows&&0===end||self.table.rowManager.reRenderInPosition()}return self.origFuncs.splice.apply(data,arguments)}})},ReactiveData.prototype.unwatchData=function(){if(!1!==this.data)for(var key in this.origFuncs)Object.defineProperty(this.data,key,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})},ReactiveData.prototype.watchRow=function(row){var data=row.getData();for(var key in this.blocked=!0,data)this.watchKey(row,data,key);this.blocked=!1},ReactiveData.prototype.watchKey=function(row,data,key){var self=this,props=Object.getOwnPropertyDescriptor(data,key),value=data[key],version=this.currentVersion;Object.defineProperty(data,key,{set:function(newValue){if(value=newValue,!self.blocked&&version===self.currentVersion){var update={};update[key]=newValue,row.updateData(update)}props.set&&props.set(newValue)},get:function(){return props.get&&props.get(),value}})},ReactiveData.prototype.unwatchRow=function(row){var data=row.getData();for(var key in data)Object.defineProperty(data,key,{value:data[key]})},ReactiveData.prototype.block=function(){this.blocked=!0},ReactiveData.prototype.unblock=function(){this.blocked=!1},Tabulator.prototype.registerModule("reactiveData",ReactiveData);var ResizeColumns=function(table){this.table=table,this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.handle=null,this.prevHandle=null};ResizeColumns.prototype.initializeColumn=function(type,column,element){var self=this,variableHeight=!1,mode=this.table.options.resizableColumns;if("header"===type&&(variableHeight="textarea"==column.definition.formatter||column.definition.variableHeight,column.modules.resize={variableHeight:variableHeight}),!0===mode||mode==type){var handle=document.createElement("div");handle.className="tabulator-col-resize-handle";var prevHandle=document.createElement("div");prevHandle.className="tabulator-col-resize-handle prev",handle.addEventListener("click",function(e){e.stopPropagation()});var handleDown=function(e){var nearestColumn=column.getLastColumn();nearestColumn&&self._checkResizability(nearestColumn)&&(self.startColumn=column,self._mouseDown(e,nearestColumn,handle))};handle.addEventListener("mousedown",handleDown),handle.addEventListener("touchstart",handleDown,{passive:!0}),handle.addEventListener("dblclick",function(e){var col=column.getLastColumn();col&&self._checkResizability(col)&&col.reinitializeWidth(!0)}),prevHandle.addEventListener("click",function(e){e.stopPropagation()});var prevHandleDown=function(e){var nearestColumn,colIndex,prevColumn;(nearestColumn=column.getFirstColumn())&&(prevColumn=0<(colIndex=self.table.columnManager.findColumnIndex(nearestColumn))&&self.table.columnManager.getColumnByIndex(colIndex-1))&&self._checkResizability(prevColumn)&&(self.startColumn=column,self._mouseDown(e,prevColumn,prevHandle))};prevHandle.addEventListener("mousedown",prevHandleDown),prevHandle.addEventListener("touchstart",prevHandleDown,{passive:!0}),prevHandle.addEventListener("dblclick",function(e){var nearestColumn,colIndex,prevColumn;(nearestColumn=column.getFirstColumn())&&(prevColumn=0<(colIndex=self.table.columnManager.findColumnIndex(nearestColumn))&&self.table.columnManager.getColumnByIndex(colIndex-1))&&self._checkResizability(prevColumn)&&prevColumn.reinitializeWidth(!0)}),element.appendChild(handle),element.appendChild(prevHandle)}},ResizeColumns.prototype._checkResizability=function(column){return void 0!==column.definition.resizable?column.definition.resizable:this.table.options.resizableColumns},ResizeColumns.prototype._mouseDown=function(e,column,handle){var self=this;function mouseMove(e){column.setWidth(self.startWidth+((void 0===e.screenX?e.touches[0].screenX:e.screenX)-self.startX)),!self.table.browserSlow&&column.modules.resize&&column.modules.resize.variableHeight&&column.checkCellHeights()}function mouseUp(e){self.startColumn.modules.edit&&(self.startColumn.modules.edit.blocked=!1),self.table.browserSlow&&column.modules.resize&&column.modules.resize.variableHeight&&column.checkCellHeights(),document.body.removeEventListener("mouseup",mouseUp),document.body.removeEventListener("mousemove",mouseMove),handle.removeEventListener("touchmove",mouseMove),handle.removeEventListener("touchend",mouseUp),self.table.element.classList.remove("tabulator-block-select"),self.table.options.persistentLayout&&self.table.modExists("persistence",!0)&&self.table.modules.persistence.save("columns"),self.table.options.columnResized.call(self.table,column.getComponent())}self.table.element.classList.add("tabulator-block-select"),e.stopPropagation(),self.startColumn.modules.edit&&(self.startColumn.modules.edit.blocked=!0),self.startX=void 0===e.screenX?e.touches[0].screenX:e.screenX,self.startWidth=column.getWidth(),document.body.addEventListener("mousemove",mouseMove),document.body.addEventListener("mouseup",mouseUp),handle.addEventListener("touchmove",mouseMove,{passive:!0}),handle.addEventListener("touchend",mouseUp)},Tabulator.prototype.registerModule("resizeColumns",ResizeColumns);var ResizeRows=function(table){this.table=table,this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null};ResizeRows.prototype.initializeRow=function(row){var self=this,rowEl=row.getElement(),handle=document.createElement("div");handle.className="tabulator-row-resize-handle";var prevHandle=document.createElement("div");prevHandle.className="tabulator-row-resize-handle prev",handle.addEventListener("click",function(e){e.stopPropagation()});var handleDown=function(e){self.startRow=row,self._mouseDown(e,row,handle)};handle.addEventListener("mousedown",handleDown,{passive:!0}),handle.addEventListener("touchstart",handleDown),prevHandle.addEventListener("click",function(e){e.stopPropagation()});var prevHandleDown=function(e){var prevRow=self.table.rowManager.prevDisplayRow(row);prevRow&&(self.startRow=prevRow,self._mouseDown(e,prevRow,prevHandle))};prevHandle.addEventListener("mousedown",prevHandleDown),prevHandle.addEventListener("touchstart",prevHandleDown,{passive:!0}),rowEl.appendChild(handle),rowEl.appendChild(prevHandle)},ResizeRows.prototype._mouseDown=function(e,row,handle){var self=this;function mouseMove(e){row.setHeight(self.startHeight+((void 0===e.screenY?e.touches[0].screenY:e.screenY)-self.startY))}function mouseUp(e){document.body.removeEventListener("mouseup",mouseMove),document.body.removeEventListener("mousemove",mouseMove),handle.removeEventListener("touchmove",mouseMove),handle.removeEventListener("touchend",mouseUp),self.table.element.classList.remove("tabulator-block-select"),self.table.options.rowResized.call(this.table,row.getComponent())}self.table.element.classList.add("tabulator-block-select"),e.stopPropagation(),self.startY=void 0===e.screenY?e.touches[0].screenY:e.screenY,self.startHeight=row.getHeight(),document.body.addEventListener("mousemove",mouseMove),document.body.addEventListener("mouseup",mouseUp),handle.addEventListener("touchmove",mouseMove,{passive:!0}),handle.addEventListener("touchend",mouseUp)},Tabulator.prototype.registerModule("resizeRows",ResizeRows);var ResizeTable=function(table){this.table=table,this.binding=!1,this.observer=!1};ResizeTable.prototype.initialize=function(row){var table=this.table;"undefined"!=typeof ResizeObserver&&"virtual"===table.rowManager.getRenderMode()?(this.observer=new ResizeObserver(function(entry){table.redraw()}),this.observer.observe(table.element)):(this.binding=function(){table.redraw()},window.addEventListener("resize",this.binding))},ResizeTable.prototype.clearBindings=function(row){this.binding&&window.removeEventListener("resize",this.binding),this.observer&&this.observer.unobserve(this.table.element)},Tabulator.prototype.registerModule("resizeTable",ResizeTable);var ResponsiveLayout=function(table){this.table=table,this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0};ResponsiveLayout.prototype.initialize=function(){var self=this,columns=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach(function(column,i){column.modules.responsive&&column.modules.responsive.order&&column.modules.responsive.visible&&(column.modules.responsive.index=i,columns.push(column),column.visible||"collapse"!==self.mode||self.hiddenColumns.push(column))}),columns=(columns=columns.reverse()).sort(function(a,b){return b.modules.responsive.order-a.modules.responsive.order||b.modules.responsive.index-a.modules.responsive.index}),this.columns=columns,"collapse"===this.mode&&this.generateCollapsedContent()},ResponsiveLayout.prototype.initializeColumn=function(column){var def=column.getDefinition();column.modules.responsive={order:void 0===def.responsive?1:def.responsive,visible:!1!==def.visible}},ResponsiveLayout.prototype.layoutRow=function(row){var rowEl=row.getElement(),el=document.createElement("div");el.classList.add("tabulator-responsive-collapse"),rowEl.classList.contains("tabulator-calcs")||(row.modules.responsiveLayout={element:el},this.collapseStartOpen||(el.style.display="none"),rowEl.appendChild(el),this.generateCollapsedRowContent(row))},ResponsiveLayout.prototype.updateColumnVisibility=function(column,visible){column.modules.responsive&&(column.modules.responsive.visible=visible,this.initialize())},ResponsiveLayout.prototype.hideColumn=function(column){column.hide(!1,!0),"collapse"===this.mode&&(this.hiddenColumns.unshift(column),this.generateCollapsedContent())},ResponsiveLayout.prototype.showColumn=function(column){var index;column.show(!1,!0),column.setWidth(column.getWidth()),"collapse"===this.mode&&(-1<(index=this.hiddenColumns.indexOf(column))&&this.hiddenColumns.splice(index,1),this.generateCollapsedContent())},ResponsiveLayout.prototype.update=function(){for(var working=!0;working;){var width="fitColumns"==this.table.modules.layout.getMode()?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),diff=this.table.columnManager.element.clientWidth-width;if(diff<0){var column=this.columns[this.index];column?(this.hideColumn(column),this.index++):working=!1}else{var _column=this.columns[this.index-1];_column&&0<diff&&diff>=_column.getWidth()?(this.showColumn(_column),this.index--):working=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}},ResponsiveLayout.prototype.generateCollapsedContent=function(){var self=this;this.table.rowManager.getDisplayRows().forEach(function(row){self.generateCollapsedRowContent(row)})},ResponsiveLayout.prototype.generateCollapsedRowContent=function(row){var el,contents;if(row.modules.responsiveLayout){for(el=row.modules.responsiveLayout.element;el.firstChild;)el.removeChild(el.firstChild);(contents=this.collapseFormatter(this.generateCollapsedRowData(row)))&&el.appendChild(contents)}},ResponsiveLayout.prototype.generateCollapsedRowData=function(row){var mockCellComponent,self=this,data=row.getData(),output=[];return this.hiddenColumns.forEach(function(column){var value=column.getFieldValue(data);column.definition.title&&column.field&&(column.modules.format&&self.table.options.responsiveLayoutCollapseUseFormatters?(mockCellComponent={value:!1,data:{},getValue:function(){return value},getData:function(){return data},getElement:function(){return document.createElement("div")},getRow:function(){return row.getComponent()},getColumn:function(){return column.getComponent()}},output.push({title:column.definition.title,value:column.modules.format.formatter.call(self.table.modules.format,mockCellComponent,column.modules.format.params)})):output.push({title:column.definition.title,value:value}))}),output},ResponsiveLayout.prototype.formatCollapsedData=function(data){var list=document.createElement("table"),listContents="";return data.forEach(function(item){var div=document.createElement("div");item.value instanceof Node&&(div.appendChild(item.value),item.value=div.innerHTML),listContents+="<tr><td><strong>"+item.title+"</strong></td><td>"+item.value+"</td></tr>"}),list.innerHTML=listContents,Object.keys(data).length?list:""},Tabulator.prototype.registerModule("responsiveLayout",ResponsiveLayout);var SelectRow=function(table){this.table=table,this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null};SelectRow.prototype.clearSelectionData=function(silent){this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],silent||this._rowSelectionChanged()},SelectRow.prototype.initializeRow=function(row){function endSelect(){setTimeout(function(){self.selecting=!1},50),document.body.removeEventListener("mouseup",endSelect)}var self=this,element=row.getElement();row.modules.select={selected:!1},self.table.options.selectableCheck.call(this.table,row.getComponent())?(element.classList.add("tabulator-selectable"),element.classList.remove("tabulator-unselectable"),self.table.options.selectable&&"highlight"!=self.table.options.selectable&&("click"===self.table.options.selectableRangeMode?element.addEventListener("click",function(e){if(self.table._clearSelection(),e.shiftKey){self.lastClickedRow=self.lastClickedRow||row;var lastClickedRowIdx=self.table.rowManager.getDisplayRowIndex(self.lastClickedRow),rowIdx=self.table.rowManager.getDisplayRowIndex(row),fromRowIdx=lastClickedRowIdx<=rowIdx?lastClickedRowIdx:rowIdx,toRowIdx=rowIdx<=lastClickedRowIdx?lastClickedRowIdx:rowIdx,toggledRows=self.table.rowManager.getDisplayRows().slice(0).splice(fromRowIdx,toRowIdx-fromRowIdx+1);e.ctrlKey||e.metaKey?(toggledRows.forEach(function(toggledRow){toggledRow!==self.lastClickedRow&&(!0===self.table.options.selectable||self.isRowSelected(row)?self.toggleRow(toggledRow):self.selectedRows.length<self.table.options.selectable&&self.toggleRow(toggledRow))}),self.lastClickedRow=row):(self.deselectRows(),!0!==self.table.options.selectable&&toggledRows.length>self.table.options.selectable&&(toggledRows=toggledRows.slice(0,self.table.options.selectable)),self.selectRows(toggledRows))}else e.ctrlKey||e.metaKey?self.toggleRow(row):(self.deselectRows(),self.selectRows(row)),self.lastClickedRow=row;self.table._clearSelection()}):(element.addEventListener("click",function(e){self.table._clearSelection(),self.selecting||self.toggleRow(row)}),element.addEventListener("mousedown",function(e){if(e.shiftKey)return self.table._clearSelection(),self.selecting=!0,self.selectPrev=[],document.body.addEventListener("mouseup",endSelect),document.body.addEventListener("keyup",endSelect),self.toggleRow(row),!1}),element.addEventListener("mouseenter",function(e){self.selecting&&(self.table._clearSelection(),self.toggleRow(row),self.selectPrev[1]==row&&self.toggleRow(self.selectPrev[0]))}),element.addEventListener("mouseout",function(e){self.selecting&&(self.table._clearSelection(),self.selectPrev.unshift(row))})))):(element.classList.add("tabulator-unselectable"),element.classList.remove("tabulator-selectable"))},SelectRow.prototype.toggleRow=function(row){this.table.options.selectableCheck.call(this.table,row.getComponent())&&(row.modules.select&&row.modules.select.selected?this._deselectRow(row):this._selectRow(row))},SelectRow.prototype.selectRows=function(rows){var self=this;switch(void 0===rows?"undefined":_typeof(rows)){case"undefined":self.table.rowManager.rows.forEach(function(row){self._selectRow(row,!0,!0)}),self._rowSelectionChanged();break;case"boolean":!0===rows&&(self.table.rowManager.activeRows.forEach(function(row){self._selectRow(row,!0,!0)}),self._rowSelectionChanged());break;default:Array.isArray(rows)?(rows.forEach(function(row){self._selectRow(row,!0,!0)}),self._rowSelectionChanged()):self._selectRow(rows,!1,!0)}},SelectRow.prototype._selectRow=function(rowInfo,silent,force){if(!isNaN(this.table.options.selectable)&&!0!==this.table.options.selectable&&!force&&this.selectedRows.length>=this.table.options.selectable){if(!this.table.options.selectableRollingSelection)return!1;this._deselectRow(this.selectedRows[0])}var row=this.table.rowManager.findRow(rowInfo);row?-1==this.selectedRows.indexOf(row)&&(row.modules.select||(row.modules.select={}),row.modules.select.selected=!0,row.modules.select.checkboxEl&&(row.modules.select.checkboxEl.checked=!0),row.getElement().classList.add("tabulator-selected"),this.selectedRows.push(row),silent||(this.table.options.rowSelected.call(this.table,row.getComponent()),this._rowSelectionChanged())):silent||console.warn("Selection Error - No such row found, ignoring selection:"+rowInfo)},SelectRow.prototype.isRowSelected=function(row){return-1!==this.selectedRows.indexOf(row)},SelectRow.prototype.deselectRows=function(rows){var rowCount,self=this;if(void 0===rows){rowCount=self.selectedRows.length;for(var i=0;i<rowCount;i++)self._deselectRow(self.selectedRows[0],!0);self._rowSelectionChanged()}else Array.isArray(rows)?(rows.forEach(function(row){self._deselectRow(row,!0)}),self._rowSelectionChanged()):self._deselectRow(rows)},SelectRow.prototype._deselectRow=function(rowInfo,silent){var index,row=this.table.rowManager.findRow(rowInfo);row?-1<(index=this.selectedRows.findIndex(function(selectedRow){return selectedRow==row}))&&(row.modules.select||(row.modules.select={}),row.modules.select.selected=!1,row.modules.select.checkboxEl&&(row.modules.select.checkboxEl.checked=!1),row.getElement().classList.remove("tabulator-selected"),this.selectedRows.splice(index,1),silent||(this.table.options.rowDeselected.call(this.table,row.getComponent()),this._rowSelectionChanged())):silent||console.warn("Deselection Error - No such row found, ignoring selection:"+rowInfo)},SelectRow.prototype.getSelectedData=function(){var data=[];return this.selectedRows.forEach(function(row){data.push(row.getData())}),data},SelectRow.prototype.getSelectedRows=function(){var rows=[];return this.selectedRows.forEach(function(row){rows.push(row.getComponent())}),rows},SelectRow.prototype._rowSelectionChanged=function(){this.headerCheckboxElement&&(0===this.selectedRows.length?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),this.table.options.rowSelectionChanged.call(this.table,this.getSelectedData(),this.getSelectedRows())},SelectRow.prototype.registerRowSelectCheckbox=function(row,element){row._row.modules.select||(row._row.modules.select={}),row._row.modules.select.checkboxEl=element},SelectRow.prototype.registerHeaderSelectCheckbox=function(element){this.headerCheckboxElement=element},Tabulator.prototype.registerModule("selectRow",SelectRow);var Sort=function(table){this.table=table,this.sortList=[],this.changed=!1};Sort.prototype.initializeColumn=function(column,content){var colEl,arrowEl,self=this,sorter=!1;switch(_typeof(column.definition.sorter)){case"string":self.sorters[column.definition.sorter]?sorter=self.sorters[column.definition.sorter]:console.warn("Sort Error - No such sorter found: ",column.definition.sorter);break;case"function":sorter=column.definition.sorter}column.modules.sort={sorter:sorter,dir:"none",params:column.definition.sorterParams||{},startingDir:column.definition.headerSortStartingDir||"asc",tristate:void 0!==column.definition.headerSortTristate?column.definition.headerSortTristate:this.table.options.headerSortTristate},(void 0===column.definition.headerSort?!1!==this.table.options.headerSort:!1!==column.definition.headerSort)&&((colEl=column.getElement()).classList.add("tabulator-sortable"),(arrowEl=document.createElement("div")).classList.add("tabulator-arrow"),content.appendChild(arrowEl),colEl.addEventListener("click",function(e){var dir="",sorters=[],match=!1;if(column.modules.sort){if(column.modules.sort.tristate)dir="none"==column.modules.sort.dir?column.modules.sort.startingDir:column.modules.sort.dir==column.modules.sort.startingDir?"asc"==column.modules.sort.dir?"desc":"asc":"none";else switch(column.modules.sort.dir){case"asc":dir="desc";break;case"desc":dir="asc";break;default:dir=column.modules.sort.startingDir}self.table.options.columnHeaderSortMulti&&(e.shiftKey||e.ctrlKey)?(-1<(match=(sorters=self.getSort()).findIndex(function(sorter){return sorter.field===column.getField()}))?(sorters[match].dir=dir,match!=sorters.length-1&&(match=sorters.splice(match,1)[0],"none"!=dir&&sorters.push(match))):"none"!=dir&&sorters.push({column:column,dir:dir}),self.setSort(sorters)):"none"==dir?self.clear():self.setSort(column,dir),self.table.rowManager.sorterRefresh(!self.sortList.length)}}))},Sort.prototype.hasChanged=function(){var changed=this.changed;return this.changed=!1,changed},Sort.prototype.getSort=function(){var sorters=[];return this.sortList.forEach(function(item){item.column&&sorters.push({column:item.column.getComponent(),field:item.column.getField(),dir:item.dir})}),sorters},Sort.prototype.setSort=function(sortList,dir){var self=this,newSortList=[];Array.isArray(sortList)||(sortList=[{column:sortList,dir:dir}]),sortList.forEach(function(item){var column;(column=self.table.columnManager.findColumn(item.column))?(item.column=column,newSortList.push(item),self.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",item.column)}),self.sortList=newSortList,this.table.options.persistentSort&&this.table.modExists("persistence",!0)&&this.table.modules.persistence.save("sort")},Sort.prototype.clear=function(){this.setSort([])},Sort.prototype.findSorter=function(column){var value,row=this.table.rowManager.activeRows[0],sorter="string";if(row&&(row=row.getData(),column.getField()))switch(void 0===(value=column.getFieldValue(row))?"undefined":_typeof(value)){case"undefined":sorter="string";break;case"boolean":sorter="boolean";break;default:isNaN(value)||""===value?value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(sorter="alphanum"):sorter="number"}return this.sorters[sorter]},Sort.prototype.sort=function(data){var sortList,self=this;sortList=this.table.options.sortOrderReverse?self.sortList.slice().reverse():self.sortList,self.table.options.dataSorting&&self.table.options.dataSorting.call(self.table,self.getSort()),self.clearColumnHeaders(),self.table.options.ajaxSorting?sortList.forEach(function(item,i){self.setColumnHeader(item.column,item.dir)}):sortList.forEach(function(item,i){item.column&&item.column.modules.sort&&(item.column.modules.sort.sorter||(item.column.modules.sort.sorter=self.findSorter(item.column)),self._sortItem(data,item.column,item.dir,sortList,i)),self.setColumnHeader(item.column,item.dir)}),self.table.options.dataSorted&&self.table.options.dataSorted.call(self.table,self.getSort(),self.table.rowManager.getComponents(!0))},Sort.prototype.clearColumnHeaders=function(){this.table.columnManager.getRealColumns().forEach(function(column){column.modules.sort&&(column.modules.sort.dir="none",column.getElement().setAttribute("aria-sort","none"))})},Sort.prototype.setColumnHeader=function(column,dir){column.modules.sort.dir=dir,column.getElement().setAttribute("aria-sort",dir)},Sort.prototype._sortItem=function(data,column,dir,sortList,i){var self=this,params="function"==typeof column.modules.sort.params?column.modules.sort.params(column.getComponent(),dir):column.modules.sort.params;data.sort(function(a,b){var result=self._sortRow(a,b,column,dir,params);if(0===result&&i)for(var j=i-1;0<=j&&0===(result=self._sortRow(a,b,sortList[j].column,sortList[j].dir,params));j--);return result})},Sort.prototype._sortRow=function(a,b,column,dir,params){var el1Comp,el2Comp,el1="asc"==dir?a:b,el2="asc"==dir?b:a;return a=void 0!==(a=column.getFieldValue(el1.getData()))?a:"",b=void 0!==(b=column.getFieldValue(el2.getData()))?b:"",el1Comp=el1.getComponent(),el2Comp=el2.getComponent(),column.modules.sort.sorter.call(this,a,b,el1Comp,el2Comp,column.getComponent(),dir,params)},Sort.prototype.sorters={number:function(a,b,aRow,bRow,column,dir,params){var alignEmptyValues=params.alignEmptyValues,decimal=params.decimalSeparator||".",thousand=params.thousandSeparator||",",emptyAlign=0;if(a=parseFloat(String(a).split(thousand).join("").split(decimal).join(".")),b=parseFloat(String(b).split(thousand).join("").split(decimal).join(".")),isNaN(a))emptyAlign=isNaN(b)?0:-1;else{if(!isNaN(b))return a-b;emptyAlign=1}return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign},string:function(a,b,aRow,bRow,column,dir,params){var locale,alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(a){if(b){switch(_typeof(params.locale)){case"boolean":params.locale&&(locale=this.table.modules.localize.getLocale());break;case"string":locale=params.locale}return String(a).toLowerCase().localeCompare(String(b).toLowerCase(),locale)}emptyAlign=1}else emptyAlign=b?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign},date:function(a,b,aRow,bRow,column,dir,params){return params.format||(params.format="DD/MM/YYYY"),this.sorters.datetime.call(this,a,b,aRow,bRow,column,dir,params)},time:function(a,b,aRow,bRow,column,dir,params){return params.format||(params.format="hh:mm"),this.sorters.datetime.call(this,a,b,aRow,bRow,column,dir,params)},datetime:function(a,b,aRow,bRow,column,dir,params){var format=params.format||"DD/MM/YYYY hh:mm:ss",alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if("undefined"!=typeof moment){if(a=moment(a,format),b=moment(b,format),a.isValid()){if(b.isValid())return a-b;emptyAlign=1}else emptyAlign=b.isValid()?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}console.error("Sort Error - 'datetime' sorter is dependant on moment.js")},boolean:function(a,b,aRow,bRow,column,dir,params){return(!0===a||"true"===a||"True"===a||1===a?1:0)-(!0===b||"true"===b||"True"===b||1===b?1:0)},array:function(a,b,aRow,bRow,column,dir,params){var type=params.type||"length",alignEmptyValues=params.alignEmptyValues,emptyAlign=0;function calc(value){switch(type){case"length":return value.length;case"sum":return value.reduce(function(c,d){return c+d});case"max":return Math.max.apply(null,value);case"min":return Math.min.apply(null,value);case"avg":return value.reduce(function(c,d){return c+d})/value.length}}if(Array.isArray(a)){if(Array.isArray(b))return(a?calc(a):0)-(b?calc(b):0);alignEmptyValues=1}else alignEmptyValues=Array.isArray(b)?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign},exists:function(a,b,aRow,bRow,column,dir,params){return(void 0===a?0:1)-(void 0===b?0:1)},alphanum:function(as,bs,aRow,bRow,column,dir,params){var a,b,a1,b1,L,i=0,rx=/(\d+)|(\D+)/g,rd=/\d/,alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(as||0===as){if(bs||0===bs){if(isFinite(as)&&isFinite(bs))return as-bs;if((a=String(as).toLowerCase())===(b=String(bs).toLowerCase()))return 0;if(!rd.test(a)||!rd.test(b))return b<a?1:-1;for(a=a.match(rx),b=b.match(rx),L=a.length>b.length?b.length:a.length;i<L;)if((a1=a[i])!==(b1=b[i++]))return isFinite(a1)&&isFinite(b1)?("0"===a1.charAt(0)&&(a1="."+a1),"0"===b1.charAt(0)&&(b1="."+b1),a1-b1):b1<a1?1:-1;return a.length>b.length}emptyAlign=1}else emptyAlign=bs||0===bs?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}},Tabulator.prototype.registerModule("sort",Sort);var Validate=function(table){this.table=table};return Validate.prototype.initializeColumn=function(column){var validator,self=this,config=[];column.definition.validator&&(Array.isArray(column.definition.validator)?column.definition.validator.forEach(function(item){(validator=self._extractValidator(item))&&config.push(validator)}):(validator=this._extractValidator(column.definition.validator))&&config.push(validator),column.modules.validate=!!config.length&&config)},Validate.prototype._extractValidator=function(value){var parts,type,params;switch(void 0===value?"undefined":_typeof(value)){case"string":return type=(parts=value.split(":",2)).shift(),params=parts[0],this._buildValidator(type,params);case"function":return this._buildValidator(value);case"object":return this._buildValidator(value.type,value.parameters)}},Validate.prototype._buildValidator=function(type,params){var func="function"==typeof type?type:this.validators[type];return func?{type:"function"==typeof type?"function":type,func:func,params:params}:(console.warn("Validator Setup Error - No matching validator found:",type),!1)},Validate.prototype.validate=function(validators,cell,value){var self=this,valid=[];return validators&&validators.forEach(function(item){item.func.call(self,cell,value,item.params)||valid.push({type:item.type,parameters:item.params})}),!valid.length||valid},Validate.prototype.validators={integer:function(cell,value,parameters){return""===value||null==value||"number"==typeof(value=Number(value))&&isFinite(value)&&Math.floor(value)===value},float:function(cell,value,parameters){return""===value||null==value||"number"==typeof(value=Number(value))&&isFinite(value)&&value%1!=0},numeric:function(cell,value,parameters){return""===value||null==value||!isNaN(value)},string:function(cell,value,parameters){return""===value||null==value||isNaN(value)},max:function(cell,value,parameters){return""===value||null==value||parseFloat(value)<=parameters},min:function(cell,value,parameters){return""===value||null==value||parseFloat(value)>=parameters},minLength:function(cell,value,parameters){return""===value||null==value||String(value).length>=parameters},maxLength:function(cell,value,parameters){return""===value||null==value||String(value).length<=parameters},in:function(cell,value,parameters){return""===value||null==value||("string"==typeof parameters&&(parameters=parameters.split("|")),""===value||-1<parameters.indexOf(value))},regex:function(cell,value,parameters){return""===value||null==value||new RegExp(parameters).test(value)},unique:function(cell,value,parameters){if(""===value||null==value)return!0;var unique=!0,cellData=cell.getData(),column=cell.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(row){var data=row.getData();data!==cellData&&value==column.getFieldValue(data)&&(unique=!1)}),unique},required:function(cell,value,parameters){return""!==value&&null!=value}},Tabulator.prototype.registerModule("validate",Validate),Tabulator}),$(document).ready(function(){permissions.modify_diagram&&($("#propName").prop("disabled",!1),$("#newObjectButton").prop("disabled",!1).click(newObject),$("#propFillColor").prop("disabled",!1),$("#propStrokeColor").prop("disabled",!1),$("#lockObject").prop("disabled",!1),$("#moveUp").prop("disabled",!1).click(moveUp),$("#moveDown").prop("disabled",!1).click(moveDown),$("#moveToFront").prop("disabled",!1).click(moveToFront),$("#moveToBack").prop("disabled",!1).click(moveToBack),$("#objectWidth").prop("disabled",!1),$("#objectHeight").prop("disabled",!1),$("#insertObjectButton").prop("disabled",!1).click(insertObject),$("#deleteObjectButton").prop("disabled",!1).click(deleteObjectConfirm)),permissions.modify_notes&&$("#newNoteButton").prop("disabled",!1),$("#propName").change(function(){updatePropName(this.value)}),$("#lockObject").change(function(){toggleObjectLock($("#lockObject").is(":checked"))}),$("#objectWidth").change(function(){setObjectSize()}),$("#objectHeight").change(function(){setObjectSize()}),$("#closeToolbarButton").click(closeToolbar),$("#cancelLinkButton").click(cancelLink),$("#editDetailsButton").click(function(){editDetails()}),$("#newNoteButton").click(function(){newNote()}),$("#toolsTab").click(function(){toggleToolbar("tools")}),$("#notesTab").click(function(){toggleToolbar("notes")}),$("#filesTab").click(function(){toggleToolbar("files")})});
